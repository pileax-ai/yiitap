import et from"./vendor-katex-C66qTcOd.js";import{aw as _t}from"./vendor-BQXXivym.js";import{D as ne,S as tt,f as Rt,c as be,N as Z,T as Nt,P as S,a as $,b as D,R as Ot,l as Ht,d as Bt,e as _,g as zt,h as jt,F as W,j as Dt,i as Ft,k as Wt,m as Kt,n as nt,o as Ut,p as Vt,q as qt,r as Gt,s as Jt,t as Xt,A as Zt,u as Qt,v as Yt,w as en,x as tn,y as nn,z as Ne,B as rn,C as re,E as sn,G as on,H as an,I as ln,J as cn,K as dn,L as un,M as oe,O as Me,Q as pn,U as fn,V as hn,W as mn}from"./vendor-prosemirror-Bw4OSzyh.js";import{f as rt,r as Oe,t as kn,a as gn}from"./vendor-collab-zeKlvpyG.js";var yn=Object.defineProperty,we=(e,t)=>{for(var n in t)yn(e,n,{get:t[n],enumerable:!0})};function st(e){const{state:t,transaction:n}=e;let{selection:r}=n,{doc:s}=n,{storedMarks:o}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,o=n.storedMarks,n}}}var vn=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:r}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([i,a])=>[i,(...c)=>{const u=a(...c)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:r,state:s}=this,{view:o}=r,i=[],a=!!e,l=e||s.tr,c=()=>(!a&&t&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(l),i.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,p])=>[d,(...k)=>{const h=this.buildProps(l,t),g=p(...k)(h);return i.push(g),u}])),run:c};return u}createCan(e){const{rawCommands:t,state:n}=this,r=!1,s=e||n.tr,o=this.buildProps(s,r);return{...Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...c)=>l(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,r)}}buildProps(e,t=!0){const{rawCommands:n,editor:r,state:s}=this,{view:o}=r,i={tr:e,editor:r,view:o,state:st({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(i)]))}};return i}},N={};we(N,{blur:()=>bn,clearContent:()=>Mn,clearNodes:()=>wn,command:()=>xn,createParagraphNear:()=>Tn,cut:()=>An,deleteCurrentNode:()=>Cn,deleteNode:()=>Ln,deleteRange:()=>En,deleteSelection:()=>Sn,enter:()=>$n,exitCode:()=>In,extendMarkRange:()=>_n,first:()=>Rn,focus:()=>Hn,forEach:()=>Bn,insertContent:()=>zn,insertContentAt:()=>Fn,joinBackward:()=>Un,joinDown:()=>Kn,joinForward:()=>Vn,joinItemBackward:()=>qn,joinItemForward:()=>Gn,joinTextblockBackward:()=>Jn,joinTextblockForward:()=>Xn,joinUp:()=>Wn,keyboardShortcut:()=>Qn,lift:()=>Yn,liftEmptyBlock:()=>er,liftListItem:()=>tr,newlineInCode:()=>nr,resetAttributes:()=>rr,scrollIntoView:()=>sr,selectAll:()=>or,selectNodeBackward:()=>ir,selectNodeForward:()=>ar,selectParentNode:()=>lr,selectTextblockEnd:()=>cr,selectTextblockStart:()=>dr,setContent:()=>pr,setMark:()=>Hr,setMeta:()=>Br,setNode:()=>zr,setNodeSelection:()=>jr,setTextDirection:()=>Dr,setTextSelection:()=>Fr,sinkListItem:()=>Wr,splitBlock:()=>Kr,splitListItem:()=>Ur,toggleList:()=>Vr,toggleMark:()=>qr,toggleNode:()=>Gr,toggleWrap:()=>Jr,undoInputRule:()=>Xr,unsetAllMarks:()=>Zr,unsetMark:()=>Qr,unsetTextDirection:()=>Yr,updateAttributes:()=>es,wrapIn:()=>ts,wrapInList:()=>ns});var bn=()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),(n=window==null?void 0:window.getSelection())==null||n.removeAllRanges())}),!0),Mn=(e=!0)=>({commands:t})=>t.setContent("",{emitUpdate:e}),wn=()=>({state:e,tr:t,dispatch:n})=>{const{selection:r}=t,{ranges:s}=r;return n&&s.forEach(({$from:o,$to:i})=>{e.doc.nodesBetween(o.pos,i.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=t,d=c.resolve(u.map(l)),p=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(p);if(!f)return;const k=Ht(f);if(a.type.isTextblock){const{defaultType:h}=d.parent.contentMatchAt(d.index());t.setNodeMarkup(f.start,h)}(k||k===0)&&t.lift(f,k)})}),!0},xn=e=>t=>e(t),Tn=()=>({state:e,dispatch:t})=>Bt(e,t),An=(e,t)=>({editor:n,tr:r})=>{const{state:s}=n,o=s.doc.slice(e.from,e.to);r.deleteRange(e.from,e.to);const i=r.mapping.map(t);return r.insert(i,o.content),r.setSelection(new _(r.doc.resolve(Math.max(i-1,0)))),!0},Cn=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,r=n.$anchor.node();if(r.content.size>0)return!1;const s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r.type){if(t){const a=s.before(o),l=s.after(o);e.delete(a,l).scrollIntoView()}return!0}return!1};function L(e,t){if(typeof e=="string"){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}var Ln=e=>({tr:t,state:n,dispatch:r})=>{const s=L(e,n.schema),o=t.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===s){if(r){const l=o.before(i),c=o.after(i);t.delete(l,c).scrollIntoView()}return!0}return!1},En=e=>({tr:t,dispatch:n})=>{const{from:r,to:s}=e;return n&&t.delete(r,s),!0},Sn=()=>({state:e,dispatch:t})=>zt(e,t),$n=()=>({commands:e})=>e.keyboardShortcut("Enter"),In=()=>({state:e,dispatch:t})=>jt(e,t);function Pn(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function ie(e,t,n={strict:!0}){const r=Object.keys(t);return r.length?r.every(s=>n.strict?t[s]===e[s]:Pn(t[s])?t[s].test(e[s]):t[s]===e[s]):!0}function ot(e,t,n={}){return e.find(r=>r.type===t&&ie(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function He(e,t,n={}){return!!ot(e,t,n)}function xe(e,t,n){var r;if(!e||!t)return;let s=e.parent.childAfter(e.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===t))&&(s=e.parent.childBefore(e.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===t)||(n=n||((r=s.node.marks[0])==null?void 0:r.attrs),!ot([...s.node.marks],t,n)))return;let i=s.index,a=e.start()+s.offset,l=i+1,c=a+s.node.nodeSize;for(;i>0&&He([...e.parent.child(i-1).marks],t,n);)i-=1,a-=e.parent.child(i).nodeSize;for(;l<e.parent.childCount&&He([...e.parent.child(l).marks],t,n);)c+=e.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function B(e,t){if(typeof e=="string"){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}var _n=(e,t={})=>({tr:n,state:r,dispatch:s})=>{const o=B(e,r.schema),{doc:i,selection:a}=n,{$from:l,from:c,to:u}=a;if(s){const d=xe(l,o,t);if(d&&d.from<=c&&d.to>=u){const p=_.create(i,d.from,d.to);n.setSelection(p)}}return!0},Rn=e=>t=>{const n=typeof e=="function"?e(t):e;for(let r=0;r<n.length;r+=1)if(n[r](t))return!0;return!1};function it(e){return e instanceof _}function j(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function Nn(e,t=null){if(!t)return null;const n=D.atStart(e),r=D.atEnd(e);if(t==="start"||t===!0)return n;if(t==="end")return r;const s=n.from,o=r.to;return t==="all"?_.create(e,j(0,s,o),j(e.content.size,s,o)):_.create(e,j(t,s,o),j(t,s,o))}function Be(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function ae(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function On(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var Hn=(e=null,t={})=>({editor:n,view:r,tr:s,dispatch:o})=>{t={scrollIntoView:!0,...t};const i=()=>{(ae()||Be())&&r.dom.focus(),On()&&!ae()&&!Be()&&r.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),t!=null&&t.scrollIntoView&&n.commands.scrollIntoView())})};try{if(r.hasFocus()&&e===null||e===!1)return!0}catch{return!1}if(o&&e===null&&!it(n.state.selection))return i(),!0;const a=Nn(s.doc,e)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),i()),!0},Bn=(e,t)=>n=>e.every((r,s)=>t(r,{...n,index:s})),zn=(e,t)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),at=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const r=t[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?e.removeChild(r):r.nodeType===1&&at(r)}return e};function J(e){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${e}</body>`,n=new window.DOMParser().parseFromString(t,"text/html").body;return at(n)}function X(e,t,n){if(e instanceof ln||e instanceof W)return e;n={slice:!0,parseOptions:{},...n};const r=typeof e=="object"&&e!==null,s=typeof e=="string";if(r)try{if(Array.isArray(e)&&e.length>0)return W.fromArray(e.map(a=>t.nodeFromJSON(a)));const i=t.nodeFromJSON(e);return n.errorOnInvalidContent&&i.check(),i}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",o),X("",t,n)}if(s){if(n.errorOnInvalidContent){let i=!1,a="";const l=new tt({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(i=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?ne.fromSchema(l).parseSlice(J(e),n.parseOptions):ne.fromSchema(l).parse(J(e),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=ne.fromSchema(t);return n.slice?o.parseSlice(J(e),n.parseOptions).content:o.parse(J(e),n.parseOptions)}return X("",t,n)}function jn(e,t,n){const r=e.steps.length-1;if(r<t)return;const s=e.steps[r];if(!(s instanceof cn||s instanceof dn))return;const o=e.mapping.maps[r];let i=0;o.forEach((a,l,c,u)=>{i===0&&(i=u)}),e.setSelection(D.near(e.doc.resolve(i),n))}var Dn=e=>!("type"in e),Fn=(e,t,n)=>({tr:r,dispatch:s,editor:o})=>{var i;if(s){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=g=>{o.emit("contentError",{editor:o,error:g,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{X(t,o.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=X(t,o.schema,{parseOptions:c,errorOnInvalidContent:(i=n.errorOnInvalidContent)!=null?i:o.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof e=="number"?{from:e,to:e}:{from:e.from,to:e.to},p=!0,f=!0;if((Dn(a)?a:[a]).forEach(g=>{g.check(),p=p?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=r.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let h;if(p){if(Array.isArray(t))h=t.map(g=>g.text||"").join("");else if(t instanceof W){let g="";t.forEach(m=>{m.text&&(g+=m.text)}),h=g}else typeof t=="object"&&t&&t.text?h=t.text:h=t;r.insertText(h,u,d)}else{h=a;const g=r.doc.resolve(u),m=g.node(),y=g.parentOffset===0,v=m.isText||m.isTextblock,M=m.content.size>0;y&&v&&M&&(u=Math.max(0,u-1)),r.replaceWith(u,d,h)}n.updateSelection&&jn(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:h}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:h})}return!0},Wn=()=>({state:e,dispatch:t})=>Dt(e,t),Kn=()=>({state:e,dispatch:t})=>Ft(e,t),Un=()=>({state:e,dispatch:t})=>Wt(e,t),Vn=()=>({state:e,dispatch:t})=>Kt(e,t),qn=()=>({state:e,dispatch:t,tr:n})=>{try{const r=nt(e.doc,e.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),t&&t(n),!0)}catch{return!1}},Gn=()=>({state:e,dispatch:t,tr:n})=>{try{const r=nt(e.doc,e.selection.$from.pos,1);return r==null?!1:(n.join(r,2),t&&t(n),!0)}catch{return!1}},Jn=()=>({state:e,dispatch:t})=>Ut(e,t),Xn=()=>({state:e,dispatch:t})=>Vt(e,t);function lt(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Zn(e){const t=e.split(/-(?!$)/);let n=t[t.length-1];n==="Space"&&(n=" ");let r,s,o,i;for(let a=0;a<t.length-1;a+=1){const l=t[a];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))ae()||lt()?i=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}var Qn=e=>({editor:t,view:n,tr:r,dispatch:s})=>{const o=Zn(e).split(/-(?!$)/),i=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function K(e,t,n={}){const{from:r,to:s,empty:o}=e.selection,i=t?L(t,e.schema):null,a=[];e.doc.nodesBetween(r,s,(d,p)=>{if(d.isText)return;const f=Math.max(r,p),k=Math.min(s,p+d.nodeSize);a.push({node:d,from:f,to:k})});const l=s-r,c=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>ie(d.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((d,p)=>d+p.to-p.from,0)>=l}var Yn=(e,t={})=>({state:n,dispatch:r})=>{const s=L(e,n.schema);return K(n,s,t)?qt(n,r):!1},er=()=>({state:e,dispatch:t})=>Gt(e,t),tr=e=>({state:t,dispatch:n})=>{const r=L(e,t.schema);return Jt(r)(t,n)},nr=()=>({state:e,dispatch:t})=>Xt(e,t);function Te(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function ze(e,t){const n=typeof t=="string"?[t]:t;return Object.keys(e).reduce((r,s)=>(n.includes(s)||(r[s]=e[s]),r),{})}var rr=(e,t)=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const a=Te(typeof e=="string"?e:e.name,r.schema);if(!a)return!1;a==="node"&&(o=L(e,r.schema)),a==="mark"&&(i=B(e,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{o&&o===u.type&&(l=!0,s&&n.setNodeMarkup(d,void 0,ze(u.attrs,t))),i&&u.marks.length&&u.marks.forEach(p=>{i===p.type&&(l=!0,s&&n.addMark(d,d+u.nodeSize,i.create(ze(p.attrs,t))))})})}),l},sr=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),or=()=>({tr:e,dispatch:t})=>{if(t){const n=new Zt(e.doc);e.setSelection(n)}return!0},ir=()=>({state:e,dispatch:t})=>Qt(e,t),ar=()=>({state:e,dispatch:t})=>Yt(e,t),lr=()=>({state:e,dispatch:t})=>en(e,t),cr=()=>({state:e,dispatch:t})=>tn(e,t),dr=()=>({state:e,dispatch:t})=>nn(e,t);function ur(e,t,n={},r={}){return X(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var pr=(e,{errorOnInvalidContent:t,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:s,tr:o,dispatch:i,commands:a})=>{const{doc:l}=o;if(r.preserveWhitespace!=="full"){const c=ur(e,s.schema,r,{errorOnInvalidContent:t??s.options.enableContentCheck});return i&&o.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return i&&o.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},e,{parseOptions:r,errorOnInvalidContent:t??s.options.enableContentCheck})};function ct(e,t){const n=B(t,e.schema),{from:r,to:s,empty:o}=e.selection,i=[];o?(e.storedMarks&&i.push(...e.storedMarks),i.push(...e.selection.$head.marks())):e.doc.nodesBetween(r,s,l=>{i.push(...l.marks)});const a=i.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function dt(e,t){const n=new Nt(e);return t.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function fr(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function hr(e,t,n){const r=[];return e.nodesBetween(t.from,t.to,(s,o)=>{n(s)&&r.push({node:s,pos:o})}),r}function mr(e,t){for(let n=e.depth;n>0;n-=1){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}function ce(e){return t=>mr(t.$from,e)}function b(e,t,n){return e.config[t]===void 0&&e.parent?b(e.parent,t,n):typeof e.config[t]=="function"?e.config[t].bind({...n,parent:e.parent?b(e.parent,t,n):null}):e.config[t]}function Ae(e){return e.map(t=>{const n={name:t.name,options:t.options,storage:t.storage},r=b(t,"addExtensions",n);return r?[t,...Ae(r())]:t}).flat(10)}function kr(e){return typeof e=="function"}function T(e,t=void 0,...n){return kr(e)?t?e.bind(t)(...n):e(...n):e}function gr(e={}){return Object.keys(e).length===0&&e.constructor===Object}function de(e){const t=e.filter(s=>s.type==="extension"),n=e.filter(s=>s.type==="node"),r=e.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:n,markExtensions:r}}function yr(e){const t=[],{nodeExtensions:n,markExtensions:r}=de(e),s=[...n,...r],o={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1},i=n.filter(c=>c.name!=="text").map(c=>c.name),a=r.map(c=>c.name),l=[...i,...a];return e.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage,extensions:s},d=b(c,"addGlobalAttributes",u);if(!d)return;d().forEach(f=>{let k;Array.isArray(f.types)?k=f.types:f.types==="*"?k=l:f.types==="nodes"?k=i:f.types==="marks"?k=a:k=[],k.forEach(h=>{Object.entries(f.attributes).forEach(([g,m])=>{t.push({type:h,name:g,attribute:{...o,...m}})})})})}),s.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage},d=b(c,"addAttributes",u);if(!d)return;const p=d();Object.entries(p).forEach(([f,k])=>{const h={...o,...k};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,t.push({type:c.name,name:f,attribute:h})})}),t}function A(...e){return e.filter(t=>!!t).reduce((t,n)=>{const r={...t};return Object.entries(n).forEach(([s,o])=>{if(!r[s]){r[s]=o;return}if(s==="class"){const a=o?String(o).split(" "):[],l=r[s]?r[s].split(" "):[],c=a.filter(u=>!l.includes(u));r[s]=[...l,...c].join(" ")}else if(s==="style"){const a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,p]=u.split(":").map(f=>f.trim());c.set(d,p)}),a.forEach(u=>{const[d,p]=u.split(":").map(f=>f.trim());c.set(d,p)}),r[s]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[s]=o}),r},{})}function me(e,t){return t.filter(n=>n.type===e.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(e.attrs)||{}:{[n.name]:e.attrs[n.name]}).reduce((n,r)=>A(n,r),{})}function vr(e){return typeof e!="string"?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):e==="true"?!0:e==="false"?!1:e}function je(e,t){return"style"in e?e:{...e,getAttrs:n=>{const r=e.getAttrs?e.getAttrs(n):e.attrs;if(r===!1)return!1;const s=t.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(n):vr(n.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...r,...s}}}}function De(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>t==="attrs"&&gr(n)?!1:n!=null))}function Fe(e){var t,n;const r={};return!((t=e==null?void 0:e.attribute)!=null&&t.isRequired)&&"default"in((e==null?void 0:e.attribute)||{})&&(r.default=e.attribute.default),((n=e==null?void 0:e.attribute)==null?void 0:n.validate)!==void 0&&(r.validate=e.attribute.validate),[e.name,r]}function br(e,t){var n;const r=yr(e),{nodeExtensions:s,markExtensions:o}=de(e),i=(n=s.find(c=>b(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(s.map(c=>{const u=r.filter(m=>m.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:t},p=e.reduce((m,y)=>{const v=b(y,"extendNodeSchema",d);return{...m,...v?v(c):{}}},{}),f=De({...p,content:T(b(c,"content",d)),marks:T(b(c,"marks",d)),group:T(b(c,"group",d)),inline:T(b(c,"inline",d)),atom:T(b(c,"atom",d)),selectable:T(b(c,"selectable",d)),draggable:T(b(c,"draggable",d)),code:T(b(c,"code",d)),whitespace:T(b(c,"whitespace",d)),linebreakReplacement:T(b(c,"linebreakReplacement",d)),defining:T(b(c,"defining",d)),isolating:T(b(c,"isolating",d)),attrs:Object.fromEntries(u.map(Fe))}),k=T(b(c,"parseHTML",d));k&&(f.parseDOM=k.map(m=>je(m,u)));const h=b(c,"renderHTML",d);h&&(f.toDOM=m=>h({node:m,HTMLAttributes:me(m,u)}));const g=b(c,"renderText",d);return g&&(f.toText=g),[c.name,f]})),l=Object.fromEntries(o.map(c=>{const u=r.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:t},p=e.reduce((g,m)=>{const y=b(m,"extendMarkSchema",d);return{...g,...y?y(c):{}}},{}),f=De({...p,inclusive:T(b(c,"inclusive",d)),excludes:T(b(c,"excludes",d)),group:T(b(c,"group",d)),spanning:T(b(c,"spanning",d)),code:T(b(c,"code",d)),attrs:Object.fromEntries(u.map(Fe))}),k=T(b(c,"parseHTML",d));k&&(f.parseDOM=k.map(g=>je(g,u)));const h=b(c,"renderHTML",d);return h&&(f.toDOM=g=>h({mark:g,HTMLAttributes:me(g,u)})),[c.name,f]}));return new tt({topNode:i,nodes:a,marks:l})}function Mr(e){const t=e.filter((n,r)=>e.indexOf(n)!==r);return Array.from(new Set(t))}function wr(e){return e.sort((n,r)=>{const s=b(n,"priority")||100,o=b(r,"priority")||100;return s>o?-1:s<o?1:0})}function xr(e){const t=wr(Ae(e)),n=Mr(t.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),t}function Tr(e,t){const n=xr(e);return br(n,t)}function Ar(e,t){const n=Tr(t),r=J(e);return ne.fromSchema(n).parse(r).toJSON()}function Cr(e,t,n){const{from:r,to:s}=t,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let a="";return e.nodesBetween(r,s,(l,c,u,d)=>{var p;l.isBlock&&c>r&&(a+=o);const f=i==null?void 0:i[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:t})),!1;l.isText&&(a+=(p=l==null?void 0:l.text)==null?void 0:p.slice(Math.max(r,c)-c,s-c))}),a}function Lr(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,t])=>t.spec.toText).map(([t,n])=>[t,n.spec.toText]))}function Er(e,t){const n=L(t,e.schema),{from:r,to:s}=e.selection,o=[];e.doc.nodesBetween(r,s,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===n.name);return i?{...i.attrs}:{}}function Sr(e,t){const n=Te(typeof t=="string"?t:t.name,e.schema);return n==="node"?Er(e,t):n==="mark"?ct(e,t):{}}function $r(e,t=JSON.stringify){const n={};return e.filter(r=>{const s=t(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function Ir(e){const t=$r(e);return t.length===1?t:t.filter((n,r)=>!t.filter((o,i)=>i!==r).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function ut(e){const{mapping:t,steps:n}=e,r=[];return t.maps.forEach((s,o)=>{const i=[];if(s.ranges.length)s.forEach((a,l)=>{i.push({from:a,to:l})});else{const{from:a,to:l}=n[o];if(a===void 0||l===void 0)return;i.push({from:a,to:l})}i.forEach(({from:a,to:l})=>{const c=t.slice(o).map(a,-1),u=t.slice(o).map(l),d=t.invert().map(c,-1),p=t.invert().map(u);r.push({oldRange:{from:d,to:p},newRange:{from:c,to:u}})})}),Ir(r)}function Ce(e,t,n){const r=[];return e===t?n.resolve(e).marks().forEach(s=>{const o=n.resolve(e),i=xe(o,s.type);i&&r.push({mark:s,...i})}):n.nodesBetween(e,t,(s,o)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(i=>({from:o,to:o+s.nodeSize,mark:i})))}),r}var Pr=(e,t,n,r=20)=>{const s=e.doc.resolve(n);let o=r,i=null;for(;o>0&&i===null;){const a=s.node(o);(a==null?void 0:a.type.name)===t?i=a:o-=1}return[i,o]};function se(e,t,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=e.find(o=>o.type===t&&o.name===r);return s?s.attribute.keepOnSplit:!1}))}function _r(e,t,n={}){const{empty:r,ranges:s}=e.selection,o=t?B(t,e.schema):null;if(r)return!!(e.storedMarks||e.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>ie(d.attrs,n,{strict:!1}));let i=0;const a=[];if(s.forEach(({$from:d,$to:p})=>{const f=d.pos,k=p.pos;e.doc.nodesBetween(f,k,(h,g)=>{if(o&&h.inlineContent&&!h.type.allowsMarkType(o))return!1;if(!h.isText&&!h.marks.length)return;const m=Math.max(f,g),y=Math.min(k,g+h.nodeSize),v=y-m;i+=v,a.push(...h.marks.map(M=>({mark:M,from:m,to:y})))})}),i===0)return!1;const l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>ie(d.mark.attrs,n,{strict:!1})).reduce((d,p)=>d+p.to-p.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,p)=>d+p.to-p.from,0);return(l>0?l+c:l)>=i}var Rr=(e,t)=>{const{$from:n,$to:r,$anchor:s}=e.selection;if(t){const o=ce(a=>a.type.name===t)(e.selection);if(!o)return!1;const i=e.doc.resolve(o.pos+1);return s.pos+1===i.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},Nr=e=>{const{$from:t,$to:n}=e.selection;return!(t.parentOffset>0||t.pos!==n.pos)};function We(e,t){const{nodeExtensions:n}=de(t),r=n.find(i=>i.name===e);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},o=T(b(r,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function Le(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(e.type.name==="hardBreak")return!0;if(e.isText)return/^\s*$/m.test((r=e.text)!=null?r:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(e.content.childCount===0)return!0;if(t){let s=!0;return e.content.forEach(o=>{s!==!1&&(Le(o,{ignoreWhitespace:n,checkChildren:t})||(s=!1))}),s}return!1}function pt(e){return e instanceof Z}function Or(e,t,n){var r;const{selection:s}=t;let o=null;if(it(s)&&(o=s.$cursor),o){const a=(r=e.storedMarks)!=null?r:o.marks();return o.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:i}=s;return i.some(({$from:a,$to:l})=>{let c=a.depth===0?e.doc.inlineContent&&e.doc.type.allowsMarkType(n):!1;return e.doc.nodesBetween(a.pos,l.pos,(u,d,p)=>{if(c)return!1;if(u.isInline){const f=!p||p.type.allowsMarkType(n),k=!!n.isInSet(u.marks)||!u.marks.some(h=>h.type.excludes(n));c=f&&k}return!c}),c})}var Hr=(e,t={})=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=n,{empty:i,ranges:a}=o,l=B(e,r.schema);if(s)if(i){const c=ct(r,l);n.addStoredMark(l.create({...c,...t}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(p,f)=>{const k=Math.max(f,u),h=Math.min(f+p.nodeSize,d);p.marks.find(m=>m.type===l)?p.marks.forEach(m=>{l===m.type&&n.addMark(k,h,l.create({...m.attrs,...t}))}):n.addMark(k,h,l.create(t))})});return Or(r,n,l)},Br=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),zr=(e,t={})=>({state:n,dispatch:r,chain:s})=>{const o=L(e,n.schema);let i;return n.selection.$anchor.sameParent(n.selection.$head)&&(i=n.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:a})=>Ne(o,{...i,...t})(n)?!0:a.clearNodes()).command(({state:a})=>Ne(o,{...i,...t})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},jr=e=>({tr:t,dispatch:n})=>{if(n){const{doc:r}=t,s=j(e,0,r.content.size),o=Z.create(r,s);t.setSelection(o)}return!0},Dr=(e,t)=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=r;let i,a;return typeof t=="number"?(i=t,a=t):t&&"from"in t&&"to"in t?(i=t.from,a=t.to):(i=o.from,a=o.to),s&&n.doc.nodesBetween(i,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:e})}),!0},Fr=e=>({tr:t,dispatch:n})=>{if(n){const{doc:r}=t,{from:s,to:o}=typeof e=="number"?{from:e,to:e}:e,i=_.atStart(r).from,a=_.atEnd(r).to,l=j(s,i,a),c=j(o,i,a),u=_.create(r,l,c);t.setSelection(u)}return!0},Wr=e=>({state:t,dispatch:n})=>{const r=L(e,t.schema);return rn(r)(t,n)};function Ke(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const r=n.filter(s=>t==null?void 0:t.includes(s.type.name));e.tr.ensureMarks(r)}}var Kr=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:r,editor:s})=>{const{selection:o,doc:i}=t,{$from:a,$to:l}=o,c=s.extensionManager.attributes,u=se(c,a.node().type.name,a.node().attrs);if(o instanceof Z&&o.node.isBlock)return!a.parentOffset||!re(i,a.pos)?!1:(r&&(e&&Ke(n,s.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,p=a.depth===0?void 0:fr(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&p?[{type:p,attrs:u}]:void 0,k=re(t.doc,t.mapping.map(a.pos),1,f);if(!f&&!k&&re(t.doc,t.mapping.map(a.pos),1,p?[{type:p}]:void 0)&&(k=!0,f=p?[{type:p,attrs:u}]:void 0),r){if(k&&(o instanceof _&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,f),p&&!d&&!a.parentOffset&&a.parent.type!==p)){const h=t.mapping.map(a.before()),g=t.doc.resolve(h);a.node(-1).canReplaceWith(g.index(),g.index()+1,p)&&t.setNodeMarkup(t.mapping.map(a.before()),p)}e&&Ke(n,s.extensionManager.splittableMarks),t.scrollIntoView()}return k},Ur=(e,t={})=>({tr:n,state:r,dispatch:s,editor:o})=>{var i;const a=L(e,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const p=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let m=W.empty;const y=l.index(-1)?1:l.index(-2)?2:3;for(let P=l.depth-y;P>=l.depth-3;P-=1)m=W.from(l.node(P).copy(m));const v=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,M={...se(p,l.node().type.name,l.node().attrs),...t},x=((i=a.contentMatch.defaultType)==null?void 0:i.createAndFill(M))||void 0;m=m.append(W.from(a.createAndFill(null,x)||void 0));const w=l.before(l.depth-(y-1));n.replace(w,l.after(-v),new sn(m,4-y,0));let E=-1;n.doc.nodesBetween(w,n.doc.content.size,(P,R)=>{if(E>-1)return!1;P.isTextblock&&P.content.size===0&&(E=R+1)}),E>-1&&n.setSelection(_.near(n.doc.resolve(E))),n.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,k={...se(p,d.type.name,d.attrs),...t},h={...se(p,l.node().type.name,l.node().attrs),...t};n.delete(l.pos,c.pos);const g=f?[{type:a,attrs:k},{type:f,attrs:h}]:[{type:a,attrs:k}];if(!re(n.doc,l.pos,2))return!1;if(s){const{selection:m,storedMarks:y}=r,{splittableMarks:v}=o.extensionManager,M=y||m.$to.parentOffset&&m.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!M||!s)return!0;const x=M.filter(w=>v.includes(w.type.name));n.ensureMarks(x)}return!0},ue=(e,t)=>{const n=ce(i=>i.type===t)(e.selection);if(!n)return!0;const r=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=e.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&be(e.doc,n.pos)&&e.join(n.pos),!0},pe=(e,t)=>{const n=ce(i=>i.type===t)(e.selection);if(!n)return!0;const r=e.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=e.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&be(e.doc,r)&&e.join(r),!0},Vr=(e,t,n,r={})=>({editor:s,tr:o,state:i,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:p}=s.extensionManager,f=L(e,i.schema),k=L(t,i.schema),{selection:h,storedMarks:g}=i,{$from:m,$to:y}=h,v=m.blockRange(y),M=g||h.$to.parentOffset&&h.$from.marks();if(!v)return!1;const x=ce(w=>We(w.type.name,d))(h);if(v.depth>=1&&x&&v.depth-x.depth<=1){if(x.node.type===f)return c.liftListItem(k);if(We(x.node.type.name,d)&&f.validContent(x.node.content)&&a)return l().command(()=>(o.setNodeMarkup(x.pos,f),!0)).command(()=>ue(o,f)).command(()=>pe(o,f)).run()}return!n||!M||!a?l().command(()=>u().wrapInList(f,r)?!0:c.clearNodes()).wrapInList(f,r).command(()=>ue(o,f)).command(()=>pe(o,f)).run():l().command(()=>{const w=u().wrapInList(f,r),E=M.filter(P=>p.includes(P.type.name));return o.ensureMarks(E),w?!0:c.clearNodes()}).wrapInList(f,r).command(()=>ue(o,f)).command(()=>pe(o,f)).run()},qr=(e,t={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:o=!1}=n,i=B(e,r.schema);return _r(r,i,t)?s.unsetMark(i,{extendEmptyMarkRange:o}):s.setMark(i,t)},Gr=(e,t,n={})=>({state:r,commands:s})=>{const o=L(e,r.schema),i=L(t,r.schema),a=K(r,o,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(i,l):s.setNode(o,{...l,...n})},Jr=(e,t={})=>({state:n,commands:r})=>{const s=L(e,n.schema);return K(n,s,t)?r.lift(s):r.wrapIn(s,t)},Xr=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let o;if(s.spec.isInputRules&&(o=s.getState(e))){if(t){const i=e.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)i.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,e.schema.text(o.text,l))}else i.delete(o.from,o.to)}return!0}}return!1},Zr=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:r,ranges:s}=n;return r||t&&s.forEach(o=>{e.removeMark(o.$from.pos,o.$to.pos)}),!0},Qr=(e,t={})=>({tr:n,state:r,dispatch:s})=>{var o;const{extendEmptyMarkRange:i=!1}=t,{selection:a}=n,l=B(e,r.schema),{$from:c,empty:u,ranges:d}=a;if(!s)return!0;if(u&&i){let{from:p,to:f}=a;const k=(o=c.marks().find(g=>g.type===l))==null?void 0:o.attrs,h=xe(c,l,k);h&&(p=h.from,f=h.to),n.removeMark(p,f,l)}else d.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,l)});return n.removeStoredMark(l),!0},Yr=e=>({tr:t,state:n,dispatch:r})=>{const{selection:s}=n;let o,i;return typeof e=="number"?(o=e,i=e):e&&"from"in e&&"to"in e?(o=e.from,i=e.to):(o=s.from,i=s.to),r&&t.doc.nodesBetween(o,i,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,t.setNodeMarkup(l,void 0,c)}),!0},es=(e,t={})=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const a=Te(typeof e=="string"?e:e.name,r.schema);if(!a)return!1;a==="node"&&(o=L(e,r.schema)),a==="mark"&&(i=B(e,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let p,f,k,h;n.selection.empty?r.doc.nodesBetween(u,d,(g,m)=>{o&&o===g.type&&(l=!0,k=Math.max(m,u),h=Math.min(m+g.nodeSize,d),p=m,f=g)}):r.doc.nodesBetween(u,d,(g,m)=>{m<u&&o&&o===g.type&&(l=!0,k=Math.max(m,u),h=Math.min(m+g.nodeSize,d),p=m,f=g),m>=u&&m<=d&&(o&&o===g.type&&(l=!0,s&&n.setNodeMarkup(m,void 0,{...g.attrs,...t})),i&&g.marks.length&&g.marks.forEach(y=>{if(i===y.type&&(l=!0,s)){const v=Math.max(m,u),M=Math.min(m+g.nodeSize,d);n.addMark(v,M,i.create({...y.attrs,...t}))}}))}),f&&(p!==void 0&&s&&n.setNodeMarkup(p,void 0,{...f.attrs,...t}),i&&f.marks.length&&f.marks.forEach(g=>{i===g.type&&s&&n.addMark(k,h,i.create({...g.attrs,...t}))}))}),l},ts=(e,t={})=>({state:n,dispatch:r})=>{const s=L(e,n.schema);return on(s,t)(n,r)},ns=(e,t={})=>({state:n,dispatch:r})=>{const s=L(e,n.schema);return an(s,t)(n,r)},q=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=(t=e.undoable)!=null?t:!0}};function rs(e){return Object.prototype.toString.call(e).slice(8,-1)}function ee(e){return rs(e)!=="Object"?!1:e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function ft(e,t){const n={...e};return ee(e)&&ee(t)&&Object.keys(t).forEach(r=>{ee(t[r])&&ee(e[r])?n[r]=ft(e[r],t[r]):n[r]=t[r]}),n}var Ee=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...T(b(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...T(b(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>ft(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},G=class ht extends Ee{constructor(){super(...arguments),this.type="mark"}static create(t={}){const n=typeof t=="function"?t():t;return new ht(n)}static handleExit({editor:t,mark:n}){const{tr:r}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){const i=s.marks();if(!!!i.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=i.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),t.view.dispatch(r),!0}return!1}configure(t){return super.configure(t)}extend(t){const n=typeof t=="function"?t():t;return super.extend(n)}},mt=class{constructor(e){this.find=e.find,this.handler=e.handler}},ss={};we(ss,{ClipboardTextSerializer:()=>os,Commands:()=>is,Delete:()=>as,Drop:()=>ls,Editable:()=>cs,FocusEvents:()=>ds,Keymap:()=>us,Paste:()=>ps,Tabindex:()=>fs,TextDirection:()=>hs,focusEventsPluginKey:()=>gt});var C=class kt extends Ee{constructor(){super(...arguments),this.type="extension"}static create(t={}){const n=typeof t=="function"?t():t;return new kt(n)}configure(t){return super.configure(t)}extend(t){const n=typeof t=="function"?t():t;return super.extend(n)}},os=C.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new S({key:new $("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:r,selection:s}=t,{ranges:o}=s,i=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),l=Lr(n);return Cr(r,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),is=C.create({name:"commands",addCommands(){return{...N}}}),as=C.create({name:"delete",onUpdate({transaction:e,appendedTransactions:t}){var n,r,s;const o=()=>{var i,a,l,c;if((c=(l=(a=(i=this.editor.options.coreExtensionOptions)==null?void 0:i.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,e))!=null?c:e.getMeta("y-sync$"))return;const u=dt(e.before,[e,...t]);ut(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(k,h)=>{const g=h+k.nodeSize-2,m=f.oldRange.from<=h&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:k,from:h,to:g,newFrom:u.mapping.map(h),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!m,editor:this.editor,transaction:e,combinedTransform:u})})});const p=u.mapping;u.steps.forEach((f,k)=>{var h,g;if(f instanceof Ot){const m=p.slice(k).map(f.from,-1),y=p.slice(k).map(f.to),v=p.invert().map(m,-1),M=p.invert().map(y),x=(h=u.doc.nodeAt(m-1))==null?void 0:h.marks.some(E=>E.eq(f.mark)),w=(g=u.doc.nodeAt(y))==null?void 0:g.marks.some(E=>E.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:v,to:M},newRange:{from:m,to:y},partial:!!(w||x),editor:this.editor,transaction:e,combinedTransform:u})}})};(s=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||s?setTimeout(o,0):o()}}),ls=C.create({name:"drop",addProseMirrorPlugins(){return[new S({key:new $("tiptapDrop"),props:{handleDrop:(e,t,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:r})}}})]}}),cs=C.create({name:"editable",addProseMirrorPlugins(){return[new S({key:new $("editable"),props:{editable:()=>this.editor.options.editable}})]}}),gt=new $("focusEvents"),ds=C.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new S({key:gt,props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const r=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,n)=>{e.isFocused=!1;const r=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}}),us=C.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:p,parent:f}=d,k=d.parent.isTextblock&&p>0?a.doc.resolve(p-1):d,h=k.parent.type.spec.isolating,g=d.pos-d.parentOffset,m=h&&k.parent.childCount===1?g===d.pos:D.atStart(c).from===p;return!u||!f.type.isTextblock||f.textContent.length||!m||m&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},o={...r,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ae()||lt()?o:s},addProseMirrorPlugins(){return[new S({key:new $("clearDocument"),appendTransaction:(e,t,n)=>{if(e.some(h=>h.getMeta("composition")))return;const r=e.some(h=>h.docChanged)&&!t.doc.eq(n.doc),s=e.some(h=>h.getMeta("preventClearDocument"));if(!r||s)return;const{empty:o,from:i,to:a}=t.selection,l=D.atStart(t.doc).from,c=D.atEnd(t.doc).to;if(o||!(i===l&&a===c)||!Le(n.doc))return;const p=n.tr,f=st({state:n,transaction:p}),{commands:k}=new vn({editor:this.editor,state:f});if(k.clearNodes(),!!p.steps.length)return p}})]}}),ps=C.create({name:"paste",addProseMirrorPlugins(){return[new S({key:new $("tiptapPaste"),props:{handlePaste:(e,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}}),fs=C.create({name:"tabindex",addProseMirrorPlugins(){return[new S({key:new $("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),hs=C.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:e}=de(this.extensions);return[{types:e.filter(t=>t.name!=="text").map(t=>t.name),attributes:{dir:{default:this.options.direction,parseHTML:t=>{const n=t.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:t=>t.dir?{dir:t.dir}:{}}}}]},addProseMirrorPlugins(){return[new S({key:new $("textDirection"),props:{attributes:()=>{const e=this.options.direction;return e?{dir:e}:{}}}})]}});function U(e){return new q({find:e.find,handler:({state:t,range:n,match:r})=>{const s=T(e.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:o}=t,i=r[r.length-1],a=r[0];if(i){const l=a.search(/\S/),c=n.from+a.indexOf(i),u=c+i.length;if(Ce(n.from,n.to,t.doc).filter(f=>f.mark.type.excluded.find(h=>h===e.type&&h!==f.mark.type)).filter(f=>f.to>c).length)return null;u<n.to&&o.delete(u,n.to),c>n.from&&o.delete(n.from+l,c);const p=n.from+l+i.length;o.addMark(n.from+l,p,e.type.create(s||{})),o.removeStoredMark(e.type)}},undoable:e.undoable})}function ms(e){return new q({find:e.find,handler:({state:t,range:n,match:r})=>{const s=T(e.getAttributes,void 0,r)||{},{tr:o}=t,i=n.from;let a=n.to;const l=e.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=i+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];o.insertText(d,i+r[0].length-1),o.replaceWith(u,a,l)}else if(r[0]){const c=e.type.isInline?i:i-1;o.insert(c,e.type.create(s)).delete(o.mapping.map(i),o.mapping.map(a))}o.scrollIntoView()},undoable:e.undoable})}function ke(e){return new q({find:e.find,handler:({state:t,range:n,match:r})=>{const s=t.doc.resolve(n.from),o=T(e.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,o)},undoable:e.undoable})}function V(e){return new q({find:e.find,handler:({state:t,range:n,match:r,chain:s})=>{const o=T(e.getAttributes,void 0,r)||{},i=t.tr.delete(n.from,n.to),l=i.doc.resolve(n.from).blockRange(),c=l&&Rt(l,e.type,o);if(!c)return null;if(i.wrap(l,c),e.keepMarks&&e.editor){const{selection:d,storedMarks:p}=t,{splittableMarks:f}=e.editor.extensionManager,k=p||d.$to.parentOffset&&d.$from.marks();if(k){const h=k.filter(g=>f.includes(g.type.name));i.ensureMarks(h)}}if(e.keepAttributes){const d=e.type.name==="bulletList"||e.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(d,o).run()}const u=i.doc.resolve(n.from-1).nodeBefore;u&&u.type===e.type&&be(i.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(r,u))&&i.join(n.from-1)},undoable:e.undoable})}function ks(e,t){const{selection:n}=e,{$from:r}=n;if(n instanceof Z){const o=r.index();return r.parent.canReplaceWith(o,o+1,t)}let s=r.depth;for(;s>=0;){const o=r.index(s);if(r.node(s).contentMatchAt(o).matchType(t))return!0;s-=1}return!1}var gs={};we(gs,{createAtomBlockMarkdownSpec:()=>yt,createBlockMarkdownSpec:()=>ys,createInlineMarkdownSpec:()=>Ms,parseAttributes:()=>Se,parseIndentedBlocks:()=>ge,renderNestedMarkdownContent:()=>Ie,serializeAttributes:()=>$e});function Se(e){if(!(e!=null&&e.trim()))return{};const t={},n=[],r=e.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),s=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(s){const c=s.map(u=>u.trim().slice(1));t.class=c.join(" ")}const o=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);o&&(t.id=o[1]);const i=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(i)).forEach(([,c,u])=>{var d;const p=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=n[p];f&&(t[c]=f.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(t[u]=!0)}),t}function $e(e){if(!e||Object.keys(e).length===0)return"";const t=[];return e.class&&String(e.class).split(/\s+/).filter(Boolean).forEach(r=>t.push(`.${r}`)),e.id&&t.push(`#${e.id}`),Object.entries(e).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?t.push(n):r!==!1&&r!=null&&t.push(`${n}="${String(r)}"`))}),t.join(" ")}function yt(e){const{nodeName:t,name:n,parseAttributes:r=Se,serializeAttributes:s=$e,defaultAttributes:o={},requiredAttributes:i=[],allowedAttributes:a}=e,l=n||t,c=u=>{if(!a)return u;const d={};return a.forEach(p=>{p in u&&(d[p]=u[p])}),d};return{parseMarkdown:(u,d)=>{const p={...o,...u.attributes};return d.createNode(t,p,[])},markdownTokenizer:{name:t,level:"block",start(u){var d;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(p))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,p){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),k=u.match(f);if(!k)return;const h=k[1]||"",g=r(h);if(!i.find(y=>!(y in g)))return{type:t,raw:k[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),p=s(d),f=p?` {${p}}`:"";return`:::${l}${f} :::`}}}function ys(e){const{nodeName:t,name:n,getContent:r,parseAttributes:s=Se,serializeAttributes:o=$e,defaultAttributes:i={},content:a="block",allowedAttributes:l}=e,c=n||t,u=d=>{if(!l)return d;const p={};return l.forEach(f=>{f in d&&(p[f]=d[f])}),p};return{parseMarkdown:(d,p)=>{let f;if(r){const h=r(d);f=typeof h=="string"?[{type:"text",text:h}]:h}else a==="block"?f=p.parseChildren(d.tokens||[]):f=p.parseInline(d.tokens||[]);const k={...i,...d.attributes};return p.createNode(t,k,f)},markdownTokenizer:{name:t,level:"block",start(d){var p;const f=new RegExp(`^:::${c}`,"m"),k=(p=d.match(f))==null?void 0:p.index;return k!==void 0?k:-1},tokenize(d,p,f){var k;const h=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(h);if(!g)return;const[m,y=""]=g,v=s(y);let M=1;const x=m.length;let w="";const E=/^:::([\w-]*)(\s.*)?/gm,P=d.slice(x);for(E.lastIndex=0;;){const R=E.exec(P);if(R===null)break;const Y=R.index,It=R[1];if(!((k=R[2])!=null&&k.endsWith(":::"))){if(It)M+=1;else if(M-=1,M===0){const Re=P.slice(0,Y);w=Re.trim();const Pt=d.slice(0,x+Y+R[0].length);let H=[];if(w)if(a==="block")for(H=f.blockTokens(Re),H.forEach(O=>{O.text&&(!O.tokens||O.tokens.length===0)&&(O.tokens=f.inlineTokens(O.text))});H.length>0;){const O=H[H.length-1];if(O.type==="paragraph"&&(!O.text||O.text.trim()===""))H.pop();else break}else H=f.inlineTokens(w);return{type:t,raw:Pt,attributes:v,content:w,tokens:H}}}}}},renderMarkdown:(d,p)=>{const f=u(d.attrs||{}),k=o(f),h=k?` {${k}}`:"",g=p.renderChildren(d.content||[],`

`);return`:::${c}${h}

${g}

:::`}}}function vs(e){if(!e.trim())return{};const t={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(e);for(;r!==null;){const[,s,o,i]=r;t[s]=o||i,r=n.exec(e)}return t}function bs(e){return Object.entries(e).filter(([,t])=>t!=null).map(([t,n])=>`${t}="${n}"`).join(" ")}function Ms(e){const{nodeName:t,name:n,getContent:r,parseAttributes:s=vs,serializeAttributes:o=bs,defaultAttributes:i={},selfClosing:a=!1,allowedAttributes:l}=e,c=n||t,u=p=>{if(!l)return p;const f={};return l.forEach(k=>{const h=typeof k=="string"?k:k.name,g=typeof k=="string"?void 0:k.skipIfDefault;if(h in p){const m=p[h];if(g!==void 0&&m===g)return;f[h]=m}}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,f)=>{const k={...i,...p.attributes};if(a)return f.createNode(t,k);const h=r?r(p):p.content||"";return h?f.createNode(t,k,[f.createTextNode(h)]):f.createNode(t,k,[])},markdownTokenizer:{name:t,level:"inline",start(p){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),k=p.match(f),h=k==null?void 0:k.index;return h!==void 0?h:-1},tokenize(p,f,k){const h=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=p.match(h);if(!g)return;let m="",y="";if(a){const[,M]=g;y=M}else{const[,M,x]=g;y=M,m=x||""}const v=s(y.trim());return{type:t,raw:g[0],content:m.trim(),attributes:v}}},renderMarkdown:p=>{let f="";r?f=r(p):p.content&&p.content.length>0&&(f=p.content.filter(m=>m.type==="text").map(m=>m.text).join(""));const k=u(p.attrs||{}),h=o(k),g=h?` ${h}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function ge(e,t,n){var r,s,o,i;const a=e.split(`
`),l=[];let c="",u=0;const d=t.baseIndentSize||2;for(;u<a.length;){const p=a[u],f=p.match(t.itemPattern);if(!f){if(l.length>0)break;if(p.trim()===""){u+=1,c=`${c}${p}
`;continue}else return}const k=t.extractItemData(f),{indentLevel:h,mainContent:g}=k;c=`${c}${p}
`;const m=[g];for(u+=1;u<a.length;){const x=a[u];if(x.trim()===""){const E=a.slice(u+1).findIndex(Y=>Y.trim()!=="");if(E===-1)break;if((((s=(r=a[u+1+E].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:s.length)||0)>h){m.push(x),c=`${c}${x}
`,u+=1;continue}else break}if((((i=(o=x.match(/^(\s*)/))==null?void 0:o[1])==null?void 0:i.length)||0)>h)m.push(x),c=`${c}${x}
`,u+=1;else break}let y;const v=m.slice(1);if(v.length>0){const x=v.map(w=>w.slice(h+d)).join(`
`);x.trim()&&(t.customNestedParser?y=t.customNestedParser(x):y=n.blockTokens(x))}const M=t.createToken(k,y);l.push(M)}if(l.length!==0)return{items:l,raw:c}}function Ie(e,t,n,r){if(!e||!Array.isArray(e.content))return"";const s=typeof n=="function"?n(r):n,[o,...i]=e.content,a=t.renderChildren([o]),l=[`${s}${a}`];return i&&i.length>0&&i.forEach(c=>{const u=t.renderChildren([c]);if(u){const d=u.split(`
`).map(p=>p?t.indent(p):"").join(`
`);l.push(d)}}),l.join(`
`)}var I=class vt extends Ee{constructor(){super(...arguments),this.type="node"}static create(t={}){const n=typeof t=="function"?t():t;return new vt(n)}configure(t){return super.configure(t)}extend(t){const n=typeof t=="function"?t():t;return super.extend(n)}};function F(e){return new mt({find:e.find,handler:({state:t,range:n,match:r,pasteEvent:s})=>{const o=T(e.getAttributes,void 0,r,s);if(o===!1||o===null)return null;const{tr:i}=t,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),p=d+a.length;if(Ce(n.from,n.to,t.doc).filter(k=>k.mark.type.excluded.find(g=>g===e.type&&g!==k.mark.type)).filter(k=>k.to>d).length)return null;p<n.to&&i.delete(p,n.to),d>n.from&&i.delete(n.from+u,d),c=n.from+u+a.length,i.addMark(n.from+u,c,e.type.create(o||{})),i.removeStoredMark(e.type)}}})}function ws(e){return new mt({find:e.find,handler({match:t,chain:n,range:r,pasteEvent:s}){const o=T(e.getAttributes,void 0,t,s),i=T(e.getContent,void 0,o);if(o===!1||o===null)return null;const a={type:e.type.name,attrs:o};i&&(a.content=i),t.input&&n().deleteRange(r).insertContentAt(r.from,a)}})}var xs=I.create({name:"blockMath",group:"block",atom:!0,addOptions(){return{onClick:void 0,katexOptions:void 0}},addAttributes(){return{latex:{default:"",parseHTML:e=>e.getAttribute("data-latex"),renderHTML:e=>({"data-latex":e.latex})}}},addCommands(){return{insertBlockMath:e=>({commands:t,editor:n})=>{const{latex:r,pos:s}=e;return r?t.insertContentAt(s??n.state.selection.from,{type:this.name,attrs:{latex:r}}):!1},deleteBlockMath:e=>({editor:t,tr:n})=>{var r;const s=(r=e==null?void 0:e.pos)!=null?r:t.state.selection.$from.pos,o=t.state.doc.nodeAt(s);return!o||o.type.name!==this.name?!1:(n.delete(s,s+o.nodeSize),!0)},updateBlockMath:e=>({editor:t,tr:n})=>{const r=e==null?void 0:e.latex;let s=e==null?void 0:e.pos;s===void 0&&(s=t.state.selection.$from.pos);const o=t.state.doc.nodeAt(s);return!o||o.type.name!==this.name?!1:(n.setNodeMarkup(s,this.type,{...o.attrs,latex:r||o.attrs.latex}),!0)}}},parseHTML(){return[{tag:'div[data-type="block-math"]'}]},renderHTML({HTMLAttributes:e}){return["div",A(e,{"data-type":"block-math"})]},parseMarkdown:e=>({type:"blockMath",attrs:{latex:e.latex}}),renderMarkdown:e=>{var t;return["$$",((t=e.attrs)==null?void 0:t.latex)||"","$$"].join(`
`)},markdownTokenizer:{name:"blockMath",level:"block",start:e=>e.indexOf("$$"),tokenize:e=>{const t=e.match(/^\$\$([^$]+)\$\$/);if(!t)return;const[n,r]=t;return{type:"blockMath",raw:n,latex:r.trim()}}},addInputRules(){return[new q({find:/^\$\$\$([^$]+)\$\$\$$/,handler:({state:e,range:t,match:n})=>{const[,r]=n,{tr:s}=e,o=t.from,i=t.to;s.replaceWith(o,i,this.type.create({latex:r}))}})]},addNodeView(){const{katexOptions:e}=this.options;return({node:t,getPos:n})=>{const r=document.createElement("div"),s=document.createElement("div");r.className="tiptap-mathematics-render",this.editor.isEditable&&r.classList.add("tiptap-mathematics-render--editable"),s.className="block-math-inner",r.dataset.type="block-math",r.setAttribute("data-latex",t.attrs.latex),r.appendChild(s);function o(){try{et.render(t.attrs.latex,s,e),r.classList.remove("block-math-error")}catch{r.textContent=t.attrs.latex,r.classList.add("block-math-error")}}const i=a=>{a.preventDefault(),a.stopPropagation();const l=n();l!=null&&this.options.onClick&&this.options.onClick(t,l)};return this.options.onClick&&r.addEventListener("click",i),o(),{dom:r,destroy(){r.removeEventListener("click",i)}}}}}),Ts=I.create({name:"inlineMath",group:"inline",inline:!0,atom:!0,addOptions(){return{onClick:void 0,katexOptions:void 0}},addAttributes(){return{latex:{default:"",parseHTML:e=>e.getAttribute("data-latex"),renderHTML:e=>({"data-latex":e.latex})}}},addCommands(){return{insertInlineMath:e=>({editor:t,tr:n})=>{var r;const s=e.latex,o=(r=e==null?void 0:e.pos)!=null?r:t.state.selection.from;return s?(n.replaceWith(o,o,this.type.create({latex:s})),!0):!1},deleteInlineMath:e=>({editor:t,tr:n})=>{var r;const s=(r=e==null?void 0:e.pos)!=null?r:t.state.selection.$from.pos,o=t.state.doc.nodeAt(s);return!o||o.type.name!==this.name?!1:(n.delete(s,s+o.nodeSize),!0)},updateInlineMath:e=>({editor:t,tr:n})=>{const r=e==null?void 0:e.latex;let s=e==null?void 0:e.pos;s===void 0&&(s=t.state.selection.$from.pos);const o=t.state.doc.nodeAt(s);return!o||o.type.name!==this.name?!1:(n.setNodeMarkup(s,this.type,{...o.attrs,latex:r}),!0)}}},parseHTML(){return[{tag:'span[data-type="inline-math"]'}]},renderHTML({HTMLAttributes:e}){return["span",A(e,{"data-type":"inline-math"})]},parseMarkdown:e=>({type:"inlineMath",attrs:{latex:e.latex}}),renderMarkdown:e=>{var t;return`$${((t=e.attrs)==null?void 0:t.latex)||""}$`},markdownTokenizer:{name:"inlineMath",level:"inline",start:e=>e.indexOf("$"),tokenize:e=>{const t=e.match(/^\$([^$]+)\$(?!\$)/);if(!t)return;const[n,r]=t;return{type:"inlineMath",raw:n,latex:r.trim()}}},addInputRules(){return[new q({find:/(^|[^$])(\$\$([^$\n]+?)\$\$)(?!\$)/,handler:({state:e,range:t,match:n})=>{const r=n[3],{tr:s}=e,o=t.from,i=t.to;s.replaceWith(o,i,this.type.create({latex:r}))}})]},addNodeView(){const{katexOptions:e}=this.options;return({node:t,getPos:n})=>{const r=document.createElement("span");r.className="tiptap-mathematics-render",this.editor.isEditable&&r.classList.add("tiptap-mathematics-render--editable"),r.dataset.type="inline-math",r.setAttribute("data-latex",t.attrs.latex);function s(){try{et.render(t.attrs.latex,r,e),r.classList.remove("inline-math-error")}catch{r.textContent=t.attrs.latex,r.classList.add("inline-math-error")}}const o=i=>{i.preventDefault(),i.stopPropagation();const a=n();a!=null&&this.options.onClick&&this.options.onClick(t,a)};return this.options.onClick&&r.addEventListener("click",o),s(),{dom:r,destroy(){r.removeEventListener("click",o)}}}}});C.create({name:"Mathematics",addOptions(){return{inlineOptions:void 0,blockOptions:void 0,katexOptions:void 0}},addExtensions(){return[xs.configure({...this.options.blockOptions,katexOptions:this.options.katexOptions}),Ts.configure({...this.options.inlineOptions,katexOptions:this.options.katexOptions})]}});function As(e,t){const r=t.split(`
`).flatMap(s=>[s,""]).map(s=>`${e}${s}`).join(`
`);return r.slice(0,r.length-1)}function Cs(e,t){const n=[];return Array.from(e.keys()).forEach(r=>{(!t||!t.marks||!t.marks.map(s=>s.type).includes(r))&&n.push(r)}),n}function Ls(e,t){const n=[];return Array.from(t.entries()).forEach(([r,s])=>{e.has(r)||n.push({type:r,mark:s})}),n}function Es(e,t,n,r){const s=!n,o=n&&n.type==="text"&&(!n.marks||n.marks.length===0),i=n&&n.type==="text"&&n.marks&&!r(t,new Map(n.marks.map(l=>[l.type,l]))),a=[];if(s||o||i)if(n&&n.type==="text"&&n.marks){const l=new Map(n.marks.map(c=>[c.type,c]));Array.from(e.keys()).forEach(c=>{l.has(c)||a.push(c)})}else(s||o)&&a.push(...Array.from(e.keys()));return a}function Ss(e,t){let n="";return Array.from(e.keys()).reverse().forEach(r=>{const s=e.get(r),o=t(r,s);o&&(n=o+n)}),e.clear(),n}function $s(e,t,n){let r="";return Array.from(e.entries()).forEach(([s,o])=>{const i=n(s,o);i&&(r+=i),t.set(s,o)}),r}function fe(e){const n=(e.raw||e.text||"").match(/^(\s*)[-+*]\s+\[([ xX])\]\s+/);return n?{isTask:!0,checked:n[2].toLowerCase()==="x",indentLevel:n[1].length}:{isTask:!1,indentLevel:0}}function te(e,t){return typeof e!="string"?"json":t}var Is=class{constructor(e){this.baseExtensions=[],this.extensions=[],this.lastParseResult=null;var t,n,r,s,o;this.markedInstance=(t=e==null?void 0:e.marked)!=null?t:_t,this.lexer=new this.markedInstance.Lexer,this.indentStyle=(r=(n=e==null?void 0:e.indentation)==null?void 0:n.style)!=null?r:"space",this.indentSize=(o=(s=e==null?void 0:e.indentation)==null?void 0:s.size)!=null?o:2,this.baseExtensions=(e==null?void 0:e.extensions)||[],e!=null&&e.markedOptions&&typeof this.markedInstance.setOptions=="function"&&this.markedInstance.setOptions(e.markedOptions),this.registry=new Map,this.nodeTypeRegistry=new Map,e!=null&&e.extensions&&(this.baseExtensions=e.extensions,Ae(e.extensions).forEach(a=>this.registerExtension(a,!1))),this.lexer=new this.markedInstance.Lexer}get instance(){return this.markedInstance}get indentCharacter(){return this.indentStyle==="space"?" ":"	"}get indentString(){return this.indentCharacter.repeat(this.indentSize)}hasMarked(){return!!this.markedInstance}registerExtension(e,t=!0){var n,r;this.extensions.push(e);const s=e.name,o=b(e,"markdownTokenName")||s,i=b(e,"parseMarkdown"),a=b(e,"renderMarkdown"),l=b(e,"markdownTokenizer"),c=(n=b(e,"markdownOptions"))!=null?n:null,u=(r=c==null?void 0:c.indentsContent)!=null?r:!1,d={tokenName:o,nodeName:s,parseMarkdown:i,renderMarkdown:a,isIndenting:u,tokenizer:l};if(o&&i){const p=this.registry.get(o)||[];p.push(d),this.registry.set(o,p)}if(a){const p=this.nodeTypeRegistry.get(s)||[];p.push(d),this.nodeTypeRegistry.set(s,p)}l&&this.hasMarked()&&(this.registerTokenizer(l),t&&(this.lexer=new this.markedInstance.Lexer))}registerTokenizer(e){if(!this.hasMarked())return;const{name:t,start:n,level:r="inline",tokenize:s}=e,a={inlineTokens:u=>this.lexer.inlineTokens(u),blockTokens:u=>this.lexer.blockTokens(u)};let l;n?l=typeof n=="function"?n:u=>u.indexOf(n):l=u=>{const d=s(u,[],a);return d&&d.raw?u.indexOf(d.raw):-1};const c={name:t,level:r,start:l,tokenizer:(u,d)=>{const p=s(u,d,a);if(p&&p.type)return{...p,type:p.type||t,raw:p.raw||"",tokens:p.tokens||[]}},childTokens:[]};this.markedInstance.use({extensions:[c]})}getHandlersForToken(e){try{return this.registry.get(e)||[]}catch{return[]}}getHandlerForToken(e){const t=this.getHandlersForToken(e);if(t.length>0)return t[0];const n=this.getHandlersForNodeType(e);return n.length>0?n[0]:void 0}getHandlersForNodeType(e){try{return this.nodeTypeRegistry.get(e)||[]}catch{return[]}}serialize(e){if(!e)return"";const t=this.renderNodes(e,e);return this.isEmptyOutput(t)?"":t}isEmptyOutput(e){return!e||e.trim()===""?!0:e.replace(/&nbsp;/g,"").replace(/\u00A0/g,"").trim()===""}parse(e){if(!this.hasMarked())throw new Error("No marked instance available for parsing");const t=this.markedInstance.lexer(e);return{type:"doc",content:this.parseTokens(t)}}parseTokens(e){return e.map(t=>this.parseToken(t)).filter(t=>t!==null).flatMap(t=>Array.isArray(t)?t:[t])}parseToken(e){if(!e.type)return null;if(e.type==="list")return this.parseListToken(e);const t=this.getHandlersForToken(e.type),n=this.createParseHelpers();if(t.find(s=>{if(!s.parseMarkdown)return!1;const o=s.parseMarkdown(e,n),i=this.normalizeParseResult(o);return i&&(!Array.isArray(i)||i.length>0)?(this.lastParseResult=i,!0):!1})&&this.lastParseResult){const s=this.lastParseResult;return this.lastParseResult=null,s}return this.parseFallbackToken(e)}parseListToken(e){if(!e.items||e.items.length===0)return this.parseTokenWithHandlers(e);const t=e.items.some(a=>fe(a).isTask),n=e.items.some(a=>!fe(a).isTask);if(!t||!n||this.getHandlersForToken("taskList").length===0)return this.parseTokenWithHandlers(e);const r=[];let s=[],o=null;for(let a=0;a<e.items.length;a+=1){const l=e.items[a],{isTask:c,checked:u,indentLevel:d}=fe(l);let p=l;if(c){const h=(l.raw||l.text||"").split(`
`),g=h[0].match(/^\s*[-+*]\s+\[([ xX])\]\s+(.*)$/),m=g?g[2]:"";let y=[];if(h.length>1&&h.slice(1).join(`
`).trim()){const M=h.slice(1),x=M.filter(w=>w.trim());if(x.length>0){const w=Math.min(...x.map(R=>R.length-R.trimStart().length)),P=M.map(R=>R.trim()?R.slice(w):"").join(`
`).trim();P&&(y=this.markedInstance.lexer(`${P}
`))}}p={type:"taskItem",raw:"",mainContent:m,indentLevel:d,checked:u??!1,text:m,tokens:this.lexer.inlineTokens(m),nestedTokens:y}}const f=c?"taskList":"list";o!==f?(s.length>0&&r.push({type:o,items:s}),s=[p],o=f):s.push(p)}s.length>0&&r.push({type:o,items:s});const i=[];for(let a=0;a<r.length;a+=1){const l=r[a],c={...e,type:l.type,items:l.items},u=this.parseToken(c);u&&(Array.isArray(u)?i.push(...u):i.push(u))}return i.length>0?i:null}parseTokenWithHandlers(e){if(!e.type)return null;const t=this.getHandlersForToken(e.type),n=this.createParseHelpers();if(t.find(s=>{if(!s.parseMarkdown)return!1;const o=s.parseMarkdown(e,n),i=this.normalizeParseResult(o);return i&&(!Array.isArray(i)||i.length>0)?(this.lastParseResult=i,!0):!1})&&this.lastParseResult){const s=this.lastParseResult;return this.lastParseResult=null,s}return this.parseFallbackToken(e)}createParseHelpers(){return{parseInline:e=>this.parseInlineTokens(e),parseChildren:e=>this.parseTokens(e),createTextNode:(e,t)=>({type:"text",text:e,marks:t||void 0}),createNode:(e,t,n)=>{const r={type:e,attrs:t||void 0,content:n||void 0};return(!t||Object.keys(t).length===0)&&delete r.attrs,r},applyMark:(e,t,n)=>({mark:e,content:t,attrs:n&&Object.keys(n).length>0?n:void 0})}}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}parseInlineTokens(e){var t,n,r,s;const o=[];for(let i=0;i<e.length;i+=1){const a=e[i];if(a.type==="text")o.push({type:"text",text:a.text||""});else if(a.type==="html"){const l=((n=(t=a.raw)!=null?t:a.text)!=null?n:"").toString(),c=/^<\/[\s]*[\w-]+/i.test(l),u=l.match(/^<[\s]*([\w-]+)(\s|>|\/|$)/i);if(!c&&u&&!/\/>$/.test(l)){const p=u[1],f=this.escapeRegex(p),k=new RegExp(`^<\\/\\s*${f}\\b`,"i");let h=-1;const g=[l];for(let m=i+1;m<e.length;m+=1){const y=e[m],v=((s=(r=y.raw)!=null?r:y.text)!=null?s:"").toString();if(g.push(v),y.type==="html"&&k.test(v)){h=m;break}}if(h!==-1){const m=g.join(""),y={type:"html",raw:m,text:m,block:!1},v=this.parseHTMLToken(y);if(v){const M=this.normalizeParseResult(v);Array.isArray(M)?o.push(...M):M&&o.push(M)}i=h;continue}}const d=this.parseHTMLToken(a);if(d){const p=this.normalizeParseResult(d);Array.isArray(p)?o.push(...p):p&&o.push(p)}}else if(a.type){const l=this.getHandlerForToken(a.type);if(l&&l.parseMarkdown){const c=this.createParseHelpers(),u=l.parseMarkdown(a,c);if(this.isMarkResult(u)){const d=this.applyMarkToContent(u.mark,u.content,u.attrs);o.push(...d)}else{const d=this.normalizeParseResult(u);Array.isArray(d)?o.push(...d):d&&o.push(d)}}else a.tokens&&o.push(...this.parseInlineTokens(a.tokens))}}return o}applyMarkToContent(e,t,n){return t.map(r=>{if(r.type==="text"){const s=r.marks||[],o=n?{type:e,attrs:n}:{type:e};return{...r,marks:[...s,o]}}return{...r,content:r.content?this.applyMarkToContent(e,r.content,n):void 0}})}isMarkResult(e){return e&&typeof e=="object"&&"mark"in e}normalizeParseResult(e){return e?this.isMarkResult(e)?e.content:e:null}parseFallbackToken(e){switch(e.type){case"paragraph":return{type:"paragraph",content:e.tokens?this.parseInlineTokens(e.tokens):[]};case"heading":return{type:"heading",attrs:{level:e.depth||1},content:e.tokens?this.parseInlineTokens(e.tokens):[]};case"text":return{type:"text",text:e.text||""};case"html":return this.parseHTMLToken(e);case"space":return null;default:return e.tokens?this.parseTokens(e.tokens):null}}parseHTMLToken(e){const t=e.text||e.raw||"";if(!t.trim())return null;if(typeof window>"u")return e.block?{type:"paragraph",content:[{type:"text",text:t}]}:{type:"text",text:t};try{const n=Ar(t,this.baseExtensions);return n.type==="doc"&&n.content?e.block?n.content:n.content.length===1&&n.content[0].type==="paragraph"&&n.content[0].content?n.content[0].content:n.content:n}catch(n){throw new Error(`Failed to parse HTML in markdown: ${n}`)}}renderNodeToMarkdown(e,t,n=0,r=0){var s;if(e.type==="text")return e.text||"";if(!e.type)return"";const o=this.getHandlerForToken(e.type);if(!o)return"";const i={renderChildren:(c,u)=>{const d=o.isIndenting?r+1:r;return!Array.isArray(c)&&c.content?this.renderNodes(c.content,e,u||"",n,d):this.renderNodes(c,e,u||"",n,d)},indent:c=>this.indentString+c,wrapInBlock:As},a={index:n,level:r,parentType:t==null?void 0:t.type,meta:{parentAttrs:t==null?void 0:t.attrs}};return((s=o.renderMarkdown)==null?void 0:s.call(o,e,i,a))||""}renderNodes(e,t,n="",r=0,s=0){return Array.isArray(e)?this.renderNodesWithMarkBoundaries(e,t,n,s):e.type?this.renderNodeToMarkdown(e,t,r,s):""}renderNodesWithMarkBoundaries(e,t,n="",r=0){const s=[],o=new Map;return e.forEach((i,a)=>{const l=a<e.length-1?e[a+1]:null;if(i.type)if(i.type==="text"){let c=i.text||"";const u=new Map((i.marks||[]).map(m=>[m.type,m])),d=Ls(o,u),p=Cs(u,l);let f="";if(p.length>0){const m=c.match(/(\s+)$/);m&&(f=m[1],c=c.slice(0,-f.length))}p.forEach(m=>{const y=u.get(m),v=this.getMarkClosing(m,y);v&&(c+=v),o.has(m)&&o.delete(m)});let k="";if(d.length>0){const m=c.match(/^(\s+)/);m&&(k=m[1],c=c.slice(k.length))}d.forEach(({type:m,mark:y})=>{const v=this.getMarkOpening(m,y);v&&(c=v+c),p.includes(m)||o.set(m,y)}),c=k+c;const h=Es(o,u,l,this.markSetsEqual.bind(this));let g="";if(h.length>0){const m=c.match(/(\s+)$/);m&&(g=m[1],c=c.slice(0,-g.length))}h.forEach(m=>{const y=o.get(m),v=this.getMarkClosing(m,y);v&&(c+=v),o.delete(m)}),c+=g,c+=f,s.push(c)}else{const c=new Map(o),u=Ss(o,this.getMarkClosing.bind(this)),d=this.renderNodeToMarkdown(i,t,a,r),p=i.type==="hardBreak"?"":$s(c,o,this.getMarkOpening.bind(this));s.push(u+d+p)}}),s.join(n)}getMarkOpening(e,t){const n=this.getHandlersForNodeType(e),r=n.length>0?n[0]:void 0;if(!r||!r.renderMarkdown)return"";const s="__TIPTAP_MARKDOWN_PLACEHOLDER__",o={type:e,attrs:t.attrs||{},content:[{type:"text",text:s}]};try{const i=r.renderMarkdown(o,{renderChildren:()=>s,indent:l=>l,wrapInBlock:(l,c)=>l+c},{index:0,level:0,parentType:"text",meta:{}}),a=i.indexOf(s);return a>=0?i.substring(0,a):""}catch(i){throw new Error(`Failed to get mark opening for ${e}: ${i}`)}}getMarkClosing(e,t){const n=this.getHandlersForNodeType(e),r=n.length>0?n[0]:void 0;if(!r||!r.renderMarkdown)return"";const s="__TIPTAP_MARKDOWN_PLACEHOLDER__",o={type:e,attrs:t.attrs||{},content:[{type:"text",text:s}]};try{const i=r.renderMarkdown(o,{renderChildren:()=>s,indent:c=>c,wrapInBlock:(c,u)=>c+u},{index:0,level:0,parentType:"text",meta:{}}),a=i.indexOf(s),l=a+s.length;return a>=0?i.substring(l):""}catch(i){throw new Error(`Failed to get mark closing for ${e}: ${i}`)}}markSetsEqual(e,t){return e.size!==t.size?!1:Array.from(e.keys()).every(n=>t.has(n))}},Ue=Is,Do=C.create({name:"markdown",addOptions(){return{indentation:{style:"space",size:2},marked:void 0,markedOptions:{}}},addCommands(){return{setContent:(e,t)=>{if(!(t!=null&&t.contentType)||te(e,t==null?void 0:t.contentType)!=="markdown"||!this.editor.markdown)return N.setContent(e,t);const r=this.editor.markdown.parse(e);return N.setContent(r,t)},insertContent:(e,t)=>{if(!(t!=null&&t.contentType)||te(e,t==null?void 0:t.contentType)!=="markdown"||!this.editor.markdown)return N.insertContent(e,t);const r=this.editor.markdown.parse(e);return N.insertContent(r,t)},insertContentAt:(e,t,n)=>{if(!(n!=null&&n.contentType)||te(t,n==null?void 0:n.contentType)!=="markdown"||!this.editor.markdown)return N.insertContentAt(e,t,n);const s=this.editor.markdown.parse(t);return N.insertContentAt(e,s,n)}}},addStorage(){return{manager:new Ue({indentation:this.options.indentation,marked:this.options.marked,markedOptions:this.options.markedOptions,extensions:[]})}},onBeforeCreate(){if(this.editor.markdown){console.error("[tiptap][markdown]: There is already a `markdown` property on the editor instance. This might lead to unexpected behavior.");return}if(this.storage.manager=new Ue({indentation:this.options.indentation,marked:this.options.marked,markedOptions:this.options.markedOptions,extensions:this.editor.extensionManager.baseExtensions}),this.editor.markdown=this.storage.manager,this.editor.getMarkdown=()=>this.storage.manager.serialize(this.editor.getJSON()),!this.editor.options.contentType||te(this.editor.options.content,this.editor.options.contentType)!=="markdown")return;if(!this.editor.markdown)throw new Error('[tiptap][markdown]: The `contentType` option is set to "markdown", but the Markdown extension is not added to the editor. Please add the Markdown extension to use this feature.');if(this.editor.options.content===void 0||typeof this.editor.options.content!="string")throw new Error('[tiptap][markdown]: The `contentType` option is set to "markdown", but the initial content is not a string. Please provide the initial content as a markdown string.');const t=this.editor.markdown.parse(this.editor.options.content);this.editor.options.content=t}}),Ps=/https?:\/\/[^\s]+?\.(?:mp3|wav|ogg|oga|flac|m4a|aac|opus|weba|webm)(?:\?[^\s]*)?/gi,_s=/^data:audio\/[a-zA-Z0-9.+-]+;base64,/i,bt=(e,t=!1)=>{if(!e)return!1;if(t&&_s.test(e)||e.startsWith("//")||e.startsWith("/")||e.startsWith("./")||e.startsWith("../"))return!0;try{const n=new URL(e);return n.protocol==="http:"||n.protocol==="https:"}catch{return!1}},Rs=(e,t=!1)=>e&&bt(e,t)?e:null,Ns=I.create({name:"audio",addOptions(){return{addPasteHandler:!0,allowBase64:!1,autoplay:!1,controls:!0,loop:!1,muted:!1,preload:"metadata",controlslist:void 0,crossorigin:void 0,disableRemotePlayback:!1,HTMLAttributes:{},inline:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},atom:!0,draggable:!0,addAttributes(){return{src:{default:null},controls:{default:this.options.controls},autoplay:{default:this.options.autoplay},loop:{default:this.options.loop},muted:{default:this.options.muted},preload:{default:this.options.preload},controlslist:{default:this.options.controlslist},crossorigin:{default:this.options.crossorigin},disableremoteplayback:{default:this.options.disableRemotePlayback}}},parseHTML(){return[{tag:this.options.allowBase64?"audio[src]":'audio[src]:not([src^="data:"])'}]},addCommands(){return{setAudio:e=>({commands:t})=>bt(e.src,this.options.allowBase64)?t.insertContent({type:this.name,attrs:e}):!1}},addPasteRules(){return this.options.addPasteHandler?[ws({find:Ps,type:this.type,getAttributes:e=>({src:e[0]})})]:[]},renderHTML({HTMLAttributes:e}){const t=Rs(e.src,this.options.allowBase64),n=A(this.options.HTMLAttributes,{controls:this.options.controls,autoplay:this.options.autoplay,loop:this.options.loop,muted:this.options.muted,preload:this.options.preload,controlslist:this.options.controlslist,crossorigin:this.options.crossorigin,disableremoteplayback:this.options.disableRemotePlayback},{...e,src:t});return["audio",Object.fromEntries(Object.entries(n).filter(([,s])=>s!=null&&s!==!1))]},...yt({nodeName:"audio",allowedAttributes:["src","controls","autoplay","loop","muted","preload","controlslist","crossorigin","disableremoteplayback"]})}),Fo=Ns,le=(e,t)=>{if(e==="slot")return 0;if(e instanceof Function)return e(t);const{children:n,...r}=t??{};if(e==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[e,r,n]},Os=/^\s*>\s$/,Hs=I.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:e}){return le("blockquote",{...A(this.options.HTMLAttributes,e),children:le("slot",{})})},parseMarkdown:(e,t)=>t.createNode("blockquote",void 0,t.parseChildren(e.tokens||[])),renderMarkdown:(e,t)=>{if(!e.content)return"";const n=">",r=[];return e.content.forEach(s=>{const a=t.renderChildren([s]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);r.push(a.join(`
`))}),r.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[V({find:Os,type:this.type})]}}),Bs=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,zs=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,js=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Ds=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Fs=G.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return le("strong",{...A(this.options.HTMLAttributes,e),children:le("slot",{})})},markdownTokenName:"strong",parseMarkdown:(e,t)=>t.applyMark("bold",t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>`**${t.renderChildren(e)}**`,addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[U({find:Bs,type:this.type}),U({find:js,type:this.type})]},addPasteRules(){return[F({find:zs,type:this.type}),F({find:Ds,type:this.type})]}}),Ws=/(^|[^`])`([^`]+)`(?!`)$/,Ks=/(^|[^`])`([^`]+)`(?!`)/g,Us=G.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",A(this.options.HTMLAttributes,e),0]},markdownTokenName:"codespan",parseMarkdown:(e,t)=>t.applyMark("code",[{type:"text",text:e.text||""}]),renderMarkdown:(e,t)=>e.content?`\`${t.renderChildren(e.content)}\``:"",addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[U({find:Ws,type:this.type})]},addPasteRules(){return[F({find:Ks,type:this.type})]}}),he=4,Vs=/^```([a-z]+)?[\s\n]$/,qs=/^~~~([a-z]+)?[\s\n]$/,Gs=I.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:he,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options;if(!n)return null;const o=[...((t=e.firstElementChild)==null?void 0:t.classList)||[]].filter(i=>i.startsWith(n)).map(i=>i.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",A(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(e,t)=>{var n;return((n=e.raw)==null?void 0:n.startsWith("```"))===!1&&e.codeBlockStyle!=="indented"?[]:t.createNode("codeBlock",{language:e.lang||null},e.text?[t.createTextNode(e.text)]:[])},renderMarkdown:(e,t)=>{var n;let r="";const s=((n=e.attrs)==null?void 0:n.language)||"";return e.content?r=[`\`\`\`${s}`,t.renderChildren(e.content),"```"].join(`
`):r=`\`\`\`${s}

\`\`\``,r},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=t.pos===1;return!e||t.parent.type.name!==this.name?!1:n||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const n=(t=this.options.tabSize)!=null?t:he,{state:r}=e,{selection:s}=r,{$from:o,empty:i}=s;if(o.parent.type!==this.type)return!1;const a=" ".repeat(n);return i?e.commands.insertContent(a):e.commands.command(({tr:l})=>{const{from:c,to:u}=s,f=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(k=>a+k).join(`
`);return l.replaceWith(c,u,r.schema.text(f)),!0})},"Shift-Tab":({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const n=(t=this.options.tabSize)!=null?t:he,{state:r}=e,{selection:s}=r,{$from:o,empty:i}=s;return o.parent.type!==this.type?!1:i?e.commands.command(({tr:a})=>{var l;const{pos:c}=o,u=o.start(),d=o.end(),f=r.doc.textBetween(u,d,`
`,`
`).split(`
`);let k=0,h=0;const g=c-u;for(let w=0;w<f.length;w+=1){if(h+f[w].length>=g){k=w;break}h+=f[w].length+1}const y=((l=f[k].match(/^ */))==null?void 0:l[0])||"",v=Math.min(y.length,n);if(v===0)return!0;let M=u;for(let w=0;w<k;w+=1)M+=f[w].length+1;return a.delete(M,M+v),c-M<=v&&a.setSelection(_.create(a.doc,M)),!0}):e.commands.command(({tr:a})=>{const{from:l,to:c}=s,p=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(f=>{var k;const h=((k=f.match(/^ */))==null?void 0:k[0])||"",g=Math.min(h.length,n);return f.slice(g)}).join(`
`);return a.replaceWith(l,c,r.schema.text(p)),!0})},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const o=r.parentOffset===r.parent.nodeSize-2,i=r.parent.textContent.endsWith(`

`);return!o||!i?!1:e.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:r}=t,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?e.commands.command(({tr:c})=>(c.setSelection(D.near(r.resolve(a))),!0)):e.commands.exitCode()}}},addInputRules(){return[ke({find:Vs,type:this.type,getAttributes:e=>({language:e[1]})}),ke({find:qs,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new S({key:new $("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,o=s==null?void 0:s.mode;if(!n||!o)return!1;const{tr:i,schema:a}=e.state,l=a.text(n.replace(/\r\n?/g,`
`));return i.replaceSelectionWith(this.type.create({language:o},l)),i.selection.$from.parent.type!==this.type&&i.setSelection(_.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.setMeta("paste",!0),e.dispatch(i),!0}}})]}}),Js=I.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,`

`):""}),Xs=I.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",A(this.options.HTMLAttributes,e)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command(()=>{const{selection:s,storedMarks:o}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=r.extensionManager,l=o||s.$to.parentOffset&&s.$from.marks();return t().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&i){const d=l.filter(p=>a.includes(p.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Zs=I.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,A(this.options.HTMLAttributes,t),0]},parseMarkdown:(e,t)=>t.createNode("heading",{level:e.depth||1},t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>{var n;const r=(n=e.attrs)!=null&&n.level?parseInt(e.attrs.level,10):1,s="#".repeat(r);return e.content?`${s} ${t.renderChildren(e.content)}`:""},addCommands(){return{setHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.setNode(this.name,e):!1,toggleHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.toggleNode(this.name,"paragraph",e):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>ke({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}}),Qs=I.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:e}){return["hr",A(this.options.HTMLAttributes,e)]},markdownTokenName:"hr",parseMarkdown:(e,t)=>t.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{if(!ks(t,t.schema.nodes[this.name]))return!1;const{selection:n}=t,{$to:r}=n,s=e();return pt(n)?s.insertContentAt(r.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({state:o,tr:i,dispatch:a})=>{if(a){const{$to:l}=i.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?i.setSelection(_.create(i.doc,l.pos+1)):l.nodeAfter.isBlock?i.setSelection(Z.create(i.doc,l.pos)):i.setSelection(_.create(i.doc,l.pos));else{const u=o.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u==null?void 0:u.create();d&&(i.insert(c,d),i.setSelection(_.create(i.doc,c+1)))}i.scrollIntoView()}return!0}).run()}}},addInputRules(){return[ms({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),Ys=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,eo=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,to=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,no=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,ro=G.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>e.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",A(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(e,t)=>t.applyMark("italic",t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>`*${t.renderChildren(e)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[U({find:Ys,type:this.type}),U({find:to,type:this.type})]},addPasteRules(){return[F({find:eo,type:this.type}),F({find:no,type:this.type})]}}),Pe="[\0- -\u2029]",so=new RegExp(Pe),oo=new RegExp(`${Pe}$`),io=new RegExp(Pe,"g");function ao(e){return e.length===1?e[0].isLink:e.length===3&&e[1].isLink?["()","[]"].includes(e[0].value+e[2].value):!1}function lo(e){return new S({key:new $("autolink"),appendTransaction:(t,n,r)=>{const s=t.some(c=>c.docChanged)&&!n.doc.eq(r.doc),o=t.some(c=>c.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=r,a=dt(n.doc,[...t]);if(ut(a).forEach(({newRange:c})=>{const u=hr(r.doc,c,f=>f.isTextblock);let d,p;if(u.length>1)d=u[0],p=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=r.doc.textBetween(c.from,c.to," "," ");if(!oo.test(f))return;d=u[0],p=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&p){const f=p.split(so).filter(Boolean);if(f.length<=0)return!1;const k=f[f.length-1],h=d.pos+p.lastIndexOf(k);if(!k)return!1;const g=kn(k).map(m=>m.toObject(e.defaultProtocol));if(!ao(g))return!1;g.filter(m=>m.isLink).map(m=>({...m,from:h+m.start+1,to:h+m.end+1})).filter(m=>r.schema.marks.code?!r.doc.rangeHasMark(m.from,m.to,r.schema.marks.code):!0).filter(m=>e.validate(m.value)).filter(m=>e.shouldAutoLink(m.value)).forEach(m=>{Ce(m.from,m.to,r.doc).some(y=>y.mark.type===e.type)||i.addMark(m.from,m.to,e.type.create({href:m.href}))})}}),!!i.steps.length)return i}})}function co(e){return new S({key:new $("handleClickLink"),props:{handleClick:(t,n,r)=>{var s,o;if(r.button!==0||!t.editable)return!1;let i=null;if(r.target instanceof HTMLAnchorElement)i=r.target;else{const l=r.target;if(!l)return!1;const c=e.editor.view.dom;i=l.closest("a"),i&&!c.contains(i)&&(i=null)}if(!i)return!1;let a=!1;if(e.enableClickSelection&&(a=e.editor.commands.extendMarkRange(e.type.name)),e.openOnClick){const l=Sr(t.state,e.type.name),c=(s=i.href)!=null?s:l.href,u=(o=i.target)!=null?o:l.target;c&&(window.open(c,u),a=!0)}return a}}})}function uo(e){return new S({key:new $("handlePasteLink"),props:{handlePaste:(t,n,r)=>{const{shouldAutoLink:s}=e,{state:o}=t,{selection:i}=o,{empty:a}=i;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=rt(l,{defaultProtocol:e.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||s!==void 0&&!s(c.value)?!1:e.editor.commands.setMark(e.type,{href:c.href})}}})}function z(e,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!e||e.replace(io,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var po=G.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(e=>{if(typeof e=="string"){Oe(e);return}Oe(e.scheme,e.optionalSlashes)})},onDestroy(){gn()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!z(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>{const t=/^[a-z][a-z0-9+.-]*:\/\//i.test(e),n=/^[a-z][a-z0-9+.-]*:/i.test(e);if(t||n&&!e.includes("@"))return!0;const s=(e.includes("@")?e.split("@").pop():e).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(s)||!/\./.test(s))}}},addAttributes(){return{href:{default:null,parseHTML(e){return e.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class},title:{default:null}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:n=>!!z(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:t=>!!z(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",A(this.options.HTMLAttributes,e),0]:["a",A(this.options.HTMLAttributes,{...e,href:""}),0]},markdownTokenName:"link",parseMarkdown:(e,t)=>t.applyMark("link",t.parseInline(e.tokens||[]),{href:e.href,title:e.title||null}),renderMarkdown:(e,t)=>{var n,r,s,o;const i=(r=(n=e.attrs)==null?void 0:n.href)!=null?r:"",a=(o=(s=e.attrs)==null?void 0:s.title)!=null?o:"",l=t.renderChildren(e);return a?`[${l}](${i} "${a}")`:`[${l}](${i})`},addCommands(){return{setLink:e=>({chain:t})=>{const{href:n}=e;return this.options.isAllowedUri(n,{defaultValidate:r=>!!z(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,e).setMeta("preventAutolink",!0).run():!1},toggleLink:e=>({chain:t})=>{const{href:n}=e||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!z(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[F({find:e=>{const t=[];if(e){const{protocols:n,defaultProtocol:r}=this.options,s=rt(e).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!z(i,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(o=>{this.options.shouldAutoLink(o.value)&&t.push({text:o.value,data:{href:o.href},index:o.start})})}return t},type:this.type,getAttributes:e=>{var t;return{href:(t=e.data)==null?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[],{protocols:t,defaultProtocol:n}=this.options;return this.options.autolink&&e.push(lo({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!z(s,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),e.push(co({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&e.push(uo({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),e}}),fo=Object.defineProperty,ho=(e,t)=>{for(var n in t)fo(e,n,{get:t[n],enumerable:!0})},mo="listItem",Ve="textStyle",qe=/^\s*([-+*])\s$/,Mt=I.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:e}){return["ul",A(this.options.HTMLAttributes,e),0]},markdownTokenName:"list",parseMarkdown:(e,t)=>e.type!=="list"||e.ordered?[]:{type:"bulletList",content:e.items?t.parseChildren(e.items):[]},renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(mo,this.editor.getAttributes(Ve)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=V({find:qe,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=V({find:qe,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Ve),editor:this.editor})),[e]}}),wt=I.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",A(this.options.HTMLAttributes,e),0]},markdownTokenName:"list_item",parseMarkdown:(e,t)=>{if(e.type!=="list_item")return[];let n=[];if(e.tokens&&e.tokens.length>0)if(e.tokens.some(s=>s.type==="paragraph"))n=t.parseChildren(e.tokens);else{const s=e.tokens[0];if(s&&s.type==="text"&&s.tokens&&s.tokens.length>0){if(n=[{type:"paragraph",content:t.parseInline(s.tokens)}],e.tokens.length>1){const i=e.tokens.slice(1),a=t.parseChildren(i);n.push(...a)}}else n=t.parseChildren(e.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(e,t,n)=>Ie(e,t,r=>{var s,o;return r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${(((o=(s=r.meta)==null?void 0:s.parentAttrs)==null?void 0:o.start)||1)+r.index}. `:"- "},n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ko={};ho(ko,{findListItemPos:()=>Q,getNextListDepth:()=>_e,handleBackspace:()=>ye,handleDelete:()=>ve,hasListBefore:()=>xt,hasListItemAfter:()=>go,hasListItemBefore:()=>Tt,listItemHasSubList:()=>At,nextListIsDeeper:()=>Ct,nextListIsHigher:()=>Lt});var Q=(e,t)=>{const{$from:n}=t.selection,r=L(e,t.schema);let s=null,o=n.depth,i=n.pos,a=null;for(;o>0&&a===null;)s=n.node(o),s.type===r?a=o:(o-=1,i-=1);return a===null?null:{$pos:t.doc.resolve(i),depth:a}},_e=(e,t)=>{const n=Q(e,t);if(!n)return!1;const[,r]=Pr(t,e,n.$pos.pos+4);return r},xt=(e,t,n)=>{const{$anchor:r}=e.selection,s=Math.max(0,r.pos-2),o=e.doc.resolve(s).node();return!(!o||!n.includes(o.type.name))},Tt=(e,t)=>{var n;const{$anchor:r}=t.selection,s=t.doc.resolve(r.pos-2);return!(s.index()===0||((n=s.nodeBefore)==null?void 0:n.type.name)!==e)},At=(e,t,n)=>{if(!n)return!1;const r=L(e,t.schema);let s=!1;return n.descendants(o=>{o.type===r&&(s=!0)}),s},ye=(e,t,n)=>{if(e.commands.undoInputRule())return!0;if(e.state.selection.from!==e.state.selection.to)return!1;if(!K(e.state,t)&&xt(e.state,t,n)){const{$anchor:a}=e.state.selection,l=e.state.doc.resolve(a.before()-1),c=[];l.node().descendants((p,f)=>{p.type.name===t&&c.push({node:p,pos:f})});const u=c.at(-1);if(!u)return!1;const d=e.state.doc.resolve(l.start()+u.pos+1);return e.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!K(e.state,t)||!Nr(e.state))return!1;const r=Q(t,e.state);if(!r)return!1;const o=e.state.doc.resolve(r.$pos.pos-2).node(r.depth),i=At(t,e.state,o);return Tt(t,e.state)&&!i?e.commands.joinItemBackward():e.chain().liftListItem(t).run()},Ct=(e,t)=>{const n=_e(e,t),r=Q(e,t);return!r||!n?!1:n>r.depth},Lt=(e,t)=>{const n=_e(e,t),r=Q(e,t);return!r||!n?!1:n<r.depth},ve=(e,t)=>{if(!K(e.state,t)||!Rr(e.state,t))return!1;const{selection:n}=e.state,{$from:r,$to:s}=n;return!n.empty&&r.sameParent(s)?!1:Ct(t,e.state)?e.chain().focus(e.state.selection.from+4).lift(t).joinBackward().run():Lt(t,e.state)?e.chain().joinForward().joinBackward().run():e.commands.joinItemForward()},go=(e,t)=>{var n;const{$anchor:r}=t.selection,s=t.doc.resolve(r.pos-r.parentOffset-2);return!(s.index()===s.parent.childCount-1||((n=s.nodeAfter)==null?void 0:n.type.name)!==e)},Et=C.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n})=>{e.state.schema.nodes[n]!==void 0&&ve(e,n)&&(t=!0)}),t},"Mod-Delete":({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n})=>{e.state.schema.nodes[n]!==void 0&&ve(e,n)&&(t=!0)}),t},Backspace:({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{e.state.schema.nodes[n]!==void 0&&ye(e,n,r)&&(t=!0)}),t},"Mod-Backspace":({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{e.state.schema.nodes[n]!==void 0&&ye(e,n,r)&&(t=!0)}),t}}}}),Ge=/^(\s*)(\d+)\.\s+(.*)$/,yo=/^\s/;function vo(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n],o=s.match(Ge);if(!o)break;const[,i,a,l]=o,c=i.length;let u=l,d=n+1;const p=[s];for(;d<e.length;){const f=e[d];if(f.match(Ge))break;if(f.trim()==="")p.push(f),u+=`
`,d+=1;else if(f.match(yo))p.push(f),u+=`
${f.slice(c+2)}`,d+=1;else break}t.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:p.join(`
`)}),r=d,n=d}return[t,r]}function St(e,t,n){var r;const s=[];let o=0;for(;o<e.length;){const i=e[o];if(i.indent===t){const a=i.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const f=n.blockTokens(u);c.push(...f)}let d=o+1;const p=[];for(;d<e.length&&e[d].indent>t;)p.push(e[d]),d+=1;if(p.length>0){const f=Math.min(...p.map(h=>h.indent)),k=St(p,f,n);c.push({type:"list",ordered:!0,start:p[0].number,items:k,raw:p.map(h=>h.raw).join(`
`)})}s.push({type:"list_item",raw:i.raw,tokens:c}),o=d}else o+=1}return s}function bo(e,t){return e.map(n=>{if(n.type!=="list_item")return t.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(s=>{if(s.type==="paragraph"||s.type==="list"||s.type==="blockquote"||s.type==="code")r.push(...t.parseChildren([s]));else if(s.type==="text"&&s.tokens){const o=t.parseChildren([s]);r.push({type:"paragraph",content:o})}else{const o=t.parseChildren([s]);o.length>0&&r.push(...o)}}),{type:"listItem",content:r}})}var Mo="listItem",Je="textStyle",Xe=/^(\d+)\.\s$/,$t=I.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1},type:{default:null,parseHTML:e=>e.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return t===1?["ol",A(this.options.HTMLAttributes,n),0]:["ol",A(this.options.HTMLAttributes,e),0]},markdownTokenName:"list",parseMarkdown:(e,t)=>{if(e.type!=="list"||!e.ordered)return[];const n=e.start||1,r=e.items?bo(e.items,t):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:e=>{const t=e.match(/^(\s*)(\d+)\.\s+/),n=t==null?void 0:t.index;return n!==void 0?n:-1},tokenize:(e,t,n)=>{var r;const s=e.split(`
`),[o,i]=vo(s);if(o.length===0)return;const a=St(o,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=o[0])==null?void 0:r.number)||1,items:a,raw:s.slice(0,i).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Mo,this.editor.getAttributes(Je)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=V({find:Xe,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=V({find:Xe,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(Je)}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1],editor:this.editor})),[e]}}),wo=/^\s*(\[([( |x])?\])\s$/,xo=I.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:e=>{const t=e.getAttribute("data-checked");return t===""||t==="true"},renderHTML:e=>({"data-checked":e.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:e,HTMLAttributes:t}){return["li",A(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:e.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(e,t)=>{const n=[];if(e.tokens&&e.tokens.length>0?n.push(t.createNode("paragraph",{},t.parseInline(e.tokens))):e.text?n.push(t.createNode("paragraph",{},[t.createNode("text",{text:e.text})])):n.push(t.createNode("paragraph",{},[])),e.nestedTokens&&e.nestedTokens.length>0){const r=t.parseChildren(e.nestedTokens);n.push(...r)}return t.createNode("taskItem",{checked:e.checked||!1},n)},renderMarkdown:(e,t)=>{var n;const s=`- [${(n=e.attrs)!=null&&n.checked?"x":" "}] `;return Ie(e,t,s)},addKeyboardShortcuts(){const e={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...e,Tab:()=>this.editor.commands.sinkListItem(this.name)}:e},addNodeView(){return({node:e,HTMLAttributes:t,getPos:n,editor:r})=>{const s=document.createElement("li"),o=document.createElement("label"),i=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=d=>{var p,f;a.ariaLabel=((f=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:f.call(p,d,a.checked))||`Task item checkbox for ${d.textContent||"empty task item"}`};c(e),o.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",d=>d.preventDefault()),a.addEventListener("change",d=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:p}=d.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const k=n();if(typeof k!="number")return!1;const h=f.doc.nodeAt(k);return f.setNodeMarkup(k,void 0,{...h==null?void 0:h.attrs,checked:p}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(e,p)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([d,p])=>{s.setAttribute(d,p)}),s.dataset.checked=e.attrs.checked,a.checked=e.attrs.checked,o.append(a,i),s.append(o,l),Object.entries(t).forEach(([d,p])=>{s.setAttribute(d,p)});let u=new Set(Object.keys(t));return{dom:s,contentDOM:l,update:d=>{if(d.type!==this.type)return!1;s.dataset.checked=d.attrs.checked,a.checked=d.attrs.checked,c(d);const p=r.extensionManager.attributes,f=me(d,p),k=new Set(Object.keys(f)),h=this.options.HTMLAttributes;return u.forEach(g=>{k.has(g)||(g in h?s.setAttribute(g,h[g]):s.removeAttribute(g))}),Object.entries(f).forEach(([g,m])=>{m==null?g in h?s.setAttribute(g,h[g]):s.removeAttribute(g):s.setAttribute(g,m)}),u=k,!0}}}},addInputRules(){return[V({find:wo,type:this.type,getAttributes:e=>({checked:e[e.length-1]==="x"})})]}}),To=I.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:e}){return["ul",A(this.options.HTMLAttributes,e,{"data-type":this.name}),0]},parseMarkdown:(e,t)=>t.createNode("taskList",{},t.parseChildren(e.items||[])),renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(e){var t;const n=(t=e.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:t.index;return n!==void 0?n:-1},tokenize(e,t,n){const r=o=>{const i=ge(o,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return i?[{type:"taskList",raw:i.raw,items:i.items}]:n.blockTokens(o)},s=ge(e,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,i)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:n.inlineTokens(o.mainContent),nestedTokens:i}),customNestedParser:r},n);if(s)return{type:"taskList",raw:s.raw,items:s.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});C.create({name:"listKit",addExtensions(){const e=[];return this.options.bulletList!==!1&&e.push(Mt.configure(this.options.bulletList)),this.options.listItem!==!1&&e.push(wt.configure(this.options.listItem)),this.options.listKeymap!==!1&&e.push(Et.configure(this.options.listKeymap)),this.options.orderedList!==!1&&e.push($t.configure(this.options.orderedList)),this.options.taskItem!==!1&&e.push(xo.configure(this.options.taskItem)),this.options.taskList!==!1&&e.push(To.configure(this.options.taskList)),e}});var Ze="&nbsp;",Ao="",Co=I.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:e}){return["p",A(this.options.HTMLAttributes,e),0]},parseMarkdown:(e,t)=>{const n=e.tokens||[];if(n.length===1&&n[0].type==="image")return t.parseChildren([n[0]]);const r=t.parseInline(n);return r.length===1&&r[0].type==="text"&&(r[0].text===Ze||r[0].text===Ao)?t.createNode("paragraph",void 0,[]):t.createNode("paragraph",void 0,r)},renderMarkdown:(e,t)=>{if(!e)return"";const n=Array.isArray(e.content)?e.content:[];return n.length===0?Ze:t.renderChildren(n)},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Lo=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Eo=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,So=G.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["s",A(this.options.HTMLAttributes,e),0]},markdownTokenName:"del",parseMarkdown:(e,t)=>t.applyMark("strike",t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>`~~${t.renderChildren(e)}~~`,addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[U({find:Lo,type:this.type})]},addPasteRules(){return[F({find:Eo,type:this.type})]}}),$o=I.create({name:"text",group:"inline",parseMarkdown:e=>({type:"text",text:e.text||""}),renderMarkdown:e=>e.text||""}),Io=G.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["u",A(this.options.HTMLAttributes,e),0]},parseMarkdown(e,t){return t.applyMark(this.name||"underline",t.parseInline(e.tokens||[]))},renderMarkdown(e,t){return`++${t.renderChildren(e)}++`},markdownTokenizer:{name:"underline",level:"inline",start(e){return e.indexOf("++")},tokenize(e,t,n){const s=/^(\+\+)([\s\S]+?)(\+\+)/.exec(e);if(!s)return;const o=s[2].trim();return{type:"underline",raw:s[0],text:o,tokens:n.inlineTokens(o)}}},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});C.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:e=>e.length,wordCounter:e=>e.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=e=>{const t=(e==null?void 0:e.node)||this.editor.state.doc;if(((e==null?void 0:e.mode)||this.options.mode)==="textSize"){const r=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(r)}return t.nodeSize},this.storage.words=e=>{const t=(e==null?void 0:e.node)||this.editor.state.doc,n=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let e=!1;return[new S({key:new $("characterCount"),appendTransaction:(t,n,r)=>{if(e)return;const s=this.options.limit;if(s==null||s===0){e=!0;return}const o=this.storage.characters({node:r.doc});if(o>s){const i=o-s,a=0,l=i;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return e=!0,c}e=!0},filterTransaction:(t,n)=>{const r=this.options.limit;if(!t.docChanged||r===0||r===null||r===void 0)return!0;const s=this.storage.characters({node:n.doc}),o=this.storage.characters({node:t.doc});if(o<=r||s>r&&o>r&&o<=s)return!0;if(s>r&&o>r&&o>s||!t.getMeta("paste"))return!1;const a=t.selection.$head.pos,l=o-r,c=a-l,u=a;return t.deleteRange(c,u),!(this.storage.characters({node:t.doc})>r)}})]}});var Po=C.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[un(this.options)]}});C.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new S({key:new $("focus"),props:{decorations:({doc:e,selection:t})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:s}=t,o=[];if(!n||!r)return oe.create(e,[]);let i=0;this.options.mode==="deepest"&&e.descendants((l,c)=>{if(l.isText)return;if(!(s>=c&&s<=c+l.nodeSize-1))return!1;i+=1});let a=0;return e.descendants((l,c)=>{if(l.isText||!(s>=c&&s<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&i-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";o.push(Me.node(c,c+l.nodeSize,{class:this.options.className}))}),oe.create(e,o)}}})]}});var _o=C.create({name:"gapCursor",addProseMirrorPlugins(){return[pn()]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=T(b(e,"allowGapCursor",n)))!=null?t:null}}}),Qe="placeholder";function Ro(e){return e.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}C.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:Qe,placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){const e=this.options.dataAttribute?`data-${Ro(this.options.dataAttribute)}`:`data-${Qe}`;return[new S({key:new $("placeholder"),props:{decorations:({doc:t,selection:n})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=n,o=[];if(!r)return null;const i=this.editor.isEmpty;return t.descendants((a,l)=>{const c=s>=l&&s<=l+a.nodeSize,u=!a.isLeaf&&Le(a);if((c||!this.options.showOnlyCurrent)&&u){const d=[this.options.emptyNodeClass];i&&d.push(this.options.emptyEditorClass);const p=Me.node(l,l+a.nodeSize,{class:d.join(" "),[e]:typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:l,hasAnchor:c}):this.options.placeholder});o.push(p)}return this.options.includeChildren}),oe.create(t,o)}}})]}});C.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:e,options:t}=this;return[new S({key:new $("selection"),props:{decorations(n){return n.selection.empty||e.isFocused||!e.isEditable||pt(n.selection)||e.view.dragging?null:oe.create(n.doc,[Me.inline(n.selection.from,n.selection.to,{class:t.className})])}}})]}});function Ye({types:e,node:t}){return t&&Array.isArray(e)&&e.includes(t.type)||(t==null?void 0:t.type)===e}var No=C.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var e;const t=new $(this.name),n=this.options.node||((e=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:e.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(n).includes(s.name));return[new S({key:t,appendTransaction:(s,o,i)=>{const{doc:a,tr:l,schema:c}=i,u=t.getState(i),d=a.content.size,p=c.nodes[n];if(u)return l.insert(d,p.create())},state:{init:(s,o)=>{const i=o.tr.doc.lastChild;return!Ye({node:i,types:r})},apply:(s,o)=>{if(!s.docChanged||s.getMeta("__uniqueIDTransaction"))return o;const i=s.doc.lastChild;return!Ye({node:i,types:r})}}})]}}),Oo=C.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>mn(e,t),redo:()=>({state:e,dispatch:t})=>hn(e,t)}},addProseMirrorPlugins(){return[fn(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}});C.create({name:"starterKit",addExtensions(){var e,t,n,r;const s=[];return this.options.bold!==!1&&s.push(Fs.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(Hs.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push(Mt.configure(this.options.bulletList)),this.options.code!==!1&&s.push(Us.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(Gs.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(Js.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(Po.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(_o.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(Xs.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(Zs.configure(this.options.heading)),this.options.undoRedo!==!1&&s.push(Oo.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&s.push(Qs.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push(ro.configure(this.options.italic)),this.options.listItem!==!1&&s.push(wt.configure(this.options.listItem)),this.options.listKeymap!==!1&&s.push(Et.configure((e=this.options)==null?void 0:e.listKeymap)),this.options.link!==!1&&s.push(po.configure((t=this.options)==null?void 0:t.link)),this.options.orderedList!==!1&&s.push($t.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(Co.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(So.configure(this.options.strike)),this.options.text!==!1&&s.push($o.configure(this.options.text)),this.options.underline!==!1&&s.push(Io.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&s.push(No.configure((r=this.options)==null?void 0:r.trailingNode)),s}});export{xs as B,Ts as I,Do as M,Fo as i};
