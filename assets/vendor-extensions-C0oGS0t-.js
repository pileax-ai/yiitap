import{ah as mi,ai as gi,aj as _i,ak as yi,al as Dr,am as bi,an as Br,ao as jr,ap as wi,aq as Ur,ar as or}from"./vendor-BGgN9CvK.js";function ki(e){return Object.prototype.toString.call(e)}function bn(e){return ki(e)==="[object String]"}const xi=Object.prototype.hasOwnProperty;function Ci(e,t){return xi.call(e,t)}function vt(e){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n){if(typeof n!="object")throw new TypeError(n+"must be object");Object.keys(n).forEach(function(r){e[r]=n[r]})}}),e}function Wr(e,t,n){return[].concat(e.slice(0,t),n,e.slice(t+1))}function wn(e){return!(e>=55296&&e<=57343||e>=64976&&e<=65007||(e&65535)===65535||(e&65535)===65534||e>=0&&e<=8||e===11||e>=14&&e<=31||e>=127&&e<=159||e>1114111)}function At(e){if(e>65535){e-=65536;const t=55296+(e>>10),n=56320+(e&1023);return String.fromCharCode(t,n)}return String.fromCharCode(e)}const zr=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,Ai=/&([a-z#][a-z0-9]{1,31});/gi,Si=new RegExp(zr.source+"|"+Ai.source,"gi"),Ei=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function Pi(e,t){if(t.charCodeAt(0)===35&&Ei.test(t)){const r=t[1].toLowerCase()==="x"?parseInt(t.slice(2),16):parseInt(t.slice(1),10);return wn(r)?At(r):e}const n=Dr(e);return n!==e?n:e}function Ri(e){return e.indexOf("\\")<0?e:e.replace(zr,"$1")}function Me(e){return e.indexOf("\\")<0&&e.indexOf("&")<0?e:e.replace(Si,function(t,n,r){return n||Pi(t,r)})}const vi=/[&<>"]/,Ii=/[&<>"]/g,$i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Mi(e){return $i[e]}function pe(e){return vi.test(e)?e.replace(Ii,Mi):e}const Ti=/[.?*+^$[\]\\(){}|-]/g;function Oi(e){return e.replace(Ti,"\\$&")}function M(e){switch(e){case 9:case 32:return!0}return!1}function He(e){if(e>=8192&&e<=8202)return!0;switch(e){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function Xe(e){return _i.test(e)||yi.test(e)}function Ve(e){switch(e){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function It(e){return e=e.trim().replace(/\s+/g," "),"ẞ".toLowerCase()==="Ṿ"&&(e=e.replace(/ẞ/g,"ß")),e.toLowerCase().toUpperCase()}const Fi={mdurl:gi,ucmicro:mi},Li=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt:Wr,assign:vt,escapeHtml:pe,escapeRE:Oi,fromCodePoint:At,has:Ci,isMdAsciiPunct:Ve,isPunctChar:Xe,isSpace:M,isString:bn,isValidEntityCode:wn,isWhiteSpace:He,lib:Fi,normalizeReference:It,unescapeAll:Me,unescapeMd:Ri},Symbol.toStringTag,{value:"Module"}));function Ni(e,t,n){let r,s,i,o;const a=e.posMax,l=e.pos;for(e.pos=t+1,r=1;e.pos<a;){if(i=e.src.charCodeAt(e.pos),i===93&&(r--,r===0)){s=!0;break}if(o=e.pos,e.md.inline.skipToken(e),i===91){if(o===e.pos-1)r++;else if(n)return e.pos=l,-1}}let c=-1;return s&&(c=e.pos),e.pos=l,c}function Di(e,t,n){let r,s=t;const i={ok:!1,pos:0,str:""};if(e.charCodeAt(s)===60){for(s++;s<n;){if(r=e.charCodeAt(s),r===10||r===60)return i;if(r===62)return i.pos=s+1,i.str=Me(e.slice(t+1,s)),i.ok=!0,i;if(r===92&&s+1<n){s+=2;continue}s++}return i}let o=0;for(;s<n&&(r=e.charCodeAt(s),!(r===32||r<32||r===127));){if(r===92&&s+1<n){if(e.charCodeAt(s+1)===32)break;s+=2;continue}if(r===40&&(o++,o>32))return i;if(r===41){if(o===0)break;o--}s++}return t===s||o!==0||(i.str=Me(e.slice(t,s)),i.pos=s,i.ok=!0),i}function Bi(e,t,n,r){let s,i=t;const o={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(r)o.str=r.str,o.marker=r.marker;else{if(i>=n)return o;let a=e.charCodeAt(i);if(a!==34&&a!==39&&a!==40)return o;t++,i++,a===40&&(a=41),o.marker=a}for(;i<n;){if(s=e.charCodeAt(i),s===o.marker)return o.pos=i+1,o.str+=Me(e.slice(t,i)),o.ok=!0,o;if(s===40&&o.marker===41)return o;s===92&&i+1<n&&i++,i++}return o.can_continue=!0,o.str+=Me(e.slice(t,i)),o}const ji=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination:Di,parseLinkLabel:Ni,parseLinkTitle:Bi},Symbol.toStringTag,{value:"Module"})),se={};se.code_inline=function(e,t,n,r,s){const i=e[t];return"<code"+s.renderAttrs(i)+">"+pe(i.content)+"</code>"};se.code_block=function(e,t,n,r,s){const i=e[t];return"<pre"+s.renderAttrs(i)+"><code>"+pe(e[t].content)+`</code></pre>
`};se.fence=function(e,t,n,r,s){const i=e[t],o=i.info?Me(i.info).trim():"";let a="",l="";if(o){const f=o.split(/(\s+)/g);a=f[0],l=f.slice(2).join("")}let c;if(n.highlight?c=n.highlight(i.content,a,l)||pe(i.content):c=pe(i.content),c.indexOf("<pre")===0)return c+`
`;if(o){const f=i.attrIndex("class"),u=i.attrs?i.attrs.slice():[];f<0?u.push(["class",n.langPrefix+a]):(u[f]=u[f].slice(),u[f][1]+=" "+n.langPrefix+a);const p={attrs:u};return`<pre><code${s.renderAttrs(p)}>${c}</code></pre>
`}return`<pre><code${s.renderAttrs(i)}>${c}</code></pre>
`};se.image=function(e,t,n,r,s){const i=e[t];return i.attrs[i.attrIndex("alt")][1]=s.renderInlineAsText(i.children,n,r),s.renderToken(e,t,n)};se.hardbreak=function(e,t,n){return n.xhtmlOut?`<br />
`:`<br>
`};se.softbreak=function(e,t,n){return n.breaks?n.xhtmlOut?`<br />
`:`<br>
`:`
`};se.text=function(e,t){return pe(e[t].content)};se.html_block=function(e,t){return e[t].content};se.html_inline=function(e,t){return e[t].content};function Te(){this.rules=vt({},se)}Te.prototype.renderAttrs=function(t){let n,r,s;if(!t.attrs)return"";for(s="",n=0,r=t.attrs.length;n<r;n++)s+=" "+pe(t.attrs[n][0])+'="'+pe(t.attrs[n][1])+'"';return s};Te.prototype.renderToken=function(t,n,r){const s=t[n];let i="";if(s.hidden)return"";s.block&&s.nesting!==-1&&n&&t[n-1].hidden&&(i+=`
`),i+=(s.nesting===-1?"</":"<")+s.tag,i+=this.renderAttrs(s),s.nesting===0&&r.xhtmlOut&&(i+=" /");let o=!1;if(s.block&&(o=!0,s.nesting===1&&n+1<t.length)){const a=t[n+1];(a.type==="inline"||a.hidden||a.nesting===-1&&a.tag===s.tag)&&(o=!1)}return i+=o?`>
`:">",i};Te.prototype.renderInline=function(e,t,n){let r="";const s=this.rules;for(let i=0,o=e.length;i<o;i++){const a=e[i].type;typeof s[a]<"u"?r+=s[a](e,i,t,n,this):r+=this.renderToken(e,i,t)}return r};Te.prototype.renderInlineAsText=function(e,t,n){let r="";for(let s=0,i=e.length;s<i;s++)switch(e[s].type){case"text":r+=e[s].content;break;case"image":r+=this.renderInlineAsText(e[s].children,t,n);break;case"html_inline":case"html_block":r+=e[s].content;break;case"softbreak":case"hardbreak":r+=`
`;break}return r};Te.prototype.render=function(e,t,n){let r="";const s=this.rules;for(let i=0,o=e.length;i<o;i++){const a=e[i].type;a==="inline"?r+=this.renderInline(e[i].children,t,n):typeof s[a]<"u"?r+=s[a](e,i,t,n,this):r+=this.renderToken(e,i,t,n)}return r};function q(){this.__rules__=[],this.__cache__=null}q.prototype.__find__=function(e){for(let t=0;t<this.__rules__.length;t++)if(this.__rules__[t].name===e)return t;return-1};q.prototype.__compile__=function(){const e=this,t=[""];e.__rules__.forEach(function(n){n.enabled&&n.alt.forEach(function(r){t.indexOf(r)<0&&t.push(r)})}),e.__cache__={},t.forEach(function(n){e.__cache__[n]=[],e.__rules__.forEach(function(r){r.enabled&&(n&&r.alt.indexOf(n)<0||e.__cache__[n].push(r.fn))})})};q.prototype.at=function(e,t,n){const r=this.__find__(e),s=n||{};if(r===-1)throw new Error("Parser rule not found: "+e);this.__rules__[r].fn=t,this.__rules__[r].alt=s.alt||[],this.__cache__=null};q.prototype.before=function(e,t,n,r){const s=this.__find__(e),i=r||{};if(s===-1)throw new Error("Parser rule not found: "+e);this.__rules__.splice(s,0,{name:t,enabled:!0,fn:n,alt:i.alt||[]}),this.__cache__=null};q.prototype.after=function(e,t,n,r){const s=this.__find__(e),i=r||{};if(s===-1)throw new Error("Parser rule not found: "+e);this.__rules__.splice(s+1,0,{name:t,enabled:!0,fn:n,alt:i.alt||[]}),this.__cache__=null};q.prototype.push=function(e,t,n){const r=n||{};this.__rules__.push({name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};q.prototype.enable=function(e,t){Array.isArray(e)||(e=[e]);const n=[];return e.forEach(function(r){const s=this.__find__(r);if(s<0){if(t)return;throw new Error("Rules manager: invalid rule name "+r)}this.__rules__[s].enabled=!0,n.push(r)},this),this.__cache__=null,n};q.prototype.enableOnly=function(e,t){Array.isArray(e)||(e=[e]),this.__rules__.forEach(function(n){n.enabled=!1}),this.enable(e,t)};q.prototype.disable=function(e,t){Array.isArray(e)||(e=[e]);const n=[];return e.forEach(function(r){const s=this.__find__(r);if(s<0){if(t)return;throw new Error("Rules manager: invalid rule name "+r)}this.__rules__[s].enabled=!1,n.push(r)},this),this.__cache__=null,n};q.prototype.getRules=function(e){return this.__cache__===null&&this.__compile__(),this.__cache__[e]||[]};function Y(e,t,n){this.type=e,this.tag=t,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Y.prototype.attrIndex=function(t){if(!this.attrs)return-1;const n=this.attrs;for(let r=0,s=n.length;r<s;r++)if(n[r][0]===t)return r;return-1};Y.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]};Y.prototype.attrSet=function(t,n){const r=this.attrIndex(t),s=[t,n];r<0?this.attrPush(s):this.attrs[r]=s};Y.prototype.attrGet=function(t){const n=this.attrIndex(t);let r=null;return n>=0&&(r=this.attrs[n][1]),r};Y.prototype.attrJoin=function(t,n){const r=this.attrIndex(t);r<0?this.attrPush([t,n]):this.attrs[r][1]=this.attrs[r][1]+" "+n};function qr(e,t,n){this.src=e,this.env=n,this.tokens=[],this.inlineMode=!1,this.md=t}qr.prototype.Token=Y;const Ui=/\r\n?|\n/g,Wi=/\0/g;function zi(e){let t;t=e.src.replace(Ui,`
`),t=t.replace(Wi,"�"),e.src=t}function qi(e){let t;e.inlineMode?(t=new e.Token("inline","",0),t.content=e.src,t.map=[0,1],t.children=[],e.tokens.push(t)):e.md.block.parse(e.src,e.md,e.env,e.tokens)}function Ji(e){const t=e.tokens;for(let n=0,r=t.length;n<r;n++){const s=t[n];s.type==="inline"&&e.md.inline.parse(s.content,e.md,e.env,s.children)}}function Hi(e){return/^<a[>\s]/i.test(e)}function Xi(e){return/^<\/a\s*>/i.test(e)}function Vi(e){const t=e.tokens;if(e.md.options.linkify)for(let n=0,r=t.length;n<r;n++){if(t[n].type!=="inline"||!e.md.linkify.pretest(t[n].content))continue;let s=t[n].children,i=0;for(let o=s.length-1;o>=0;o--){const a=s[o];if(a.type==="link_close"){for(o--;s[o].level!==a.level&&s[o].type!=="link_open";)o--;continue}if(a.type==="html_inline"&&(Hi(a.content)&&i>0&&i--,Xi(a.content)&&i++),!(i>0)&&a.type==="text"&&e.md.linkify.test(a.content)){const l=a.content;let c=e.md.linkify.match(l);const f=[];let u=a.level,p=0;c.length>0&&c[0].index===0&&o>0&&s[o-1].type==="text_special"&&(c=c.slice(1));for(let d=0;d<c.length;d++){const h=c[d].url,y=e.md.normalizeLink(h);if(!e.md.validateLink(y))continue;let _=c[d].text;c[d].schema?c[d].schema==="mailto:"&&!/^mailto:/i.test(_)?_=e.md.normalizeLinkText("mailto:"+_).replace(/^mailto:/,""):_=e.md.normalizeLinkText(_):_=e.md.normalizeLinkText("http://"+_).replace(/^http:\/\//,"");const P=c[d].index;if(P>p){const k=new e.Token("text","",0);k.content=l.slice(p,P),k.level=u,f.push(k)}const m=new e.Token("link_open","a",1);m.attrs=[["href",y]],m.level=u++,m.markup="linkify",m.info="auto",f.push(m);const b=new e.Token("text","",0);b.content=_,b.level=u,f.push(b);const g=new e.Token("link_close","a",-1);g.level=--u,g.markup="linkify",g.info="auto",f.push(g),p=c[d].lastIndex}if(p<l.length){const d=new e.Token("text","",0);d.content=l.slice(p),d.level=u,f.push(d)}t[n].children=s=Wr(s,o,f)}}}}const Jr=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,Gi=/\((c|tm|r)\)/i,Qi=/\((c|tm|r)\)/ig,Ki={c:"©",r:"®",tm:"™"};function Zi(e,t){return Ki[t.toLowerCase()]}function Yi(e){let t=0;for(let n=e.length-1;n>=0;n--){const r=e[n];r.type==="text"&&!t&&(r.content=r.content.replace(Qi,Zi)),r.type==="link_open"&&r.info==="auto"&&t--,r.type==="link_close"&&r.info==="auto"&&t++}}function eo(e){let t=0;for(let n=e.length-1;n>=0;n--){const r=e[n];r.type==="text"&&!t&&Jr.test(r.content)&&(r.content=r.content.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1—").replace(/(^|\s)--(?=\s|$)/mg,"$1–").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1–")),r.type==="link_open"&&r.info==="auto"&&t--,r.type==="link_close"&&r.info==="auto"&&t++}}function to(e){let t;if(e.md.options.typographer)for(t=e.tokens.length-1;t>=0;t--)e.tokens[t].type==="inline"&&(Gi.test(e.tokens[t].content)&&Yi(e.tokens[t].children),Jr.test(e.tokens[t].content)&&eo(e.tokens[t].children))}const no=/['"]/,ar=/['"]/g,lr="’";function at(e,t,n){return e.slice(0,t)+n+e.slice(t+1)}function ro(e,t){let n;const r=[];for(let s=0;s<e.length;s++){const i=e[s],o=e[s].level;for(n=r.length-1;n>=0&&!(r[n].level<=o);n--);if(r.length=n+1,i.type!=="text")continue;let a=i.content,l=0,c=a.length;e:for(;l<c;){ar.lastIndex=l;const f=ar.exec(a);if(!f)break;let u=!0,p=!0;l=f.index+1;const d=f[0]==="'";let h=32;if(f.index-1>=0)h=a.charCodeAt(f.index-1);else for(n=s-1;n>=0&&!(e[n].type==="softbreak"||e[n].type==="hardbreak");n--)if(e[n].content){h=e[n].content.charCodeAt(e[n].content.length-1);break}let y=32;if(l<c)y=a.charCodeAt(l);else for(n=s+1;n<e.length&&!(e[n].type==="softbreak"||e[n].type==="hardbreak");n++)if(e[n].content){y=e[n].content.charCodeAt(0);break}const _=Ve(h)||Xe(String.fromCharCode(h)),P=Ve(y)||Xe(String.fromCharCode(y)),m=He(h),b=He(y);if(b?u=!1:P&&(m||_||(u=!1)),m?p=!1:_&&(b||P||(p=!1)),y===34&&f[0]==='"'&&h>=48&&h<=57&&(p=u=!1),u&&p&&(u=_,p=P),!u&&!p){d&&(i.content=at(i.content,f.index,lr));continue}if(p)for(n=r.length-1;n>=0;n--){let g=r[n];if(r[n].level<o)break;if(g.single===d&&r[n].level===o){g=r[n];let k,w;d?(k=t.md.options.quotes[2],w=t.md.options.quotes[3]):(k=t.md.options.quotes[0],w=t.md.options.quotes[1]),i.content=at(i.content,f.index,w),e[g.token].content=at(e[g.token].content,g.pos,k),l+=w.length-1,g.token===s&&(l+=k.length-1),a=i.content,c=a.length,r.length=n;continue e}}u?r.push({token:s,pos:f.index,single:d,level:o}):p&&d&&(i.content=at(i.content,f.index,lr))}}}function so(e){if(e.md.options.typographer)for(let t=e.tokens.length-1;t>=0;t--)e.tokens[t].type!=="inline"||!no.test(e.tokens[t].content)||ro(e.tokens[t].children,e)}function io(e){let t,n;const r=e.tokens,s=r.length;for(let i=0;i<s;i++){if(r[i].type!=="inline")continue;const o=r[i].children,a=o.length;for(t=0;t<a;t++)o[t].type==="text_special"&&(o[t].type="text");for(t=n=0;t<a;t++)o[t].type==="text"&&t+1<a&&o[t+1].type==="text"?o[t+1].content=o[t].content+o[t+1].content:(t!==n&&(o[n]=o[t]),n++);t!==n&&(o.length=n)}}const Jt=[["normalize",zi],["block",qi],["inline",Ji],["linkify",Vi],["replacements",to],["smartquotes",so],["text_join",io]];function kn(){this.ruler=new q;for(let e=0;e<Jt.length;e++)this.ruler.push(Jt[e][0],Jt[e][1])}kn.prototype.process=function(e){const t=this.ruler.getRules("");for(let n=0,r=t.length;n<r;n++)t[n](e)};kn.prototype.State=qr;function ie(e,t,n,r){this.src=e,this.md=t,this.env=n,this.tokens=r,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const s=this.src;for(let i=0,o=0,a=0,l=0,c=s.length,f=!1;o<c;o++){const u=s.charCodeAt(o);if(!f)if(M(u)){a++,u===9?l+=4-l%4:l++;continue}else f=!0;(u===10||o===c-1)&&(u!==10&&o++,this.bMarks.push(i),this.eMarks.push(o),this.tShift.push(a),this.sCount.push(l),this.bsCount.push(0),f=!1,a=0,l=0,i=o+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}ie.prototype.push=function(e,t,n){const r=new Y(e,t,n);return r.block=!0,n<0&&this.level--,r.level=this.level,n>0&&this.level++,this.tokens.push(r),r};ie.prototype.isEmpty=function(t){return this.bMarks[t]+this.tShift[t]>=this.eMarks[t]};ie.prototype.skipEmptyLines=function(t){for(let n=this.lineMax;t<n&&!(this.bMarks[t]+this.tShift[t]<this.eMarks[t]);t++);return t};ie.prototype.skipSpaces=function(t){for(let n=this.src.length;t<n;t++){const r=this.src.charCodeAt(t);if(!M(r))break}return t};ie.prototype.skipSpacesBack=function(t,n){if(t<=n)return t;for(;t>n;)if(!M(this.src.charCodeAt(--t)))return t+1;return t};ie.prototype.skipChars=function(t,n){for(let r=this.src.length;t<r&&this.src.charCodeAt(t)===n;t++);return t};ie.prototype.skipCharsBack=function(t,n,r){if(t<=r)return t;for(;t>r;)if(n!==this.src.charCodeAt(--t))return t+1;return t};ie.prototype.getLines=function(t,n,r,s){if(t>=n)return"";const i=new Array(n-t);for(let o=0,a=t;a<n;a++,o++){let l=0;const c=this.bMarks[a];let f=c,u;for(a+1<n||s?u=this.eMarks[a]+1:u=this.eMarks[a];f<u&&l<r;){const p=this.src.charCodeAt(f);if(M(p))p===9?l+=4-(l+this.bsCount[a])%4:l++;else if(f-c<this.tShift[a])l++;else break;f++}l>r?i[o]=new Array(l-r+1).join(" ")+this.src.slice(f,u):i[o]=this.src.slice(f,u)}return i.join("")};ie.prototype.Token=Y;const oo=65536;function Ht(e,t){const n=e.bMarks[t]+e.tShift[t],r=e.eMarks[t];return e.src.slice(n,r)}function cr(e){const t=[],n=e.length;let r=0,s=e.charCodeAt(r),i=!1,o=0,a="";for(;r<n;)s===124&&(i?(a+=e.substring(o,r-1),o=r):(t.push(a+e.substring(o,r)),a="",o=r+1)),i=s===92,r++,s=e.charCodeAt(r);return t.push(a+e.substring(o)),t}function ao(e,t,n,r){if(t+2>n)return!1;let s=t+1;if(e.sCount[s]<e.blkIndent||e.sCount[s]-e.blkIndent>=4)return!1;let i=e.bMarks[s]+e.tShift[s];if(i>=e.eMarks[s])return!1;const o=e.src.charCodeAt(i++);if(o!==124&&o!==45&&o!==58||i>=e.eMarks[s])return!1;const a=e.src.charCodeAt(i++);if(a!==124&&a!==45&&a!==58&&!M(a)||o===45&&M(a))return!1;for(;i<e.eMarks[s];){const g=e.src.charCodeAt(i);if(g!==124&&g!==45&&g!==58&&!M(g))return!1;i++}let l=Ht(e,t+1),c=l.split("|");const f=[];for(let g=0;g<c.length;g++){const k=c[g].trim();if(!k){if(g===0||g===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(k))return!1;k.charCodeAt(k.length-1)===58?f.push(k.charCodeAt(0)===58?"center":"right"):k.charCodeAt(0)===58?f.push("left"):f.push("")}if(l=Ht(e,t).trim(),l.indexOf("|")===-1||e.sCount[t]-e.blkIndent>=4)return!1;c=cr(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop();const u=c.length;if(u===0||u!==f.length)return!1;if(r)return!0;const p=e.parentType;e.parentType="table";const d=e.md.block.ruler.getRules("blockquote"),h=e.push("table_open","table",1),y=[t,0];h.map=y;const _=e.push("thead_open","thead",1);_.map=[t,t+1];const P=e.push("tr_open","tr",1);P.map=[t,t+1];for(let g=0;g<c.length;g++){const k=e.push("th_open","th",1);f[g]&&(k.attrs=[["style","text-align:"+f[g]]]);const w=e.push("inline","",0);w.content=c[g].trim(),w.children=[],e.push("th_close","th",-1)}e.push("tr_close","tr",-1),e.push("thead_close","thead",-1);let m,b=0;for(s=t+2;s<n&&!(e.sCount[s]<e.blkIndent);s++){let g=!1;for(let w=0,C=d.length;w<C;w++)if(d[w](e,s,n,!0)){g=!0;break}if(g||(l=Ht(e,s).trim(),!l)||e.sCount[s]-e.blkIndent>=4||(c=cr(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop(),b+=u-c.length,b>oo))break;if(s===t+2){const w=e.push("tbody_open","tbody",1);w.map=m=[t+2,0]}const k=e.push("tr_open","tr",1);k.map=[s,s+1];for(let w=0;w<u;w++){const C=e.push("td_open","td",1);f[w]&&(C.attrs=[["style","text-align:"+f[w]]]);const T=e.push("inline","",0);T.content=c[w]?c[w].trim():"",T.children=[],e.push("td_close","td",-1)}e.push("tr_close","tr",-1)}return m&&(e.push("tbody_close","tbody",-1),m[1]=s),e.push("table_close","table",-1),y[1]=s,e.parentType=p,e.line=s,!0}function lo(e,t,n){if(e.sCount[t]-e.blkIndent<4)return!1;let r=t+1,s=r;for(;r<n;){if(e.isEmpty(r)){r++;continue}if(e.sCount[r]-e.blkIndent>=4){r++,s=r;continue}break}e.line=s;const i=e.push("code_block","code",0);return i.content=e.getLines(t,s,4+e.blkIndent,!1)+`
`,i.map=[t,e.line],!0}function co(e,t,n,r){let s=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4||s+3>i)return!1;const o=e.src.charCodeAt(s);if(o!==126&&o!==96)return!1;let a=s;s=e.skipChars(s,o);let l=s-a;if(l<3)return!1;const c=e.src.slice(a,s),f=e.src.slice(s,i);if(o===96&&f.indexOf(String.fromCharCode(o))>=0)return!1;if(r)return!0;let u=t,p=!1;for(;u++,!(u>=n||(s=a=e.bMarks[u]+e.tShift[u],i=e.eMarks[u],s<i&&e.sCount[u]<e.blkIndent));)if(e.src.charCodeAt(s)===o&&!(e.sCount[u]-e.blkIndent>=4)&&(s=e.skipChars(s,o),!(s-a<l)&&(s=e.skipSpaces(s),!(s<i)))){p=!0;break}l=e.sCount[t],e.line=u+(p?1:0);const d=e.push("fence","code",0);return d.info=f,d.content=e.getLines(t+1,u,l,!0),d.markup=c,d.map=[t,e.line],!0}function uo(e,t,n,r){let s=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];const o=e.lineMax;if(e.sCount[t]-e.blkIndent>=4||e.src.charCodeAt(s)!==62)return!1;if(r)return!0;const a=[],l=[],c=[],f=[],u=e.md.block.ruler.getRules("blockquote"),p=e.parentType;e.parentType="blockquote";let d=!1,h;for(h=t;h<n;h++){const b=e.sCount[h]<e.blkIndent;if(s=e.bMarks[h]+e.tShift[h],i=e.eMarks[h],s>=i)break;if(e.src.charCodeAt(s++)===62&&!b){let k=e.sCount[h]+1,w,C;e.src.charCodeAt(s)===32?(s++,k++,C=!1,w=!0):e.src.charCodeAt(s)===9?(w=!0,(e.bsCount[h]+k)%4===3?(s++,k++,C=!1):C=!0):w=!1;let T=k;for(a.push(e.bMarks[h]),e.bMarks[h]=s;s<i;){const v=e.src.charCodeAt(s);if(M(v))v===9?T+=4-(T+e.bsCount[h]+(C?1:0))%4:T++;else break;s++}d=s>=i,l.push(e.bsCount[h]),e.bsCount[h]=e.sCount[h]+1+(w?1:0),c.push(e.sCount[h]),e.sCount[h]=T-k,f.push(e.tShift[h]),e.tShift[h]=s-e.bMarks[h];continue}if(d)break;let g=!1;for(let k=0,w=u.length;k<w;k++)if(u[k](e,h,n,!0)){g=!0;break}if(g){e.lineMax=h,e.blkIndent!==0&&(a.push(e.bMarks[h]),l.push(e.bsCount[h]),f.push(e.tShift[h]),c.push(e.sCount[h]),e.sCount[h]-=e.blkIndent);break}a.push(e.bMarks[h]),l.push(e.bsCount[h]),f.push(e.tShift[h]),c.push(e.sCount[h]),e.sCount[h]=-1}const y=e.blkIndent;e.blkIndent=0;const _=e.push("blockquote_open","blockquote",1);_.markup=">";const P=[t,0];_.map=P,e.md.block.tokenize(e,t,h);const m=e.push("blockquote_close","blockquote",-1);m.markup=">",e.lineMax=o,e.parentType=p,P[1]=e.line;for(let b=0;b<f.length;b++)e.bMarks[b+t]=a[b],e.tShift[b+t]=f[b],e.sCount[b+t]=c[b],e.bsCount[b+t]=l[b];return e.blkIndent=y,!0}function fo(e,t,n,r){const s=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4)return!1;let i=e.bMarks[t]+e.tShift[t];const o=e.src.charCodeAt(i++);if(o!==42&&o!==45&&o!==95)return!1;let a=1;for(;i<s;){const c=e.src.charCodeAt(i++);if(c!==o&&!M(c))return!1;c===o&&a++}if(a<3)return!1;if(r)return!0;e.line=t+1;const l=e.push("hr","hr",0);return l.map=[t,e.line],l.markup=Array(a+1).join(String.fromCharCode(o)),!0}function ur(e,t){const n=e.eMarks[t];let r=e.bMarks[t]+e.tShift[t];const s=e.src.charCodeAt(r++);if(s!==42&&s!==45&&s!==43)return-1;if(r<n){const i=e.src.charCodeAt(r);if(!M(i))return-1}return r}function fr(e,t){const n=e.bMarks[t]+e.tShift[t],r=e.eMarks[t];let s=n;if(s+1>=r)return-1;let i=e.src.charCodeAt(s++);if(i<48||i>57)return-1;for(;;){if(s>=r)return-1;if(i=e.src.charCodeAt(s++),i>=48&&i<=57){if(s-n>=10)return-1;continue}if(i===41||i===46)break;return-1}return s<r&&(i=e.src.charCodeAt(s),!M(i))?-1:s}function ho(e,t){const n=e.level+2;for(let r=t+2,s=e.tokens.length-2;r<s;r++)e.tokens[r].level===n&&e.tokens[r].type==="paragraph_open"&&(e.tokens[r+2].hidden=!0,e.tokens[r].hidden=!0,r+=2)}function po(e,t,n,r){let s,i,o,a,l=t,c=!0;if(e.sCount[l]-e.blkIndent>=4||e.listIndent>=0&&e.sCount[l]-e.listIndent>=4&&e.sCount[l]<e.blkIndent)return!1;let f=!1;r&&e.parentType==="paragraph"&&e.sCount[l]>=e.blkIndent&&(f=!0);let u,p,d;if((d=fr(e,l))>=0){if(u=!0,o=e.bMarks[l]+e.tShift[l],p=Number(e.src.slice(o,d-1)),f&&p!==1)return!1}else if((d=ur(e,l))>=0)u=!1;else return!1;if(f&&e.skipSpaces(d)>=e.eMarks[l])return!1;if(r)return!0;const h=e.src.charCodeAt(d-1),y=e.tokens.length;u?(a=e.push("ordered_list_open","ol",1),p!==1&&(a.attrs=[["start",p]])):a=e.push("bullet_list_open","ul",1);const _=[l,0];a.map=_,a.markup=String.fromCharCode(h);let P=!1;const m=e.md.block.ruler.getRules("list"),b=e.parentType;for(e.parentType="list";l<n;){i=d,s=e.eMarks[l];const g=e.sCount[l]+d-(e.bMarks[l]+e.tShift[l]);let k=g;for(;i<s;){const oe=e.src.charCodeAt(i);if(oe===9)k+=4-(k+e.bsCount[l])%4;else if(oe===32)k++;else break;i++}const w=i;let C;w>=s?C=1:C=k-g,C>4&&(C=1);const T=g+C;a=e.push("list_item_open","li",1),a.markup=String.fromCharCode(h);const v=[l,0];a.map=v,u&&(a.info=e.src.slice(o,d-1));const I=e.tight,R=e.tShift[l],ce=e.sCount[l],Ne=e.listIndent;if(e.listIndent=e.blkIndent,e.blkIndent=T,e.tight=!0,e.tShift[l]=w-e.bMarks[l],e.sCount[l]=k,w>=s&&e.isEmpty(l+1)?e.line=Math.min(e.line+2,n):e.md.block.tokenize(e,l,n,!0),(!e.tight||P)&&(c=!1),P=e.line-l>1&&e.isEmpty(e.line-1),e.blkIndent=e.listIndent,e.listIndent=Ne,e.tShift[l]=R,e.sCount[l]=ce,e.tight=I,a=e.push("list_item_close","li",-1),a.markup=String.fromCharCode(h),l=e.line,v[1]=l,l>=n||e.sCount[l]<e.blkIndent||e.sCount[l]-e.blkIndent>=4)break;let ot=!1;for(let oe=0,pi=m.length;oe<pi;oe++)if(m[oe](e,l,n,!0)){ot=!0;break}if(ot)break;if(u){if(d=fr(e,l),d<0)break;o=e.bMarks[l]+e.tShift[l]}else if(d=ur(e,l),d<0)break;if(h!==e.src.charCodeAt(d-1))break}return u?a=e.push("ordered_list_close","ol",-1):a=e.push("bullet_list_close","ul",-1),a.markup=String.fromCharCode(h),_[1]=l,e.line=l,e.parentType=b,c&&ho(e,y),!0}function mo(e,t,n,r){let s=e.bMarks[t]+e.tShift[t],i=e.eMarks[t],o=t+1;if(e.sCount[t]-e.blkIndent>=4||e.src.charCodeAt(s)!==91)return!1;function a(m){const b=e.lineMax;if(m>=b||e.isEmpty(m))return null;let g=!1;if(e.sCount[m]-e.blkIndent>3&&(g=!0),e.sCount[m]<0&&(g=!0),!g){const C=e.md.block.ruler.getRules("reference"),T=e.parentType;e.parentType="reference";let v=!1;for(let I=0,R=C.length;I<R;I++)if(C[I](e,m,b,!0)){v=!0;break}if(e.parentType=T,v)return null}const k=e.bMarks[m]+e.tShift[m],w=e.eMarks[m];return e.src.slice(k,w+1)}let l=e.src.slice(s,i+1);i=l.length;let c=-1;for(s=1;s<i;s++){const m=l.charCodeAt(s);if(m===91)return!1;if(m===93){c=s;break}else if(m===10){const b=a(o);b!==null&&(l+=b,i=l.length,o++)}else if(m===92&&(s++,s<i&&l.charCodeAt(s)===10)){const b=a(o);b!==null&&(l+=b,i=l.length,o++)}}if(c<0||l.charCodeAt(c+1)!==58)return!1;for(s=c+2;s<i;s++){const m=l.charCodeAt(s);if(m===10){const b=a(o);b!==null&&(l+=b,i=l.length,o++)}else if(!M(m))break}const f=e.md.helpers.parseLinkDestination(l,s,i);if(!f.ok)return!1;const u=e.md.normalizeLink(f.str);if(!e.md.validateLink(u))return!1;s=f.pos;const p=s,d=o,h=s;for(;s<i;s++){const m=l.charCodeAt(s);if(m===10){const b=a(o);b!==null&&(l+=b,i=l.length,o++)}else if(!M(m))break}let y=e.md.helpers.parseLinkTitle(l,s,i);for(;y.can_continue;){const m=a(o);if(m===null)break;l+=m,s=i,i=l.length,o++,y=e.md.helpers.parseLinkTitle(l,s,i,y)}let _;for(s<i&&h!==s&&y.ok?(_=y.str,s=y.pos):(_="",s=p,o=d);s<i;){const m=l.charCodeAt(s);if(!M(m))break;s++}if(s<i&&l.charCodeAt(s)!==10&&_)for(_="",s=p,o=d;s<i;){const m=l.charCodeAt(s);if(!M(m))break;s++}if(s<i&&l.charCodeAt(s)!==10)return!1;const P=It(l.slice(1,c));return P?(r||(typeof e.env.references>"u"&&(e.env.references={}),typeof e.env.references[P]>"u"&&(e.env.references[P]={title:_,href:u}),e.line=o),!0):!1}const go=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],_o="[a-zA-Z_:][a-zA-Z0-9:._-]*",yo="[^\"'=<>`\\x00-\\x20]+",bo="'[^']*'",wo='"[^"]*"',ko="(?:"+yo+"|"+bo+"|"+wo+")",xo="(?:\\s+"+_o+"(?:\\s*=\\s*"+ko+")?)",Hr="<[A-Za-z][A-Za-z0-9\\-]*"+xo+"*\\s*\\/?>",Xr="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",Co="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",Ao="<[?][\\s\\S]*?[?]>",So="<![A-Za-z][^>]*>",Eo="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",Po=new RegExp("^(?:"+Hr+"|"+Xr+"|"+Co+"|"+Ao+"|"+So+"|"+Eo+")"),Ro=new RegExp("^(?:"+Hr+"|"+Xr+")"),ke=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+go.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(Ro.source+"\\s*$"),/^$/,!1]];function vo(e,t,n,r){let s=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4||!e.md.options.html||e.src.charCodeAt(s)!==60)return!1;let o=e.src.slice(s,i),a=0;for(;a<ke.length&&!ke[a][0].test(o);a++);if(a===ke.length)return!1;if(r)return ke[a][2];let l=t+1;if(!ke[a][1].test(o)){for(;l<n&&!(e.sCount[l]<e.blkIndent);l++)if(s=e.bMarks[l]+e.tShift[l],i=e.eMarks[l],o=e.src.slice(s,i),ke[a][1].test(o)){o.length!==0&&l++;break}}e.line=l;const c=e.push("html_block","",0);return c.map=[t,l],c.content=e.getLines(t,l,e.blkIndent,!0),!0}function Io(e,t,n,r){let s=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];if(e.sCount[t]-e.blkIndent>=4)return!1;let o=e.src.charCodeAt(s);if(o!==35||s>=i)return!1;let a=1;for(o=e.src.charCodeAt(++s);o===35&&s<i&&a<=6;)a++,o=e.src.charCodeAt(++s);if(a>6||s<i&&!M(o))return!1;if(r)return!0;i=e.skipSpacesBack(i,s);const l=e.skipCharsBack(i,35,s);l>s&&M(e.src.charCodeAt(l-1))&&(i=l),e.line=t+1;const c=e.push("heading_open","h"+String(a),1);c.markup="########".slice(0,a),c.map=[t,e.line];const f=e.push("inline","",0);f.content=e.src.slice(s,i).trim(),f.map=[t,e.line],f.children=[];const u=e.push("heading_close","h"+String(a),-1);return u.markup="########".slice(0,a),!0}function $o(e,t,n){const r=e.md.block.ruler.getRules("paragraph");if(e.sCount[t]-e.blkIndent>=4)return!1;const s=e.parentType;e.parentType="paragraph";let i=0,o,a=t+1;for(;a<n&&!e.isEmpty(a);a++){if(e.sCount[a]-e.blkIndent>3)continue;if(e.sCount[a]>=e.blkIndent){let d=e.bMarks[a]+e.tShift[a];const h=e.eMarks[a];if(d<h&&(o=e.src.charCodeAt(d),(o===45||o===61)&&(d=e.skipChars(d,o),d=e.skipSpaces(d),d>=h))){i=o===61?1:2;break}}if(e.sCount[a]<0)continue;let p=!1;for(let d=0,h=r.length;d<h;d++)if(r[d](e,a,n,!0)){p=!0;break}if(p)break}if(!i)return!1;const l=e.getLines(t,a,e.blkIndent,!1).trim();e.line=a+1;const c=e.push("heading_open","h"+String(i),1);c.markup=String.fromCharCode(o),c.map=[t,e.line];const f=e.push("inline","",0);f.content=l,f.map=[t,e.line-1],f.children=[];const u=e.push("heading_close","h"+String(i),-1);return u.markup=String.fromCharCode(o),e.parentType=s,!0}function Mo(e,t,n){const r=e.md.block.ruler.getRules("paragraph"),s=e.parentType;let i=t+1;for(e.parentType="paragraph";i<n&&!e.isEmpty(i);i++){if(e.sCount[i]-e.blkIndent>3||e.sCount[i]<0)continue;let c=!1;for(let f=0,u=r.length;f<u;f++)if(r[f](e,i,n,!0)){c=!0;break}if(c)break}const o=e.getLines(t,i,e.blkIndent,!1).trim();e.line=i;const a=e.push("paragraph_open","p",1);a.map=[t,e.line];const l=e.push("inline","",0);return l.content=o,l.map=[t,e.line],l.children=[],e.push("paragraph_close","p",-1),e.parentType=s,!0}const lt=[["table",ao,["paragraph","reference"]],["code",lo],["fence",co,["paragraph","reference","blockquote","list"]],["blockquote",uo,["paragraph","reference","blockquote","list"]],["hr",fo,["paragraph","reference","blockquote","list"]],["list",po,["paragraph","reference","blockquote"]],["reference",mo],["html_block",vo,["paragraph","reference","blockquote"]],["heading",Io,["paragraph","reference","blockquote"]],["lheading",$o],["paragraph",Mo]];function $t(){this.ruler=new q;for(let e=0;e<lt.length;e++)this.ruler.push(lt[e][0],lt[e][1],{alt:(lt[e][2]||[]).slice()})}$t.prototype.tokenize=function(e,t,n){const r=this.ruler.getRules(""),s=r.length,i=e.md.options.maxNesting;let o=t,a=!1;for(;o<n&&(e.line=o=e.skipEmptyLines(o),!(o>=n||e.sCount[o]<e.blkIndent));){if(e.level>=i){e.line=n;break}const l=e.line;let c=!1;for(let f=0;f<s;f++)if(c=r[f](e,o,n,!1),c){if(l>=e.line)throw new Error("block rule didn't increment state.line");break}if(!c)throw new Error("none of the block rules matched");e.tight=!a,e.isEmpty(e.line-1)&&(a=!0),o=e.line,o<n&&e.isEmpty(o)&&(a=!0,o++,e.line=o)}};$t.prototype.parse=function(e,t,n,r){if(!e)return;const s=new this.State(e,t,n,r);this.tokenize(s,s.line,s.lineMax)};$t.prototype.State=ie;function Ke(e,t,n,r){this.src=e,this.env=n,this.md=t,this.tokens=r,this.tokens_meta=Array(r.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}Ke.prototype.pushPending=function(){const e=new Y("text","",0);return e.content=this.pending,e.level=this.pendingLevel,this.tokens.push(e),this.pending="",e};Ke.prototype.push=function(e,t,n){this.pending&&this.pushPending();const r=new Y(e,t,n);let s=null;return n<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),r.level=this.level,n>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],s={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(r),this.tokens_meta.push(s),r};Ke.prototype.scanDelims=function(e,t){const n=this.posMax,r=this.src.charCodeAt(e),s=e>0?this.src.charCodeAt(e-1):32;let i=e;for(;i<n&&this.src.charCodeAt(i)===r;)i++;const o=i-e,a=i<n?this.src.charCodeAt(i):32,l=Ve(s)||Xe(String.fromCharCode(s)),c=Ve(a)||Xe(String.fromCharCode(a)),f=He(s),u=He(a),p=!u&&(!c||f||l),d=!f&&(!l||u||c);return{can_open:p&&(t||!d||l),can_close:d&&(t||!p||c),length:o}};Ke.prototype.Token=Y;function To(e){switch(e){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function Oo(e,t){let n=e.pos;for(;n<e.posMax&&!To(e.src.charCodeAt(n));)n++;return n===e.pos?!1:(t||(e.pending+=e.src.slice(e.pos,n)),e.pos=n,!0)}const Fo=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function Lo(e,t){if(!e.md.options.linkify||e.linkLevel>0)return!1;const n=e.pos,r=e.posMax;if(n+3>r||e.src.charCodeAt(n)!==58||e.src.charCodeAt(n+1)!==47||e.src.charCodeAt(n+2)!==47)return!1;const s=e.pending.match(Fo);if(!s)return!1;const i=s[1],o=e.md.linkify.matchAtStart(e.src.slice(n-i.length));if(!o)return!1;let a=o.url;if(a.length<=i.length)return!1;let l=a.length;for(;l>0&&a.charCodeAt(l-1)===42;)l--;l!==a.length&&(a=a.slice(0,l));const c=e.md.normalizeLink(a);if(!e.md.validateLink(c))return!1;if(!t){e.pending=e.pending.slice(0,-i.length);const f=e.push("link_open","a",1);f.attrs=[["href",c]],f.markup="linkify",f.info="auto";const u=e.push("text","",0);u.content=e.md.normalizeLinkText(a);const p=e.push("link_close","a",-1);p.markup="linkify",p.info="auto"}return e.pos+=a.length-i.length,!0}function No(e,t){let n=e.pos;if(e.src.charCodeAt(n)!==10)return!1;const r=e.pending.length-1,s=e.posMax;if(!t)if(r>=0&&e.pending.charCodeAt(r)===32)if(r>=1&&e.pending.charCodeAt(r-1)===32){let i=r-1;for(;i>=1&&e.pending.charCodeAt(i-1)===32;)i--;e.pending=e.pending.slice(0,i),e.push("hardbreak","br",0)}else e.pending=e.pending.slice(0,-1),e.push("softbreak","br",0);else e.push("softbreak","br",0);for(n++;n<s&&M(e.src.charCodeAt(n));)n++;return e.pos=n,!0}const xn=[];for(let e=0;e<256;e++)xn.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(e){xn[e.charCodeAt(0)]=1});function Do(e,t){let n=e.pos;const r=e.posMax;if(e.src.charCodeAt(n)!==92||(n++,n>=r))return!1;let s=e.src.charCodeAt(n);if(s===10){for(t||e.push("hardbreak","br",0),n++;n<r&&(s=e.src.charCodeAt(n),!!M(s));)n++;return e.pos=n,!0}let i=e.src[n];if(s>=55296&&s<=56319&&n+1<r){const a=e.src.charCodeAt(n+1);a>=56320&&a<=57343&&(i+=e.src[n+1],n++)}const o="\\"+i;if(!t){const a=e.push("text_special","",0);s<256&&xn[s]!==0?a.content=i:a.content=o,a.markup=o,a.info="escape"}return e.pos=n+1,!0}function Bo(e,t){let n=e.pos;if(e.src.charCodeAt(n)!==96)return!1;const s=n;n++;const i=e.posMax;for(;n<i&&e.src.charCodeAt(n)===96;)n++;const o=e.src.slice(s,n),a=o.length;if(e.backticksScanned&&(e.backticks[a]||0)<=s)return t||(e.pending+=o),e.pos+=a,!0;let l=n,c;for(;(c=e.src.indexOf("`",l))!==-1;){for(l=c+1;l<i&&e.src.charCodeAt(l)===96;)l++;const f=l-c;if(f===a){if(!t){const u=e.push("code_inline","code",0);u.markup=o,u.content=e.src.slice(n,c).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return e.pos=l,!0}e.backticks[f]=c}return e.backticksScanned=!0,t||(e.pending+=o),e.pos+=a,!0}function jo(e,t){const n=e.pos,r=e.src.charCodeAt(n);if(t||r!==126)return!1;const s=e.scanDelims(e.pos,!0);let i=s.length;const o=String.fromCharCode(r);if(i<2)return!1;let a;i%2&&(a=e.push("text","",0),a.content=o,i--);for(let l=0;l<i;l+=2)a=e.push("text","",0),a.content=o+o,e.delimiters.push({marker:r,length:0,token:e.tokens.length-1,end:-1,open:s.can_open,close:s.can_close});return e.pos+=s.length,!0}function hr(e,t){let n;const r=[],s=t.length;for(let i=0;i<s;i++){const o=t[i];if(o.marker!==126||o.end===-1)continue;const a=t[o.end];n=e.tokens[o.token],n.type="s_open",n.tag="s",n.nesting=1,n.markup="~~",n.content="",n=e.tokens[a.token],n.type="s_close",n.tag="s",n.nesting=-1,n.markup="~~",n.content="",e.tokens[a.token-1].type==="text"&&e.tokens[a.token-1].content==="~"&&r.push(a.token-1)}for(;r.length;){const i=r.pop();let o=i+1;for(;o<e.tokens.length&&e.tokens[o].type==="s_close";)o++;o--,i!==o&&(n=e.tokens[o],e.tokens[o]=e.tokens[i],e.tokens[i]=n)}}function Uo(e){const t=e.tokens_meta,n=e.tokens_meta.length;hr(e,e.delimiters);for(let r=0;r<n;r++)t[r]&&t[r].delimiters&&hr(e,t[r].delimiters)}const Vr={tokenize:jo,postProcess:Uo};function Wo(e,t){const n=e.pos,r=e.src.charCodeAt(n);if(t||r!==95&&r!==42)return!1;const s=e.scanDelims(e.pos,r===42);for(let i=0;i<s.length;i++){const o=e.push("text","",0);o.content=String.fromCharCode(r),e.delimiters.push({marker:r,length:s.length,token:e.tokens.length-1,end:-1,open:s.can_open,close:s.can_close})}return e.pos+=s.length,!0}function dr(e,t){const n=t.length;for(let r=n-1;r>=0;r--){const s=t[r];if(s.marker!==95&&s.marker!==42||s.end===-1)continue;const i=t[s.end],o=r>0&&t[r-1].end===s.end+1&&t[r-1].marker===s.marker&&t[r-1].token===s.token-1&&t[s.end+1].token===i.token+1,a=String.fromCharCode(s.marker),l=e.tokens[s.token];l.type=o?"strong_open":"em_open",l.tag=o?"strong":"em",l.nesting=1,l.markup=o?a+a:a,l.content="";const c=e.tokens[i.token];c.type=o?"strong_close":"em_close",c.tag=o?"strong":"em",c.nesting=-1,c.markup=o?a+a:a,c.content="",o&&(e.tokens[t[r-1].token].content="",e.tokens[t[s.end+1].token].content="",r--)}}function zo(e){const t=e.tokens_meta,n=e.tokens_meta.length;dr(e,e.delimiters);for(let r=0;r<n;r++)t[r]&&t[r].delimiters&&dr(e,t[r].delimiters)}const Gr={tokenize:Wo,postProcess:zo};function qo(e,t){let n,r,s,i,o="",a="",l=e.pos,c=!0;if(e.src.charCodeAt(e.pos)!==91)return!1;const f=e.pos,u=e.posMax,p=e.pos+1,d=e.md.helpers.parseLinkLabel(e,e.pos,!0);if(d<0)return!1;let h=d+1;if(h<u&&e.src.charCodeAt(h)===40){for(c=!1,h++;h<u&&(n=e.src.charCodeAt(h),!(!M(n)&&n!==10));h++);if(h>=u)return!1;if(l=h,s=e.md.helpers.parseLinkDestination(e.src,h,e.posMax),s.ok){for(o=e.md.normalizeLink(s.str),e.md.validateLink(o)?h=s.pos:o="",l=h;h<u&&(n=e.src.charCodeAt(h),!(!M(n)&&n!==10));h++);if(s=e.md.helpers.parseLinkTitle(e.src,h,e.posMax),h<u&&l!==h&&s.ok)for(a=s.str,h=s.pos;h<u&&(n=e.src.charCodeAt(h),!(!M(n)&&n!==10));h++);}(h>=u||e.src.charCodeAt(h)!==41)&&(c=!0),h++}if(c){if(typeof e.env.references>"u")return!1;if(h<u&&e.src.charCodeAt(h)===91?(l=h+1,h=e.md.helpers.parseLinkLabel(e,h),h>=0?r=e.src.slice(l,h++):h=d+1):h=d+1,r||(r=e.src.slice(p,d)),i=e.env.references[It(r)],!i)return e.pos=f,!1;o=i.href,a=i.title}if(!t){e.pos=p,e.posMax=d;const y=e.push("link_open","a",1),_=[["href",o]];y.attrs=_,a&&_.push(["title",a]),e.linkLevel++,e.md.inline.tokenize(e),e.linkLevel--,e.push("link_close","a",-1)}return e.pos=h,e.posMax=u,!0}function Jo(e,t){let n,r,s,i,o,a,l,c,f="";const u=e.pos,p=e.posMax;if(e.src.charCodeAt(e.pos)!==33||e.src.charCodeAt(e.pos+1)!==91)return!1;const d=e.pos+2,h=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(h<0)return!1;if(i=h+1,i<p&&e.src.charCodeAt(i)===40){for(i++;i<p&&(n=e.src.charCodeAt(i),!(!M(n)&&n!==10));i++);if(i>=p)return!1;for(c=i,a=e.md.helpers.parseLinkDestination(e.src,i,e.posMax),a.ok&&(f=e.md.normalizeLink(a.str),e.md.validateLink(f)?i=a.pos:f=""),c=i;i<p&&(n=e.src.charCodeAt(i),!(!M(n)&&n!==10));i++);if(a=e.md.helpers.parseLinkTitle(e.src,i,e.posMax),i<p&&c!==i&&a.ok)for(l=a.str,i=a.pos;i<p&&(n=e.src.charCodeAt(i),!(!M(n)&&n!==10));i++);else l="";if(i>=p||e.src.charCodeAt(i)!==41)return e.pos=u,!1;i++}else{if(typeof e.env.references>"u")return!1;if(i<p&&e.src.charCodeAt(i)===91?(c=i+1,i=e.md.helpers.parseLinkLabel(e,i),i>=0?s=e.src.slice(c,i++):i=h+1):i=h+1,s||(s=e.src.slice(d,h)),o=e.env.references[It(s)],!o)return e.pos=u,!1;f=o.href,l=o.title}if(!t){r=e.src.slice(d,h);const y=[];e.md.inline.parse(r,e.md,e.env,y);const _=e.push("image","img",0),P=[["src",f],["alt",""]];_.attrs=P,_.children=y,_.content=r,l&&P.push(["title",l])}return e.pos=i,e.posMax=p,!0}const Ho=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,Xo=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function Vo(e,t){let n=e.pos;if(e.src.charCodeAt(n)!==60)return!1;const r=e.pos,s=e.posMax;for(;;){if(++n>=s)return!1;const o=e.src.charCodeAt(n);if(o===60)return!1;if(o===62)break}const i=e.src.slice(r+1,n);if(Xo.test(i)){const o=e.md.normalizeLink(i);if(!e.md.validateLink(o))return!1;if(!t){const a=e.push("link_open","a",1);a.attrs=[["href",o]],a.markup="autolink",a.info="auto";const l=e.push("text","",0);l.content=e.md.normalizeLinkText(i);const c=e.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return e.pos+=i.length+2,!0}if(Ho.test(i)){const o=e.md.normalizeLink("mailto:"+i);if(!e.md.validateLink(o))return!1;if(!t){const a=e.push("link_open","a",1);a.attrs=[["href",o]],a.markup="autolink",a.info="auto";const l=e.push("text","",0);l.content=e.md.normalizeLinkText(i);const c=e.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return e.pos+=i.length+2,!0}return!1}function Go(e){return/^<a[>\s]/i.test(e)}function Qo(e){return/^<\/a\s*>/i.test(e)}function Ko(e){const t=e|32;return t>=97&&t<=122}function Zo(e,t){if(!e.md.options.html)return!1;const n=e.posMax,r=e.pos;if(e.src.charCodeAt(r)!==60||r+2>=n)return!1;const s=e.src.charCodeAt(r+1);if(s!==33&&s!==63&&s!==47&&!Ko(s))return!1;const i=e.src.slice(r).match(Po);if(!i)return!1;if(!t){const o=e.push("html_inline","",0);o.content=i[0],Go(o.content)&&e.linkLevel++,Qo(o.content)&&e.linkLevel--}return e.pos+=i[0].length,!0}const Yo=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,ea=/^&([a-z][a-z0-9]{1,31});/i;function ta(e,t){const n=e.pos,r=e.posMax;if(e.src.charCodeAt(n)!==38||n+1>=r)return!1;if(e.src.charCodeAt(n+1)===35){const i=e.src.slice(n).match(Yo);if(i){if(!t){const o=i[1][0].toLowerCase()==="x"?parseInt(i[1].slice(1),16):parseInt(i[1],10),a=e.push("text_special","",0);a.content=wn(o)?At(o):At(65533),a.markup=i[0],a.info="entity"}return e.pos+=i[0].length,!0}}else{const i=e.src.slice(n).match(ea);if(i){const o=Dr(i[0]);if(o!==i[0]){if(!t){const a=e.push("text_special","",0);a.content=o,a.markup=i[0],a.info="entity"}return e.pos+=i[0].length,!0}}}return!1}function pr(e){const t={},n=e.length;if(!n)return;let r=0,s=-2;const i=[];for(let o=0;o<n;o++){const a=e[o];if(i.push(0),(e[r].marker!==a.marker||s!==a.token-1)&&(r=o),s=a.token,a.length=a.length||0,!a.close)continue;t.hasOwnProperty(a.marker)||(t[a.marker]=[-1,-1,-1,-1,-1,-1]);const l=t[a.marker][(a.open?3:0)+a.length%3];let c=r-i[r]-1,f=c;for(;c>l;c-=i[c]+1){const u=e[c];if(u.marker===a.marker&&u.open&&u.end<0){let p=!1;if((u.close||a.open)&&(u.length+a.length)%3===0&&(u.length%3!==0||a.length%3!==0)&&(p=!0),!p){const d=c>0&&!e[c-1].open?i[c-1]+1:0;i[o]=o-c+d,i[c]=d,a.open=!1,u.end=o,u.close=!1,f=-1,s=-2;break}}}f!==-1&&(t[a.marker][(a.open?3:0)+(a.length||0)%3]=f)}}function na(e){const t=e.tokens_meta,n=e.tokens_meta.length;pr(e.delimiters);for(let r=0;r<n;r++)t[r]&&t[r].delimiters&&pr(t[r].delimiters)}function ra(e){let t,n,r=0;const s=e.tokens,i=e.tokens.length;for(t=n=0;t<i;t++)s[t].nesting<0&&r--,s[t].level=r,s[t].nesting>0&&r++,s[t].type==="text"&&t+1<i&&s[t+1].type==="text"?s[t+1].content=s[t].content+s[t+1].content:(t!==n&&(s[n]=s[t]),n++);t!==n&&(s.length=n)}const Xt=[["text",Oo],["linkify",Lo],["newline",No],["escape",Do],["backticks",Bo],["strikethrough",Vr.tokenize],["emphasis",Gr.tokenize],["link",qo],["image",Jo],["autolink",Vo],["html_inline",Zo],["entity",ta]],Vt=[["balance_pairs",na],["strikethrough",Vr.postProcess],["emphasis",Gr.postProcess],["fragments_join",ra]];function Ze(){this.ruler=new q;for(let e=0;e<Xt.length;e++)this.ruler.push(Xt[e][0],Xt[e][1]);this.ruler2=new q;for(let e=0;e<Vt.length;e++)this.ruler2.push(Vt[e][0],Vt[e][1])}Ze.prototype.skipToken=function(e){const t=e.pos,n=this.ruler.getRules(""),r=n.length,s=e.md.options.maxNesting,i=e.cache;if(typeof i[t]<"u"){e.pos=i[t];return}let o=!1;if(e.level<s){for(let a=0;a<r;a++)if(e.level++,o=n[a](e,!0),e.level--,o){if(t>=e.pos)throw new Error("inline rule didn't increment state.pos");break}}else e.pos=e.posMax;o||e.pos++,i[t]=e.pos};Ze.prototype.tokenize=function(e){const t=this.ruler.getRules(""),n=t.length,r=e.posMax,s=e.md.options.maxNesting;for(;e.pos<r;){const i=e.pos;let o=!1;if(e.level<s){for(let a=0;a<n;a++)if(o=t[a](e,!1),o){if(i>=e.pos)throw new Error("inline rule didn't increment state.pos");break}}if(o){if(e.pos>=r)break;continue}e.pending+=e.src[e.pos++]}e.pending&&e.pushPending()};Ze.prototype.parse=function(e,t,n,r){const s=new this.State(e,t,n,r);this.tokenize(s);const i=this.ruler2.getRules(""),o=i.length;for(let a=0;a<o;a++)i[a](s)};Ze.prototype.State=Ke;const sa={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},ia={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},oa={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},aa={default:sa,zero:ia,commonmark:oa},la=/^(vbscript|javascript|file|data):/,ca=/^data:image\/(gif|png|jpeg|webp);/;function ua(e){const t=e.trim().toLowerCase();return la.test(t)?ca.test(t):!0}const Qr=["http:","https:","mailto:"];function fa(e){const t=Br(e,!0);if(t.hostname&&(!t.protocol||Qr.indexOf(t.protocol)>=0))try{t.hostname=jr.toASCII(t.hostname)}catch{}return wi(Ur(t))}function ha(e){const t=Br(e,!0);if(t.hostname&&(!t.protocol||Qr.indexOf(t.protocol)>=0))try{t.hostname=jr.toUnicode(t.hostname)}catch{}return or(Ur(t),or.defaultChars+"%")}function Z(e,t){if(!(this instanceof Z))return new Z(e,t);t||bn(e)||(t=e||{},e="default"),this.inline=new Ze,this.block=new $t,this.core=new kn,this.renderer=new Te,this.linkify=new bi,this.validateLink=ua,this.normalizeLink=fa,this.normalizeLinkText=ha,this.utils=Li,this.helpers=vt({},ji),this.options={},this.configure(e),t&&this.set(t)}Z.prototype.set=function(e){return vt(this.options,e),this};Z.prototype.configure=function(e){const t=this;if(bn(e)){const n=e;if(e=aa[n],!e)throw new Error('Wrong `markdown-it` preset "'+n+'", check name')}if(!e)throw new Error("Wrong `markdown-it` preset, can't be empty");return e.options&&t.set(e.options),e.components&&Object.keys(e.components).forEach(function(n){e.components[n].rules&&t[n].ruler.enableOnly(e.components[n].rules),e.components[n].rules2&&t[n].ruler2.enableOnly(e.components[n].rules2)}),this};Z.prototype.enable=function(e,t){let n=[];Array.isArray(e)||(e=[e]),["core","block","inline"].forEach(function(s){n=n.concat(this[s].ruler.enable(e,!0))},this),n=n.concat(this.inline.ruler2.enable(e,!0));const r=e.filter(function(s){return n.indexOf(s)<0});if(r.length&&!t)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+r);return this};Z.prototype.disable=function(e,t){let n=[];Array.isArray(e)||(e=[e]),["core","block","inline"].forEach(function(s){n=n.concat(this[s].ruler.disable(e,!0))},this),n=n.concat(this.inline.ruler2.disable(e,!0));const r=e.filter(function(s){return n.indexOf(s)<0});if(r.length&&!t)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+r);return this};Z.prototype.use=function(e){const t=[this].concat(Array.prototype.slice.call(arguments,1));return e.apply(e,t),this};Z.prototype.parse=function(e,t){if(typeof e!="string")throw new Error("Input data should be a String");const n=new this.core.State(e,this,t);return this.core.process(n),n.tokens};Z.prototype.render=function(e,t){return t=t||{},this.renderer.render(this.parse(e,t),this.options,t)};Z.prototype.parseInline=function(e,t){const n=new this.core.State(e,this,t);return n.inlineMode=!0,this.core.process(n),n.tokens};Z.prototype.renderInline=function(e,t){return t=t||{},this.renderer.render(this.parseInline(e,t),this.options,t)};const on="RFC3986",an={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},da="RFC1738",pa=Array.isArray,ee=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),Gt=1024,ma=(e,t,n,r,s)=>{if(e.length===0)return e;let i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),n==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<i.length;a+=Gt){const l=i.length>=Gt?i.slice(a,a+Gt):i,c=[];for(let f=0;f<l.length;++f){let u=l.charCodeAt(f);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===da&&(u===40||u===41)){c[c.length]=l.charAt(f);continue}if(u<128){c[c.length]=ee[u];continue}if(u<2048){c[c.length]=ee[192|u>>6]+ee[128|u&63];continue}if(u<55296||u>=57344){c[c.length]=ee[224|u>>12]+ee[128|u>>6&63]+ee[128|u&63];continue}f+=1,u=65536+((u&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=ee[240|u>>18]+ee[128|u>>12&63]+ee[128|u>>6&63]+ee[128|u&63]}o+=c.join("")}return o};function ga(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function mr(e,t){if(pa(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const _a=Object.prototype.hasOwnProperty,Kr={brackets(e){return String(e)+"[]"},comma:"comma",indices(e,t){return String(e)+"["+t+"]"},repeat(e){return String(e)}},te=Array.isArray,ya=Array.prototype.push,Zr=function(e,t){ya.apply(e,te(t)?t:[t])},ba=Date.prototype.toISOString,N={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ma,encodeValuesOnly:!1,format:on,formatter:an[on],indices:!1,serializeDate(e){return ba.call(e)},skipNulls:!1,strictNullHandling:!1};function wa(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"}const Qt={};function Yr(e,t,n,r,s,i,o,a,l,c,f,u,p,d,h,y,_,P){let m=e,b=P,g=0,k=!1;for(;(b=b.get(Qt))!==void 0&&!k;){const I=b.get(e);if(g+=1,typeof I<"u"){if(I===g)throw new RangeError("Cyclic object value");k=!0}typeof b.get(Qt)>"u"&&(g=0)}if(typeof c=="function"?m=c(t,m):m instanceof Date?m=p==null?void 0:p(m):n==="comma"&&te(m)&&(m=mr(m,function(I){return I instanceof Date?p==null?void 0:p(I):I})),m===null){if(i)return l&&!y?l(t,N.encoder,_,"key",d):t;m=""}if(wa(m)||ga(m)){if(l){const I=y?t:l(t,N.encoder,_,"key",d);return[(h==null?void 0:h(I))+"="+(h==null?void 0:h(l(m,N.encoder,_,"value",d)))]}return[(h==null?void 0:h(t))+"="+(h==null?void 0:h(String(m)))]}const w=[];if(typeof m>"u")return w;let C;if(n==="comma"&&te(m))y&&l&&(m=mr(m,l)),C=[{value:m.length>0?m.join(",")||null:void 0}];else if(te(c))C=c;else{const I=Object.keys(m);C=f?I.sort(f):I}const T=a?String(t).replace(/\./g,"%2E"):String(t),v=r&&te(m)&&m.length===1?T+"[]":T;if(s&&te(m)&&m.length===0)return v+"[]";for(let I=0;I<C.length;++I){const R=C[I],ce=typeof R=="object"&&typeof R.value<"u"?R.value:m[R];if(o&&ce===null)continue;const Ne=u&&a?R.replace(/\./g,"%2E"):R,ot=te(m)?typeof n=="function"?n(v,Ne):v:v+(u?"."+Ne:"["+Ne+"]");P.set(e,g);const oe=new WeakMap;oe.set(Qt,P),Zr(w,Yr(ce,ot,n,r,s,i,o,a,n==="comma"&&y&&te(m)?null:l,c,f,u,p,d,h,y,_,oe))}return w}function ka(e=N){if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=e.charset||N.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=on;if(typeof e.format<"u"){if(!_a.call(an,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=an[n];let s=N.filter;(typeof e.filter=="function"||te(e.filter))&&(s=e.filter);let i;if(e.arrayFormat&&e.arrayFormat in Kr?i=e.arrayFormat:"indices"in e?i=e.indices?"indices":"repeat":i=N.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof e.allowDots>"u"?e.encodeDotInKeys?!0:N.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:N.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:N.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:N.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?N.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:N.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:N.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:N.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:N.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:N.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:N.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:N.strictNullHandling}}function xa(e,t={}){let n=e;const r=ka(t);let s,i;typeof r.filter=="function"?(i=r.filter,n=i("",n)):te(r.filter)&&(i=r.filter,s=i);const o=[];if(typeof n!="object"||n===null)return"";const a=Kr[r.arrayFormat],l=a==="comma"&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let p=0;p<s.length;++p){const d=s[p];r.skipNulls&&n[d]===null||Zr(o,Yr(n[d],d,a,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const f=o.join(r.delimiter);let u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),f.length>0?u+f:""}const Ee="4.104.0";let gr=!1,qe,es,ts,ln,ns,rs,ss,is,os;function Ca(e,t={auto:!1}){if(gr)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(qe)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${qe}'\``);gr=t.auto,qe=e.kind,es=e.fetch,ts=e.FormData,ln=e.File,ns=e.ReadableStream,rs=e.getMultipartRequestOptions,ss=e.getDefaultAgent,is=e.fileFromPath,os=e.isFsReadStream}class Aa{constructor(t){this.body=t}get[Symbol.toStringTag](){return"MultipartBody"}}function Sa({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,i;try{n=fetch,r=Request,s=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(o,a)=>({...a,body:new Aa(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1}}const as=()=>{qe||Ca(Sa(),{auto:!0})};as();class A extends Error{}class U extends A{constructor(t,n,r,s){super(`${U.makeMessage(t,n,r)}`),this.status=t,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=n;const i=n;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(t,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,n,r,s){if(!t||!s)return new Mt({message:r,cause:un(n)});const i=n==null?void 0:n.error;return t===400?new ls(t,i,r,s):t===401?new cs(t,i,r,s):t===403?new us(t,i,r,s):t===404?new fs(t,i,r,s):t===409?new hs(t,i,r,s):t===422?new ds(t,i,r,s):t===429?new ps(t,i,r,s):t>=500?new ms(t,i,r,s):new U(t,i,r,s)}}class V extends U{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Mt extends U{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class Cn extends Mt{constructor({message:t}={}){super({message:t??"Request timed out."})}}class ls extends U{}class cs extends U{}class us extends U{}class fs extends U{}class hs extends U{}class ds extends U{}class ps extends U{}class ms extends U{}class gs extends A{constructor(){super("Could not parse response content as the length limit was reached")}}class _s extends A{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var ct=function(e,t,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(e,n):s?s.value=n:t.set(e,n),n},_e=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},H;class Tt{constructor(){H.set(this,void 0),this.buffer=new Uint8Array,ct(this,H,null,"f")}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let r=new Uint8Array(this.buffer.length+n.length);r.set(this.buffer),r.set(n,this.buffer.length),this.buffer=r;const s=[];let i;for(;(i=Ea(this.buffer,_e(this,H,"f")))!=null;){if(i.carriage&&_e(this,H,"f")==null){ct(this,H,i.index,"f");continue}if(_e(this,H,"f")!=null&&(i.index!==_e(this,H,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,_e(this,H,"f")-1))),this.buffer=this.buffer.slice(_e(this,H,"f")),ct(this,H,null,"f");continue}const o=_e(this,H,"f")!==null?i.preceding-1:i.preceding,a=this.decodeText(this.buffer.slice(0,o));s.push(a),this.buffer=this.buffer.slice(i.index),ct(this,H,null,"f")}return s}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof Buffer<"u"){if(t instanceof Buffer)return t.toString();if(t instanceof Uint8Array)return Buffer.from(t).toString();throw new A(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new A(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new A("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}H=new WeakMap;Tt.NEWLINE_CHARS=new Set([`
`,"\r"]);Tt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ea(e,t){for(let s=t??0;s<e.length;s++){if(e[s]===10)return{preceding:s,index:s+1,carriage:!1};if(e[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Pa(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}function ys(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class re{constructor(t,n){this.iterator=t,this.controller=n}static fromSSEResponse(t,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of Ra(t,n))if(!i){if(o.data.startsWith("[DONE]")){i=!0;continue}if(o.event===null||o.event.startsWith("response.")||o.event.startsWith("transcript.")){let a;try{a=JSON.parse(o.data)}catch(l){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),l}if(a&&a.error)throw new U(void 0,a.error,void 0,Ss(t.headers));yield a}else{let a;try{a=JSON.parse(o.data)}catch(l){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),l}if(o.event=="error")throw new U(void 0,a.error,a.message,void 0);yield{event:o.event,data:a}}}i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||n.abort()}}return new re(s,n)}static fromReadableStream(t,n){let r=!1;async function*s(){const o=new Tt,a=ys(t);for await(const l of a)for(const c of o.decode(l))yield c;for(const l of o.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const a of s())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{o||n.abort()}}return new re(i,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const o=r.next();t.push(o),n.push(o)}return i.shift()}});return[new re(()=>s(t),this.controller),new re(()=>s(n),this.controller)]}toReadableStream(){const t=this;let n;const r=new TextEncoder;return new ns({async start(){n=t[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:o}=await n.next();if(o)return s.close();const a=r.encode(JSON.stringify(i)+`
`);s.enqueue(a)}catch(i){s.error(i)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}}async function*Ra(e,t){if(!e.body)throw t.abort(),new A("Attempted to iterate over a response with no body");const n=new Ia,r=new Tt,s=ys(e.body);for await(const i of va(s))for(const o of r.decode(i)){const a=n.decode(o);a&&(yield a)}for(const i of r.flush()){const o=n.decode(i);o&&(yield o)}}async function*va(e){let t=new Uint8Array;for await(const n of e){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(t.length+r.length);s.set(t),s.set(r,t.length),t=s;let i;for(;(i=Pa(t))!==-1;)yield t.slice(0,i),t=t.slice(i)}t.length>0&&(yield t)}class Ia{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,s]=$a(t,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function $a(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}const bs=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function",ws=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&Ot(e),Ot=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",Ma=e=>ws(e)||bs(e)||os(e);async function ks(e,t,n){var s;if(e=await e,ws(e))return e;if(bs(e)){const i=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=Ot(i)?[await i.arrayBuffer()]:[i];return new ln(o,t,n)}const r=await Ta(e);if(t||(t=Fa(e)??"unknown_file"),!(n!=null&&n.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(n={...n,type:i})}return new ln(r,t,n)}async function Ta(e){var n;let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Ot(e))t.push(await e.arrayBuffer());else if(La(e))for await(const r of e)t.push(r);else throw new Error(`Unexpected data type: ${typeof e}; constructor: ${(n=e==null?void 0:e.constructor)==null?void 0:n.name}; props: ${Oa(e)}`);return t}function Oa(e){return`[${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}function Fa(e){var t;return Kt(e.name)||Kt(e.filename)||((t=Kt(e.path))==null?void 0:t.split(/[\\/]/).pop())}const Kt=e=>{if(typeof e=="string")return e;if(typeof Buffer<"u"&&e instanceof Buffer)return String(e)},La=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function",_r=e=>e&&typeof e=="object"&&e.body&&e[Symbol.toStringTag]==="MultipartBody",we=async e=>{const t=await Na(e.body);return rs(t,e)},Na=async e=>{const t=new ts;return await Promise.all(Object.entries(e||{}).map(([n,r])=>cn(t,n,r))),t},cn=async(e,t,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")e.append(t,String(n));else if(Ma(n)){const r=await ks(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>cn(e,t+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>cn(e,`${t}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var ve={},Da=function(e,t,n,r,s){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n},Ba=function(e,t,n,r){if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ut;as();async function xs(e){var o;const{response:t}=e;if(e.options.stream)return de("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):re.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type"),r=(o=n==null?void 0:n.split(";")[0])==null?void 0:o.trim();if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.endsWith("+json"))){const a=await t.json();return de("response",t.status,t.url,t.headers,a),Cs(a,t)}const i=await t.text();return de("response",t.status,t.url,t.headers,i),i}function Cs(e,t){return!e||typeof e!="object"||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Ft extends Promise{constructor(t,n=xs){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n}_thenUnwrap(t){return new Ft(this.responsePromise,async n=>Cs(t(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}class ja{constructor({baseURL:t,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=t,this.maxRetries=Zt("maxRetries",n),this.timeout=Zt("timeout",r),this.httpAgent=s,this.fetch=i??es}authHeaders(t){return{}}defaultHeaders(t){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Ja(),...this.authHeaders(t)}}validateHeaders(t,n){}defaultIdempotencyKey(){return`stainless-node-retry-${Ga()}`}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&Ot(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:t,path:n,...s,body:i}}))}getAPIList(t,n,r){return this.requestAPIList(n,{method:"get",path:t,...r})}calculateContentLength(t){if(typeof t=="string"){if(typeof Buffer<"u")return Buffer.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}else if(ArrayBuffer.isView(t))return t.byteLength.toString();return null}buildRequest(t,{retryCount:n=0}={}){var y;const r={...t},{method:s,path:i,query:o,headers:a={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:_r(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,c=this.calculateContentLength(l),f=this.buildURL(i,o);"timeout"in r&&Zt("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const u=r.httpAgent??this.httpAgent??ss(f),p=r.timeout+1e3;typeof((y=u==null?void 0:u.options)==null?void 0:y.timeout)=="number"&&p>(u.options.timeout??0)&&(u.options.timeout=p),this.idempotencyHeader&&s!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=t.idempotencyKey);const d=this.buildHeaders({options:r,headers:a,contentLength:c,retryCount:n});return{req:{method:s,...l&&{body:l},headers:d,...u&&{agent:u},signal:r.signal??null},url:f,timeout:r.timeout}}buildHeaders({options:t,headers:n,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const o=this.defaultHeaders(t);return kr(i,o),kr(i,n),_r(t.body)&&qe!=="node"&&delete i["content-type"],ht(o,"x-stainless-retry-count")===void 0&&ht(n,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),ht(o,"x-stainless-timeout")===void 0&&ht(n,"x-stainless-timeout")===void 0&&t.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(t.timeout/1e3))),this.validateHeaders(i,n),i}async prepareOptions(t){}async prepareRequest(t,{url:n,options:r}){}parseHeaders(t){return t?Symbol.iterator in t?Object.fromEntries(Array.from(t).map(n=>[...n])):{...t}:{}}makeStatusError(t,n,r,s){return U.generate(t,n,r,s)}request(t,n=null){return new Ft(this.makeRequest(t,n))}async makeRequest(t,n){var u,p;const r=await t,s=r.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(r);const{req:i,url:o,timeout:a}=this.buildRequest(r,{retryCount:s-n});if(await this.prepareRequest(i,{url:o,options:r}),de("request",o,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new V;const l=new AbortController,c=await this.fetchWithTimeout(o,i,a,l).catch(un);if(c instanceof Error){if((p=r.signal)!=null&&p.aborted)throw new V;if(n)return this.retryRequest(r,n);throw c.name==="AbortError"?new Cn:new Mt({cause:c})}const f=Ss(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const m=`retrying, ${n} attempts remaining`;return de(`response (error; ${m})`,c.status,o,f),this.retryRequest(r,n,f)}const d=await c.text().catch(m=>un(m).message),h=Ha(d),y=h?void 0:d;throw de(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,f,y),this.makeStatusError(c.status,h,y,f)}return{response:c,options:r,controller:l}}requestAPIList(t,n){const r=this.makeRequest(n,null);return new Ua(this,r,t)}buildURL(t,n){const r=Va(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return Es(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(t){return Object.entries(t).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new A(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(t,n,r,s){const{signal:i,...o}=n||{};i&&i.addEventListener("abort",()=>s.abort());const a=setTimeout(()=>s.abort(),r),l={signal:s.signal,...o};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,t,l).finally(()=>{clearTimeout(a)})}shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const a=parseFloat(i);Number.isNaN(a)||(s=a)}const o=r==null?void 0:r["retry-after"];if(o&&!s){const a=parseFloat(o);Number.isNaN(a)?s=Date.parse(o)-Date.now():s=a*1e3}if(!(s&&0<=s&&s<60*1e3)){const a=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,a)}return await Ye(s),this.makeRequest(t,n-1)}calculateDefaultRetryTimeoutMillis(t,n){const i=n-t,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ee}`}}class As{constructor(t,n,r,s){ut.set(this,void 0),Da(this,ut,t),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const t=this.nextPageInfo();if(!t)throw new A("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in t&&typeof n.query=="object")n.query={...n.query,...t.params};else if("url"in t){const r=[...Object.entries(n.query||{}),...t.url.searchParams.entries()];for(const[s,i]of r)t.url.searchParams.set(s,i);n.query=void 0,n.path=t.url.toString()}return await Ba(this,ut,"f").requestAPIList(this.constructor,n)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(ut=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const n of t.getPaginatedItems())yield n}}class Ua extends Ft{constructor(t,n,r){super(n,async s=>new r(t,s.response,await xs(s),s.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const n of t)yield n}}const Ss=e=>new Proxy(Object.fromEntries(e.entries()),{get(t,n){const r=n.toString();return t[r.toLowerCase()]||t[r]}}),Wa={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},F=e=>typeof e=="object"&&e!==null&&!Es(e)&&Object.keys(e).every(t=>Ps(Wa,t)),za=()=>{var t;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":br(Deno.build.os),"X-Stainless-Arch":yr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":br(process.platform),"X-Stainless-Arch":yr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=qa();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function qa(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:t,version:`${s}.${i}.${o}`}}}return null}const yr=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",br=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let wr;const Ja=()=>wr??(wr=za()),Ha=e=>{try{return JSON.parse(e)}catch{return}},Xa=/^[a-z][a-z0-9+.-]*:/i,Va=e=>Xa.test(e),Ye=e=>new Promise(t=>setTimeout(t,e)),Zt=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new A(`${e} must be an integer`);if(t<0)throw new A(`${e} must be a positive integer`);return t},un=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},ft=e=>{var t,n,r,s;if(typeof process<"u")return((t=ve==null?void 0:ve[e])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(s=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,e))==null?void 0:s.trim()};function Es(e){if(!e)return!0;for(const t in e)return!1;return!0}function Ps(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function kr(e,t){for(const n in t){if(!Ps(t,n))continue;const r=n.toLowerCase();if(!r)continue;const s=t[n];s===null?delete e[r]:s!==void 0&&(e[r]=s)}}const xr=new Set(["authorization","api-key"]);function de(e,...t){if(typeof process<"u"&&(ve==null?void 0:ve.DEBUG)==="true"){const n=t.map(r=>{if(!r)return r;if(r.headers){const i={...r,headers:{...r.headers}};for(const o in r.headers)xr.has(o.toLowerCase())&&(i.headers[o]="REDACTED");return i}let s=null;for(const i in r)xr.has(i.toLowerCase())&&(s??(s={...r}),s[i]="REDACTED");return s??r});console.log(`OpenAI:DEBUG:${e}`,...n)}}const Ga=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),Qa=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Ka=e=>typeof(e==null?void 0:e.get)=="function",ht=(e,t)=>{var r;const n=t.toLowerCase();if(Ka(e)){const s=((r=t[0])==null?void 0:r.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,(i,o,a)=>o+a.toUpperCase());for(const i of[t,n,t.toUpperCase(),s]){const o=e.get(i);if(o)return o}}for(const[s,i]of Object.entries(e))if(s.toLowerCase()===n)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${t} header, using the first entry.`),i[0]):i},Za=e=>{if(typeof Buffer<"u"){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};function Yt(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}class Lt extends As{constructor(t,n,r,s){super(t,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class D extends As{constructor(t,n,r,s){super(t,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const t=this.nextPageInfo();if(!t)return null;if("params"in t)return t.params;const n=Object.fromEntries(t.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const t=this.getPaginatedItems();if(!t.length)return null;const n=(r=t[t.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}class S{constructor(t){this._client=t}}let Rs=class extends S{list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/chat/completions/${t}/messages`,Ya,{query:n,...r})}},Nt=class extends S{constructor(){super(...arguments),this.messages=new Rs(this._client)}create(t,n){return this._client.post("/chat/completions",{body:t,...n,stream:t.stream??!1})}retrieve(t,n){return this._client.get(`/chat/completions/${t}`,n)}update(t,n,r){return this._client.post(`/chat/completions/${t}`,{body:n,...r})}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/chat/completions",Dt,{query:t,...n})}del(t,n){return this._client.delete(`/chat/completions/${t}`,n)}};class Dt extends D{}class Ya extends D{}Nt.ChatCompletionsPage=Dt;Nt.Messages=Rs;let Bt=class extends S{constructor(){super(...arguments),this.completions=new Nt(this._client)}};Bt.Completions=Nt;Bt.ChatCompletionsPage=Dt;class vs extends S{create(t,n){return this._client.post("/audio/speech",{body:t,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class Is extends S{create(t,n){return this._client.post("/audio/transcriptions",we({body:t,...n,stream:t.stream??!1,__metadata:{model:t.model}}))}}class $s extends S{create(t,n){return this._client.post("/audio/translations",we({body:t,...n,__metadata:{model:t.model}}))}}class et extends S{constructor(){super(...arguments),this.transcriptions=new Is(this._client),this.translations=new $s(this._client),this.speech=new vs(this._client)}}et.Transcriptions=Is;et.Translations=$s;et.Speech=vs;class An extends S{create(t,n){return this._client.post("/batches",{body:t,...n})}retrieve(t,n){return this._client.get(`/batches/${t}`,n)}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/batches",Sn,{query:t,...n})}cancel(t,n){return this._client.post(`/batches/${t}/cancel`,n)}}class Sn extends D{}An.BatchesPage=Sn;var G=function(e,t,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(e,n):s?s.value=n:t.set(e,n),n},O=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},fn,yt,bt,De,Be,wt,je,le,Ue,St,Et,Pe,Ms;class En{constructor(){fn.add(this),this.controller=new AbortController,yt.set(this,void 0),bt.set(this,()=>{}),De.set(this,()=>{}),Be.set(this,void 0),wt.set(this,()=>{}),je.set(this,()=>{}),le.set(this,{}),Ue.set(this,!1),St.set(this,!1),Et.set(this,!1),Pe.set(this,!1),G(this,yt,new Promise((t,n)=>{G(this,bt,t,"f"),G(this,De,n,"f")}),"f"),G(this,Be,new Promise((t,n)=>{G(this,wt,t,"f"),G(this,je,n,"f")}),"f"),O(this,yt,"f").catch(()=>{}),O(this,Be,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},O(this,fn,"m",Ms).bind(this))},0)}_connected(){this.ended||(O(this,bt,"f").call(this),this._emit("connect"))}get ended(){return O(this,Ue,"f")}get errored(){return O(this,St,"f")}get aborted(){return O(this,Et,"f")}abort(){this.controller.abort()}on(t,n){return(O(this,le,"f")[t]||(O(this,le,"f")[t]=[])).push({listener:n}),this}off(t,n){const r=O(this,le,"f")[t];if(!r)return this;const s=r.findIndex(i=>i.listener===n);return s>=0&&r.splice(s,1),this}once(t,n){return(O(this,le,"f")[t]||(O(this,le,"f")[t]=[])).push({listener:n,once:!0}),this}emitted(t){return new Promise((n,r)=>{G(this,Pe,!0,"f"),t!=="error"&&this.once("error",r),this.once(t,n)})}async done(){G(this,Pe,!0,"f"),await O(this,Be,"f")}_emit(t,...n){if(O(this,Ue,"f"))return;t==="end"&&(G(this,Ue,!0,"f"),O(this,wt,"f").call(this));const r=O(this,le,"f")[t];if(r&&(O(this,le,"f")[t]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),t==="abort"){const s=n[0];!O(this,Pe,"f")&&!(r!=null&&r.length)&&Promise.reject(s),O(this,De,"f").call(this,s),O(this,je,"f").call(this,s),this._emit("end");return}if(t==="error"){const s=n[0];!O(this,Pe,"f")&&!(r!=null&&r.length)&&Promise.reject(s),O(this,De,"f").call(this,s),O(this,je,"f").call(this,s),this._emit("end")}}_emitFinal(){}}yt=new WeakMap,bt=new WeakMap,De=new WeakMap,Be=new WeakMap,wt=new WeakMap,je=new WeakMap,le=new WeakMap,Ue=new WeakMap,St=new WeakMap,Et=new WeakMap,Pe=new WeakMap,fn=new WeakSet,Ms=function(t){if(G(this,St,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new V),t instanceof V)return G(this,Et,!0,"f"),this._emit("abort",t);if(t instanceof A)return this._emit("error",t);if(t instanceof Error){const n=new A(t.message);return n.cause=t,this._emit("error",n)}return this._emit("error",new A(String(t)))};var x=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},J=function(e,t,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(e,n):s?s.value=n:t.set(e,n),n},j,hn,ne,kt,Q,be,Re,ye,Pt,X,xt,Ct,Je,We,ze,Cr,Ar,Sr,Er,Pr,Rr,vr;class K extends En{constructor(){super(...arguments),j.add(this),hn.set(this,[]),ne.set(this,{}),kt.set(this,{}),Q.set(this,void 0),be.set(this,void 0),Re.set(this,void 0),ye.set(this,void 0),Pt.set(this,void 0),X.set(this,void 0),xt.set(this,void 0),Ct.set(this,void 0),Je.set(this,void 0)}[(hn=new WeakMap,ne=new WeakMap,kt=new WeakMap,Q=new WeakMap,be=new WeakMap,Re=new WeakMap,ye=new WeakMap,Pt=new WeakMap,X=new WeakMap,xt=new WeakMap,Ct=new WeakMap,Je=new WeakMap,j=new WeakSet,Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",s=>{const i=n.shift();i?i.resolve(s):t.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>n.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const n=new K;return n._run(()=>n._fromReadableStream(t)),n}async _fromReadableStream(t,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=re.fromReadableStream(t,this.controller);for await(const o of s)x(this,j,"m",We).call(this,o);if((i=s.controller.signal)!=null&&i.aborted)throw new V;return this._addRun(x(this,j,"m",ze).call(this))}toReadableStream(){return new re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,n,r,s,i){const o=new K;return o._run(()=>o._runToolAssistantStream(t,n,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(t,n,r,s,i){var c;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const a={...s,stream:!0},l=await t.submitToolOutputs(n,r,a,{...i,signal:this.controller.signal});this._connected();for await(const f of l)x(this,j,"m",We).call(this,f);if((c=l.controller.signal)!=null&&c.aborted)throw new V;return this._addRun(x(this,j,"m",ze).call(this))}static createThreadAssistantStream(t,n,r){const s=new K;return s._run(()=>s._threadAssistantStream(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(t,n,r,s){const i=new K;return i._run(()=>i._runAssistantStream(t,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return x(this,xt,"f")}currentRun(){return x(this,Ct,"f")}currentMessageSnapshot(){return x(this,Q,"f")}currentRunStepSnapshot(){return x(this,Je,"f")}async finalRunSteps(){return await this.done(),Object.values(x(this,ne,"f"))}async finalMessages(){return await this.done(),Object.values(x(this,kt,"f"))}async finalRun(){if(await this.done(),!x(this,be,"f"))throw Error("Final run was not received.");return x(this,be,"f")}async _createThreadAssistantStream(t,n,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await t.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of o)x(this,j,"m",We).call(this,l);if((a=o.controller.signal)!=null&&a.aborted)throw new V;return this._addRun(x(this,j,"m",ze).call(this))}async _createAssistantStream(t,n,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},a=await t.create(n,o,{...s,signal:this.controller.signal});this._connected();for await(const c of a)x(this,j,"m",We).call(this,c);if((l=a.controller.signal)!=null&&l.aborted)throw new V;return this._addRun(x(this,j,"m",ze).call(this))}static accumulateDelta(t,n){for(const[r,s]of Object.entries(n)){if(!t.hasOwnProperty(r)){t[r]=s;continue}let i=t[r];if(i==null){t[r]=s;continue}if(r==="index"||r==="type"){t[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Yt(i)&&Yt(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(o=>typeof o=="string"||typeof o=="number")){i.push(...s);continue}for(const o of s){if(!Yt(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);const l=i[a];l==null?i.push(o):i[a]=this.accumulateDelta(l,o)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);t[r]=i}return t}_addRun(t){return t}async _threadAssistantStream(t,n,r){return await this._createThreadAssistantStream(n,t,r)}async _runAssistantStream(t,n,r,s){return await this._createAssistantStream(n,t,r,s)}async _runToolAssistantStream(t,n,r,s,i){return await this._createToolAssistantStream(r,t,n,s,i)}}We=function(t){if(!this.ended)switch(J(this,xt,t,"f"),x(this,j,"m",Sr).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":x(this,j,"m",vr).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":x(this,j,"m",Ar).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":x(this,j,"m",Cr).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ze=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");if(!x(this,be,"f"))throw Error("Final run has not been received");return x(this,be,"f")},Cr=function(t){const[n,r]=x(this,j,"m",Pr).call(this,t,x(this,Q,"f"));J(this,Q,n,"f"),x(this,kt,"f")[n.id]=n;for(const s of r){const i=n.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,n),t.data.delta.content)for(const s of t.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,o=n.content[s.index];if(o&&o.type=="text")this._emit("textDelta",i,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=x(this,Re,"f")){if(x(this,ye,"f"))switch(x(this,ye,"f").type){case"text":this._emit("textDone",x(this,ye,"f").text,x(this,Q,"f"));break;case"image_file":this._emit("imageFileDone",x(this,ye,"f").image_file,x(this,Q,"f"));break}J(this,Re,s.index,"f")}J(this,ye,n.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(x(this,Re,"f")!==void 0){const s=t.data.content[x(this,Re,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,x(this,Q,"f"));break;case"text":this._emit("textDone",s.text,x(this,Q,"f"));break}}x(this,Q,"f")&&this._emit("messageDone",t.data),J(this,Q,void 0,"f")}},Ar=function(t){const n=x(this,j,"m",Er).call(this,t);switch(J(this,Je,n,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const r=t.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==x(this,Pt,"f")?this._emit("toolCallDelta",i,n.step_details.tool_calls[i.index]):(x(this,X,"f")&&this._emit("toolCallDone",x(this,X,"f")),J(this,Pt,i.index,"f"),J(this,X,n.step_details.tool_calls[i.index],"f"),x(this,X,"f")&&this._emit("toolCallCreated",x(this,X,"f")));this._emit("runStepDelta",t.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":J(this,Je,void 0,"f"),t.data.step_details.type=="tool_calls"&&x(this,X,"f")&&(this._emit("toolCallDone",x(this,X,"f")),J(this,X,void 0,"f")),this._emit("runStepDone",t.data,n);break}},Sr=function(t){x(this,hn,"f").push(t),this._emit("event",t)},Er=function(t){switch(t.event){case"thread.run.step.created":return x(this,ne,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let n=x(this,ne,"f")[t.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=t.data;if(r.delta){const s=K.accumulateDelta(n,r.delta);x(this,ne,"f")[t.data.id]=s}return x(this,ne,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":x(this,ne,"f")[t.data.id]=t.data;break}if(x(this,ne,"f")[t.data.id])return x(this,ne,"f")[t.data.id];throw new Error("No snapshot available")},Pr=function(t,n){let r=[];switch(t.event){case"thread.message.created":return[t.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=t.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in n.content){let o=n.content[i.index];n.content[i.index]=x(this,j,"m",Rr).call(this,i,o)}else n.content[i.index]=i,r.push(i);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Rr=function(t,n){return K.accumulateDelta(n,t)},vr=function(t){switch(J(this,Ct,t.data,"f"),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":J(this,be,t.data,"f"),x(this,X,"f")&&(this._emit("toolCallDone",x(this,X,"f")),J(this,X,void 0,"f"));break}};class Pn extends S{create(t,n){return this._client.post("/assistants",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/assistants/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/assistants/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/assistants",Rn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,n){return this._client.delete(`/assistants/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Rn extends D{}Pn.AssistantsPage=Rn;function Ir(e){return typeof e.parse=="function"}const Ie=e=>(e==null?void 0:e.role)==="assistant",Ts=e=>(e==null?void 0:e.role)==="function",Os=e=>(e==null?void 0:e.role)==="tool";function vn(e){return(e==null?void 0:e.$brand)==="auto-parseable-response-format"}function tt(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function el(e,t){return!t||!Fs(t)?{...e,choices:e.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:In(e,t)}function In(e,t){const n=e.choices.map(r=>{var s;if(r.finish_reason==="length")throw new gs;if(r.finish_reason==="content_filter")throw new _s;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>nl(t,i)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?tl(t,r.message.content):null}}});return{...e,choices:n}}function tl(e,t){var n,r;return((n=e.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=e.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function nl(e,t){var r;const n=(r=e.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===t.function.name});return{...t,function:{...t.function,parsed_arguments:tt(n)?n.$parseRaw(t.function.arguments):n!=null&&n.function.strict?JSON.parse(t.function.arguments):null}}}function rl(e,t){var r;if(!e)return!1;const n=(r=e.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===t.function.name});return tt(n)||(n==null?void 0:n.function.strict)||!1}function Fs(e){var t;return vn(e.response_format)?!0:((t=e.tools)==null?void 0:t.some(n=>tt(n)||n.type==="function"&&n.function.strict===!0))??!1}function sl(e){for(const t of e??[]){if(t.type!=="function")throw new A(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new A(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var z=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},W,dn,Rt,pn,mn,gn,Ls,_n;const $r=10;class Ns extends En{constructor(){super(...arguments),W.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){var r;this._chatCompletions.push(t),this._emit("chatCompletion",t);const n=(r=t.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),t}_addMessage(t,n=!0){if("content"in t||(t.content=null),this.messages.push(t),n){if(this._emit("message",t),(Ts(t)||Os(t))&&t.content)this._emit("functionCallResult",t.content);else if(Ie(t)&&t.function_call)this._emit("functionCall",t.function_call);else if(Ie(t)&&t.tool_calls)for(const r of t.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new A("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),z(this,W,"m",dn).call(this)}async finalMessage(){return await this.done(),z(this,W,"m",Rt).call(this)}async finalFunctionCall(){return await this.done(),z(this,W,"m",pn).call(this)}async finalFunctionCallResult(){return await this.done(),z(this,W,"m",mn).call(this)}async totalUsage(){return await this.done(),z(this,W,"m",gn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const n=z(this,W,"m",Rt).call(this);n&&this._emit("finalMessage",n);const r=z(this,W,"m",dn).call(this);r&&this._emit("finalContent",r);const s=z(this,W,"m",pn).call(this);s&&this._emit("finalFunctionCall",s);const i=z(this,W,"m",mn).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",z(this,W,"m",gn).call(this))}async _createChatCompletion(t,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),z(this,W,"m",Ls).call(this,n);const i=await t.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(In(i,n))}async _runChatCompletion(t,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(t,n,r)}async _runFunctions(t,n,r){var p;const s="function",{function_call:i="auto",stream:o,...a}=n,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=$r}=r||{},f={};for(const d of n.functions)f[d.name||d.function.name]=d;const u=n.functions.map(d=>({name:d.name||d.function.name,parameters:d.parameters,description:d.description}));for(const d of n.messages)this._addMessage(d,!1);for(let d=0;d<c;++d){const y=(p=(await this._createChatCompletion(t,{...a,function_call:i,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:p.message;if(!y)throw new A("missing message in ChatCompletion response");if(!y.function_call)return;const{name:_,arguments:P}=y.function_call,m=f[_];if(m){if(l&&l!==_){const w=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:_,content:w});continue}}else{const w=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${u.map(C=>JSON.stringify(C.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:_,content:w});continue}let b;try{b=Ir(m)?await m.parse(P):P}catch(w){this._addMessage({role:s,name:_,content:w instanceof Error?w.message:String(w)});continue}const g=await m.function(b,this),k=z(this,W,"m",_n).call(this,g);if(this._addMessage({role:s,name:_,content:k}),l)return}}async _runTools(t,n,r){var d,h,y;const s="tool",{tool_choice:i="auto",stream:o,...a}=n,l=typeof i!="string"&&((d=i==null?void 0:i.function)==null?void 0:d.name),{maxChatCompletions:c=$r}=r||{},f=n.tools.map(_=>{if(tt(_)){if(!_.$callback)throw new A("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),u={};for(const _ of f)_.type==="function"&&(u[_.function.name||_.function.function.name]=_.function);const p="tools"in n?f.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(const _ of n.messages)this._addMessage(_,!1);for(let _=0;_<c;++_){const m=(h=(await this._createChatCompletion(t,{...a,tool_choice:i,tools:p,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!m)throw new A("missing message in ChatCompletion response");if(!((y=m.tool_calls)!=null&&y.length))return;for(const b of m.tool_calls){if(b.type!=="function")continue;const g=b.id,{name:k,arguments:w}=b.function,C=u[k];if(C){if(l&&l!==k){const R=`Invalid tool_call: ${JSON.stringify(k)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:g,content:R});continue}}else{const R=`Invalid tool_call: ${JSON.stringify(k)}. Available options are: ${Object.keys(u).map(ce=>JSON.stringify(ce)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:g,content:R});continue}let T;try{T=Ir(C)?await C.parse(w):w}catch(R){const ce=R instanceof Error?R.message:String(R);this._addMessage({role:s,tool_call_id:g,content:ce});continue}const v=await C.function(T,this),I=z(this,W,"m",_n).call(this,v);if(this._addMessage({role:s,tool_call_id:g,content:I}),l)return}}}}W=new WeakSet,dn=function(){return z(this,W,"m",Rt).call(this).content??null},Rt=function(){let t=this.messages.length;for(;t-- >0;){const n=this.messages[t];if(Ie(n)){const{function_call:r,...s}=n,i={...s,content:n.content??null,refusal:n.refusal??null};return r&&(i.function_call=r),i}}throw new A("stream ended without producing a ChatCompletionMessage with role=assistant")},pn=function(){var t,n;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Ie(s)&&(s!=null&&s.function_call))return s.function_call;if(Ie(s)&&((t=s==null?void 0:s.tool_calls)!=null&&t.length))return(n=s.tool_calls.at(-1))==null?void 0:n.function}},mn=function(){for(let t=this.messages.length-1;t>=0;t--){const n=this.messages[t];if(Ts(n)&&n.content!=null||Os(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===n.tool_call_id))}))return n.content}},gn=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(t.completion_tokens+=n.completion_tokens,t.prompt_tokens+=n.prompt_tokens,t.total_tokens+=n.total_tokens);return t},Ls=function(t){if(t.n!=null&&t.n>1)throw new A("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},_n=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class Ge extends Ns{static runFunctions(t,n,r){const s=new Ge,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(t,n,i)),s}static runTools(t,n,r){const s=new Ge,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,n,i)),s}_addMessage(t,n=!0){super._addMessage(t,n),Ie(t)&&t.content&&this._emit("content",t.content)}}const Ds=1,Bs=2,js=4,Us=8,Ws=16,zs=32,qs=64,Js=128,Hs=256,Xs=Js|Hs,Vs=Ws|zs|Xs|qs,Gs=Ds|Bs|Vs,Qs=js|Us,il=Gs|Qs,B={STR:Ds,NUM:Bs,ARR:js,OBJ:Us,NULL:Ws,BOOL:zs,NAN:qs,INFINITY:Js,MINUS_INFINITY:Hs,INF:Xs,SPECIAL:Vs,ATOM:Gs,COLLECTION:Qs,ALL:il};class ol extends Error{}class al extends Error{}function ll(e,t=B.ALL){if(typeof e!="string")throw new TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw new Error(`${e} is empty`);return cl(e.trim(),t)}const cl=(e,t)=>{const n=e.length;let r=0;const s=p=>{throw new ol(`${p} at position ${r}`)},i=p=>{throw new al(`${p} at position ${r}`)},o=()=>(u(),r>=n&&s("Unexpected end of input"),e[r]==='"'?a():e[r]==="{"?l():e[r]==="["?c():e.substring(r,r+4)==="null"||B.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)==="true"||B.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)==="false"||B.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)==="Infinity"||B.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)==="-Infinity"||B.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)==="NaN"||B.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):f()),a=()=>{const p=r;let d=!1;for(r++;r<n&&(e[r]!=='"'||d&&e[r-1]==="\\");)d=e[r]==="\\"?!d:!1,r++;if(e.charAt(r)=='"')try{return JSON.parse(e.substring(p,++r-Number(d)))}catch(h){i(String(h))}else if(B.STR&t)try{return JSON.parse(e.substring(p,r-Number(d))+'"')}catch{return JSON.parse(e.substring(p,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,u();const p={};try{for(;e[r]!=="}";){if(u(),r>=n&&B.OBJ&t)return p;const d=a();u(),r++;try{const h=o();Object.defineProperty(p,d,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(B.OBJ&t)return p;throw h}u(),e[r]===","&&r++}}catch{if(B.OBJ&t)return p;s("Expected '}' at end of object")}return r++,p},c=()=>{r++;const p=[];try{for(;e[r]!=="]";)p.push(o()),u(),e[r]===","&&r++}catch{if(B.ARR&t)return p;s("Expected ']' at end of array")}return r++,p},f=()=>{if(r===0){e==="-"&&B.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(d){if(B.NUM&t)try{return e[e.length-1]==="."?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch{}i(String(d))}}const p=r;for(e[r]==="-"&&r++;e[r]&&!",]}".includes(e[r]);)r++;r==n&&!(B.NUM&t)&&s("Unterminated number literal");try{return JSON.parse(e.substring(p,r))}catch{e.substring(p,r)==="-"&&B.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(p,e.lastIndexOf("e")))}catch(h){i(String(h))}}},u=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return o()},Mr=e=>ll(e,B.ALL^B.NUM);var xe=function(e,t,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(e,n):s?s.value=n:t.set(e,n),n},$=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},L,ae,Ce,ue,en,dt,tn,nn,rn,pt,sn,Tr;class Qe extends Ns{constructor(t){super(),L.add(this),ae.set(this,void 0),Ce.set(this,void 0),ue.set(this,void 0),xe(this,ae,t,"f"),xe(this,Ce,[],"f")}get currentChatCompletionSnapshot(){return $(this,ue,"f")}static fromReadableStream(t){const n=new Qe(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){const s=new Qe(n);return s._run(()=>s._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(t,n,r){var o;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),$(this,L,"m",en).call(this);const i=await t.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const a of i)$(this,L,"m",tn).call(this,a);if((o=i.controller.signal)!=null&&o.aborted)throw new V;return this._addChatCompletion($(this,L,"m",pt).call(this))}async _fromReadableStream(t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),$(this,L,"m",en).call(this),this._connected();const s=re.fromReadableStream(t,this.controller);let i;for await(const a of s)i&&i!==a.id&&this._addChatCompletion($(this,L,"m",pt).call(this)),$(this,L,"m",tn).call(this,a),i=a.id;if((o=s.controller.signal)!=null&&o.aborted)throw new V;return this._addChatCompletion($(this,L,"m",pt).call(this))}[(ae=new WeakMap,Ce=new WeakMap,ue=new WeakMap,L=new WeakSet,en=function(){this.ended||xe(this,ue,void 0,"f")},dt=function(n){let r=$(this,Ce,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},$(this,Ce,"f")[n.index]=r,r)},tn=function(n){var s,i,o,a,l,c,f,u,p,d,h,y,_,P,m;if(this.ended)return;const r=$(this,L,"m",Tr).call(this,n);this._emit("chunk",n,r);for(const b of n.choices){const g=r.choices[b.index];b.delta.content!=null&&((s=g.message)==null?void 0:s.role)==="assistant"&&((i=g.message)!=null&&i.content)&&(this._emit("content",b.delta.content,g.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:g.message.content,parsed:g.message.parsed})),b.delta.refusal!=null&&((o=g.message)==null?void 0:o.role)==="assistant"&&((a=g.message)!=null&&a.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:g.message.refusal}),((l=b.logprobs)==null?void 0:l.content)!=null&&((c=g.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=b.logprobs)==null?void 0:f.content,snapshot:((u=g.logprobs)==null?void 0:u.content)??[]}),((p=b.logprobs)==null?void 0:p.refusal)!=null&&((d=g.message)==null?void 0:d.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(h=b.logprobs)==null?void 0:h.refusal,snapshot:((y=g.logprobs)==null?void 0:y.refusal)??[]});const k=$(this,L,"m",dt).call(this,g);g.finish_reason&&($(this,L,"m",rn).call(this,g),k.current_tool_call_index!=null&&$(this,L,"m",nn).call(this,g,k.current_tool_call_index));for(const w of b.delta.tool_calls??[])k.current_tool_call_index!==w.index&&($(this,L,"m",rn).call(this,g),k.current_tool_call_index!=null&&$(this,L,"m",nn).call(this,g,k.current_tool_call_index)),k.current_tool_call_index=w.index;for(const w of b.delta.tool_calls??[]){const C=(_=g.message.tool_calls)==null?void 0:_[w.index];C!=null&&C.type&&((C==null?void 0:C.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(P=C.function)==null?void 0:P.name,index:w.index,arguments:C.function.arguments,parsed_arguments:C.function.parsed_arguments,arguments_delta:((m=w.function)==null?void 0:m.arguments)??""}):(C==null||C.type,void 0))}}},nn=function(n,r){var o,a,l;if($(this,L,"m",dt).call(this,n).done_tool_calls.has(r))return;const i=(o=n.message.tool_calls)==null?void 0:o[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(a=$(this,ae,"f"))==null?void 0:a.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:tt(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},rn=function(n){var s,i;const r=$(this,L,"m",dt).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const o=$(this,L,"m",sn).call(this);this._emit("content.done",{content:n.message.content,parsed:o?o.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(s=n.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(i=n.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},pt=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");const n=$(this,ue,"f");if(!n)throw new A("request ended without sending any chunks");return xe(this,ue,void 0,"f"),xe(this,Ce,[],"f"),ul(n,$(this,ae,"f"))},sn=function(){var r;const n=(r=$(this,ae,"f"))==null?void 0:r.response_format;return vn(n)?n:null},Tr=function(n){var r,s,i,o;let a=$(this,ue,"f");const{choices:l,...c}=n;a?Object.assign(a,c):a=xe(this,ue,{...c,choices:[]},"f");for(const{delta:f,finish_reason:u,index:p,logprobs:d=null,...h}of n.choices){let y=a.choices[p];if(y||(y=a.choices[p]={finish_reason:u,index:p,message:{},logprobs:d,...h}),d)if(!y.logprobs)y.logprobs=Object.assign({},d);else{const{content:w,refusal:C,...T}=d;Object.assign(y.logprobs,T),w&&((r=y.logprobs).content??(r.content=[]),y.logprobs.content.push(...w)),C&&((s=y.logprobs).refusal??(s.refusal=[]),y.logprobs.refusal.push(...C))}if(u&&(y.finish_reason=u,$(this,ae,"f")&&Fs($(this,ae,"f")))){if(u==="length")throw new gs;if(u==="content_filter")throw new _s}if(Object.assign(y,h),!f)continue;const{content:_,refusal:P,function_call:m,role:b,tool_calls:g,...k}=f;if(Object.assign(y.message,k),P&&(y.message.refusal=(y.message.refusal||"")+P),b&&(y.message.role=b),m&&(y.message.function_call?(m.name&&(y.message.function_call.name=m.name),m.arguments&&((i=y.message.function_call).arguments??(i.arguments=""),y.message.function_call.arguments+=m.arguments)):y.message.function_call=m),_&&(y.message.content=(y.message.content||"")+_,!y.message.refusal&&$(this,L,"m",sn).call(this)&&(y.message.parsed=Mr(y.message.content))),g){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:w,id:C,type:T,function:v,...I}of g){const R=(o=y.message.tool_calls)[w]??(o[w]={});Object.assign(R,I),C&&(R.id=C),T&&(R.type=T),v&&(R.function??(R.function={name:v.name??"",arguments:""})),v!=null&&v.name&&(R.function.name=v.name),v!=null&&v.arguments&&(R.function.arguments+=v.arguments,rl($(this,ae,"f"),R)&&(R.function.parsed_arguments=Mr(R.function.arguments)))}}}return a},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("chunk",s=>{const i=n.shift();i?i.resolve(s):t.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>n.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function ul(e,t){const{id:n,choices:r,created:s,model:i,system_fingerprint:o,...a}=e,l={...a,id:n,choices:r.map(({message:c,finish_reason:f,index:u,logprobs:p,...d})=>{if(!f)throw new A(`missing finish_reason for choice ${u}`);const{content:h=null,function_call:y,tool_calls:_,...P}=c,m=c.role;if(!m)throw new A(`missing role for choice ${u}`);if(y){const{arguments:b,name:g}=y;if(b==null)throw new A(`missing function_call.arguments for choice ${u}`);if(!g)throw new A(`missing function_call.name for choice ${u}`);return{...d,message:{content:h,function_call:{arguments:b,name:g},role:m,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:p}}return _?{...d,index:u,finish_reason:f,logprobs:p,message:{...P,role:m,content:h,refusal:c.refusal??null,tool_calls:_.map((b,g)=>{const{function:k,type:w,id:C,...T}=b,{arguments:v,name:I,...R}=k||{};if(C==null)throw new A(`missing choices[${u}].tool_calls[${g}].id
${mt(e)}`);if(w==null)throw new A(`missing choices[${u}].tool_calls[${g}].type
${mt(e)}`);if(I==null)throw new A(`missing choices[${u}].tool_calls[${g}].function.name
${mt(e)}`);if(v==null)throw new A(`missing choices[${u}].tool_calls[${g}].function.arguments
${mt(e)}`);return{...T,id:C,type:w,function:{...R,name:I,arguments:v}}})}}:{...d,message:{...P,content:h,role:m,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:p}}),created:s,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}};return el(l,t)}function mt(e){return JSON.stringify(e)}class $e extends Qe{static fromReadableStream(t){const n=new $e(null);return n._run(()=>n._fromReadableStream(t)),n}static runFunctions(t,n,r){const s=new $e(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(t,n,i)),s}static runTools(t,n,r){const s=new $e(n),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,n,i)),s}}let Ks=class extends S{parse(t,n){return sl(t.tools),this._client.chat.completions.create(t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>In(r,t))}runFunctions(t,n){return t.stream?$e.runFunctions(this._client,t,n):Ge.runFunctions(this._client,t,n)}runTools(t,n){return t.stream?$e.runTools(this._client,t,n):Ge.runTools(this._client,t,n)}stream(t,n){return Qe.createChatCompletion(this._client,t,n)}};class yn extends S{constructor(){super(...arguments),this.completions=new Ks(this._client)}}(function(e){e.Completions=Ks})(yn||(yn={}));class Zs extends S{create(t,n){return this._client.post("/realtime/sessions",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Ys extends S{create(t,n){return this._client.post("/realtime/transcription_sessions",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class jt extends S{constructor(){super(...arguments),this.sessions=new Zs(this._client),this.transcriptionSessions=new Ys(this._client)}}jt.Sessions=Zs;jt.TranscriptionSessions=Ys;class $n extends S{create(t,n,r){return this._client.post(`/threads/${t}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/threads/${t}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,s){return this._client.post(`/threads/${t}/messages/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/threads/${t}/messages`,Mn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n,r){return this._client.delete(`/threads/${t}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Mn extends D{}$n.MessagesPage=Mn;class Tn extends S{retrieve(t,n,r,s={},i){return F(s)?this.retrieve(t,n,r,{},s):this._client.get(`/threads/${t}/runs/${n}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(t,n,r={},s){return F(r)?this.list(t,n,{},r):this._client.getAPIList(`/threads/${t}/runs/${n}/steps`,On,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class On extends D{}Tn.RunStepsPage=On;let nt=class extends S{constructor(){super(...arguments),this.steps=new Tn(this._client)}create(t,n,r){const{include:s,...i}=n;return this._client.post(`/threads/${t}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(t,n,r){return this._client.get(`/threads/${t}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,s){return this._client.post(`/threads/${t}/runs/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/threads/${t}/runs`,Fn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(t,n,r){return this._client.post(`/threads/${t}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const s=await this.create(t,n,r);return await this.poll(t,s.id,r)}createAndStream(t,n,r){return K.createAssistantStream(t,this._client.beta.threads.runs,n,r)}async poll(t,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:o}=await this.retrieve(t,n,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(r!=null&&r.pollIntervalMs)a=r.pollIntervalMs;else{const l=o.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(a=c)}}await Ye(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(t,n,r){return K.createAssistantStream(t,this._client.beta.threads.runs,n,r)}submitToolOutputs(t,n,r,s){return this._client.post(`/threads/${t}/runs/${n}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(t,n,r,s){const i=await this.submitToolOutputs(t,n,r,s);return await this.poll(t,i.id,s)}submitToolOutputsStream(t,n,r,s){return K.createToolAssistantStream(t,n,this._client.beta.threads.runs,r,s)}};class Fn extends D{}nt.RunsPage=Fn;nt.Steps=Tn;nt.RunStepsPage=On;class Oe extends S{constructor(){super(...arguments),this.runs=new nt(this._client),this.messages=new $n(this._client)}create(t={},n){return F(t)?this.create({},t):this._client.post("/threads",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/threads/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/threads/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n){return this._client.delete(`/threads/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(t,n){return this._client.post("/threads/runs",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}async createAndRunPoll(t,n){const r=await this.createAndRun(t,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(t,n){return K.createThreadAssistantStream(t,this._client.beta.threads,n)}}Oe.Runs=nt;Oe.RunsPage=Fn;Oe.Messages=$n;Oe.MessagesPage=Mn;class Fe extends S{constructor(){super(...arguments),this.realtime=new jt(this._client),this.chat=new yn(this._client),this.assistants=new Pn(this._client),this.threads=new Oe(this._client)}}Fe.Realtime=jt;Fe.Assistants=Pn;Fe.AssistantsPage=Rn;Fe.Threads=Oe;class ei extends S{create(t,n){return this._client.post("/completions",{body:t,...n,stream:t.stream??!1})}}class ti extends S{retrieve(t,n,r){return this._client.get(`/containers/${t}/files/${n}/content`,{...r,headers:{Accept:"application/binary",...r==null?void 0:r.headers},__binaryResponse:!0})}}let Ut=class extends S{constructor(){super(...arguments),this.content=new ti(this._client)}create(t,n,r){return this._client.post(`/containers/${t}/files`,we({body:n,...r}))}retrieve(t,n,r){return this._client.get(`/containers/${t}/files/${n}`,r)}list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/containers/${t}/files`,Ln,{query:n,...r})}del(t,n,r){return this._client.delete(`/containers/${t}/files/${n}`,{...r,headers:{Accept:"*/*",...r==null?void 0:r.headers}})}};class Ln extends D{}Ut.FileListResponsesPage=Ln;Ut.Content=ti;class rt extends S{constructor(){super(...arguments),this.files=new Ut(this._client)}create(t,n){return this._client.post("/containers",{body:t,...n})}retrieve(t,n){return this._client.get(`/containers/${t}`,n)}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/containers",Nn,{query:t,...n})}del(t,n){return this._client.delete(`/containers/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class Nn extends D{}rt.ContainerListResponsesPage=Nn;rt.Files=Ut;rt.FileListResponsesPage=Ln;class ni extends S{create(t,n){const r=!!t.encoding_format;let s=r?t.encoding_format:"base64";r&&de("Request","User defined encoding_format:",t.encoding_format);const i=this._client.post("/embeddings",{body:{...t,encoding_format:s},...n});return r?i:(de("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(o=>(o&&o.data&&o.data.forEach(a=>{const l=a.embedding;a.embedding=Za(l)}),o)))}}class Dn extends S{retrieve(t,n,r,s){return this._client.get(`/evals/${t}/runs/${n}/output_items/${r}`,s)}list(t,n,r={},s){return F(r)?this.list(t,n,{},r):this._client.getAPIList(`/evals/${t}/runs/${n}/output_items`,Bn,{query:r,...s})}}class Bn extends D{}Dn.OutputItemListResponsesPage=Bn;class st extends S{constructor(){super(...arguments),this.outputItems=new Dn(this._client)}create(t,n,r){return this._client.post(`/evals/${t}/runs`,{body:n,...r})}retrieve(t,n,r){return this._client.get(`/evals/${t}/runs/${n}`,r)}list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/evals/${t}/runs`,jn,{query:n,...r})}del(t,n,r){return this._client.delete(`/evals/${t}/runs/${n}`,r)}cancel(t,n,r){return this._client.post(`/evals/${t}/runs/${n}`,r)}}class jn extends D{}st.RunListResponsesPage=jn;st.OutputItems=Dn;st.OutputItemListResponsesPage=Bn;class it extends S{constructor(){super(...arguments),this.runs=new st(this._client)}create(t,n){return this._client.post("/evals",{body:t,...n})}retrieve(t,n){return this._client.get(`/evals/${t}`,n)}update(t,n,r){return this._client.post(`/evals/${t}`,{body:n,...r})}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/evals",Un,{query:t,...n})}del(t,n){return this._client.delete(`/evals/${t}`,n)}}class Un extends D{}it.EvalListResponsesPage=Un;it.Runs=st;it.RunListResponsesPage=jn;let Wn=class extends S{create(t,n){return this._client.post("/files",we({body:t,...n}))}retrieve(t,n){return this._client.get(`/files/${t}`,n)}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/files",zn,{query:t,...n})}del(t,n){return this._client.delete(`/files/${t}`,n)}content(t,n){return this._client.get(`/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(t,n){return this._client.get(`/files/${t}/content`,n)}async waitForProcessing(t,{pollInterval:n=5e3,maxWait:r=1800*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let o=await this.retrieve(t);for(;!o.status||!s.has(o.status);)if(await Ye(n),o=await this.retrieve(t),Date.now()-i>r)throw new Cn({message:`Giving up on waiting for file ${t} to finish processing after ${r} milliseconds.`});return o}};class zn extends D{}Wn.FileObjectsPage=zn;class ri extends S{}let si=class extends S{run(t,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...n})}validate(t,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...n})}};class qn extends S{constructor(){super(...arguments),this.graders=new si(this._client)}}qn.Graders=si;class Jn extends S{create(t,n,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${t}/permissions`,Hn,{body:n,method:"post",...r})}retrieve(t,n={},r){return F(n)?this.retrieve(t,{},n):this._client.get(`/fine_tuning/checkpoints/${t}/permissions`,{query:n,...r})}del(t,n,r){return this._client.delete(`/fine_tuning/checkpoints/${t}/permissions/${n}`,r)}}class Hn extends Lt{}Jn.PermissionCreateResponsesPage=Hn;let Wt=class extends S{constructor(){super(...arguments),this.permissions=new Jn(this._client)}};Wt.Permissions=Jn;Wt.PermissionCreateResponsesPage=Hn;class Xn extends S{list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/fine_tuning/jobs/${t}/checkpoints`,Vn,{query:n,...r})}}class Vn extends D{}Xn.FineTuningJobCheckpointsPage=Vn;class Le extends S{constructor(){super(...arguments),this.checkpoints=new Xn(this._client)}create(t,n){return this._client.post("/fine_tuning/jobs",{body:t,...n})}retrieve(t,n){return this._client.get(`/fine_tuning/jobs/${t}`,n)}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/fine_tuning/jobs",Gn,{query:t,...n})}cancel(t,n){return this._client.post(`/fine_tuning/jobs/${t}/cancel`,n)}listEvents(t,n={},r){return F(n)?this.listEvents(t,{},n):this._client.getAPIList(`/fine_tuning/jobs/${t}/events`,Qn,{query:n,...r})}pause(t,n){return this._client.post(`/fine_tuning/jobs/${t}/pause`,n)}resume(t,n){return this._client.post(`/fine_tuning/jobs/${t}/resume`,n)}}class Gn extends D{}class Qn extends D{}Le.FineTuningJobsPage=Gn;Le.FineTuningJobEventsPage=Qn;Le.Checkpoints=Xn;Le.FineTuningJobCheckpointsPage=Vn;class me extends S{constructor(){super(...arguments),this.methods=new ri(this._client),this.jobs=new Le(this._client),this.checkpoints=new Wt(this._client),this.alpha=new qn(this._client)}}me.Methods=ri;me.Jobs=Le;me.FineTuningJobsPage=Gn;me.FineTuningJobEventsPage=Qn;me.Checkpoints=Wt;me.Alpha=qn;class ii extends S{}class Kn extends S{constructor(){super(...arguments),this.graderModels=new ii(this._client)}}Kn.GraderModels=ii;class oi extends S{createVariation(t,n){return this._client.post("/images/variations",we({body:t,...n}))}edit(t,n){return this._client.post("/images/edits",we({body:t,...n}))}generate(t,n){return this._client.post("/images/generations",{body:t,...n})}}class Zn extends S{retrieve(t,n){return this._client.get(`/models/${t}`,n)}list(t){return this._client.getAPIList("/models",Yn,t)}del(t,n){return this._client.delete(`/models/${t}`,n)}}class Yn extends Lt{}Zn.ModelsPage=Yn;class ai extends S{create(t,n){return this._client.post("/moderations",{body:t,...n})}}function fl(e,t){return!t||!dl(t)?{...e,output_parsed:null,output:e.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:li(e,t)}function li(e,t){const n=e.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:gl(t,s)};if(s.type==="message"){const i=s.content.map(o=>o.type==="output_text"?{...o,parsed:hl(t,o.text)}:o);return{...s,content:i}}return s}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||ci(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const s of r.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function hl(e,t){var n,r,s,i;return((r=(n=e.text)==null?void 0:n.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((s=e.text)==null?void 0:s.format)?((i=e.text)==null?void 0:i.format).$parseRaw(t):JSON.parse(t)}function dl(e){var t;return!!vn((t=e.text)==null?void 0:t.format)}function pl(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function ml(e,t){return e.find(n=>n.type==="function"&&n.name===t)}function gl(e,t){const n=ml(e.tools??[],t.name);return{...t,...t,parsed_arguments:pl(n)?n.$parseRaw(t.arguments):n!=null&&n.strict?JSON.parse(t.arguments):null}}function ci(e){const t=[];for(const n of e.output)if(n.type==="message")for(const r of n.content)r.type==="output_text"&&t.push(r.text);e.output_text=t.join("")}class ui extends S{list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/responses/${t}/input_items`,yl,{query:n,...r})}}var Ae=function(e,t,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(e,n):s?s.value=n:t.set(e,n),n},fe=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Se,gt,he,_t,Or,Fr,Lr,Nr;class er extends En{constructor(t){super(),Se.add(this),gt.set(this,void 0),he.set(this,void 0),_t.set(this,void 0),Ae(this,gt,t,"f")}static createResponse(t,n,r){const s=new er(n);return s._run(()=>s._createOrRetrieveResponse(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(t,n,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),fe(this,Se,"m",Or).call(this);let i,o=null;"response_id"in n?(i=await t.responses.retrieve(n.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),o=n.starting_after??null):i=await t.responses.create({...n,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const l of i)fe(this,Se,"m",Fr).call(this,l,o);if((a=i.controller.signal)!=null&&a.aborted)throw new V;return fe(this,Se,"m",Lr).call(this)}[(gt=new WeakMap,he=new WeakMap,_t=new WeakMap,Se=new WeakSet,Or=function(){this.ended||Ae(this,he,void 0,"f")},Fr=function(n,r){if(this.ended)return;const s=(o,a)=>{(r==null||a.sequence_number>r)&&this._emit(o,a)},i=fe(this,Se,"m",Nr).call(this,n);switch(s("event",n),n.type){case"response.output_text.delta":{const o=i.output[n.output_index];if(!o)throw new A(`missing output at index ${n.output_index}`);if(o.type==="message"){const a=o.content[n.content_index];if(!a)throw new A(`missing content at index ${n.content_index}`);if(a.type!=="output_text")throw new A(`expected content to be 'output_text', got ${a.type}`);s("response.output_text.delta",{...n,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const o=i.output[n.output_index];if(!o)throw new A(`missing output at index ${n.output_index}`);o.type==="function_call"&&s("response.function_call_arguments.delta",{...n,snapshot:o.arguments});break}default:s(n.type,n);break}},Lr=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");const n=fe(this,he,"f");if(!n)throw new A("request ended without sending any events");Ae(this,he,void 0,"f");const r=_l(n,fe(this,gt,"f"));return Ae(this,_t,r,"f"),r},Nr=function(n){let r=fe(this,he,"f");if(!r){if(n.type!=="response.created")throw new A(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=Ae(this,he,n.response,"f"),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{const s=r.output[n.output_index];if(!s)throw new A(`missing output at index ${n.output_index}`);s.type==="message"&&s.content.push(n.part);break}case"response.output_text.delta":{const s=r.output[n.output_index];if(!s)throw new A(`missing output at index ${n.output_index}`);if(s.type==="message"){const i=s.content[n.content_index];if(!i)throw new A(`missing content at index ${n.content_index}`);if(i.type!=="output_text")throw new A(`expected content to be 'output_text', got ${i.type}`);i.text+=n.delta}break}case"response.function_call_arguments.delta":{const s=r.output[n.output_index];if(!s)throw new A(`missing output at index ${n.output_index}`);s.type==="function_call"&&(s.arguments+=n.delta);break}case"response.completed":{Ae(this,he,n.response,"f");break}}return r},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",s=>{const i=n.shift();i?i.resolve(s):t.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>n.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=fe(this,_t,"f");if(!t)throw new A("stream ended without producing a ChatCompletion");return t}}function _l(e,t){return fl(e,t)}class tr extends S{constructor(){super(...arguments),this.inputItems=new ui(this._client)}create(t,n){return this._client.post("/responses",{body:t,...n,stream:t.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&ci(r),r))}retrieve(t,n={},r){return this._client.get(`/responses/${t}`,{query:n,...r,stream:(n==null?void 0:n.stream)??!1})}del(t,n){return this._client.delete(`/responses/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(t,n){return this._client.responses.create(t,n)._thenUnwrap(r=>li(r,t))}stream(t,n){return er.createResponse(this._client,t,n)}cancel(t,n){return this._client.post(`/responses/${t}/cancel`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class yl extends D{}tr.InputItems=ui;class fi extends S{create(t,n,r){return this._client.post(`/uploads/${t}/parts`,we({body:n,...r}))}}class nr extends S{constructor(){super(...arguments),this.parts=new fi(this._client)}create(t,n){return this._client.post("/uploads",{body:t,...n})}cancel(t,n){return this._client.post(`/uploads/${t}/cancel`,n)}complete(t,n,r){return this._client.post(`/uploads/${t}/complete`,{body:n,...r})}}nr.Parts=fi;const bl=async e=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of t)s.status==="fulfilled"&&r.push(s.value);return r};class zt extends S{create(t,n,r){return this._client.post(`/vector_stores/${t}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/vector_stores/${t}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,s){return this._client.post(`/vector_stores/${t}/files/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,n={},r){return F(n)?this.list(t,{},n):this._client.getAPIList(`/vector_stores/${t}/files`,qt,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n,r){return this._client.delete(`/vector_stores/${t}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const s=await this.create(t,n,r);return await this.poll(t,s.id,r)}async poll(t,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(t,n,{...r,headers:s}).withResponse(),o=i.data;switch(o.status){case"in_progress":let a=5e3;if(r!=null&&r.pollIntervalMs)a=r.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(a=c)}}await Ye(a);break;case"failed":case"completed":return o}}}async upload(t,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(t,{file_id:s.id},r)}async uploadAndPoll(t,n,r){const s=await this.upload(t,n,r);return await this.poll(t,s.id,r)}content(t,n,r){return this._client.getAPIList(`/vector_stores/${t}/files/${n}/content`,rr,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class qt extends D{}class rr extends Lt{}zt.VectorStoreFilesPage=qt;zt.FileContentResponsesPage=rr;class hi extends S{create(t,n,r){return this._client.post(`/vector_stores/${t}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/vector_stores/${t}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(t,n,r){return this._client.post(`/vector_stores/${t}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const s=await this.create(t,n);return await this.poll(t,s.id,r)}listFiles(t,n,r={},s){return F(r)?this.listFiles(t,n,{},r):this._client.getAPIList(`/vector_stores/${t}/file_batches/${n}/files`,qt,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(t,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:o}=await this.retrieve(t,n,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let a=5e3;if(r!=null&&r.pollIntervalMs)a=r.pollIntervalMs;else{const l=o.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(a=c)}}await Ye(a);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(t,{files:n,fileIds:r=[]},s){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,o=Math.min(i,n.length),a=this._client,l=n.values(),c=[...r];async function f(p){for(let d of p){const h=await a.files.create({file:d,purpose:"assistants"},s);c.push(h.id)}}const u=Array(o).fill(l).map(f);return await bl(u),await this.createAndPoll(t,{file_ids:c})}}class ge extends S{constructor(){super(...arguments),this.files=new zt(this._client),this.fileBatches=new hi(this._client)}create(t,n){return this._client.post("/vector_stores",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/vector_stores/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/vector_stores/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t={},n){return F(t)?this.list({},t):this._client.getAPIList("/vector_stores",sr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,n){return this._client.delete(`/vector_stores/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(t,n,r){return this._client.getAPIList(`/vector_stores/${t}/search`,ir,{body:n,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class sr extends D{}class ir extends Lt{}ge.VectorStoresPage=sr;ge.VectorStoreSearchResponsesPage=ir;ge.Files=zt;ge.VectorStoreFilesPage=qt;ge.FileContentResponsesPage=rr;ge.FileBatches=hi;var di;class E extends ja{constructor({baseURL:t=ft("OPENAI_BASE_URL"),apiKey:n=ft("OPENAI_API_KEY"),organization:r=ft("OPENAI_ORG_ID")??null,project:s=ft("OPENAI_PROJECT_ID")??null,...i}={}){if(n===void 0)throw new A("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:n,organization:r,project:s,...i,baseURL:t||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&Qa())throw new A(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new ei(this),this.chat=new Bt(this),this.embeddings=new ni(this),this.files=new Wn(this),this.images=new oi(this),this.audio=new et(this),this.moderations=new ai(this),this.models=new Zn(this),this.fineTuning=new me(this),this.graders=new Kn(this),this.vectorStores=new ge(this),this.beta=new Fe(this),this.batches=new An(this),this.uploads=new nr(this),this.responses=new tr(this),this.evals=new it(this),this.containers=new rt(this),this._options=o,this.apiKey=n,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(t){return{...super.defaultHeaders(t),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(t){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(t){return xa(t,{arrayFormat:"brackets"})}}di=E;E.OpenAI=di;E.DEFAULT_TIMEOUT=6e5;E.OpenAIError=A;E.APIError=U;E.APIConnectionError=Mt;E.APIConnectionTimeoutError=Cn;E.APIUserAbortError=V;E.NotFoundError=fs;E.ConflictError=hs;E.RateLimitError=ps;E.BadRequestError=ls;E.AuthenticationError=cs;E.InternalServerError=ms;E.PermissionDeniedError=us;E.UnprocessableEntityError=ds;E.toFile=ks;E.fileFromPath=is;E.Completions=ei;E.Chat=Bt;E.ChatCompletionsPage=Dt;E.Embeddings=ni;E.Files=Wn;E.FileObjectsPage=zn;E.Images=oi;E.Audio=et;E.Moderations=ai;E.Models=Zn;E.ModelsPage=Yn;E.FineTuning=me;E.Graders=Kn;E.VectorStores=ge;E.VectorStoresPage=sr;E.VectorStoreSearchResponsesPage=ir;E.Beta=Fe;E.Batches=An;E.BatchesPage=Sn;E.Uploads=nr;E.Responses=tr;E.Evals=it;E.EvalListResponsesPage=Un;E.Containers=rt;E.ContainerListResponsesPage=Nn;export{Z as M,E as O};
