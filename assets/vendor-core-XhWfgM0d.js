import{r as Zt,n as yt,a7 as Wn,al as xr,B as vt,am as sn,y as rn,o as Ie,b as te,v as Tr,P as qn,an as Cr,g as Sr,s as Ar,ao as Er,ap as Kn,aq as Jn,ar as Qn,as as Gn,at as Yn,au as Xn,av as Zn,aw as ts,ax as es,ay as Lr,az as Oe,aA as _r,aB as Ir,aC as Or,aD as at,aE as Kt,aF as $e,aG as $r,aH as Pr,aI as Hr,aJ as Nr,aK as Rr,aL as ns,aM as Dr,aN as zr,aO as Br,aP as Ur,aQ as jr,aR as Vr}from"./vendor-CZgesK76.js";import{f as Fr,c as Pe,N as et,T as Wr,D as jt,S as ss,a as He,b as qr,E as Kr,d as Jr,e as X,g as z,P as O,h as $,k as Qr,R as Gr,F as W,l as Yr,i as Xr,j as Zr,m as to,n as eo,o as no,p as so,q as ro,r as rs,s as oo,t as io,u as ao,v as lo,w as co,x as uo,A as os,y as po,z as ho,B as fo,C as mo,G as go,H as on,I as yo,J as Vt,K as ft,L as vo,M as bo,O as ko,Q as wo,U as Mo,V as Z,W as ct,X as xo,Y as To,Z as Co,_ as So,$ as Ne,a0 as an,a1 as Ao,a2 as Eo,a3 as Lo,a4 as ln,a5 as _o,a6 as cn,a7 as dn,a8 as Io,a9 as un,aa as Oo,ab as $o,ac as Po,ad as Ho,ae as No,af as Ro,ag as Do}from"./vendor-prosemirror-D_WSVx0v.js";import{f as is,r as pn,t as zo,a as Bo,U as as,I as ls,C as Uo,Y as cs,b as Q,s as ue,D as jo,c as hn,d as Vo,i as fn,e as ds,S as us,g as G,h as pe,R as ye,j as ve,k as Fo,l as Wo,m as qo,n as Ko,o as Jo,p as Qo,q as Go,u as mn,v as Ct,w as Yo}from"./vendor-collab-4TbWQLBD.js";import ps from"./vendor-katex-C66qTcOd.js";import{L as Xo}from"./vendor-utils-7C4DHr6B.js";var Zo=Object.defineProperty,Re=(t,e)=>{for(var n in e)Zo(t,n,{get:e[n],enumerable:!0})};function ee(t){const{state:e,transaction:n}=t;let{selection:s}=n,{doc:r}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return s},get doc(){return r},get tr(){return s=n.selection,r=n.doc,o=n.storedMarks,n}}}var ne=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:s}=e,{tr:r}=n,o=this.buildProps(r);return Object.fromEntries(Object.entries(t).map(([i,a])=>[i,(...c)=>{const u=a(...c)(o);return!r.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(r),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:s,state:r}=this,{view:o}=s,i=[],a=!!t,l=t||r.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(l),i.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,p])=>[d,(...f)=>{const m=this.buildProps(l,e),y=p(...f)(m);return i.push(y),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,s=!1,r=t||n.tr,o=this.buildProps(r,s);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(r,s)}}buildProps(t,e=!0){const{rawCommands:n,editor:s,state:r}=this,{view:o}=s,i={tr:t,editor:s,view:o,state:ee({state:r,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(i)]))}};return i}},K={};Re(K,{blur:()=>ti,clearContent:()=>ei,clearNodes:()=>ni,command:()=>si,createParagraphNear:()=>ri,cut:()=>oi,deleteCurrentNode:()=>ii,deleteNode:()=>ai,deleteRange:()=>li,deleteSelection:()=>ci,enter:()=>di,exitCode:()=>ui,extendMarkRange:()=>pi,first:()=>hi,focus:()=>mi,forEach:()=>gi,insertContent:()=>yi,insertContentAt:()=>ki,joinBackward:()=>xi,joinDown:()=>Mi,joinForward:()=>Ti,joinItemBackward:()=>Ci,joinItemForward:()=>Si,joinTextblockBackward:()=>Ai,joinTextblockForward:()=>Ei,joinUp:()=>wi,keyboardShortcut:()=>_i,lift:()=>Ii,liftEmptyBlock:()=>Oi,liftListItem:()=>$i,newlineInCode:()=>Pi,resetAttributes:()=>Hi,scrollIntoView:()=>Ni,selectAll:()=>Ri,selectNodeBackward:()=>Di,selectNodeForward:()=>zi,selectParentNode:()=>Bi,selectTextblockEnd:()=>Ui,selectTextblockStart:()=>ji,setContent:()=>Vi,setMark:()=>sa,setMeta:()=>ra,setNode:()=>oa,setNodeSelection:()=>ia,setTextDirection:()=>aa,setTextSelection:()=>la,sinkListItem:()=>ca,splitBlock:()=>da,splitListItem:()=>ua,toggleList:()=>pa,toggleMark:()=>ha,toggleNode:()=>fa,toggleWrap:()=>ma,undoInputRule:()=>ga,unsetAllMarks:()=>ya,unsetMark:()=>va,unsetTextDirection:()=>ba,updateAttributes:()=>ka,wrapIn:()=>wa,wrapInList:()=>Ma});var ti=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())==null||n.removeAllRanges())}),!0),ei=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),ni=()=>({state:t,tr:e,dispatch:n})=>{const{selection:s}=e,{ranges:r}=s;return n&&r.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),p=c.resolve(u.map(l+a.nodeSize)),h=d.blockRange(p);if(!h)return;const f=Yr(h);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(f||f===0)&&e.lift(h,f)})}),!0},si=t=>e=>t(e),ri=()=>({state:t,dispatch:e})=>Xr(t,e),oi=(t,e)=>({editor:n,tr:s})=>{const{state:r}=n,o=r.doc.slice(t.from,t.to);s.deleteRange(t.from,t.to);const i=s.mapping.map(e);return s.insert(i,o.content),s.setSelection(new z(s.doc.resolve(Math.max(i-1,0)))),!0},ii=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,s=n.$anchor.node();if(s.content.size>0)return!1;const r=t.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===s.type){if(e){const a=r.before(o),l=r.after(o);t.delete(a,l).scrollIntoView()}return!0}return!1};function B(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var ai=t=>({tr:e,state:n,dispatch:s})=>{const r=B(t,n.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===r){if(s){const l=o.before(i),c=o.after(i);e.delete(l,c).scrollIntoView()}return!0}return!1},li=t=>({tr:e,dispatch:n})=>{const{from:s,to:r}=t;return n&&e.delete(s,r),!0},ci=()=>({state:t,dispatch:e})=>Zr(t,e),di=()=>({commands:t})=>t.keyboardShortcut("Enter"),ui=()=>({state:t,dispatch:e})=>to(t,e);function De(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Jt(t,e,n={strict:!0}){const s=Object.keys(e);return s.length?s.every(r=>n.strict?e[r]===t[r]:De(e[r])?e[r].test(t[r]):e[r]===t[r]):!0}function hs(t,e,n={}){return t.find(s=>s.type===e&&Jt(Object.fromEntries(Object.keys(n).map(r=>[r,s.attrs[r]])),n))}function gn(t,e,n={}){return!!hs(t,e,n)}function ze(t,e,n){var s;if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if((!r.node||!r.node.marks.some(u=>u.type===e))&&(r=t.parent.childBefore(t.parentOffset)),!r.node||!r.node.marks.some(u=>u.type===e)||(n=n||((s=r.node.marks[0])==null?void 0:s.attrs),!hs([...r.node.marks],e,n)))return;let i=r.index,a=t.start()+r.offset,l=i+1,c=a+r.node.nodeSize;for(;i>0&&gn([...t.parent.child(i-1).marks],e,n);)i-=1,a-=t.parent.child(i).nodeSize;for(;l<t.parent.childCount&&gn([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function nt(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var pi=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const o=nt(t,s.schema),{doc:i,selection:a}=n,{$from:l,from:c,to:u}=a;if(r){const d=ze(l,o,e);if(d&&d.from<=c&&d.to>=u){const p=z.create(i,d.from,d.to);n.setSelection(p)}}return!0},hi=t=>e=>{const n=typeof t=="function"?t(e):t;for(let s=0;s<n.length;s+=1)if(n[s](e))return!0;return!1};function Be(t){return t instanceof z}function Y(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function fs(t,e=null){if(!e)return null;const n=X.atStart(t),s=X.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return s;const r=n.from,o=s.to;return e==="all"?z.create(t,Y(0,r,o),Y(t.content.size,r,o)):z.create(t,Y(e,r,o),Y(e,r,o))}function be(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Et(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function fi(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var mi=(t=null,e={})=>({editor:n,view:s,tr:r,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{(Et()||be())&&s.dom.focus(),fi()&&!Et()&&!be()&&s.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};try{if(s.hasFocus()&&t===null||t===!1)return!0}catch{return!1}if(o&&t===null&&!Be(n.state.selection))return i(),!0;const a=fs(r.doc,t)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),i()),!0},gi=(t,e)=>n=>t.every((s,r)=>e(s,{...n,index:r})),yi=(t,e)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),ms=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const s=e[n];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?t.removeChild(s):s.nodeType===1&&ms(s)}return t};function xt(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return ms(n)}function Lt(t,e,n){if(t instanceof He||t instanceof W)return t;n={slice:!0,parseOptions:{},...n};const s=typeof t=="object"&&t!==null,r=typeof t=="string";if(s)try{if(Array.isArray(t)&&t.length>0)return W.fromArray(t.map(a=>e.nodeFromJSON(a)));const i=e.nodeFromJSON(t);return n.errorOnInvalidContent&&i.check(),i}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),Lt("",e,n)}if(r){if(n.errorOnInvalidContent){let i=!1,a="";const l=new ss({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(i=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?jt.fromSchema(l).parseSlice(xt(t),n.parseOptions):jt.fromSchema(l).parse(xt(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=jt.fromSchema(e);return n.slice?o.parseSlice(xt(t),n.parseOptions).content:o.parse(xt(t),n.parseOptions)}return Lt("",e,n)}function vi(t,e,n){const s=t.steps.length-1;if(s<e)return;const r=t.steps[s];if(!(r instanceof ko||r instanceof wo))return;const o=t.mapping.maps[s];let i=0;o.forEach((a,l,c,u)=>{i===0&&(i=u)}),t.setSelection(X.near(t.doc.resolve(i),n))}var bi=t=>!("type"in t),ki=(t,e,n)=>({tr:s,dispatch:r,editor:o})=>{var i;if(r){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=y=>{o.emit("contentError",{editor:o,error:y,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{Lt(e,o.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(y){l(y)}try{a=Lt(e,o.schema,{parseOptions:c,errorOnInvalidContent:(i=n.errorOnInvalidContent)!=null?i:o.options.enableContentCheck})}catch(y){return l(y),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,h=!0;if((bi(a)?a:[a]).forEach(y=>{y.check(),p=p?y.isText&&y.marks.length===0:!1,h=h?y.isBlock:!1}),u===d&&h){const{parent:y}=s.doc.resolve(u);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(u-=1,d+=1)}let m;if(p){if(Array.isArray(e))m=e.map(y=>y.text||"").join("");else if(e instanceof W){let y="";e.forEach(g=>{g.text&&(y+=g.text)}),m=y}else typeof e=="object"&&e&&e.text?m=e.text:m=e;s.insertText(m,u,d)}else{m=a;const y=s.doc.resolve(u),g=y.node(),v=y.parentOffset===0,b=g.isText||g.isTextblock,k=g.content.size>0;v&&b&&k&&(u=Math.max(0,u-1)),s.replaceWith(u,d,m)}n.updateSelection&&vi(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:u,text:m}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:u,text:m})}return!0},wi=()=>({state:t,dispatch:e})=>eo(t,e),Mi=()=>({state:t,dispatch:e})=>no(t,e),xi=()=>({state:t,dispatch:e})=>so(t,e),Ti=()=>({state:t,dispatch:e})=>ro(t,e),Ci=()=>({state:t,dispatch:e,tr:n})=>{try{const s=rs(t.doc,t.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},Si=()=>({state:t,dispatch:e,tr:n})=>{try{const s=rs(t.doc,t.selection.$from.pos,1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},Ai=()=>({state:t,dispatch:e})=>oo(t,e),Ei=()=>({state:t,dispatch:e})=>io(t,e);function gs(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Li(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let s,r,o,i;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))Et()||gs()?i=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return s&&(n=`Alt-${n}`),r&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}var _i=t=>({editor:e,view:n,tr:s,dispatch:r})=>{const o=Li(t).split(/-(?!$)/),i=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(s.mapping);u&&r&&s.maybeStep(u)}),!0};function rt(t,e,n={}){const{from:s,to:r,empty:o}=t.selection,i=e?B(e,t.schema):null,a=[];t.doc.nodesBetween(s,r,(d,p)=>{if(d.isText)return;const h=Math.max(s,p),f=Math.min(r,p+d.nodeSize);a.push({node:d,from:h,to:f})});const l=r-s,c=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>Jt(d.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((d,p)=>d+p.to-p.from,0)>=l}var Ii=(t,e={})=>({state:n,dispatch:s})=>{const r=B(t,n.schema);return rt(n,r,e)?ao(n,s):!1},Oi=()=>({state:t,dispatch:e})=>lo(t,e),$i=t=>({state:e,dispatch:n})=>{const s=B(t,e.schema);return co(s)(e,n)},Pi=()=>({state:t,dispatch:e})=>uo(t,e);function se(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function yn(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((s,r)=>(n.includes(r)||(s[r]=t[r]),s),{})}var Hi=(t,e)=>({tr:n,state:s,dispatch:r})=>{let o=null,i=null;const a=se(typeof t=="string"?t:t.name,s.schema);if(!a)return!1;a==="node"&&(o=B(t,s.schema)),a==="mark"&&(i=nt(t,s.schema));let l=!1;return n.selection.ranges.forEach(c=>{s.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{o&&o===u.type&&(l=!0,r&&n.setNodeMarkup(d,void 0,yn(u.attrs,e))),i&&u.marks.length&&u.marks.forEach(p=>{i===p.type&&(l=!0,r&&n.addMark(d,d+u.nodeSize,i.create(yn(p.attrs,e))))})})}),l},Ni=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Ri=()=>({tr:t,dispatch:e})=>{if(e){const n=new os(t.doc);t.setSelection(n)}return!0},Di=()=>({state:t,dispatch:e})=>po(t,e),zi=()=>({state:t,dispatch:e})=>ho(t,e),Bi=()=>({state:t,dispatch:e})=>fo(t,e),Ui=()=>({state:t,dispatch:e})=>mo(t,e),ji=()=>({state:t,dispatch:e})=>go(t,e);function ke(t,e,n={},s={}){return Lt(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}var Vi=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:s={}}={})=>({editor:r,tr:o,dispatch:i,commands:a})=>{const{doc:l}=o;if(s.preserveWhitespace!=="full"){const c=ke(t,r.schema,s,{errorOnInvalidContent:e??r.options.enableContentCheck});return i&&o.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return i&&o.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:s,errorOnInvalidContent:e??r.options.enableContentCheck})};function ys(t,e){const n=nt(e,t.schema),{from:s,to:r,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(s,r,l=>{i.push(...l.marks)});const a=i.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function Ue(t,e){const n=new Wr(t);return e.forEach(s=>{s.steps.forEach(r=>{n.step(r)})}),n}function je(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function st(t,e){const n=[];return t.descendants((s,r)=>{e(s)&&n.push({node:s,pos:r})}),n}function vs(t,e,n){const s=[];return t.nodesBetween(e.from,e.to,(r,o)=>{n(r)&&s.push({node:r,pos:o})}),s}function bs(t,e){for(let n=t.depth;n>0;n-=1){const s=t.node(n);if(e(s))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:s}}}function ut(t){return e=>bs(e.$from,t)}function w(t,e,n){return t.config[e]===void 0&&t.parent?w(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?w(t.parent,e,n):null}):t.config[e]}function re(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},s=w(e,"addExtensions",n);return s?[e,...re(s())]:e}).flat(10)}function oe(t,e){const n=qr.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function ks(t){return typeof t=="function"}function I(t,e=void 0,...n){return ks(t)?e?t.bind(e)(...n):t(...n):t}function Fi(t={}){return Object.keys(t).length===0&&t.constructor===Object}function mt(t){const e=t.filter(r=>r.type==="extension"),n=t.filter(r=>r.type==="node"),s=t.filter(r=>r.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:s}}function ws(t){const e=[],{nodeExtensions:n,markExtensions:s}=mt(t),r=[...n,...s],o={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1},i=n.filter(c=>c.name!=="text").map(c=>c.name),a=s.map(c=>c.name),l=[...i,...a];return t.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage,extensions:r},d=w(c,"addGlobalAttributes",u);if(!d)return;d().forEach(h=>{let f;Array.isArray(h.types)?f=h.types:h.types==="*"?f=l:h.types==="nodes"?f=i:h.types==="marks"?f=a:f=[],f.forEach(m=>{Object.entries(h.attributes).forEach(([y,g])=>{e.push({type:m,name:y,attribute:{...o,...g}})})})})}),r.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage},d=w(c,"addAttributes",u);if(!d)return;const p=d();Object.entries(p).forEach(([h,f])=>{const m={...o,...f};typeof(m==null?void 0:m.default)=="function"&&(m.default=m.default()),m!=null&&m.isRequired&&(m==null?void 0:m.default)===void 0&&delete m.default,e.push({type:c.name,name:h,attribute:m})})}),e}function A(...t){return t.filter(e=>!!e).reduce((e,n)=>{const s={...e};return Object.entries(n).forEach(([r,o])=>{if(!s[r]){s[r]=o;return}if(r==="class"){const a=o?String(o).split(" "):[],l=s[r]?s[r].split(" "):[],c=a.filter(u=>!l.includes(u));s[r]=[...l,...c].join(" ")}else if(r==="style"){const a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],l=s[r]?s[r].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,p]=u.split(":").map(h=>h.trim());c.set(d,p)}),a.forEach(u=>{const[d,p]=u.split(":").map(h=>h.trim());c.set(d,p)}),s[r]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else s[r]=o}),s},{})}function _t(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,s)=>A(n,s),{})}function Wi(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function vn(t,e){return"style"in t?t:{...t,getAttrs:n=>{const s=t.getAttrs?t.getAttrs(n):t.attrs;if(s===!1)return!1;const r=e.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(n):Wi(n.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...s,...r}}}}function bn(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Fi(n)?!1:n!=null))}function kn(t){var e,n;const s={};return!((e=t==null?void 0:t.attribute)!=null&&e.isRequired)&&"default"in((t==null?void 0:t.attribute)||{})&&(s.default=t.attribute.default),((n=t==null?void 0:t.attribute)==null?void 0:n.validate)!==void 0&&(s.validate=t.attribute.validate),[t.name,s]}function Ms(t,e){var n;const s=ws(t),{nodeExtensions:r,markExtensions:o}=mt(t),i=(n=r.find(c=>w(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(r.map(c=>{const u=s.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((g,v)=>{const b=w(v,"extendNodeSchema",d);return{...g,...b?b(c):{}}},{}),h=bn({...p,content:I(w(c,"content",d)),marks:I(w(c,"marks",d)),group:I(w(c,"group",d)),inline:I(w(c,"inline",d)),atom:I(w(c,"atom",d)),selectable:I(w(c,"selectable",d)),draggable:I(w(c,"draggable",d)),code:I(w(c,"code",d)),whitespace:I(w(c,"whitespace",d)),linebreakReplacement:I(w(c,"linebreakReplacement",d)),defining:I(w(c,"defining",d)),isolating:I(w(c,"isolating",d)),attrs:Object.fromEntries(u.map(kn))}),f=I(w(c,"parseHTML",d));f&&(h.parseDOM=f.map(g=>vn(g,u)));const m=w(c,"renderHTML",d);m&&(h.toDOM=g=>m({node:g,HTMLAttributes:_t(g,u)}));const y=w(c,"renderText",d);return y&&(h.toText=y),[c.name,h]})),l=Object.fromEntries(o.map(c=>{const u=s.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((y,g)=>{const v=w(g,"extendMarkSchema",d);return{...y,...v?v(c):{}}},{}),h=bn({...p,inclusive:I(w(c,"inclusive",d)),excludes:I(w(c,"excludes",d)),group:I(w(c,"group",d)),spanning:I(w(c,"spanning",d)),code:I(w(c,"code",d)),attrs:Object.fromEntries(u.map(kn))}),f=I(w(c,"parseHTML",d));f&&(h.parseDOM=f.map(y=>vn(y,u)));const m=w(c,"renderHTML",d);return m&&(h.toDOM=y=>m({mark:y,HTMLAttributes:_t(y,u)})),[c.name,h]}));return new ss({topNode:i,nodes:a,marks:l})}function qi(t){const e=t.filter((n,s)=>t.indexOf(n)!==s);return Array.from(new Set(e))}function St(t){return t.sort((n,s)=>{const r=w(n,"priority")||100,o=w(s,"priority")||100;return r>o?-1:r<o?1:0})}function Ve(t){const e=St(re(t)),n=qi(e.map(s=>s.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),e}function xs(t,e){const n=Ve(t);return Ms(n,e)}function ru(t,e){const n=xs(e),s=He.fromJSON(n,t);return oe(s.content,n)}function Ki(t,e){const n=xs(e),s=xt(t);return jt.fromSchema(n).parse(s).toJSON()}function Ts(t,e,n){const{from:s,to:r}=e,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let a="";return t.nodesBetween(s,r,(l,c,u,d)=>{var p;l.isBlock&&c>s&&(a+=o);const h=i==null?void 0:i[l.type.name];if(h)return u&&(a+=h({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(p=l==null?void 0:l.text)==null?void 0:p.slice(Math.max(s,c)-c,r-c))}),a}function Cs(t,e){const n={from:0,to:t.content.size};return Ts(t,n,e)}function Fe(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function Ji(t,e){const n=B(e,t.schema),{from:s,to:r}=t.selection,o=[];t.doc.nodesBetween(s,r,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===n.name);return i?{...i.attrs}:{}}function Ss(t,e){const n=se(typeof e=="string"?e:e.name,t.schema);return n==="node"?Ji(t,e):n==="mark"?ys(t,e):{}}function Qi(t,e=JSON.stringify){const n={};return t.filter(s=>{const r=e(s);return Object.prototype.hasOwnProperty.call(n,r)?!1:n[r]=!0})}function Gi(t){const e=Qi(t);return e.length===1?e:e.filter((n,s)=>!e.filter((o,i)=>i!==s).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function We(t){const{mapping:e,steps:n}=t,s=[];return e.maps.forEach((r,o)=>{const i=[];if(r.ranges.length)r.forEach((a,l)=>{i.push({from:a,to:l})});else{const{from:a,to:l}=n[o];if(a===void 0||l===void 0)return;i.push({from:a,to:l})}i.forEach(({from:a,to:l})=>{const c=e.slice(o).map(a,-1),u=e.slice(o).map(l),d=e.invert().map(c,-1),p=e.invert().map(u);s.push({oldRange:{from:d,to:p},newRange:{from:c,to:u}})})}),Gi(s)}function qe(t,e,n){const s=[];return t===e?n.resolve(t).marks().forEach(r=>{const o=n.resolve(t),i=ze(o,r.type);i&&s.push({mark:r,...i})}):n.nodesBetween(t,e,(r,o)=>{!r||(r==null?void 0:r.nodeSize)===void 0||s.push(...r.marks.map(i=>({from:o,to:o+r.nodeSize,mark:i})))}),s}var Yi=(t,e,n,s=20)=>{const r=t.doc.resolve(n);let o=s,i=null;for(;o>0&&i===null;){const a=r.node(o);(a==null?void 0:a.type.name)===e?i=a:o-=1}return[i,o]};function Mt(t,e){return e.nodes[t]||e.marks[t]||null}function Ft(t,e,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{const r=t.find(o=>o.type===e&&o.name===s);return r?r.attribute.keepOnSplit:!1}))}var Xi=(t,e=500)=>{let n="";const s=t.parentOffset;return t.parent.nodesBetween(Math.max(0,s-e),s,(r,o,i,a)=>{var l,c;const u=((c=(l=r.type.spec).toText)==null?void 0:c.call(l,{node:r,pos:o,parent:i,index:a}))||r.textContent||"%leaf%";n+=r.isAtom&&!r.isText?u:u.slice(0,Math.max(0,s-o))}),n};function we(t,e,n={}){const{empty:s,ranges:r}=t.selection,o=e?nt(e,t.schema):null;if(s)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>Jt(d.attrs,n,{strict:!1}));let i=0;const a=[];if(r.forEach(({$from:d,$to:p})=>{const h=d.pos,f=p.pos;t.doc.nodesBetween(h,f,(m,y)=>{if(o&&m.inlineContent&&!m.type.allowsMarkType(o))return!1;if(!m.isText&&!m.marks.length)return;const g=Math.max(h,y),v=Math.min(f,y+m.nodeSize),b=v-g;i+=b,a.push(...m.marks.map(k=>({mark:k,from:g,to:v})))})}),i===0)return!1;const l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>Jt(d.mark.attrs,n,{strict:!1})).reduce((d,p)=>d+p.to-p.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,p)=>d+p.to-p.from,0);return(l>0?l+c:l)>=i}function As(t,e,n={}){if(!e)return rt(t,null,n)||we(t,null,n);const s=se(e,t.schema);return s==="node"?rt(t,e,n):s==="mark"?we(t,e,n):!1}var Zi=(t,e)=>{const{$from:n,$to:s,$anchor:r}=t.selection;if(e){const o=ut(a=>a.type.name===e)(t.selection);if(!o)return!1;const i=t.doc.resolve(o.pos+1);return r.pos+1===i.end()}return!(s.parentOffset<s.parent.nodeSize-2||n.pos!==s.pos)},ta=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function wn(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Mn(t,e){const{nodeExtensions:n}=mt(e),s=n.find(i=>i.name===t);if(!s)return!1;const r={name:s.name,options:s.options,storage:s.storage},o=I(w(s,"group",r));return typeof o!="string"?!1:o.split(" ").includes("list")}function ie(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((s=t.text)!=null?s:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let r=!0;return t.content.forEach(o=>{r!==!1&&(ie(o,{ignoreWhitespace:n,checkChildren:e})||(r=!1))}),r}return!1}function Es(t){return t instanceof et}var Ke=class Ls{constructor(e){this.position=e}static fromJSON(e){return new Ls(e.position)}toJSON(){return{position:this.position}}};function _s(t,e){const n=e.mapping.mapResult(t.position);return{position:new Ke(n.pos),mapResult:n}}function ea(t){return new Ke(t)}function Is(t,e,n){const r=t.state.doc.content.size,o=Y(e,0,r),i=Y(n,0,r),a=t.coordsAtPos(o),l=t.coordsAtPos(i,-1),c=Math.min(a.top,l.top),u=Math.max(a.bottom,l.bottom),d=Math.min(a.left,l.left),p=Math.max(a.right,l.right),h=p-d,f=u-c,g={top:c,bottom:u,left:d,right:p,width:h,height:f,x:d,y:c};return{...g,toJSON:()=>g}}function na(t,e,n){var s;const{selection:r}=e;let o=null;if(Be(r)&&(o=r.$cursor),o){const a=(s=t.storedMarks)!=null?s:o.marks();return o.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:i}=r;return i.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,p)=>{if(c)return!1;if(u.isInline){const h=!p||p.type.allowsMarkType(n),f=!!n.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(n));c=h&&f}return!c}),c})}var sa=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const{selection:o}=n,{empty:i,ranges:a}=o,l=nt(t,s.schema);if(r)if(i){const c=ys(s,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;s.doc.nodesBetween(u,d,(p,h)=>{const f=Math.max(h,u),m=Math.min(h+p.nodeSize,d);p.marks.find(g=>g.type===l)?p.marks.forEach(g=>{l===g.type&&n.addMark(f,m,l.create({...g.attrs,...e}))}):n.addMark(f,m,l.create(e))})});return na(s,n,l)},ra=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),oa=(t,e={})=>({state:n,dispatch:s,chain:r})=>{const o=B(t,n.schema);let i;return n.selection.$anchor.sameParent(n.selection.$head)&&(i=n.selection.$anchor.parent.attrs),o.isTextblock?r().command(({commands:a})=>on(o,{...i,...e})(n)?!0:a.clearNodes()).command(({state:a})=>on(o,{...i,...e})(a,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},ia=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,r=Y(t,0,s.content.size),o=et.create(s,r);e.setSelection(o)}return!0},aa=(t,e)=>({tr:n,state:s,dispatch:r})=>{const{selection:o}=s;let i,a;return typeof e=="number"?(i=e,a=e):e&&"from"in e&&"to"in e?(i=e.from,a=e.to):(i=o.from,a=o.to),r&&n.doc.nodesBetween(i,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},la=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,{from:r,to:o}=typeof t=="number"?{from:t,to:t}:t,i=z.atStart(s).from,a=z.atEnd(s).to,l=Y(r,i,a),c=Y(o,i,a),u=z.create(s,l,c);e.setSelection(u)}return!0},ca=t=>({state:e,dispatch:n})=>{const s=B(t,e.schema);return yo(s)(e,n)};function xn(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const s=n.filter(r=>e==null?void 0:e.includes(r.type.name));t.tr.ensureMarks(s)}}var da=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:s,editor:r})=>{const{selection:o,doc:i}=e,{$from:a,$to:l}=o,c=r.extensionManager.attributes,u=Ft(c,a.node().type.name,a.node().attrs);if(o instanceof et&&o.node.isBlock)return!a.parentOffset||!Vt(i,a.pos)?!1:(s&&(t&&xn(n,r.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,p=a.depth===0?void 0:je(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&p?[{type:p,attrs:u}]:void 0,f=Vt(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!f&&Vt(e.doc,e.mapping.map(a.pos),1,p?[{type:p}]:void 0)&&(f=!0,h=p?[{type:p,attrs:u}]:void 0),s){if(f&&(o instanceof z&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),p&&!d&&!a.parentOffset&&a.parent.type!==p)){const m=e.mapping.map(a.before()),y=e.doc.resolve(m);a.node(-1).canReplaceWith(y.index(),y.index()+1,p)&&e.setNodeMarkup(e.mapping.map(a.before()),p)}t&&xn(n,r.extensionManager.splittableMarks),e.scrollIntoView()}return f},ua=(t,e={})=>({tr:n,state:s,dispatch:r,editor:o})=>{var i;const a=B(t,s.schema),{$from:l,$to:c}=s.selection,u=s.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const p=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let g=W.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let C=l.depth-v;C>=l.depth-3;C-=1)g=W.from(l.node(C).copy(g));const b=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,k={...Ft(p,l.node().type.name,l.node().attrs),...e},M=((i=a.contentMatch.defaultType)==null?void 0:i.createAndFill(k))||void 0;g=g.append(W.from(a.createAndFill(null,M)||void 0));const T=l.before(l.depth-(v-1));n.replace(T,l.after(-b),new ft(g,4-v,0));let x=-1;n.doc.nodesBetween(T,n.doc.content.size,(C,S)=>{if(x>-1)return!1;C.isTextblock&&C.content.size===0&&(x=S+1)}),x>-1&&n.setSelection(z.near(n.doc.resolve(x))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,f={...Ft(p,d.type.name,d.attrs),...e},m={...Ft(p,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const y=h?[{type:a,attrs:f},{type:h,attrs:m}]:[{type:a,attrs:f}];if(!Vt(n.doc,l.pos,2))return!1;if(r){const{selection:g,storedMarks:v}=s,{splittableMarks:b}=o.extensionManager,k=v||g.$to.parentOffset&&g.$from.marks();if(n.split(l.pos,2,y).scrollIntoView(),!k||!r)return!0;const M=k.filter(T=>b.includes(T.type.name));n.ensureMarks(M)}return!0},he=(t,e)=>{const n=ut(i=>i.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&Pe(t.doc,n.pos)&&t.join(n.pos),!0},fe=(t,e)=>{const n=ut(i=>i.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&Pe(t.doc,s)&&t.join(s),!0},pa=(t,e,n,s={})=>({editor:r,tr:o,state:i,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:p}=r.extensionManager,h=B(t,i.schema),f=B(e,i.schema),{selection:m,storedMarks:y}=i,{$from:g,$to:v}=m,b=g.blockRange(v),k=y||m.$to.parentOffset&&m.$from.marks();if(!b)return!1;const M=ut(T=>Mn(T.type.name,d))(m);if(b.depth>=1&&M&&b.depth-M.depth<=1){if(M.node.type===h)return c.liftListItem(f);if(Mn(M.node.type.name,d)&&h.validContent(M.node.content)&&a)return l().command(()=>(o.setNodeMarkup(M.pos,h),!0)).command(()=>he(o,h)).command(()=>fe(o,h)).run()}return!n||!k||!a?l().command(()=>u().wrapInList(h,s)?!0:c.clearNodes()).wrapInList(h,s).command(()=>he(o,h)).command(()=>fe(o,h)).run():l().command(()=>{const T=u().wrapInList(h,s),x=k.filter(C=>p.includes(C.type.name));return o.ensureMarks(x),T?!0:c.clearNodes()}).wrapInList(h,s).command(()=>he(o,h)).command(()=>fe(o,h)).run()},ha=(t,e={},n={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:o=!1}=n,i=nt(t,s.schema);return we(s,i,e)?r.unsetMark(i,{extendEmptyMarkRange:o}):r.setMark(i,e)},fa=(t,e,n={})=>({state:s,commands:r})=>{const o=B(t,s.schema),i=B(e,s.schema),a=rt(s,o,n);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?r.setNode(i,l):r.setNode(o,{...l,...n})},ma=(t,e={})=>({state:n,commands:s})=>{const r=B(t,n.schema);return rt(n,r,e)?s.lift(r):s.wrapIn(r,e)},ga=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let s=0;s<n.length;s+=1){const r=n[s];let o;if(r.spec.isInputRules&&(o=r.getState(t))){if(e){const i=t.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)i.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,l))}else i.delete(o.from,o.to)}return!0}}return!1},ya=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:s,ranges:r}=n;return s||e&&r.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},va=(t,e={})=>({tr:n,state:s,dispatch:r})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:a}=n,l=nt(t,s.schema),{$from:c,empty:u,ranges:d}=a;if(!r)return!0;if(u&&i){let{from:p,to:h}=a;const f=(o=c.marks().find(y=>y.type===l))==null?void 0:o.attrs,m=ze(c,l,f);m&&(p=m.from,h=m.to),n.removeMark(p,h,l)}else d.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,l)});return n.removeStoredMark(l),!0},ba=t=>({tr:e,state:n,dispatch:s})=>{const{selection:r}=n;let o,i;return typeof t=="number"?(o=t,i=t):t&&"from"in t&&"to"in t?(o=t.from,i=t.to):(o=r.from,i=r.to),s&&e.doc.nodesBetween(o,i,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},ka=(t,e={})=>({tr:n,state:s,dispatch:r})=>{let o=null,i=null;const a=se(typeof t=="string"?t:t.name,s.schema);if(!a)return!1;a==="node"&&(o=B(t,s.schema)),a==="mark"&&(i=nt(t,s.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let p,h,f,m;n.selection.empty?s.doc.nodesBetween(u,d,(y,g)=>{o&&o===y.type&&(l=!0,f=Math.max(g,u),m=Math.min(g+y.nodeSize,d),p=g,h=y)}):s.doc.nodesBetween(u,d,(y,g)=>{g<u&&o&&o===y.type&&(l=!0,f=Math.max(g,u),m=Math.min(g+y.nodeSize,d),p=g,h=y),g>=u&&g<=d&&(o&&o===y.type&&(l=!0,r&&n.setNodeMarkup(g,void 0,{...y.attrs,...e})),i&&y.marks.length&&y.marks.forEach(v=>{if(i===v.type&&(l=!0,r)){const b=Math.max(g,u),k=Math.min(g+y.nodeSize,d);n.addMark(b,k,i.create({...v.attrs,...e}))}}))}),h&&(p!==void 0&&r&&n.setNodeMarkup(p,void 0,{...h.attrs,...e}),i&&h.marks.length&&h.marks.forEach(y=>{i===y.type&&r&&n.addMark(f,m,i.create({...y.attrs,...e}))}))}),l},wa=(t,e={})=>({state:n,dispatch:s})=>{const r=B(t,n.schema);return vo(r,e)(n,s)},Ma=(t,e={})=>({state:n,dispatch:s})=>{const r=B(t,n.schema);return bo(r,e)(n,s)},xa=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(s=>s.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(s=>s!==e):delete this.callbacks[t]),this}once(t,e){const n=(...s)=>{this.off(t,n),e.apply(this,s)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},pt=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},Ta=(t,e)=>{if(De(e))return e.exec(t);const n=e(t);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=t,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s};function Nt(t){var e;const{editor:n,from:s,to:r,text:o,rules:i,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(s);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let u=!1;const d=Xi(c)+o;return i.forEach(p=>{if(u)return;const h=Ta(d,p.find);if(!h)return;const f=l.state.tr,m=ee({state:l.state,transaction:f}),y={from:s-(h[0].length-o.length),to:r},{commands:g,chain:v,can:b}=new ne({editor:n,state:m});p.handler({state:m,range:y,match:h,commands:g,chain:v,can:b})===null||!f.steps.length||(p.undoable&&f.setMeta(a,{transform:f,from:s,to:r,text:o}),l.dispatch(f),u=!0)}),u}function Ca(t){const{editor:e,rules:n}=t,s=new O({state:{init(){return null},apply(r,o,i){const a=r.getMeta(s);if(a)return a;const l=r.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=oe(W.from(u),i.schema);const{from:d}=l,p=d+u.length;Nt({editor:e,from:d,to:p,text:u,rules:n,plugin:s})}),r.selectionSet||r.docChanged?null:o}},props:{handleTextInput(r,o,i,a){return Nt({editor:e,from:o,to:i,text:a,rules:n,plugin:s})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{const{$cursor:o}=r.state.selection;o&&Nt({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(r,o){if(o.key!=="Enter")return!1;const{$cursor:i}=r.state.selection;return i?Nt({editor:e,from:i.pos,to:i.pos,text:`
`,rules:n,plugin:s}):!1}},isInputRules:!0});return s}function Sa(t){return Object.prototype.toString.call(t).slice(8,-1)}function Rt(t){return Sa(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Os(t,e){const n={...t};return Rt(t)&&Rt(e)&&Object.keys(e).forEach(s=>{Rt(e[s])&&Rt(t[s])?n[s]=Os(t[s],e[s]):n[s]=e[s]}),n}var Je=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...I(w(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...I(w(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Os(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},J=class $s extends Je{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new $s(n)}static handleExit({editor:e,mark:n}){const{tr:s}=e.state,r=e.state.selection.$from;if(r.pos===r.end()){const i=r.marks();if(!!!i.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=i.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&s.removeStoredMark(l),s.insertText(" ",r.pos),e.view.dispatch(s),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Aa(t){return typeof t=="number"}var Ps=class{constructor(t){this.find=t.find,this.handler=t.handler}},Ea=(t,e,n)=>{if(De(e))return[...t.matchAll(e)];const s=e(t,n);return s?s.map(r=>{const o=[r.text];return o.index=r.index,o.input=t,o.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(r.replaceWith)),o}):[]};function La(t){const{editor:e,state:n,from:s,to:r,rule:o,pasteEvent:i,dropEvent:a}=t,{commands:l,chain:c,can:u}=new ne({editor:e,state:n}),d=[];return n.doc.nodesBetween(s,r,(h,f)=>{var m,y,g,v,b;if((y=(m=h.type)==null?void 0:m.spec)!=null&&y.code||!(h.isText||h.isTextblock||h.isInline))return;const k=(b=(v=(g=h.content)==null?void 0:g.size)!=null?v:h.nodeSize)!=null?b:0,M=Math.max(s,f),T=Math.min(r,f+k);if(M>=T)return;const x=h.isText?h.text||"":h.textBetween(M-f,T-f,void 0,"ï¿¼");Ea(x,o.find,i).forEach(S=>{if(S.index===void 0)return;const P=M+S.index+1,E=P+S[0].length,R={from:n.tr.mapping.map(P),to:n.tr.mapping.map(E)},j=o.handler({state:n,range:R,match:S,commands:l,chain:c,can:u,pasteEvent:i,dropEvent:a});d.push(j)})}),d.every(h=>h!==null)}var Dt=null,_a=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function Ia(t){const{editor:e,rules:n}=t;let s=null,r=!1,o=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:p,rule:h,pasteEvt:f})=>{const m=u.tr,y=ee({state:u,transaction:m});if(!(!La({editor:e,state:y,from:Math.max(d-1,0),to:p.b-1,rule:h,pasteEvent:f,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(u=>new O({view(d){const p=f=>{var m;s=(m=d.dom.parentElement)!=null&&m.contains(f.target)?d.dom.parentElement:null,s&&(Dt=e)},h=()=>{Dt&&(Dt=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(d,p)=>{if(o=s===d.dom.parentElement,a=p,!o){const h=Dt;h!=null&&h.isEditable&&setTimeout(()=>{const f=h.state.selection;f&&h.commands.deleteRange({from:f.from,to:f.to})},10)}return!1},paste:(d,p)=>{var h;const f=(h=p.clipboardData)==null?void 0:h.getData("text/html");return i=p,r=!!(f!=null&&f.includes("data-pm-slice")),!1}}},appendTransaction:(d,p,h)=>{const f=d[0],m=f.getMeta("uiEvent")==="paste"&&!r,y=f.getMeta("uiEvent")==="drop"&&!o,g=f.getMeta("applyPasteRules"),v=!!g;if(!m&&!y&&!v)return;if(v){let{text:M}=g;typeof M=="string"?M=M:M=oe(W.from(M),h.schema);const{from:T}=g,x=T+M.length,C=_a(M);return l({rule:u,state:h,from:T,to:{b:x},pasteEvt:C})}const b=p.doc.content.findDiffStart(h.doc.content),k=p.doc.content.findDiffEnd(h.doc.content);if(!(!Aa(b)||!k||b===k.b))return l({rule:u,state:h,from:b,to:k,pasteEvt:i})}}))}var ae=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=Ve(t),this.schema=Ms(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Mt(e.name,this.schema)},s=w(e,"addCommands",n);return s?{...t,...s()}:t},{})}get plugins(){const{editor:t}=this;return St([...this.extensions].reverse()).flatMap(s=>{const r={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:t,type:Mt(s.name,this.schema)},o=[],i=w(s,"addKeyboardShortcuts",r);let a={};if(s.type==="mark"&&w(s,"exitable",r)&&(a.ArrowRight=()=>J.handleExit({editor:t,mark:s})),i){const p=Object.fromEntries(Object.entries(i()).map(([h,f])=>[h,()=>f({editor:t})]));a={...a,...p}}const l=Qr(a);o.push(l);const c=w(s,"addInputRules",r);if(wn(s,t.options.enableInputRules)&&c){const p=c();if(p&&p.length){const h=Ca({editor:t,rules:p}),f=Array.isArray(h)?h:[h];o.push(...f)}}const u=w(s,"addPasteRules",r);if(wn(s,t.options.enablePasteRules)&&u){const p=u();if(p&&p.length){const h=Ia({editor:t,rules:p});o.push(...h)}}const d=w(s,"addProseMirrorPlugins",r);if(d){const p=d();o.push(...p)}return o})}get attributes(){return ws(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=mt(this.extensions);return Object.fromEntries(e.filter(n=>!!w(n,"addNodeView")).map(n=>{const s=this.attributes.filter(l=>l.type===n.name),r={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:B(n.name,this.schema)},o=w(n,"addNodeView",r);if(!o)return[];const i=o();if(!i)return[];const a=(l,c,u,d,p)=>{const h=_t(l,s);return i({node:l,view:c,getPos:u,decorations:d,innerDecorations:p,editor:t,extension:n,HTMLAttributes:h})};return[n.name,a]}))}dispatchTransaction(t){const{editor:e}=this;return St([...this.extensions].reverse()).reduceRight((s,r)=>{const o={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:e,type:Mt(r.name,this.schema)},i=w(r,"dispatchTransaction",o);return i?a=>{i.call(o,{transaction:a,next:s})}:s},t)}transformPastedHTML(t){const{editor:e}=this;return St([...this.extensions]).reduce((s,r)=>{const o={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:e,type:Mt(r.name,this.schema)},i=w(r,"transformPastedHTML",o);return i?(a,l)=>{const c=s(a,l);return i.call(o,c)}:s},t||(s=>s))}get markViews(){const{editor:t}=this,{markExtensions:e}=mt(this.extensions);return Object.fromEntries(e.filter(n=>!!w(n,"addMarkView")).map(n=>{const s=this.attributes.filter(a=>a.type===n.name),r={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:nt(n.name,this.schema)},o=w(n,"addMarkView",r);if(!o)return[];const i=(a,l,c)=>{const u=_t(a,s);return o()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:d=>{Fa(a,t,d)}})};return[n.name,i]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const s={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Mt(e.name,this.schema)};e.type==="mark"&&((n=I(w(e,"keepOnSplit",s)))==null||n)&&this.splittableMarks.push(e.name);const r=w(e,"onBeforeCreate",s),o=w(e,"onCreate",s),i=w(e,"onUpdate",s),a=w(e,"onSelectionUpdate",s),l=w(e,"onTransaction",s),c=w(e,"onFocus",s),u=w(e,"onBlur",s),d=w(e,"onDestroy",s);r&&this.editor.on("beforeCreate",r),o&&this.editor.on("create",o),i&&this.editor.on("update",i),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};ae.resolve=Ve;ae.sort=St;ae.flatten=re;var Oa={};Re(Oa,{ClipboardTextSerializer:()=>Ns,Commands:()=>Rs,Delete:()=>Ds,Drop:()=>zs,Editable:()=>Bs,FocusEvents:()=>js,Keymap:()=>Vs,Paste:()=>Fs,Tabindex:()=>Ws,TextDirection:()=>qs,focusEventsPluginKey:()=>Us});var _=class Hs extends Je{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new Hs(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},Ns=_.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new O({key:new $("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:s,selection:r}=e,{ranges:o}=r,i=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),l=Fe(n);return Ts(s,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Rs=_.create({name:"commands",addCommands(){return{...K}}}),Ds=_.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,s,r;const o=()=>{var i,a,l,c;if((c=(l=(a=(i=this.editor.options.coreExtensionOptions)==null?void 0:i.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=Ue(t.before,[t,...e]);We(u).forEach(h=>{u.mapping.mapResult(h.oldRange.from).deletedAfter&&u.mapping.mapResult(h.oldRange.to).deletedBefore&&u.before.nodesBetween(h.oldRange.from,h.oldRange.to,(f,m)=>{const y=m+f.nodeSize-2,g=h.oldRange.from<=m&&y<=h.oldRange.to;this.editor.emit("delete",{type:"node",node:f,from:m,to:y,newFrom:u.mapping.map(m),newTo:u.mapping.map(y),deletedRange:h.oldRange,newRange:h.newRange,partial:!g,editor:this.editor,transaction:t,combinedTransform:u})})});const p=u.mapping;u.steps.forEach((h,f)=>{var m,y;if(h instanceof Gr){const g=p.slice(f).map(h.from,-1),v=p.slice(f).map(h.to),b=p.invert().map(g,-1),k=p.invert().map(v),M=(m=u.doc.nodeAt(g-1))==null?void 0:m.marks.some(x=>x.eq(h.mark)),T=(y=u.doc.nodeAt(v))==null?void 0:y.marks.some(x=>x.eq(h.mark));this.editor.emit("delete",{type:"mark",mark:h.mark,from:h.from,to:h.to,deletedRange:{from:b,to:k},newRange:{from:g,to:v},partial:!!(T||M),editor:this.editor,transaction:t,combinedTransform:u})}})};(r=(s=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:s.async)==null||r?setTimeout(o,0):o()}}),zs=_.create({name:"drop",addProseMirrorPlugins(){return[new O({key:new $("tiptapDrop"),props:{handleDrop:(t,e,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:s})}}})]}}),Bs=_.create({name:"editable",addProseMirrorPlugins(){return[new O({key:new $("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Us=new $("focusEvents"),js=_.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new O({key:Us,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const s=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,n)=>{t.isFocused=!1;const s=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),Vs=_.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:p,parent:h}=d,f=d.parent.isTextblock&&p>0?a.doc.resolve(p-1):d,m=f.parent.type.spec.isolating,y=d.pos-d.parentOffset,g=m&&f.parent.childCount===1?y===d.pos:X.atStart(c).from===p;return!u||!h.type.isTextblock||h.textContent.length||!g||g&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...s},o={...s,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Et()||gs()?o:r},addProseMirrorPlugins(){return[new O({key:new $("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;const s=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),r=t.some(m=>m.getMeta("preventClearDocument"));if(!s||r)return;const{empty:o,from:i,to:a}=e.selection,l=X.atStart(e.doc).from,c=X.atEnd(e.doc).to;if(o||!(i===l&&a===c)||!ie(n.doc))return;const p=n.tr,h=ee({state:n,transaction:p}),{commands:f}=new ne({editor:this.editor,state:h});if(f.clearNodes(),!!p.steps.length)return p}})]}}),Fs=_.create({name:"paste",addProseMirrorPlugins(){return[new O({key:new $("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Ws=_.create({name:"tabindex",addProseMirrorPlugins(){return[new O({key:new $("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),qs=_.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=mt(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new O({key:new $("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),$a=class Tt{constructor(e,n,s=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=n,this.currentNode=r}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:n,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Tt(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Tt(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Tt(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,s)=>{const r=n.isBlock&&!n.isTextblock,o=n.isAtom&&!n.isText,i=n.isInline,a=this.pos+s+(o?0:1);if(a<0||a>this.resolvedPos.doc.nodeSize-2)return;const l=this.resolvedPos.doc.resolve(a);if(!r&&!i&&l.depth<=this.depth)return;const c=new Tt(l,this.editor,r,r||i?n:null);r&&(c.actualDepth=this.depth+1),e.push(c)}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let s=null,r=this.parent;for(;r&&!s;){if(r.node.type.name===e)if(Object.keys(n).length>0){const o=r.node.attrs,i=Object.keys(n);for(let a=0;a<i.length;a+=1){const l=i[a];if(o[l]!==n[l])break}}else s=r;r=r.parent}return s}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},s=!1){let r=[];if(!this.children||this.children.length===0)return r;const o=Object.keys(n);return this.children.forEach(i=>{s&&r.length>0||(i.node.type.name===e&&o.every(l=>n[l]===i.node.attrs[l])&&r.push(i),!(s&&r.length>0)&&(r=r.concat(i.querySelectorAll(e,n,s))))}),r}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},Pa=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function Ha(t,e,n){const s=document.querySelector("style[data-tiptap-style]");if(s!==null)return s;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}var Na=class extends xa{constructor(e={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:r})=>{throw r},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:_s,createMappablePosition:ea},this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:r,slice:o,moved:i})=>this.options.onDrop(r,o,i)),this.on("paste",({event:r,slice:o})=>this.options.onPaste(r,o)),this.on("delete",this.options.onDelete);const n=this.createDoc(),s=fs(n,this.options.autofocus);this.editorState=Kr.create({doc:n,schema:this.schema,selection:s||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;e!=null&&e.editor&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=Ha(Pa,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,n)=>{if(this.editorView)return this.editorView[n];if(n==="state")return this.editorState;if(n in e)return Reflect.get(e,n);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${n}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,n){const s=ks(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],r=this.state.reconfigure({plugins:s});return this.view.updateState(r),r}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let s=n;if([].concat(e).forEach(o=>{const i=typeof o=="string"?`${o}$`:o.key;s=s.filter(a=>!a.key.startsWith(i))}),n.length===s.length)return;const r=this.state.reconfigure({plugins:s});return this.view.updateState(r),r}createExtensionManager(){var e,n;const r=[...this.options.enableCoreExtensions?[Bs,Ns.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)==null?void 0:e.clipboardTextSerializer)==null?void 0:n.blockSeparator}),Rs,js,Vs,Ws,zs,Fs,Ds,qs.configure({direction:this.options.textDirection})].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o==null?void 0:o.type));this.extensionManager=new ae(r,this)}createCommandManager(){this.commandManager=new ne({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=ke(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(n){if(!(n instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(n.message))throw n;this.emit("contentError",{editor:this,error:n,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(s=>s.name!=="collaboration"),this.createExtensionManager()}}),e=ke(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){const{editorProps:n,enableExtensionDispatchTransaction:s}=this.options,r=n.dispatchTransaction||this.dispatchTransaction.bind(this),o=s?this.extensionManager.dispatchTransaction(r):r,i=n.transformPastedHTML,a=this.extensionManager.transformPastedHTML(i);this.editorView=new Jr(e,{...n,attributes:{role:"textbox",...n==null?void 0:n.attributes},dispatchTransaction:o,transformPastedHTML:a,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const l=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(l),this.prependClass(),this.injectCSS();const c=this.view.dom;c.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:n,transactions:s}=this.state.applyTransaction(e),r=!this.state.selection.eq(n.selection),o=s.includes(e),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),!o)return;this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:s.slice(1)}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=s.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=a==null?void 0:a.getMeta("focus"),c=a==null?void 0:a.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:a}),c&&this.emit("blur",{editor:this,event:c.event,transaction:a}),!(e.getMeta("preventUpdate")||!s.some(u=>u.docChanged)||i.doc.eq(n.doc))&&this.emit("update",{editor:this,transaction:e,appendedTransactions:s.slice(1)})}getAttributes(e){return Ss(this.state,e)}isActive(e,n){const s=typeof e=="string"?e:null,r=typeof e=="string"?n:e;return As(this.state,s,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return oe(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:s={}}=e||{};return Cs(this.state.doc,{blockSeparator:n,textSerializers:{...Fe(this.schema),...s}})}get isEmpty(){return ie(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,n;return(n=(e=this.editorView)==null?void 0:e.isDestroyed)!=null?n:!0}$node(e,n){var s;return((s=this.$doc)==null?void 0:s.querySelector(e,n))||null}$nodes(e,n){var s;return((s=this.$doc)==null?void 0:s.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new $a(n,this)}get $doc(){return this.$pos(0)}};function dt(t){return new pt({find:t.find,handler:({state:e,range:n,match:s})=>{const r=I(t.getAttributes,void 0,s);if(r===!1||r===null)return null;const{tr:o}=e,i=s[s.length-1],a=s[0];if(i){const l=a.search(/\S/),c=n.from+a.indexOf(i),u=c+i.length;if(qe(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===t.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;u<n.to&&o.delete(u,n.to),c>n.from&&o.delete(n.from+l,c);const p=n.from+l+i.length;o.addMark(n.from+l,p,t.type.create(r||{})),o.removeStoredMark(t.type)}},undoable:t.undoable})}function Ks(t){return new pt({find:t.find,handler:({state:e,range:n,match:s})=>{const r=I(t.getAttributes,void 0,s)||{},{tr:o}=e,i=n.from;let a=n.to;const l=t.type.create(r);if(s[1]){const c=s[0].lastIndexOf(s[1]);let u=i+c;u>a?u=a:a=u+s[1].length;const d=s[0][s[0].length-1];o.insertText(d,i+s[0].length-1),o.replaceWith(u,a,l)}else if(s[0]){const c=t.type.isInline?i:i-1;o.insert(c,t.type.create(r)).delete(o.mapping.map(i),o.mapping.map(a))}o.scrollIntoView()},undoable:t.undoable})}function Me(t){return new pt({find:t.find,handler:({state:e,range:n,match:s})=>{const r=e.doc.resolve(n.from),o=I(t.getAttributes,void 0,s)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)},undoable:t.undoable})}function D(t){return new pt({find:t.find,handler:({state:e,range:n,match:s})=>{let r=t.replace,o=n.from;const i=n.to;if(s[1]){const a=s[0].lastIndexOf(s[1]);r+=s[0].slice(a+s[1].length),o+=a;const l=o-i;l>0&&(r=s[0].slice(a-l,a)+r,o=i)}e.tr.insertText(r,o,i)},undoable:t.undoable})}function gt(t){return new pt({find:t.find,handler:({state:e,range:n,match:s,chain:r})=>{const o=I(t.getAttributes,void 0,s)||{},i=e.tr.delete(n.from,n.to),l=i.doc.resolve(n.from).blockRange(),c=l&&Fr(l,t.type,o);if(!c)return null;if(i.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:p}=e,{splittableMarks:h}=t.editor.extensionManager,f=p||d.$to.parentOffset&&d.$from.marks();if(f){const m=f.filter(y=>h.includes(y.type.name));i.ensureMarks(m)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(d,o).run()}const u=i.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Pe(i.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(s,u))&&i.join(n.from-1)},undoable:t.undoable})}var Ra=t=>"touches"in t,Da=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleTouchMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.touches[0];if(!l)return;const c=l.clientX-this.startX,u=l.clientY-this.startY;this.handleResize(c,u)},this.handleMouseUp=()=>{if(!this.isResizing)return;const a=this.element.offsetWidth,l=this.element.offsetHeight;this.onCommit(a,l),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,s,r,o,i;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(s=t==null?void 0:t.options)!=null&&s.directions&&(this.directions=t.options.directions),(r=t.options)!=null&&r.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(o=t.options)!=null&&o.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(i=t.options)!=null&&i.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){var t;return(t=this.contentElement)!=null?t:null}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),s=e.includes("bottom"),r=e.includes("left"),o=e.includes("right");n&&(t.style.top="0"),s&&(t.style.bottom="0"),r&&(t.style.left="0"),o&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let e;this.createCustomHandle?e=this.createCustomHandle(t):e=this.createHandle(t),e instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),e=this.createHandle(t)),this.createCustomHandle||this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.handleMap.set(t,e),this.wrapper.appendChild(e)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,Ra(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:s,height:r}=this.calculateNewDimensions(this.activeHandle,t,e),o=this.applyConstraints(s,r,n);this.element.style.width=`${o.width}px`,this.element.style.height=`${o.height}px`,this.onResize&&this.onResize(o.width,o.height)}calculateNewDimensions(t,e,n){let s=this.startWidth,r=this.startHeight;const o=t.includes("right"),i=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return o?s=this.startWidth+e:i&&(s=this.startWidth-e),a?r=this.startHeight+n:l&&(r=this.startHeight-n),(t==="right"||t==="left")&&(s=this.startWidth+(o?e:-e)),(t==="top"||t==="bottom")&&(r=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(s,r,t):{width:s,height:r}}applyConstraints(t,e,n){var s,r,o,i;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(s=this.maxSize)!=null&&s.width&&(c=Math.min(this.maxSize.width,c)),(r=this.maxSize)!=null&&r.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(o=this.maxSize)!=null&&o.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(i=this.maxSize)!=null&&i.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const s=n==="left"||n==="right",r=n==="top"||n==="bottom";return s?{width:t,height:t/this.aspectRatio}:r?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function za(t,e){const{selection:n}=t,{$from:s}=n;if(n instanceof et){const o=s.index();return s.parent.canReplaceWith(o,o+1,e)}let r=s.depth;for(;r>=0;){const o=s.index(r);if(s.node(r).contentMatchAt(o).matchType(e))return!0;r-=1}return!1}function Ba(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var Ua={};Re(Ua,{createAtomBlockMarkdownSpec:()=>Js,createBlockMarkdownSpec:()=>le,createInlineMarkdownSpec:()=>Qs,parseAttributes:()=>Qe,parseIndentedBlocks:()=>xe,renderNestedMarkdownContent:()=>Ye,serializeAttributes:()=>Ge});function Qe(t){if(!(t!=null&&t.trim()))return{};const e={},n=[],s=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),r=s.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(r){const c=r.map(u=>u.trim().slice(1));e.class=c.join(" ")}const o=s.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);o&&(e.id=o[1]);const i=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(s.matchAll(i)).forEach(([,c,u])=>{var d;const p=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),h=n[p];h&&(e[c]=h.slice(1,-1))});const l=s.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function Ge(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(s=>e.push(`.${s}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,s])=>{n==="class"||n==="id"||(s===!0?e.push(n):s!==!1&&s!=null&&e.push(`${n}="${String(s)}"`))}),e.join(" ")}function Js(t){const{nodeName:e,name:n,parseAttributes:s=Qe,serializeAttributes:r=Ge,defaultAttributes:o={},requiredAttributes:i=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const d={};return a.forEach(p=>{p in u&&(d[p]=u[p])}),d};return{parseMarkdown:(u,d)=>{const p={...o,...u.attributes};return d.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),h=(d=u.match(p))==null?void 0:d.index;return h!==void 0?h:-1},tokenize(u,d,p){const h=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),f=u.match(h);if(!f)return;const m=f[1]||"",y=s(m);if(!i.find(v=>!(v in y)))return{type:e,raw:f[0],attributes:y}}},renderMarkdown:u=>{const d=c(u.attrs||{}),p=r(d),h=p?` {${p}}`:"";return`:::${l}${h} :::`}}}function le(t){const{nodeName:e,name:n,getContent:s,parseAttributes:r=Qe,serializeAttributes:o=Ge,defaultAttributes:i={},content:a="block",allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const p={};return l.forEach(h=>{h in d&&(p[h]=d[h])}),p};return{parseMarkdown:(d,p)=>{let h;if(s){const m=s(d);h=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?h=p.parseChildren(d.tokens||[]):h=p.parseInline(d.tokens||[]);const f={...i,...d.attributes};return p.createNode(e,f,h)},markdownTokenizer:{name:e,level:"block",start(d){var p;const h=new RegExp(`^:::${c}`,"m"),f=(p=d.match(h))==null?void 0:p.index;return f!==void 0?f:-1},tokenize(d,p,h){var f;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),y=d.match(m);if(!y)return;const[g,v=""]=y,b=r(v);let k=1;const M=g.length;let T="";const x=/^:::([\w-]*)(\s.*)?/gm,C=d.slice(M);for(x.lastIndex=0;;){const S=x.exec(C);if(S===null)break;const P=S.index,E=S[1];if(!((f=S[2])!=null&&f.endsWith(":::"))){if(E)k+=1;else if(k-=1,k===0){const R=C.slice(0,P);T=R.trim();const j=d.slice(0,M+P+S[0].length);let U=[];if(T)if(a==="block")for(U=h.blockTokens(R),U.forEach(V=>{V.text&&(!V.tokens||V.tokens.length===0)&&(V.tokens=h.inlineTokens(V.text))});U.length>0;){const V=U[U.length-1];if(V.type==="paragraph"&&(!V.text||V.text.trim()===""))U.pop();else break}else U=h.inlineTokens(T);return{type:e,raw:j,attributes:b,content:T,tokens:U}}}}}},renderMarkdown:(d,p)=>{const h=u(d.attrs||{}),f=o(h),m=f?` {${f}}`:"",y=p.renderChildren(d.content||[],`

`);return`:::${c}${m}

${y}

:::`}}}function ja(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let s=n.exec(t);for(;s!==null;){const[,r,o,i]=s;e[r]=o||i,s=n.exec(t)}return e}function Va(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function Qs(t){const{nodeName:e,name:n,getContent:s,parseAttributes:r=ja,serializeAttributes:o=Va,defaultAttributes:i={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=p=>{if(!l)return p;const h={};return l.forEach(f=>{const m=typeof f=="string"?f:f.name,y=typeof f=="string"?void 0:f.skipIfDefault;if(m in p){const g=p[m];if(y!==void 0&&g===y)return;h[m]=g}}),h},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,h)=>{const f={...i,...p.attributes};if(a)return h.createNode(e,f);const m=s?s(p):p.content||"";return m?h.createNode(e,f,[h.createTextNode(m)]):h.createNode(e,f,[])},markdownTokenizer:{name:e,level:"inline",start(p){const h=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),f=p.match(h),m=f==null?void 0:f.index;return m!==void 0?m:-1},tokenize(p,h,f){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),y=p.match(m);if(!y)return;let g="",v="";if(a){const[,k]=y;v=k}else{const[,k,M]=y;v=k,g=M||""}const b=r(v.trim());return{type:e,raw:y[0],content:g.trim(),attributes:b}}},renderMarkdown:p=>{let h="";s?h=s(p):p.content&&p.content.length>0&&(h=p.content.filter(g=>g.type==="text").map(g=>g.text).join(""));const f=u(p.attrs||{}),m=o(f),y=m?` ${m}`:"";return a?`[${c}${y}]`:`[${c}${y}]${h}[/${c}]`}}}function xe(t,e,n){var s,r,o,i;const a=t.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const p=a[u],h=p.match(e.itemPattern);if(!h){if(l.length>0)break;if(p.trim()===""){u+=1,c=`${c}${p}
`;continue}else return}const f=e.extractItemData(h),{indentLevel:m,mainContent:y}=f;c=`${c}${p}
`;const g=[y];for(u+=1;u<a.length;){const M=a[u];if(M.trim()===""){const x=a.slice(u+1).findIndex(P=>P.trim()!=="");if(x===-1)break;if((((r=(s=a[u+1+x].match(/^(\s*)/))==null?void 0:s[1])==null?void 0:r.length)||0)>m){g.push(M),c=`${c}${M}
`,u+=1;continue}else break}if((((i=(o=M.match(/^(\s*)/))==null?void 0:o[1])==null?void 0:i.length)||0)>m)g.push(M),c=`${c}${M}
`,u+=1;else break}let v;const b=g.slice(1);if(b.length>0){const M=b.map(T=>T.slice(m+d)).join(`
`);M.trim()&&(e.customNestedParser?v=e.customNestedParser(M):v=n.blockTokens(M))}const k=e.createToken(f,v);l.push(k)}if(l.length!==0)return{items:l,raw:c}}function Ye(t,e,n,s){if(!t||!Array.isArray(t.content))return"";const r=typeof n=="function"?n(s):n,[o,...i]=t.content,a=e.renderChildren([o]),l=[`${r}${a}`];return i&&i.length>0&&i.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(d)}}),l.join(`
`)}function Fa(t,e,n={}){const{state:s}=e,{doc:r,tr:o}=s,i=t;r.descendants((a,l)=>{const c=o.mapping.map(l),u=o.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(h=>{if(h!==i)return!1;d=h}),!d)return;let p=!1;if(Object.keys(n).forEach(h=>{n[h]!==d.attrs[h]&&(p=!0)}),p){const h=t.type.create({...t.attrs,...n});o.removeMark(c,u,t.type),o.addMark(c,u,h)}}),o.docChanged&&e.view.dispatch(o)}var N=class Gs extends Je{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new Gs(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},Wa=class{constructor(t,e,n){this.isDragging=!1,this.component=t,this.editor=e.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=e.extension,this.node=e.node,this.decorations=e.decorations,this.innerDecorations=e.innerDecorations,this.view=e.view,this.HTMLAttributes=e.HTMLAttributes,this.getPos=e.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(t){var e,n,s,r,o,i,a;const{view:l}=this.editor,c=t.target,u=c.nodeType===3?(e=c.parentElement)==null?void 0:e.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(n=this.contentDOM)!=null&&n.contains(c)||!u)return;let d=0,p=0;if(this.dom!==u){const v=this.dom.getBoundingClientRect(),b=u.getBoundingClientRect(),k=(r=t.offsetX)!=null?r:(s=t.nativeEvent)==null?void 0:s.offsetX,M=(i=t.offsetY)!=null?i:(o=t.nativeEvent)==null?void 0:o.offsetY;d=b.x-v.x+k,p=b.y-v.y+M}const h=this.dom.cloneNode(!0);try{const v=this.dom.getBoundingClientRect();h.style.width=`${Math.round(v.width)}px`,h.style.height=`${Math.round(v.height)}px`,h.style.boxSizing="border-box",h.style.pointerEvents="none"}catch{}let f=null;try{f=document.createElement("div"),f.style.position="absolute",f.style.top="-9999px",f.style.left="-9999px",f.style.pointerEvents="none",f.appendChild(h),document.body.appendChild(f),(a=t.dataTransfer)==null||a.setDragImage(h,d,p)}finally{f&&setTimeout(()=>{try{f==null||f.remove()}catch{}},0)}const m=this.getPos();if(typeof m!="number")return;const y=et.create(l.state.doc,m),g=l.state.tr.setSelection(y);l.dispatch(g)}stopEvent(t){var e;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:t});const n=t.target;if(!(this.dom.contains(n)&&!((e=this.contentDOM)!=null&&e.contains(n))))return!1;const r=t.type.startsWith("drag"),o=t.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!o&&!r)return!0;const{isEditable:a}=this.editor,{isDragging:l}=this,c=!!this.node.type.spec.draggable,u=et.isSelectable(this.node),d=t.type==="copy",p=t.type==="paste",h=t.type==="cut",f=t.type==="mousedown";if(!c&&u&&r&&t.target===this.dom&&t.preventDefault(),c&&r&&!l&&t.target===this.dom)return t.preventDefault(),!1;if(c&&a&&!l&&f){const m=n.closest("[data-drag-handle]");m&&(this.dom===m||this.dom.contains(m))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(l||o||d||p||h||f&&u)}ignoreMutation(t){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:t}):this.node.isLeaf||this.node.isAtom?!0:t.type==="selection"||this.dom.contains(t.target)&&t.type==="childList"&&(Et()||be())&&this.editor.isFocused&&[...Array.from(t.addedNodes),...Array.from(t.removedNodes)].every(n=>n.isContentEditable)?!1:this.contentDOM===t.target&&t.type==="attributes"?!0:!this.contentDOM.contains(t.target)}updateAttributes(t){this.editor.commands.command(({tr:e})=>{const n=this.getPos();return typeof n!="number"?!1:(e.setNodeMarkup(n,void 0,{...this.node.attrs,...t}),!0)})}deleteNode(){const t=this.getPos();if(typeof t!="number")return;const e=t+this.node.nodeSize;this.editor.commands.deleteRange({from:t,to:e})}};function ot(t){return new Ps({find:t.find,handler:({state:e,range:n,match:s,pasteEvent:r})=>{const o=I(t.getAttributes,void 0,s,r);if(o===!1||o===null)return null;const{tr:i}=e,a=s[s.length-1],l=s[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),p=d+a.length;if(qe(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(y=>y===t.type&&y!==f.mark.type)).filter(f=>f.to>d).length)return null;p<n.to&&i.delete(p,n.to),d>n.from&&i.delete(n.from+u,d),c=n.from+u+a.length,i.addMark(n.from+u,c,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}function qa(t){return new Ps({find:t.find,handler({match:e,chain:n,range:s,pasteEvent:r}){const o=I(t.getAttributes,void 0,e,r),i=I(t.getContent,void 0,o);if(o===!1||o===null)return null;const a={type:t.type.name,attrs:o};i&&(a.content=i),e.input&&n().deleteRange(s).insertContentAt(s.from,a)}})}function Tn(t){return Er((e,n)=>({get(){return e(),t},set(s){t=s,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}var Ka=class extends Na{constructor(t={}){return super(t),this.contentComponent=null,this.appContext=null,this.reactiveState=Tn(this.view.state),this.reactiveExtensionStorage=Tn(this.extensionStorage),this.on("beforeTransaction",({nextState:e})=>{this.reactiveState.value=e,this.reactiveExtensionStorage.value=this.extensionStorage}),Wn(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){const n=super.registerPlugin(t,e);return this.reactiveState&&(this.reactiveState.value=n),n}unregisterPlugin(t){const e=super.unregisterPlugin(t);return this.reactiveState&&e&&(this.reactiveState.value=e),e}},iu=yt({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=Zt(),n=Sr();return Tr(()=>{const s=t.editor;s&&s.options.element&&e.value&&qn(()=>{var r;if(!e.value||!((r=s.view.dom)!=null&&r.parentNode))return;const o=Cr(e.value);e.value.append(...s.view.dom.parentNode.childNodes),s.contentComponent=n.ctx._,n&&(s.appContext={...n.appContext,provides:n.provides}),s.setOptions({element:o}),s.createNodeViews()})}),te(()=>{const s=t.editor;s&&(s.contentComponent=null,s.appContext=null)}),{rootEl:e}},render(){return vt("div",{ref:t=>{this.rootEl=t}})}}),au=yt({name:"NodeViewContent",props:{as:{type:String,default:"div"}},render(){return vt(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}}),lu=yt({name:"NodeViewWrapper",props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return vt(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(t=this.$slots).default)==null?void 0:e.call(t))}}),cu=(t={})=>{const e=Ar();return Ie(()=>{e.value=new Ka(t)}),te(()=>{var n,s,r,o;const i=(s=(n=e.value)==null?void 0:n.view.dom)==null?void 0:s.parentNode,a=i==null?void 0:i.cloneNode(!0);(r=i==null?void 0:i.parentNode)==null||r.replaceChild(a,i),(o=e.value)==null||o.destroy()}),e},Ja=class{constructor(t,{props:e={},editor:n}){this.destroyed=!1,this.editor=n,this.component=Wn(t),this.el=document.createElement("div"),this.props=xr(e),this.renderedComponent=this.renderComponent()}get element(){return this.renderedComponent.el}get ref(){var t,e,n,s;return(e=(t=this.renderedComponent.vNode)==null?void 0:t.component)!=null&&e.exposed?this.renderedComponent.vNode.component.exposed:(s=(n=this.renderedComponent.vNode)==null?void 0:n.component)==null?void 0:s.proxy}renderComponent(){if(this.destroyed)return this.renderedComponent;let t=vt(this.component,this.props);return this.editor.appContext&&(t.appContext=this.editor.appContext),typeof document<"u"&&this.el&&sn(t,this.el),{vNode:t,destroy:()=>{this.el&&sn(null,this.el),this.el=null,t=null},el:this.el?this.el.firstElementChild:null}}updateProps(t={}){this.destroyed||(Object.entries(t).forEach(([e,n])=>{this.props[e]=n}),this.renderComponent())}destroy(){this.destroyed||(this.destroyed=!0,this.renderedComponent.destroy())}},du={editor:{type:Object,required:!0},node:{type:Object,required:!0},decorations:{type:Object,required:!0},selected:{type:Boolean,required:!0},extension:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0},deleteNode:{type:Function,required:!0},view:{type:Object,required:!0},innerDecorations:{type:Object,required:!0},HTMLAttributes:{type:Object,required:!0}},Qa=class extends Wa{constructor(){super(...arguments),this.cachedExtensionWithSyncedStorage=null}get extensionWithSyncedStorage(){if(!this.cachedExtensionWithSyncedStorage){const t=this.editor,e=this.extension;this.cachedExtensionWithSyncedStorage=new Proxy(e,{get(n,s,r){var o;return s==="storage"?(o=t.storage[e.name])!=null?o:{}:Reflect.get(n,s,r)}})}return this.cachedExtensionWithSyncedStorage}mount(){const t={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extensionWithSyncedStorage,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(s={})=>this.updateAttributes(s),deleteNode:()=>this.deleteNode()},e=this.onDragStart.bind(this);this.decorationClasses=Zt(this.getDecorationClasses());const n=yt({extends:{...this.component},props:Object.keys(t),template:this.component.template,setup:s=>{var r,o;return rn("onDragStart",e),rn("decorationClasses",this.decorationClasses),(o=(r=this.component).setup)==null?void 0:o.call(r,s,{expose:()=>{}})},__scopeId:this.component.__scopeId,__cssModules:this.component.__cssModules,__name:this.component.__name,__file:this.component.__file});this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new Ja(n,{editor:this.editor,props:t})}get dom(){if(!this.renderer.element||!this.renderer.element.hasAttribute("data-node-view-wrapper"))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.dom.querySelector("[data-node-view-content]")}handleSelectionUpdate(){const{from:t,to:e}=this.editor.state.selection,n=this.getPos();if(typeof n=="number")if(t<=n&&e>=n+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(t,e,n){const s=r=>{this.decorationClasses.value=this.getDecorationClasses(),this.renderer.updateProps(r)};if(typeof this.options.update=="function"){const r=this.node,o=this.decorations,i=this.innerDecorations;return this.node=t,this.decorations=e,this.innerDecorations=n,this.options.update({oldNode:r,oldDecorations:o,newNode:t,newDecorations:e,oldInnerDecorations:i,innerDecorations:n,updateProps:()=>s({node:t,decorations:e,innerDecorations:n,extension:this.extensionWithSyncedStorage})})}return t.type!==this.node.type?!1:(t===this.node&&this.decorations===e&&this.innerDecorations===n||(this.node=t,this.decorations=e,this.innerDecorations=n,s({node:t,decorations:e,innerDecorations:n,extension:this.extensionWithSyncedStorage})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element&&this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element&&this.renderer.element.classList.remove("ProseMirror-selectednode")}getDecorationClasses(){return this.decorations.flatMap(t=>t.type.attrs.class).join(" ")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate)}};function uu(t,e){return n=>{if(!n.editor.contentComponent)return{};const s=typeof t=="function"&&"__vccOpts"in t?t.__vccOpts:t;return new Qa(s,n,e)}}var Qt=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...s}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,s,n]},Ga=/^\s*>\s$/,Ya=N.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Qt("blockquote",{...A(this.options.HTMLAttributes,t),children:Qt("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",s=[];return t.content.forEach(r=>{const a=e.renderChildren([r]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);s.push(a.join(`
`))}),s.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[gt({find:Ga,type:this.type})]}}),Xa=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Za=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,tl=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,el=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,nl=J.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Qt("strong",{...A(this.options.HTMLAttributes,t),children:Qt("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[dt({find:Xa,type:this.type}),dt({find:tl,type:this.type})]},addPasteRules(){return[ot({find:Za,type:this.type}),ot({find:el,type:this.type})]}}),sl=/(^|[^`])`([^`]+)`(?!`)$/,rl=/(^|[^`])`([^`]+)`(?!`)/g,ol=J.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",A(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[dt({find:sl,type:this.type})]},addPasteRules(){return[ot({find:rl,type:this.type})]}}),me=4,il=/^```([a-z]+)?[\s\n]$/,al=/^~~~([a-z]+)?[\s\n]$/,Ys=N.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:me,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const o=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(i=>i.startsWith(n)).map(i=>i.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",A(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let s="";const r=((n=t.attrs)==null?void 0:n.language)||"";return t.content?s=[`\`\`\`${r}`,e.renderChildren(t.content),"```"].join(`
`):s=`\`\`\`${r}

\`\`\``,s},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:me,{state:s}=t,{selection:r}=s,{$from:o,empty:i}=r;if(o.parent.type!==this.type)return!1;const a=" ".repeat(n);return i?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=r,h=s.doc.textBetween(c,u,`
`,`
`).split(`
`).map(f=>a+f).join(`
`);return l.replaceWith(c,u,s.schema.text(h)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:me,{state:s}=t,{selection:r}=s,{$from:o,empty:i}=r;return o.parent.type!==this.type?!1:i?t.commands.command(({tr:a})=>{var l;const{pos:c}=o,u=o.start(),d=o.end(),h=s.doc.textBetween(u,d,`
`,`
`).split(`
`);let f=0,m=0;const y=c-u;for(let T=0;T<h.length;T+=1){if(m+h[T].length>=y){f=T;break}m+=h[T].length+1}const v=((l=h[f].match(/^ */))==null?void 0:l[0])||"",b=Math.min(v.length,n);if(b===0)return!0;let k=u;for(let T=0;T<f;T+=1)k+=h[T].length+1;return a.delete(k,k+b),c-k<=b&&a.setSelection(z.create(a.doc,k)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=r,p=s.doc.textBetween(l,c,`
`,`
`).split(`
`).map(h=>{var f;const m=((f=h.match(/^ */))==null?void 0:f[0])||"",y=Math.min(m.length,n);return h.slice(y)}).join(`
`);return a.replaceWith(l,c,s.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const o=s.parentOffset===s.parent.nodeSize-2,i=s.parent.textContent.endsWith(`

`);return!o||!i?!1:t.chain().command(({tr:a})=>(a.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:s}=e,{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const a=r.after();return a===void 0?!1:s.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(X.near(s.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[Me({find:il,type:this.type,getAttributes:t=>({language:t[1]})}),Me({find:al,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new O({key:new $("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,o=r==null?void 0:r.mode;if(!n||!o)return!1;const{tr:i,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return i.replaceSelectionWith(this.type.create({language:o},l)),i.selection.$from.parent.type!==this.type&&i.setSelection(z.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.setMeta("paste",!0),t.dispatch(i),!0}}})]}}),Xs=N.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),pu=Xs,ll=N.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",A(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:s})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:r,storedMarks:o}=n;if(r.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=s.extensionManager,l=o||r.$to.parentOffset&&r.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&i){const d=l.filter(p=>a.includes(p.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),cl=N.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,A(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const s=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,r="#".repeat(s);return t.content?`${r} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Me({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),Zs=N.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",A(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!za(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:s}=n,r=t();return Es(n)?r.insertContentAt(s.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({state:o,tr:i,dispatch:a})=>{if(a){const{$to:l}=i.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?i.setSelection(z.create(i.doc,l.pos+1)):l.nodeAfter.isBlock?i.setSelection(et.create(i.doc,l.pos)):i.setSelection(z.create(i.doc,l.pos));else{const u=o.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u==null?void 0:u.create();d&&(i.insert(c,d),i.setSelection(z.create(i.doc,c+1)))}i.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Ks({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),hu=Zs,dl=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,ul=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,pl=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,hl=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,fl=J.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[dt({find:dl,type:this.type}),dt({find:pl,type:this.type})]},addPasteRules(){return[ot({find:ul,type:this.type}),ot({find:hl,type:this.type})]}}),Xe="[\0- Â áá â-\u2029âã]",ml=new RegExp(Xe),gl=new RegExp(`${Xe}$`),yl=new RegExp(Xe,"g");function vl(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function bl(t){return new O({key:new $("autolink"),appendTransaction:(e,n,s)=>{const r=e.some(c=>c.docChanged)&&!n.doc.eq(s.doc),o=e.some(c=>c.getMeta("preventAutolink"));if(!r||o)return;const{tr:i}=s,a=Ue(n.doc,[...e]);if(We(a).forEach(({newRange:c})=>{const u=vs(s.doc,c,h=>h.isTextblock);let d,p;if(u.length>1)d=u[0],p=s.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const h=s.doc.textBetween(c.from,c.to," "," ");if(!gl.test(h))return;d=u[0],p=s.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&p){const h=p.split(ml).filter(Boolean);if(h.length<=0)return!1;const f=h[h.length-1],m=d.pos+p.lastIndexOf(f);if(!f)return!1;const y=zo(f).map(g=>g.toObject(t.defaultProtocol));if(!vl(y))return!1;y.filter(g=>g.isLink).map(g=>({...g,from:m+g.start+1,to:m+g.end+1})).filter(g=>s.schema.marks.code?!s.doc.rangeHasMark(g.from,g.to,s.schema.marks.code):!0).filter(g=>t.validate(g.value)).filter(g=>t.shouldAutoLink(g.value)).forEach(g=>{qe(g.from,g.to,s.doc).some(v=>v.mark.type===t.type)||i.addMark(g.from,g.to,t.type.create({href:g.href}))})}}),!!i.steps.length)return i}})}function kl(t){return new O({key:new $("handleClickLink"),props:{handleClick:(e,n,s)=>{var r,o;if(s.button!==0||!e.editable)return!1;let i=null;if(s.target instanceof HTMLAnchorElement)i=s.target;else{const l=s.target;if(!l)return!1;const c=t.editor.view.dom;i=l.closest("a"),i&&!c.contains(i)&&(i=null)}if(!i)return!1;let a=!1;if(t.enableClickSelection&&(a=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=Ss(e.state,t.type.name),c=(r=i.href)!=null?r:l.href,u=(o=i.target)!=null?o:l.target;c&&(window.open(c,u),a=!0)}return a}}})}function wl(t){return new O({key:new $("handlePasteLink"),props:{handlePaste:(e,n,s)=>{const{shouldAutoLink:r}=t,{state:o}=e,{selection:i}=o,{empty:a}=i;if(a)return!1;let l="";s.content.forEach(u=>{l+=u.textContent});const c=is(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||r!==void 0&&!r(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function it(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{const r=typeof s=="string"?s:s.scheme;r&&n.push(r)}),!t||t.replace(yl,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var tr=J.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){pn(t);return}pn(t.scheme,t.optionalSlashes)})},onDestroy(){Bo()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!it(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;const r=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(r)||!/\./.test(r))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class},title:{default:null}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!it(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!it(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",A(this.options.HTMLAttributes,t),0]:["a",A(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n,s,r,o;const i=(s=(n=t.attrs)==null?void 0:n.href)!=null?s:"",a=(o=(r=t.attrs)==null?void 0:r.title)!=null?o:"",l=e.renderChildren(t);return a?`[${l}](${i} "${a}")`:`[${l}](${i})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:s=>!!it(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:s=>!!it(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ot({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:s}=this.options,r=is(t).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!it(i,n),protocols:n,defaultProtocol:s}));r.length&&r.forEach(o=>{this.options.shouldAutoLink(o.value)&&e.push({text:o.value,data:{href:o.href},index:o.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(bl({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:r=>!!it(r,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(kl({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(wl({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),fu=tr,Ml=Object.defineProperty,xl=(t,e)=>{for(var n in e)Ml(t,n,{get:e[n],enumerable:!0})},Tl="listItem",Cn="textStyle",Sn=/^\s*([-+*])\s$/,er=N.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",A(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Tl,this.editor.getAttributes(Cn)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=gt({find:Sn,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=gt({find:Sn,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Cn),editor:this.editor})),[t]}}),nr=N.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",A(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(r=>r.type==="paragraph"))n=e.parseChildren(t.tokens);else{const r=t.tokens[0];if(r&&r.type==="text"&&r.tokens&&r.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(r.tokens)}],t.tokens.length>1){const i=t.tokens.slice(1),a=e.parseChildren(i);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>Ye(t,e,s=>{var r,o;return s.parentType==="bulletList"?"- ":s.parentType==="orderedList"?`${(((o=(r=s.meta)==null?void 0:r.parentAttrs)==null?void 0:o.start)||1)+s.index}. `:"- "},n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Cl={};xl(Cl,{findListItemPos:()=>$t,getNextListDepth:()=>Ze,handleBackspace:()=>Te,handleDelete:()=>Ce,hasListBefore:()=>sr,hasListItemAfter:()=>Sl,hasListItemBefore:()=>rr,listItemHasSubList:()=>or,nextListIsDeeper:()=>ir,nextListIsHigher:()=>ar});var $t=(t,e)=>{const{$from:n}=e.selection,s=B(t,e.schema);let r=null,o=n.depth,i=n.pos,a=null;for(;o>0&&a===null;)r=n.node(o),r.type===s?a=o:(o-=1,i-=1);return a===null?null:{$pos:e.doc.resolve(i),depth:a}},Ze=(t,e)=>{const n=$t(t,e);if(!n)return!1;const[,s]=Yi(e,t,n.$pos.pos+4);return s},sr=(t,e,n)=>{const{$anchor:s}=t.selection,r=Math.max(0,s.pos-2),o=t.doc.resolve(r).node();return!(!o||!n.includes(o.type.name))},rr=(t,e)=>{var n;const{$anchor:s}=e.selection,r=e.doc.resolve(s.pos-2);return!(r.index()===0||((n=r.nodeBefore)==null?void 0:n.type.name)!==t)},or=(t,e,n)=>{if(!n)return!1;const s=B(t,e.schema);let r=!1;return n.descendants(o=>{o.type===s&&(r=!0)}),r},Te=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!rt(t.state,e)&&sr(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((p,h)=>{p.type.name===e&&c.push({node:p,pos:h})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!rt(t.state,e)||!ta(t.state))return!1;const s=$t(e,t.state);if(!s)return!1;const o=t.state.doc.resolve(s.$pos.pos-2).node(s.depth),i=or(e,t.state,o);return rr(e,t.state)&&!i?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},ir=(t,e)=>{const n=Ze(t,e),s=$t(t,e);return!s||!n?!1:n>s.depth},ar=(t,e)=>{const n=Ze(t,e),s=$t(t,e);return!s||!n?!1:n<s.depth},Ce=(t,e)=>{if(!rt(t.state,e)||!Zi(t.state,e))return!1;const{selection:n}=t.state,{$from:s,$to:r}=n;return!n.empty&&s.sameParent(r)?!1:ir(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():ar(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},Sl=(t,e)=>{var n;const{$anchor:s}=e.selection,r=e.doc.resolve(s.pos-s.parentOffset-2);return!(r.index()===r.parent.childCount-1||((n=r.nodeAfter)==null?void 0:n.type.name)!==t)},lr=_.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&Ce(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&Ce(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{t.state.schema.nodes[n]!==void 0&&Te(t,n,s)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{t.state.schema.nodes[n]!==void 0&&Te(t,n,s)&&(e=!0)}),e}}}}),An=/^(\s*)(\d+)\.\s+(.*)$/,Al=/^\s/;function El(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n],o=r.match(An);if(!o)break;const[,i,a,l]=o,c=i.length;let u=l,d=n+1;const p=[r];for(;d<t.length;){const h=t[d];if(h.match(An))break;if(h.trim()==="")p.push(h),u+=`
`,d+=1;else if(h.match(Al))p.push(h),u+=`
${h.slice(c+2)}`,d+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:p.join(`
`)}),s=d,n=d}return[e,s]}function cr(t,e,n){var s;const r=[];let o=0;for(;o<t.length;){const i=t[o];if(i.indent===e){const a=i.content.split(`
`),l=((s=a[0])==null?void 0:s.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const h=n.blockTokens(u);c.push(...h)}let d=o+1;const p=[];for(;d<t.length&&t[d].indent>e;)p.push(t[d]),d+=1;if(p.length>0){const h=Math.min(...p.map(m=>m.indent)),f=cr(p,h,n);c.push({type:"list",ordered:!0,start:p[0].number,items:f,raw:p.map(m=>m.raw).join(`
`)})}r.push({type:"list_item",raw:i.raw,tokens:c}),o=d}else o+=1}return r}function Ll(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const s=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(r=>{if(r.type==="paragraph"||r.type==="list"||r.type==="blockquote"||r.type==="code")s.push(...e.parseChildren([r]));else if(r.type==="text"&&r.tokens){const o=e.parseChildren([r]);s.push({type:"paragraph",content:o})}else{const o=e.parseChildren([r]);o.length>0&&s.push(...o)}}),{type:"listItem",content:s}})}var _l="listItem",En="textStyle",Ln=/^(\d+)\.\s$/,dr=N.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",A(this.options.HTMLAttributes,n),0]:["ol",A(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,s=t.items?Ll(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:s}:{type:"orderedList",content:s}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e==null?void 0:e.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var s;const r=t.split(`
`),[o,i]=El(r);if(o.length===0)return;const a=cr(o,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((s=o[0])==null?void 0:s.number)||1,items:a,raw:r.slice(0,i).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(_l,this.editor.getAttributes(En)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=gt({find:Ln,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=gt({find:Ln,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(En)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Il=/^\s*(\[([( |x])?\])\s$/,Ol=N.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",A(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const s=e.parseChildren(t.nestedTokens);n.push(...s)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const r=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return Ye(t,e,r)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:s})=>{const r=document.createElement("li"),o=document.createElement("label"),i=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=d=>{var p,h;a.ariaLabel=((h=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:h.call(p,d,a.checked))||`Task item checkbox for ${d.textContent||"empty task item"}`};c(t),o.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",d=>d.preventDefault()),a.addEventListener("change",d=>{if(!s.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:p}=d.target;s.isEditable&&typeof n=="function"&&s.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{const f=n();if(typeof f!="number")return!1;const m=h.doc.nodeAt(f);return h.setNodeMarkup(f,void 0,{...m==null?void 0:m.attrs,checked:p}),!0}).run(),!s.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([d,p])=>{r.setAttribute(d,p)}),r.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,o.append(a,i),r.append(o,l),Object.entries(e).forEach(([d,p])=>{r.setAttribute(d,p)});let u=new Set(Object.keys(e));return{dom:r,contentDOM:l,update:d=>{if(d.type!==this.type)return!1;r.dataset.checked=d.attrs.checked,a.checked=d.attrs.checked,c(d);const p=s.extensionManager.attributes,h=_t(d,p),f=new Set(Object.keys(h)),m=this.options.HTMLAttributes;return u.forEach(y=>{f.has(y)||(y in m?r.setAttribute(y,m[y]):r.removeAttribute(y))}),Object.entries(h).forEach(([y,g])=>{g==null?y in m?r.setAttribute(y,m[y]):r.removeAttribute(y):r.setAttribute(y,g)}),u=f,!0}}}},addInputRules(){return[gt({find:Il,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),$l=N.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",A(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const s=o=>{const i=xe(o,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:s},n);return i?[{type:"taskList",raw:i.raw,items:i.items}]:n.blockTokens(o)},r=xe(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:o=>({indentLevel:o[1].length,mainContent:o[4],checked:o[3].toLowerCase()==="x"}),createToken:(o,i)=>({type:"taskItem",raw:"",mainContent:o.mainContent,indentLevel:o.indentLevel,checked:o.checked,text:o.mainContent,tokens:n.inlineTokens(o.mainContent),nestedTokens:i}),customNestedParser:s},n);if(r)return{type:"taskList",raw:r.raw,items:r.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});_.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(er.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(nr.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(lr.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(dr.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(Ol.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push($l.configure(this.options.taskList)),t}});var _n="&nbsp;",Pl="Â ",Hl=N.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",A(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];if(n.length===1&&n[0].type==="image")return e.parseChildren([n[0]]);const s=e.parseInline(n);return s.length===1&&s[0].type==="text"&&(s[0].text===_n||s[0].text===Pl)?e.createNode("paragraph",void 0,[]):e.createNode("paragraph",void 0,s)},renderMarkdown:(t,e)=>{if(!t)return"";const n=Array.isArray(t.content)?t.content:[];return n.length===0?_n:e.renderChildren(n)},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Nl=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Rl=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Dl=J.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",A(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[dt({find:Nl,type:this.type})]},addPasteRules(){return[ot({find:Rl,type:this.type})]}}),zl=N.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),ur=J.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",A(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const r=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!r)return;const o=r[2].trim();return{type:"underline",raw:r[0],text:o,tokens:n.inlineTokens(o)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),mu=ur;_.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc;if(((t==null?void 0:t.mode)||this.options.mode)==="textSize"){const s=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(s)}return e.nodeSize},this.storage.words=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new O({key:new $("characterCount"),appendTransaction:(e,n,s)=>{if(t)return;const r=this.options.limit;if(r==null||r===0){t=!0;return}const o=this.storage.characters({node:s.doc});if(o>r){const i=o-r,a=0,l=i;console.warn(`[CharacterCount] Initial content exceeded limit of ${r} characters. Content was automatically trimmed.`);const c=s.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const s=this.options.limit;if(!e.docChanged||s===0||s===null||s===void 0)return!0;const r=this.storage.characters({node:n.doc}),o=this.storage.characters({node:e.doc});if(o<=s||r>s&&o>s&&o<=r)return!0;if(r>s&&o>s&&o>r||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=o-s,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>s)}})]}});var Bl=_.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Mo(this.options)]}}),gu=_.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new O({key:new $("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:s}=this.editor,{anchor:r}=e,o=[];if(!n||!s)return Z.create(t,[]);let i=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(r>=c&&r<=c+l.nodeSize-1))return!1;i+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(r>=c&&r<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&i-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";o.push(ct.node(c,c+l.nodeSize,{class:this.options.className}))}),Z.create(t,o)}}})]}}),Ul=_.create({name:"gapCursor",addProseMirrorPlugins(){return[xo()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=I(w(t,"allowGapCursor",n)))!=null?e:null}}}),In="placeholder";function jl(t){return t.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}_.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:In,placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){const t=this.options.dataAttribute?`data-${jl(this.options.dataAttribute)}`:`data-${In}`;return[new O({key:new $("placeholder"),props:{decorations:({doc:e,selection:n})=>{const s=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=n,o=[];if(!s)return null;const i=this.editor.isEmpty;return e.descendants((a,l)=>{const c=r>=l&&r<=l+a.nodeSize,u=!a.isLeaf&&ie(a);if((c||!this.options.showOnlyCurrent)&&u){const d=[this.options.emptyNodeClass];i&&d.push(this.options.emptyEditorClass);const p=ct.node(l,l+a.nodeSize,{class:d.join(" "),[t]:typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:l,hasAnchor:c}):this.options.placeholder});o.push(p)}return this.options.includeChildren}),Z.create(e,o)}}})]}});_.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new O({key:new $("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||Es(n.selection)||t.view.dragging?null:Z.create(n.doc,[ct.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function On({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||(e==null?void 0:e.type)===t}var Vl=_.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new $(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",s=Object.entries(this.editor.schema.nodes).map(([,r])=>r).filter(r=>(this.options.notAfter||[]).concat(n).includes(r.name));return[new O({key:e,appendTransaction:(r,o,i)=>{const{doc:a,tr:l,schema:c}=i,u=e.getState(i),d=a.content.size,p=c.nodes[n];if(u)return l.insert(d,p.create())},state:{init:(r,o)=>{const i=o.tr.doc.lastChild;return!On({node:i,types:s})},apply:(r,o)=>{if(!r.docChanged||r.getMeta("__uniqueIDTransaction"))return o;const i=r.doc.lastChild;return!On({node:i,types:s})}}})]}}),Fl=_.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>So(t,e),redo:()=>({state:t,dispatch:e})=>Co(t,e)}},addProseMirrorPlugins(){return[To(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),Wl=_.create({name:"starterKit",addExtensions(){var t,e,n,s;const r=[];return this.options.bold!==!1&&r.push(nl.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(Ya.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(er.configure(this.options.bulletList)),this.options.code!==!1&&r.push(ol.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(Ys.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(Xs.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(Bl.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(Ul.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push(ll.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push(cl.configure(this.options.heading)),this.options.undoRedo!==!1&&r.push(Fl.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&r.push(Zs.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(fl.configure(this.options.italic)),this.options.listItem!==!1&&r.push(nr.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(lr.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&r.push(tr.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&r.push(dr.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(Hl.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(Dl.configure(this.options.strike)),this.options.text!==!1&&r.push(zl.configure(this.options.text)),this.options.underline!==!1&&r.push(ur.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&r.push(Vl.configure((s=this.options)==null?void 0:s.trailingNode)),r}}),yu=Wl;function ql(t,e){const n=Math.min(t.top,e.top),s=Math.max(t.bottom,e.bottom),r=Math.min(t.left,e.left),i=Math.max(t.right,e.right)-r,a=s-n,l=r,c=n;return new DOMRect(l,c,i,a)}var Kl=class{constructor({editor:t,element:e,view:n,pluginKey:s="bubbleMenu",updateDelay:r=250,resizeDelay:o=60,shouldShow:i,appendTo:a,getReferencedVirtualElement:l,options:c}){this.preventHide=!1,this.isVisible=!1,this.scrollTarget=window,this.floatingUIOptions={strategy:"absolute",placement:"top",offset:8,flip:{},shift:{},arrow:!1,size:!1,autoPlacement:!1,hide:!1,inline:!1,onShow:void 0,onHide:void 0,onUpdate:void 0,onDestroy:void 0},this.shouldShow=({view:d,state:p,from:h,to:f})=>{const{doc:m,selection:y}=p,{empty:g}=y,v=!m.textBetween(h,f).length&&Be(p.selection),b=this.element.contains(document.activeElement);return!(!(d.hasFocus()||b)||g||v||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.resizeHandler=()=>{this.resizeDebounceTimer&&clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=window.setTimeout(()=>{this.updatePosition()},this.resizeDelay)},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var p;if(this.editor.isDestroyed){this.destroy();return}if(this.preventHide){this.preventHide=!1;return}d!=null&&d.relatedTarget&&((p=this.element.parentNode)!=null&&p.contains(d.relatedTarget))||(d==null?void 0:d.relatedTarget)!==this.editor.view.dom&&this.hide()},this.handleDebouncedUpdate=(d,p)=>{const h=!(p!=null&&p.selection.eq(d.state.selection)),f=!(p!=null&&p.doc.eq(d.state.doc));!h&&!f||(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(d,h,f,p)},this.updateDelay))},this.updateHandler=(d,p,h,f)=>{const{composing:m}=d;if(m||!p&&!h)return;if(!this.getShouldShow(f)){this.hide();return}this.updatePosition(),this.show()},this.transactionHandler=({transaction:d})=>{const p=d.getMeta(this.pluginKey);p==="updatePosition"?this.updatePosition():p&&typeof p=="object"&&p.type==="updateOptions"&&this.updateOptions(p.options)};var u;this.editor=t,this.element=e,this.view=n,this.pluginKey=s,this.updateDelay=r,this.resizeDelay=o,this.appendTo=a,this.scrollTarget=(u=c==null?void 0:c.scrollTarget)!=null?u:window,this.getReferencedVirtualElement=l,this.floatingUIOptions={...this.floatingUIOptions,...c},this.element.tabIndex=0,i&&(this.shouldShow=i),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.editor.on("transaction",this.transactionHandler),window.addEventListener("resize",this.resizeHandler),this.scrollTarget.addEventListener("scroll",this.resizeHandler),this.update(n,n.state),this.getShouldShow()&&(this.show(),this.updatePosition())}get middlewares(){const t=[];return this.floatingUIOptions.flip&&t.push(Kn(typeof this.floatingUIOptions.flip!="boolean"?this.floatingUIOptions.flip:void 0)),this.floatingUIOptions.shift&&t.push(Jn(typeof this.floatingUIOptions.shift!="boolean"?this.floatingUIOptions.shift:void 0)),this.floatingUIOptions.offset&&t.push(Qn(typeof this.floatingUIOptions.offset!="boolean"?this.floatingUIOptions.offset:void 0)),this.floatingUIOptions.arrow&&t.push(Gn(this.floatingUIOptions.arrow)),this.floatingUIOptions.size&&t.push(Yn(typeof this.floatingUIOptions.size!="boolean"?this.floatingUIOptions.size:void 0)),this.floatingUIOptions.autoPlacement&&t.push(Xn(typeof this.floatingUIOptions.autoPlacement!="boolean"?this.floatingUIOptions.autoPlacement:void 0)),this.floatingUIOptions.hide&&t.push(Zn(typeof this.floatingUIOptions.hide!="boolean"?this.floatingUIOptions.hide:void 0)),this.floatingUIOptions.inline&&t.push(ts(typeof this.floatingUIOptions.inline!="boolean"?this.floatingUIOptions.inline:void 0)),t}get virtualElement(){var t,e,n;const{selection:s}=this.editor.state,r=(t=this.getReferencedVirtualElement)==null?void 0:t.call(this);if(r)return r;if(!((n=(e=this.view)==null?void 0:e.dom)!=null&&n.parentNode))return;const o=Is(this.view,s.from,s.to);let i={getBoundingClientRect:()=>o,getClientRects:()=>[o]};if(s instanceof et){let a=this.view.nodeDOM(s.from);const l=a.dataset.nodeViewWrapper?a:a.querySelector("[data-node-view-wrapper]");l&&(a=l),a&&(i={getBoundingClientRect:()=>a.getBoundingClientRect(),getClientRects:()=>[a.getBoundingClientRect()]})}if(s instanceof Ne){const{$anchorCell:a,$headCell:l}=s,c=a?a.pos:l.pos,u=l?l.pos:a.pos,d=this.view.nodeDOM(c),p=this.view.nodeDOM(u);if(!d||!p)return;const h=d===p?d.getBoundingClientRect():ql(d.getBoundingClientRect(),p.getBoundingClientRect());i={getBoundingClientRect:()=>h,getClientRects:()=>[h]}}return i}updatePosition(){const t=this.virtualElement;t&&es(t,this.element,{placement:this.floatingUIOptions.placement,strategy:this.floatingUIOptions.strategy,middleware:this.middlewares}).then(({x:e,y:n,strategy:s,middlewareData:r})=>{var o,i;if((o=r.hide)!=null&&o.referenceHidden||(i=r.hide)!=null&&i.escaped){this.element.style.visibility="hidden";return}this.element.style.visibility="visible",this.element.style.width="max-content",this.element.style.position=s,this.element.style.left=`${e}px`,this.element.style.top=`${n}px`,this.isVisible&&this.floatingUIOptions.onUpdate&&this.floatingUIOptions.onUpdate()})}update(t,e){const{state:n}=t,s=n.selection.from!==n.selection.to;if(this.updateDelay>0&&s){this.handleDebouncedUpdate(t,e);return}const r=!(e!=null&&e.selection.eq(t.state.selection)),o=!(e!=null&&e.doc.eq(t.state.doc));this.updateHandler(t,r,o,e)}getShouldShow(t){var e;const{state:n}=this.view,{selection:s}=n,{ranges:r}=s,o=Math.min(...r.map(l=>l.$from.pos)),i=Math.max(...r.map(l=>l.$to.pos));return((e=this.shouldShow)==null?void 0:e.call(this,{editor:this.editor,element:this.element,view:this.view,state:n,oldState:t,from:o,to:i}))||!1}show(){var t;if(this.isVisible)return;this.element.style.visibility="visible",this.element.style.opacity="1";const e=typeof this.appendTo=="function"?this.appendTo():this.appendTo;(t=e??this.view.dom.parentElement)==null||t.appendChild(this.element),this.floatingUIOptions.onShow&&this.floatingUIOptions.onShow(),this.isVisible=!0}hide(){this.isVisible&&(this.element.style.visibility="hidden",this.element.style.opacity="0",this.element.remove(),this.floatingUIOptions.onHide&&this.floatingUIOptions.onHide(),this.isVisible=!1)}updateOptions(t){var e;if(t.updateDelay!==void 0&&(this.updateDelay=t.updateDelay),t.resizeDelay!==void 0&&(this.resizeDelay=t.resizeDelay),t.appendTo!==void 0&&(this.appendTo=t.appendTo),t.getReferencedVirtualElement!==void 0&&(this.getReferencedVirtualElement=t.getReferencedVirtualElement),t.shouldShow!==void 0&&t.shouldShow&&(this.shouldShow=t.shouldShow),t.options!==void 0){const n=(e=t.options.scrollTarget)!=null?e:window;n!==this.scrollTarget&&(this.scrollTarget.removeEventListener("scroll",this.resizeHandler),this.scrollTarget=n,this.scrollTarget.addEventListener("scroll",this.resizeHandler)),this.floatingUIOptions={...this.floatingUIOptions,...t.options}}}destroy(){this.hide(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),window.removeEventListener("resize",this.resizeHandler),this.scrollTarget.removeEventListener("scroll",this.resizeHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler),this.editor.off("transaction",this.transactionHandler),this.floatingUIOptions.onDestroy&&this.floatingUIOptions.onDestroy()}},Jl=t=>new O({key:typeof t.pluginKey=="string"?new $(t.pluginKey):t.pluginKey,view:e=>new Kl({view:e,...t})}),vu=yt({name:"BubbleMenu",inheritAttrs:!1,props:{pluginKey:{type:[String,Object],default:"bubbleMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},resizeDelay:{type:Number,default:void 0},options:{type:Object,default:()=>({})},appendTo:{type:[Object,Function],default:void 0},shouldShow:{type:Function,default:null},getReferencedVirtualElement:{type:Function,default:void 0}},setup(t,{slots:e,attrs:n}){const s=Zt(null);return Ie(()=>{const{editor:r,options:o,pluginKey:i,resizeDelay:a,appendTo:l,shouldShow:c,getReferencedVirtualElement:u,updateDelay:d}=t,p=s.value;p&&(p.style.visibility="hidden",p.style.position="absolute",p.remove(),qn(()=>{r.registerPlugin(Jl({editor:r,element:p,options:o,pluginKey:i,resizeDelay:a,appendTo:l,shouldShow:c,getReferencedVirtualElement:u,updateDelay:d}))}))}),te(()=>{const{pluginKey:r,editor:o}=t;o.unregisterPlugin(r)}),()=>{var r;return vt("div",{ref:s,...n},(r=e.default)==null?void 0:r.call(e))}}}),Ql=class{constructor({editor:t,element:e,view:n,pluginKey:s="floatingMenu",updateDelay:r=250,resizeDelay:o=60,options:i,appendTo:a,shouldShow:l}){this.preventHide=!1,this.isVisible=!1,this.scrollTarget=window,this.shouldShow=({view:u,state:d})=>{const{selection:p}=d,{$anchor:h,empty:f}=p,m=h.depth===1,y=h.parent.isTextblock&&!h.parent.type.spec.code&&!h.parent.textContent&&h.parent.childCount===0&&!this.getTextContent(h.parent);return!(!u.hasFocus()||!f||!m||!y||!this.editor.isEditable)},this.floatingUIOptions={strategy:"absolute",placement:"right",offset:8,flip:{},shift:{},arrow:!1,size:!1,autoPlacement:!1,hide:!1,inline:!1},this.updateHandler=(u,d,p,h)=>{const{composing:f}=u;if(f||!d&&!p)return;if(!this.getShouldShow(h)){this.hide();return}this.updatePosition(),this.show()},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:u})=>{var d;if(this.preventHide){this.preventHide=!1;return}u!=null&&u.relatedTarget&&((d=this.element.parentNode)!=null&&d.contains(u.relatedTarget))||(u==null?void 0:u.relatedTarget)!==this.editor.view.dom&&this.hide()},this.transactionHandler=({transaction:u})=>{const d=u.getMeta(this.pluginKey);d==="updatePosition"?this.updatePosition():d&&typeof d=="object"&&d.type==="updateOptions"&&this.updateOptions(d.options)},this.resizeHandler=()=>{this.resizeDebounceTimer&&clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=window.setTimeout(()=>{this.updatePosition()},this.resizeDelay)};var c;this.editor=t,this.element=e,this.view=n,this.pluginKey=s,this.updateDelay=r,this.resizeDelay=o,this.appendTo=a,this.scrollTarget=(c=i==null?void 0:i.scrollTarget)!=null?c:window,this.floatingUIOptions={...this.floatingUIOptions,...i},this.element.tabIndex=0,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.editor.on("transaction",this.transactionHandler),window.addEventListener("resize",this.resizeHandler),this.scrollTarget.addEventListener("scroll",this.resizeHandler),this.update(n,n.state),this.getShouldShow()&&(this.show(),this.updatePosition())}getTextContent(t){return Cs(t,{textSerializers:Fe(this.editor.schema)})}get middlewares(){const t=[];return this.floatingUIOptions.flip&&t.push(Kn(typeof this.floatingUIOptions.flip!="boolean"?this.floatingUIOptions.flip:void 0)),this.floatingUIOptions.shift&&t.push(Jn(typeof this.floatingUIOptions.shift!="boolean"?this.floatingUIOptions.shift:void 0)),this.floatingUIOptions.offset&&t.push(Qn(typeof this.floatingUIOptions.offset!="boolean"?this.floatingUIOptions.offset:void 0)),this.floatingUIOptions.arrow&&t.push(Gn(this.floatingUIOptions.arrow)),this.floatingUIOptions.size&&t.push(Yn(typeof this.floatingUIOptions.size!="boolean"?this.floatingUIOptions.size:void 0)),this.floatingUIOptions.autoPlacement&&t.push(Xn(typeof this.floatingUIOptions.autoPlacement!="boolean"?this.floatingUIOptions.autoPlacement:void 0)),this.floatingUIOptions.hide&&t.push(Zn(typeof this.floatingUIOptions.hide!="boolean"?this.floatingUIOptions.hide:void 0)),this.floatingUIOptions.inline&&t.push(ts(typeof this.floatingUIOptions.inline!="boolean"?this.floatingUIOptions.inline:void 0)),t}getShouldShow(t){var e;const{state:n}=this.view,{selection:s}=n,{ranges:r}=s,o=Math.min(...r.map(l=>l.$from.pos)),i=Math.max(...r.map(l=>l.$to.pos));return(e=this.shouldShow)==null?void 0:e.call(this,{editor:this.editor,view:this.view,state:n,oldState:t,from:o,to:i})}updateOptions(t){var e;if(t.updateDelay!==void 0&&(this.updateDelay=t.updateDelay),t.resizeDelay!==void 0&&(this.resizeDelay=t.resizeDelay),t.appendTo!==void 0&&(this.appendTo=t.appendTo),t.shouldShow!==void 0&&t.shouldShow&&(this.shouldShow=t.shouldShow),t.options!==void 0){const n=(e=t.options.scrollTarget)!=null?e:window;n!==this.scrollTarget&&(this.scrollTarget.removeEventListener("scroll",this.resizeHandler),this.scrollTarget=n,this.scrollTarget.addEventListener("scroll",this.resizeHandler)),this.floatingUIOptions={...this.floatingUIOptions,...t.options}}}updatePosition(){const{selection:t}=this.editor.state,e=Is(this.view,t.from,t.to);es({getBoundingClientRect:()=>e,getClientRects:()=>[e]},this.element,{placement:this.floatingUIOptions.placement,strategy:this.floatingUIOptions.strategy,middleware:this.middlewares}).then(({x:s,y:r,strategy:o,middlewareData:i})=>{var a,l;if((a=i.hide)!=null&&a.referenceHidden||(l=i.hide)!=null&&l.escaped){this.element.style.visibility="hidden";return}this.element.style.visibility="visible",this.element.style.width="max-content",this.element.style.position=o,this.element.style.left=`${s}px`,this.element.style.top=`${r}px`,this.isVisible&&this.floatingUIOptions.onUpdate&&this.floatingUIOptions.onUpdate()})}update(t,e){const n=!(e!=null&&e.selection.eq(t.state.selection)),s=!(e!=null&&e.doc.eq(t.state.doc));this.updateHandler(t,n,s,e)}show(){var t;if(this.isVisible)return;this.element.style.visibility="visible",this.element.style.opacity="1";const e=typeof this.appendTo=="function"?this.appendTo():this.appendTo;(t=e??this.view.dom.parentElement)==null||t.appendChild(this.element),this.floatingUIOptions.onShow&&this.floatingUIOptions.onShow(),this.isVisible=!0}hide(){this.isVisible&&(this.element.style.visibility="hidden",this.element.style.opacity="0",this.element.remove(),this.floatingUIOptions.onHide&&this.floatingUIOptions.onHide(),this.isVisible=!1)}destroy(){this.hide(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),window.removeEventListener("resize",this.resizeHandler),this.scrollTarget.removeEventListener("scroll",this.resizeHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler),this.editor.off("transaction",this.transactionHandler),this.floatingUIOptions.onDestroy&&this.floatingUIOptions.onDestroy()}},Gl=t=>new O({key:typeof t.pluginKey=="string"?new $(t.pluginKey):t.pluginKey,view:e=>new Ql({view:e,...t})}),bu=yt({name:"FloatingMenu",inheritAttrs:!1,props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},resizeDelay:{type:Number,default:void 0},options:{type:Object,default:()=>({})},appendTo:{type:[Object,Function],default:void 0},shouldShow:{type:Function,default:null}},setup(t,{slots:e,attrs:n}){const s=Zt(null);return Ie(()=>{const{pluginKey:r,editor:o,updateDelay:i,resizeDelay:a,options:l,appendTo:c,shouldShow:u}=t,d=s.value;d&&(d.style.visibility="hidden",d.style.position="absolute",d.remove(),o.registerPlugin(Gl({pluginKey:r,editor:o,element:d,updateDelay:i,resizeDelay:a,options:l,appendTo:c,shouldShow:u})))}),te(()=>{const{pluginKey:r,editor:o}=t;o.unregisterPlugin(r)}),()=>{var r;return vt("div",{ref:s,...n},(r=e.default)==null?void 0:r.call(e))}}}),Gt=(t,e)=>e.view.domAtPos(t).node.offsetParent!==null,Yl=(t,e,n)=>{for(let s=t.depth;s>0;s-=1){const r=t.node(s),o=e(r),i=Gt(t.start(s),n);if(o&&i)return{pos:s>0?t.before(s):0,start:t.start(s),depth:s,node:r}}},$n=(t,e)=>{const{state:n,view:s,extensionManager:r}=t,{schema:o,selection:i}=n,{empty:a,$anchor:l}=i,c=!!r.extensions.find(g=>g.name==="gapCursor");if(!a||l.parent.type!==o.nodes.detailsSummary||!c||e==="right"&&l.parentOffset!==l.parent.nodeSize-2)return!1;const u=ut(g=>g.type===o.nodes.details)(i);if(!u)return!1;const d=st(u.node,g=>g.type===o.nodes.detailsContent);if(!d.length||Gt(u.start+d[0].pos+1,t))return!1;const h=n.doc.resolve(u.pos+u.node.nodeSize),f=an.findFrom(h,1,!1);if(!f)return!1;const{tr:m}=n,y=new an(f);return m.setSelection(y),m.scrollIntoView(),s.dispatch(m),!0},ku=N.create({name:"details",content:"detailsSummary detailsContent",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,addOptions(){return{persist:!1,openClassName:"is-open",HTMLAttributes:{}}},addAttributes(){return this.options.persist?{open:{default:!1,parseHTML:t=>t.hasAttribute("open"),renderHTML:({open:t})=>t?{open:""}:{}}}:[]},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:t}){return["details",A(this.options.HTMLAttributes,t),0]},...le({nodeName:"details",content:"block"}),addNodeView(){return({editor:t,getPos:e,node:n,HTMLAttributes:s})=>{const r=document.createElement("div"),o=A(this.options.HTMLAttributes,s,{"data-type":this.name});Object.entries(o).forEach(([c,u])=>r.setAttribute(c,u));const i=document.createElement("button");i.type="button",r.append(i);const a=document.createElement("div");r.append(a);const l=c=>{if(c!==void 0)if(c){if(r.classList.contains(this.options.openClassName))return;r.classList.add(this.options.openClassName)}else{if(!r.classList.contains(this.options.openClassName))return;r.classList.remove(this.options.openClassName)}else r.classList.toggle(this.options.openClassName);const u=new Event("toggleDetailsContent"),d=a.querySelector(':scope > div[data-type="detailsContent"]');d==null||d.dispatchEvent(u)};return n.attrs.open&&setTimeout(()=>l()),i.addEventListener("click",()=>{if(l(),!this.options.persist){t.commands.focus(void 0,{scrollIntoView:!1});return}if(t.isEditable&&typeof e=="function"){const{from:c,to:u}=t.state.selection;t.chain().command(({tr:d})=>{const p=e();if(!p)return!1;const h=d.doc.nodeAt(p);return(h==null?void 0:h.type)!==this.type?!1:(d.setNodeMarkup(p,void 0,{open:!h.attrs.open}),!0)}).setTextSelection({from:c,to:u}).focus(void 0,{scrollIntoView:!1}).run()}}),{dom:r,contentDOM:a,ignoreMutation(c){return c.type==="selection"?!1:!r.contains(c.target)||r===c.target},update:c=>c.type!==this.type?!1:(c.attrs.open!==void 0&&l(c.attrs.open),!0)}}},addCommands(){return{setDetails:()=>({state:t,chain:e})=>{var n;const{schema:s,selection:r}=t,{$from:o,$to:i}=r,a=o.blockRange(i);if(!a)return!1;const l=t.doc.slice(a.start,a.end);if(!s.nodes.detailsContent.contentMatch.matchFragment(l.content))return!1;const u=((n=l.toJSON())==null?void 0:n.content)||[];return e().insertContentAt({from:a.start,to:a.end},{type:this.name,content:[{type:"detailsSummary"},{type:"detailsContent",content:u}]}).setTextSelection(a.start+2).run()},unsetDetails:()=>({state:t,chain:e})=>{const{selection:n,schema:s}=t,r=ut(g=>g.type===this.type)(n);if(!r)return!1;const o=st(r.node,g=>g.type===s.nodes.detailsSummary),i=st(r.node,g=>g.type===s.nodes.detailsContent);if(!o.length||!i.length)return!1;const a=o[0],l=i[0],c=r.pos,u=t.doc.resolve(c),d=c+r.node.nodeSize,p={from:c,to:d},h=l.node.content.toJSON()||[],f=u.parent.type.contentMatch.defaultType,y=[f==null?void 0:f.create(null,a.node.content).toJSON(),...h];return e().insertContentAt(p,y).setTextSelection(c+1).run()}}},addKeyboardShortcuts(){return{Backspace:()=>{const{schema:t,selection:e}=this.editor.state,{empty:n,$anchor:s}=e;return!n||s.parent.type!==t.nodes.detailsSummary?!1:s.parentOffset!==0?this.editor.commands.command(({tr:r})=>{const o=s.pos-1,i=s.pos;return r.delete(o,i),!0}):this.editor.commands.unsetDetails()},Enter:({editor:t})=>{const{state:e,view:n}=t,{schema:s,selection:r}=e,{$head:o}=r;if(o.parent.type!==s.nodes.detailsSummary)return!1;const i=Gt(o.after()+1,t),a=i?e.doc.nodeAt(o.after()):o.node(-2);if(!a)return!1;const l=i?0:o.indexAfter(-1),c=je(a.contentMatchAt(l));if(!c||!a.canReplaceWith(l,l,c))return!1;const u=c.createAndFill();if(!u)return!1;const d=i?o.after()+1:o.after(-1),p=e.tr.replaceWith(d,d,u),h=p.doc.resolve(d),f=X.near(h,1);return p.setSelection(f),p.scrollIntoView(),n.dispatch(p),!0},ArrowRight:({editor:t})=>$n(t,"right"),ArrowDown:({editor:t})=>$n(t,"down")}},addProseMirrorPlugins(){return[new O({key:new $("detailsSelection"),appendTransaction:(t,e,n)=>{const{editor:s,type:r}=this;if(s.view.composing||!t.some(g=>g.selectionSet)||!e.selection.empty||!n.selection.empty||!As(n,r.name))return;const{$from:l}=n.selection;if(Gt(l.pos,s))return;const u=Yl(l,g=>g.type===r,s);if(!u)return;const d=st(u.node,g=>g.type===n.schema.nodes.detailsSummary);if(!d.length)return;const p=d[0],f=(e.selection.from<n.selection.from?"forward":"backward")==="forward"?u.start+p.pos:u.pos+p.pos+p.node.nodeSize,m=z.create(n.doc,f);return n.tr.setSelection(m)}})]}}),wu=N.create({name:"detailsContent",content:"block+",defining:!0,selectable:!1,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:t}){return["div",A(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addNodeView(){return({HTMLAttributes:t})=>{const e=document.createElement("div"),n=A(this.options.HTMLAttributes,t,{"data-type":this.name,hidden:"hidden"});return Object.entries(n).forEach(([s,r])=>e.setAttribute(s,r)),e.addEventListener("toggleDetailsContent",()=>{e.toggleAttribute("hidden")}),{dom:e,contentDOM:e,ignoreMutation(s){return s.type==="selection"?!1:!e.contains(s.target)||e===s.target},update:s=>s.type===this.type}}},addKeyboardShortcuts(){return{Enter:({editor:t})=>{const{state:e,view:n}=t,{selection:s}=e,{$from:r,empty:o}=s,i=ut(E=>E.type===this.type)(s);if(!o||!i||!i.node.childCount)return!1;const a=r.index(i.depth),{childCount:l}=i.node;if(!(l===a+1))return!1;const u=i.node.type.contentMatch.defaultType,d=u==null?void 0:u.createAndFill();if(!d)return!1;const p=e.doc.resolve(i.pos+1),h=l-1,f=i.node.child(h),m=p.posAtIndex(h,i.depth);if(!f.eq(d))return!1;const g=r.node(-3);if(!g)return!1;const v=r.indexAfter(-3),b=je(g.contentMatchAt(v));if(!b||!g.canReplaceWith(v,v,b))return!1;const k=b.createAndFill();if(!k)return!1;const{tr:M}=e,T=r.after(-2);M.replaceWith(T,T,k);const x=M.doc.resolve(T),C=X.near(x,1);M.setSelection(C);const S=m,P=m+f.nodeSize;return M.delete(S,P),M.scrollIntoView(),n.dispatch(M),!0}}},...le({nodeName:"detailsContent"})}),Mu=N.create({name:"detailsSummary",content:"text*",defining:!0,selectable:!1,isolating:!0,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"summary"}]},renderHTML({HTMLAttributes:t}){return["summary",A(this.options.HTMLAttributes,t),0]},...le({nodeName:"detailsSummary",content:"inline"})}),Xl=N.create({name:"blockMath",group:"block",atom:!0,addOptions(){return{onClick:void 0,katexOptions:void 0}},addAttributes(){return{latex:{default:"",parseHTML:t=>t.getAttribute("data-latex"),renderHTML:t=>({"data-latex":t.latex})}}},addCommands(){return{insertBlockMath:t=>({commands:e,editor:n})=>{const{latex:s,pos:r}=t;return s?e.insertContentAt(r??n.state.selection.from,{type:this.name,attrs:{latex:s}}):!1},deleteBlockMath:t=>({editor:e,tr:n})=>{var s;const r=(s=t==null?void 0:t.pos)!=null?s:e.state.selection.$from.pos,o=e.state.doc.nodeAt(r);return!o||o.type.name!==this.name?!1:(n.delete(r,r+o.nodeSize),!0)},updateBlockMath:t=>({editor:e,tr:n})=>{const s=t==null?void 0:t.latex;let r=t==null?void 0:t.pos;r===void 0&&(r=e.state.selection.$from.pos);const o=e.state.doc.nodeAt(r);return!o||o.type.name!==this.name?!1:(n.setNodeMarkup(r,this.type,{...o.attrs,latex:s||o.attrs.latex}),!0)}}},parseHTML(){return[{tag:'div[data-type="block-math"]'}]},renderHTML({HTMLAttributes:t}){return["div",A(t,{"data-type":"block-math"})]},parseMarkdown:t=>({type:"blockMath",attrs:{latex:t.latex}}),renderMarkdown:t=>{var e;return["$$",((e=t.attrs)==null?void 0:e.latex)||"","$$"].join(`
`)},markdownTokenizer:{name:"blockMath",level:"block",start:t=>t.indexOf("$$"),tokenize:t=>{const e=t.match(/^\$\$([^$]+)\$\$/);if(!e)return;const[n,s]=e;return{type:"blockMath",raw:n,latex:s.trim()}}},addInputRules(){return[new pt({find:/^\$\$\$([^$]+)\$\$\$$/,handler:({state:t,range:e,match:n})=>{const[,s]=n,{tr:r}=t,o=e.from,i=e.to;r.replaceWith(o,i,this.type.create({latex:s}))}})]},addNodeView(){const{katexOptions:t}=this.options;return({node:e,getPos:n})=>{const s=document.createElement("div"),r=document.createElement("div");s.className="tiptap-mathematics-render",this.editor.isEditable&&s.classList.add("tiptap-mathematics-render--editable"),r.className="block-math-inner",s.dataset.type="block-math",s.setAttribute("data-latex",e.attrs.latex),s.appendChild(r);function o(){try{ps.render(e.attrs.latex,r,t),s.classList.remove("block-math-error")}catch{s.textContent=e.attrs.latex,s.classList.add("block-math-error")}}const i=a=>{a.preventDefault(),a.stopPropagation();const l=n();l!=null&&this.options.onClick&&this.options.onClick(e,l)};return this.options.onClick&&s.addEventListener("click",i),o(),{dom:s,destroy(){s.removeEventListener("click",i)}}}}}),Zl=N.create({name:"inlineMath",group:"inline",inline:!0,atom:!0,addOptions(){return{onClick:void 0,katexOptions:void 0}},addAttributes(){return{latex:{default:"",parseHTML:t=>t.getAttribute("data-latex"),renderHTML:t=>({"data-latex":t.latex})}}},addCommands(){return{insertInlineMath:t=>({editor:e,tr:n})=>{var s;const r=t.latex,o=(s=t==null?void 0:t.pos)!=null?s:e.state.selection.from;return r?(n.replaceWith(o,o,this.type.create({latex:r})),!0):!1},deleteInlineMath:t=>({editor:e,tr:n})=>{var s;const r=(s=t==null?void 0:t.pos)!=null?s:e.state.selection.$from.pos,o=e.state.doc.nodeAt(r);return!o||o.type.name!==this.name?!1:(n.delete(r,r+o.nodeSize),!0)},updateInlineMath:t=>({editor:e,tr:n})=>{const s=t==null?void 0:t.latex;let r=t==null?void 0:t.pos;r===void 0&&(r=e.state.selection.$from.pos);const o=e.state.doc.nodeAt(r);return!o||o.type.name!==this.name?!1:(n.setNodeMarkup(r,this.type,{...o.attrs,latex:s}),!0)}}},parseHTML(){return[{tag:'span[data-type="inline-math"]'}]},renderHTML({HTMLAttributes:t}){return["span",A(t,{"data-type":"inline-math"})]},parseMarkdown:t=>({type:"inlineMath",attrs:{latex:t.latex}}),renderMarkdown:t=>{var e;return`$${((e=t.attrs)==null?void 0:e.latex)||""}$`},markdownTokenizer:{name:"inlineMath",level:"inline",start:t=>t.indexOf("$"),tokenize:t=>{const e=t.match(/^\$([^$]+)\$(?!\$)/);if(!e)return;const[n,s]=e;return{type:"inlineMath",raw:n,latex:s.trim()}}},addInputRules(){return[new pt({find:/(^|[^$])(\$\$([^$\n]+?)\$\$)(?!\$)/,handler:({state:t,range:e,match:n})=>{const s=n[3],{tr:r}=t,o=e.from,i=e.to;r.replaceWith(o,i,this.type.create({latex:s}))}})]},addNodeView(){const{katexOptions:t}=this.options;return({node:e,getPos:n})=>{const s=document.createElement("span");s.className="tiptap-mathematics-render",this.editor.isEditable&&s.classList.add("tiptap-mathematics-render--editable"),s.dataset.type="inline-math",s.setAttribute("data-latex",e.attrs.latex);function r(){try{ps.render(e.attrs.latex,s,t),s.classList.remove("inline-math-error")}catch{s.textContent=e.attrs.latex,s.classList.add("inline-math-error")}}const o=i=>{i.preventDefault(),i.stopPropagation();const a=n();a!=null&&this.options.onClick&&this.options.onClick(e,a)};return this.options.onClick&&s.addEventListener("click",o),r(),{dom:s,destroy(){s.removeEventListener("click",o)}}}}});_.create({name:"Mathematics",addOptions(){return{inlineOptions:void 0,blockOptions:void 0,katexOptions:void 0}},addExtensions(){return[Xl.configure({...this.options.blockOptions,katexOptions:this.options.katexOptions}),Zl.configure({...this.options.inlineOptions,katexOptions:this.options.katexOptions})]}});var tc=N.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const s=t.getAttribute("colwidth"),r=s?s.split(",").map(o=>parseInt(o,10)):null;if(!r){const o=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),i=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(i&&i>-1&&o&&o[i]){const a=o[i].getAttribute("width");return a?[parseInt(a,10)]:null}}return r}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",A(this.options.HTMLAttributes,t),0]}}),ec=N.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(s=>parseInt(s,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",A(this.options.HTMLAttributes,t),0]}}),nc=N.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",A(this.options.HTMLAttributes,t),0]}});function Se(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function Pn(t,e,n,s,r,o){var i;let a=0,l=!0,c=e.firstChild;const u=t.firstChild;if(u!==null)for(let p=0,h=0;p<u.childCount;p+=1){const{colspan:f,colwidth:m}=u.child(p).attrs;for(let y=0;y<f;y+=1,h+=1){const g=r===h?o:m&&m[y],v=g?`${g}px`:"";if(a+=g||s,g||(l=!1),c){if(c.style.width!==v){const[b,k]=Se(s,g);c.style.setProperty(b,k)}c=c.nextSibling}else{const b=document.createElement("col"),[k,M]=Se(s,g);b.style.setProperty(k,M),e.appendChild(b)}}}for(;c;){const p=c.nextSibling;(i=c.parentNode)==null||i.removeChild(c),c=p}const d=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);l&&!d?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var sc=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Pn(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,Pn(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),s=this.contentDOM.contains(e);return!!(n&&!s&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function rc(t,e,n,s){let r=0,o=!0;const i=[],a=t.firstChild;if(!a)return{};for(let d=0,p=0;d<a.childCount;d+=1){const{colspan:h,colwidth:f}=a.child(d).attrs;for(let m=0;m<h;m+=1,p+=1){const y=n===p?s:f&&f[m];r+=y||e,y||(o=!1);const[g,v]=Se(e,y);i.push(["col",{style:`${g}: ${v}`}])}}const l=o?`${r}px`:"",c=o?"":`${r}px`;return{colgroup:["colgroup",{},...i],tableWidth:l,tableMinWidth:c}}function Hn(t,e){return t.createAndFill()}function oc(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const s=t.nodes[n];s.spec.tableRole&&(e[s.spec.tableRole]=s)}),t.cached.tableNodeTypes=e,e}function ic(t,e,n,s,r){const o=oc(t),i=[],a=[];for(let c=0;c<n;c+=1){const u=Hn(o.cell);if(u&&a.push(u),s){const d=Hn(o.header_cell);d&&i.push(d)}}const l=[];for(let c=0;c<e;c+=1)l.push(o.row.createChecked(null,s&&c===0?i:a));return o.table.createChecked(null,l)}function ac(t){return t instanceof Ne}var zt=({editor:t})=>{const{selection:e}=t.state;if(!ac(e))return!1;let n=0;const s=bs(e.ranges[0].$from,o=>o.type.name==="table");return s==null||s.node.descendants(o=>{if(o.type.name==="table")return!1;["tableCell","tableHeader"].includes(o.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},lc="";function cc(t){return(t||"").replace(/\s+/g," ").trim()}function dc(t,e,n={}){var s;const r=(s=n.cellLineSeparator)!=null?s:lc;if(!t||!t.content||t.content.length===0)return"";const o=[];t.content.forEach(f=>{const m=[];f.content&&f.content.forEach(y=>{let g="";y.content&&Array.isArray(y.content)&&y.content.length>1?g=y.content.map(M=>e.renderChildren(M)).join(r):g=y.content?e.renderChildren(y.content):"";const v=cc(g),b=y.type==="tableHeader";m.push({text:v,isHeader:b})}),o.push(m)});const i=o.reduce((f,m)=>Math.max(f,m.length),0);if(i===0)return"";const a=new Array(i).fill(0);o.forEach(f=>{var m;for(let y=0;y<i;y+=1){const v=(((m=f[y])==null?void 0:m.text)||"").length;v>a[y]&&(a[y]=v),a[y]<3&&(a[y]=3)}});const l=(f,m)=>f+" ".repeat(Math.max(0,m-f.length)),c=o[0],u=c.some(f=>f.isHeader);let d=`
`;const p=new Array(i).fill(0).map((f,m)=>u&&c[m]&&c[m].text||"");return d+=`| ${p.map((f,m)=>l(f,a[m])).join(" | ")} |
`,d+=`| ${a.map(f=>"-".repeat(Math.max(3,f))).join(" | ")} |
`,(u?o.slice(1):o).forEach(f=>{d+=`| ${new Array(i).fill(0).map((m,y)=>l(f[y]&&f[y].text||"",a[y])).join(" | ")} |
`}),d}var uc=dc,pc=N.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:sc,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:s,tableMinWidth:r}=rc(t,this.options.cellMinWidth),o=e.style;function i(){return o||(s?`width: ${s}`:`min-width: ${r}`)}const a=["table",A(this.options.HTMLAttributes,e,{style:i()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},a]:a},parseMarkdown:(t,e)=>{const n=[];if(t.header){const s=[];t.header.forEach(r=>{s.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(r.tokens)}]))}),n.push(e.createNode("tableRow",{},s))}return t.rows&&t.rows.forEach(s=>{const r=[];s.forEach(o=>{r.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(o.tokens)}]))}),n.push(e.createNode("tableRow",{},r))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>uc(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:s,dispatch:r,editor:o})=>{const i=ic(o.schema,t,e,n);if(r){const a=s.selection.from+1;s.replaceSelectionWith(i).scrollIntoView().setSelection(z.near(s.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Do(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Ro(t,e),deleteColumn:()=>({state:t,dispatch:e})=>No(t,e),addRowBefore:()=>({state:t,dispatch:e})=>Ho(t,e),addRowAfter:()=>({state:t,dispatch:e})=>Po(t,e),deleteRow:()=>({state:t,dispatch:e})=>$o(t,e),deleteTable:()=>({state:t,dispatch:e})=>Oo(t,e),mergeCells:()=>({state:t,dispatch:e})=>cn(t,e),splitCell:()=>({state:t,dispatch:e})=>dn(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>un("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>un("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>Io(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>cn(t,e)?!0:dn(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:s})=>_o(t,e)(n,s),goToNextCell:()=>({state:t,dispatch:e})=>ln(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>ln(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Lo(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const s=Ne.create(e.doc,t.anchorCell,t.headCell);e.setSelection(s)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:zt,"Mod-Backspace":zt,Delete:zt,"Mod-Delete":zt}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Ao({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Eo({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:I(w(t,"tableRole",e))}}});_.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(pc.configure(this.options.table)),this.options.tableCell!==!1&&t.push(tc.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(ec.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(nc.configure(this.options.tableRow)),t}});var hc=20,pr=(t,e=0)=>{const n=[];return!t.children.length||e>hc||Array.from(t.children).forEach(s=>{s.tagName==="SPAN"?n.push(s):s.children.length&&n.push(...pr(s,e+1))}),n},fc=t=>{if(!t.children.length)return;const e=pr(t);e&&e.forEach(n=>{var s,r;const o=n.getAttribute("style"),i=(r=(s=n.parentElement)==null?void 0:s.closest("span"))==null?void 0:r.getAttribute("style");n.setAttribute("style",`${i};${o}`)})},mc=J.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&fc(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",A(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleTextStyle:t=>({commands:e})=>e.toggleMark(this.name,t),removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,s)=>{if(n.isTextblock)return!0;n.marks.filter(r=>r.type===this.type).some(r=>Object.values(r.attrs).some(o=>!!o))||t.removeMark(s,s+n.nodeSize,this.type)}),!0}}}}),gc=_.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>{var e;const n=t.getAttribute("style");if(n){const s=n.split(";").map(r=>r.trim()).filter(Boolean);for(let r=s.length-1;r>=0;r-=1){const o=s[r].split(":");if(o.length>=2){const i=o[0].trim().toLowerCase(),a=o.slice(1).join(":").trim();if(i==="background-color")return a.replace(/['"]+/g,"")}}}return(e=t.style.backgroundColor)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:t=>({chain:e})=>e().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),yc=_.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;const n=t.getAttribute("style");if(n){const s=n.split(";").map(r=>r.trim()).filter(Boolean);for(let r=s.length-1;r>=0;r-=1){const o=s[r].split(":");if(o.length>=2){const i=o[0].trim().toLowerCase(),a=o.slice(1).join(":").trim();if(i==="color")return a.replace(/['"]+/g,"")}}}return(e=t.style.color)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),vc=_.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:t=>t.style.fontFamily,renderHTML:t=>t.fontFamily?{style:`font-family: ${t.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:t=>({chain:e})=>e().setMark("textStyle",{fontFamily:t}).run(),unsetFontFamily:()=>({chain:t})=>t().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),bc=_.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>t.style.fontSize,renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:t=>({chain:e})=>e().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),kc=_.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:t=>t.style.lineHeight,renderHTML:t=>t.lineHeight?{style:`line-height: ${t.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:t=>({chain:e})=>e().setMark("textStyle",{lineHeight:t}).run(),unsetLineHeight:()=>({chain:t})=>t().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});_.create({name:"textStyleKit",addExtensions(){const t=[];return this.options.backgroundColor!==!1&&t.push(gc.configure(this.options.backgroundColor)),this.options.color!==!1&&t.push(yc.configure(this.options.color)),this.options.fontFamily!==!1&&t.push(vc.configure(this.options.fontFamily)),this.options.fontSize!==!1&&t.push(bc.configure(this.options.fontSize)),this.options.lineHeight!==!1&&t.push(kc.configure(this.options.lineHeight)),this.options.textStyle!==!1&&t.push(mc.configure(this.options.textStyle)),t}});function wc(t,e){const s=e.split(`
`).flatMap(r=>[r,""]).map(r=>`${t}${r}`).join(`
`);return s.slice(0,s.length-1)}function Mc(t,e){const n=[];return Array.from(t.keys()).forEach(s=>{(!e||!e.marks||!e.marks.map(r=>r.type).includes(s))&&n.push(s)}),n}function xc(t,e){const n=[];return Array.from(e.entries()).forEach(([s,r])=>{t.has(s)||n.push({type:s,mark:r})}),n}function Tc(t,e,n,s){const r=!n,o=n&&n.type==="text"&&(!n.marks||n.marks.length===0),i=n&&n.type==="text"&&n.marks&&!s(e,new Map(n.marks.map(l=>[l.type,l]))),a=[];if(r||o||i)if(n&&n.type==="text"&&n.marks){const l=new Map(n.marks.map(c=>[c.type,c]));Array.from(t.keys()).forEach(c=>{l.has(c)||a.push(c)})}else(r||o)&&a.push(...Array.from(t.keys()));return a}function Cc(t,e){let n="";return Array.from(t.keys()).reverse().forEach(s=>{const r=t.get(s),o=e(s,r);o&&(n=o+n)}),t.clear(),n}function Sc(t,e,n){let s="";return Array.from(t.entries()).forEach(([r,o])=>{const i=n(r,o);i&&(s+=i),e.set(r,o)}),s}function ge(t){const n=(t.raw||t.text||"").match(/^(\s*)[-+*]\s+\[([ xX])\]\s+/);return n?{isTask:!0,checked:n[2].toLowerCase()==="x",indentLevel:n[1].length}:{isTask:!1,indentLevel:0}}function Bt(t,e){return typeof t!="string"?"json":e}var Ac=class{constructor(t){this.baseExtensions=[],this.extensions=[],this.lastParseResult=null;var e,n,s,r,o;this.markedInstance=(e=t==null?void 0:t.marked)!=null?e:Lr,this.lexer=new this.markedInstance.Lexer,this.indentStyle=(s=(n=t==null?void 0:t.indentation)==null?void 0:n.style)!=null?s:"space",this.indentSize=(o=(r=t==null?void 0:t.indentation)==null?void 0:r.size)!=null?o:2,this.baseExtensions=(t==null?void 0:t.extensions)||[],t!=null&&t.markedOptions&&typeof this.markedInstance.setOptions=="function"&&this.markedInstance.setOptions(t.markedOptions),this.registry=new Map,this.nodeTypeRegistry=new Map,t!=null&&t.extensions&&(this.baseExtensions=t.extensions,re(t.extensions).forEach(a=>this.registerExtension(a,!1))),this.lexer=new this.markedInstance.Lexer}get instance(){return this.markedInstance}get indentCharacter(){return this.indentStyle==="space"?" ":"	"}get indentString(){return this.indentCharacter.repeat(this.indentSize)}hasMarked(){return!!this.markedInstance}registerExtension(t,e=!0){var n,s;this.extensions.push(t);const r=t.name,o=w(t,"markdownTokenName")||r,i=w(t,"parseMarkdown"),a=w(t,"renderMarkdown"),l=w(t,"markdownTokenizer"),c=(n=w(t,"markdownOptions"))!=null?n:null,u=(s=c==null?void 0:c.indentsContent)!=null?s:!1,d={tokenName:o,nodeName:r,parseMarkdown:i,renderMarkdown:a,isIndenting:u,tokenizer:l};if(o&&i){const p=this.registry.get(o)||[];p.push(d),this.registry.set(o,p)}if(a){const p=this.nodeTypeRegistry.get(r)||[];p.push(d),this.nodeTypeRegistry.set(r,p)}l&&this.hasMarked()&&(this.registerTokenizer(l),e&&(this.lexer=new this.markedInstance.Lexer))}registerTokenizer(t){if(!this.hasMarked())return;const{name:e,start:n,level:s="inline",tokenize:r}=t,a={inlineTokens:u=>this.lexer.inlineTokens(u),blockTokens:u=>this.lexer.blockTokens(u)};let l;n?l=typeof n=="function"?n:u=>u.indexOf(n):l=u=>{const d=r(u,[],a);return d&&d.raw?u.indexOf(d.raw):-1};const c={name:e,level:s,start:l,tokenizer:(u,d)=>{const p=r(u,d,a);if(p&&p.type)return{...p,type:p.type||e,raw:p.raw||"",tokens:p.tokens||[]}},childTokens:[]};this.markedInstance.use({extensions:[c]})}getHandlersForToken(t){try{return this.registry.get(t)||[]}catch{return[]}}getHandlerForToken(t){const e=this.getHandlersForToken(t);if(e.length>0)return e[0];const n=this.getHandlersForNodeType(t);return n.length>0?n[0]:void 0}getHandlersForNodeType(t){try{return this.nodeTypeRegistry.get(t)||[]}catch{return[]}}serialize(t){if(!t)return"";const e=this.renderNodes(t,t);return this.isEmptyOutput(e)?"":e}isEmptyOutput(t){return!t||t.trim()===""?!0:t.replace(/&nbsp;/g,"").replace(/\u00A0/g,"").trim()===""}parse(t){if(!this.hasMarked())throw new Error("No marked instance available for parsing");const e=this.markedInstance.lexer(t);return{type:"doc",content:this.parseTokens(e)}}parseTokens(t){return t.map(e=>this.parseToken(e)).filter(e=>e!==null).flatMap(e=>Array.isArray(e)?e:[e])}parseToken(t){if(!t.type)return null;if(t.type==="list")return this.parseListToken(t);const e=this.getHandlersForToken(t.type),n=this.createParseHelpers();if(e.find(r=>{if(!r.parseMarkdown)return!1;const o=r.parseMarkdown(t,n),i=this.normalizeParseResult(o);return i&&(!Array.isArray(i)||i.length>0)?(this.lastParseResult=i,!0):!1})&&this.lastParseResult){const r=this.lastParseResult;return this.lastParseResult=null,r}return this.parseFallbackToken(t)}parseListToken(t){if(!t.items||t.items.length===0)return this.parseTokenWithHandlers(t);const e=t.items.some(a=>ge(a).isTask),n=t.items.some(a=>!ge(a).isTask);if(!e||!n||this.getHandlersForToken("taskList").length===0)return this.parseTokenWithHandlers(t);const s=[];let r=[],o=null;for(let a=0;a<t.items.length;a+=1){const l=t.items[a],{isTask:c,checked:u,indentLevel:d}=ge(l);let p=l;if(c){const m=(l.raw||l.text||"").split(`
`),y=m[0].match(/^\s*[-+*]\s+\[([ xX])\]\s+(.*)$/),g=y?y[2]:"";let v=[];if(m.length>1&&m.slice(1).join(`
`).trim()){const k=m.slice(1),M=k.filter(T=>T.trim());if(M.length>0){const T=Math.min(...M.map(S=>S.length-S.trimStart().length)),C=k.map(S=>S.trim()?S.slice(T):"").join(`
`).trim();C&&(v=this.markedInstance.lexer(`${C}
`))}}p={type:"taskItem",raw:"",mainContent:g,indentLevel:d,checked:u??!1,text:g,tokens:this.lexer.inlineTokens(g),nestedTokens:v}}const h=c?"taskList":"list";o!==h?(r.length>0&&s.push({type:o,items:r}),r=[p],o=h):r.push(p)}r.length>0&&s.push({type:o,items:r});const i=[];for(let a=0;a<s.length;a+=1){const l=s[a],c={...t,type:l.type,items:l.items},u=this.parseToken(c);u&&(Array.isArray(u)?i.push(...u):i.push(u))}return i.length>0?i:null}parseTokenWithHandlers(t){if(!t.type)return null;const e=this.getHandlersForToken(t.type),n=this.createParseHelpers();if(e.find(r=>{if(!r.parseMarkdown)return!1;const o=r.parseMarkdown(t,n),i=this.normalizeParseResult(o);return i&&(!Array.isArray(i)||i.length>0)?(this.lastParseResult=i,!0):!1})&&this.lastParseResult){const r=this.lastParseResult;return this.lastParseResult=null,r}return this.parseFallbackToken(t)}createParseHelpers(){return{parseInline:t=>this.parseInlineTokens(t),parseChildren:t=>this.parseTokens(t),createTextNode:(t,e)=>({type:"text",text:t,marks:e||void 0}),createNode:(t,e,n)=>{const s={type:t,attrs:e||void 0,content:n||void 0};return(!e||Object.keys(e).length===0)&&delete s.attrs,s},applyMark:(t,e,n)=>({mark:t,content:e,attrs:n&&Object.keys(n).length>0?n:void 0})}}escapeRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}parseInlineTokens(t){var e,n,s,r;const o=[];for(let i=0;i<t.length;i+=1){const a=t[i];if(a.type==="text")o.push({type:"text",text:a.text||""});else if(a.type==="html"){const l=((n=(e=a.raw)!=null?e:a.text)!=null?n:"").toString(),c=/^<\/[\s]*[\w-]+/i.test(l),u=l.match(/^<[\s]*([\w-]+)(\s|>|\/|$)/i);if(!c&&u&&!/\/>$/.test(l)){const p=u[1],h=this.escapeRegex(p),f=new RegExp(`^<\\/\\s*${h}\\b`,"i");let m=-1;const y=[l];for(let g=i+1;g<t.length;g+=1){const v=t[g],b=((r=(s=v.raw)!=null?s:v.text)!=null?r:"").toString();if(y.push(b),v.type==="html"&&f.test(b)){m=g;break}}if(m!==-1){const g=y.join(""),v={type:"html",raw:g,text:g,block:!1},b=this.parseHTMLToken(v);if(b){const k=this.normalizeParseResult(b);Array.isArray(k)?o.push(...k):k&&o.push(k)}i=m;continue}}const d=this.parseHTMLToken(a);if(d){const p=this.normalizeParseResult(d);Array.isArray(p)?o.push(...p):p&&o.push(p)}}else if(a.type){const l=this.getHandlerForToken(a.type);if(l&&l.parseMarkdown){const c=this.createParseHelpers(),u=l.parseMarkdown(a,c);if(this.isMarkResult(u)){const d=this.applyMarkToContent(u.mark,u.content,u.attrs);o.push(...d)}else{const d=this.normalizeParseResult(u);Array.isArray(d)?o.push(...d):d&&o.push(d)}}else a.tokens&&o.push(...this.parseInlineTokens(a.tokens))}}return o}applyMarkToContent(t,e,n){return e.map(s=>{if(s.type==="text"){const r=s.marks||[],o=n?{type:t,attrs:n}:{type:t};return{...s,marks:[...r,o]}}return{...s,content:s.content?this.applyMarkToContent(t,s.content,n):void 0}})}isMarkResult(t){return t&&typeof t=="object"&&"mark"in t}normalizeParseResult(t){return t?this.isMarkResult(t)?t.content:t:null}parseFallbackToken(t){switch(t.type){case"paragraph":return{type:"paragraph",content:t.tokens?this.parseInlineTokens(t.tokens):[]};case"heading":return{type:"heading",attrs:{level:t.depth||1},content:t.tokens?this.parseInlineTokens(t.tokens):[]};case"text":return{type:"text",text:t.text||""};case"html":return this.parseHTMLToken(t);case"space":return null;default:return t.tokens?this.parseTokens(t.tokens):null}}parseHTMLToken(t){const e=t.text||t.raw||"";if(!e.trim())return null;if(typeof window>"u")return t.block?{type:"paragraph",content:[{type:"text",text:e}]}:{type:"text",text:e};try{const n=Ki(e,this.baseExtensions);return n.type==="doc"&&n.content?t.block?n.content:n.content.length===1&&n.content[0].type==="paragraph"&&n.content[0].content?n.content[0].content:n.content:n}catch(n){throw new Error(`Failed to parse HTML in markdown: ${n}`)}}renderNodeToMarkdown(t,e,n=0,s=0){var r;if(t.type==="text")return t.text||"";if(!t.type)return"";const o=this.getHandlerForToken(t.type);if(!o)return"";const i={renderChildren:(c,u)=>{const d=o.isIndenting?s+1:s;return!Array.isArray(c)&&c.content?this.renderNodes(c.content,t,u||"",n,d):this.renderNodes(c,t,u||"",n,d)},indent:c=>this.indentString+c,wrapInBlock:wc},a={index:n,level:s,parentType:e==null?void 0:e.type,meta:{parentAttrs:e==null?void 0:e.attrs}};return((r=o.renderMarkdown)==null?void 0:r.call(o,t,i,a))||""}renderNodes(t,e,n="",s=0,r=0){return Array.isArray(t)?this.renderNodesWithMarkBoundaries(t,e,n,r):t.type?this.renderNodeToMarkdown(t,e,s,r):""}renderNodesWithMarkBoundaries(t,e,n="",s=0){const r=[],o=new Map;return t.forEach((i,a)=>{const l=a<t.length-1?t[a+1]:null;if(i.type)if(i.type==="text"){let c=i.text||"";const u=new Map((i.marks||[]).map(g=>[g.type,g])),d=xc(o,u),p=Mc(u,l);let h="";if(p.length>0){const g=c.match(/(\s+)$/);g&&(h=g[1],c=c.slice(0,-h.length))}p.forEach(g=>{const v=u.get(g),b=this.getMarkClosing(g,v);b&&(c+=b),o.has(g)&&o.delete(g)});let f="";if(d.length>0){const g=c.match(/^(\s+)/);g&&(f=g[1],c=c.slice(f.length))}d.forEach(({type:g,mark:v})=>{const b=this.getMarkOpening(g,v);b&&(c=b+c),p.includes(g)||o.set(g,v)}),c=f+c;const m=Tc(o,u,l,this.markSetsEqual.bind(this));let y="";if(m.length>0){const g=c.match(/(\s+)$/);g&&(y=g[1],c=c.slice(0,-y.length))}m.forEach(g=>{const v=o.get(g),b=this.getMarkClosing(g,v);b&&(c+=b),o.delete(g)}),c+=y,c+=h,r.push(c)}else{const c=new Map(o),u=Cc(o,this.getMarkClosing.bind(this)),d=this.renderNodeToMarkdown(i,e,a,s),p=i.type==="hardBreak"?"":Sc(c,o,this.getMarkOpening.bind(this));r.push(u+d+p)}}),r.join(n)}getMarkOpening(t,e){const n=this.getHandlersForNodeType(t),s=n.length>0?n[0]:void 0;if(!s||!s.renderMarkdown)return"";const r="î__TIPTAP_MARKDOWN_PLACEHOLDER__î",o={type:t,attrs:e.attrs||{},content:[{type:"text",text:r}]};try{const i=s.renderMarkdown(o,{renderChildren:()=>r,indent:l=>l,wrapInBlock:(l,c)=>l+c},{index:0,level:0,parentType:"text",meta:{}}),a=i.indexOf(r);return a>=0?i.substring(0,a):""}catch(i){throw new Error(`Failed to get mark opening for ${t}: ${i}`)}}getMarkClosing(t,e){const n=this.getHandlersForNodeType(t),s=n.length>0?n[0]:void 0;if(!s||!s.renderMarkdown)return"";const r="î__TIPTAP_MARKDOWN_PLACEHOLDER__î",o={type:t,attrs:e.attrs||{},content:[{type:"text",text:r}]};try{const i=s.renderMarkdown(o,{renderChildren:()=>r,indent:c=>c,wrapInBlock:(c,u)=>c+u},{index:0,level:0,parentType:"text",meta:{}}),a=i.indexOf(r),l=a+r.length;return a>=0?i.substring(l):""}catch(i){throw new Error(`Failed to get mark closing for ${t}: ${i}`)}}markSetsEqual(t,e){return t.size!==e.size?!1:Array.from(t.keys()).every(n=>e.has(n))}},Nn=Ac,xu=_.create({name:"markdown",addOptions(){return{indentation:{style:"space",size:2},marked:void 0,markedOptions:{}}},addCommands(){return{setContent:(t,e)=>{if(!(e!=null&&e.contentType)||Bt(t,e==null?void 0:e.contentType)!=="markdown"||!this.editor.markdown)return K.setContent(t,e);const s=this.editor.markdown.parse(t);return K.setContent(s,e)},insertContent:(t,e)=>{if(!(e!=null&&e.contentType)||Bt(t,e==null?void 0:e.contentType)!=="markdown"||!this.editor.markdown)return K.insertContent(t,e);const s=this.editor.markdown.parse(t);return K.insertContent(s,e)},insertContentAt:(t,e,n)=>{if(!(n!=null&&n.contentType)||Bt(e,n==null?void 0:n.contentType)!=="markdown"||!this.editor.markdown)return K.insertContentAt(t,e,n);const r=this.editor.markdown.parse(e);return K.insertContentAt(t,r,n)}}},addStorage(){return{manager:new Nn({indentation:this.options.indentation,marked:this.options.marked,markedOptions:this.options.markedOptions,extensions:[]})}},onBeforeCreate(){if(this.editor.markdown){console.error("[tiptap][markdown]: There is already a `markdown` property on the editor instance. This might lead to unexpected behavior.");return}if(this.storage.manager=new Nn({indentation:this.options.indentation,marked:this.options.marked,markedOptions:this.options.markedOptions,extensions:this.editor.extensionManager.baseExtensions}),this.editor.markdown=this.storage.manager,this.editor.getMarkdown=()=>this.storage.manager.serialize(this.editor.getJSON()),!this.editor.options.contentType||Bt(this.editor.options.content,this.editor.options.contentType)!=="markdown")return;if(!this.editor.markdown)throw new Error('[tiptap][markdown]: The `contentType` option is set to "markdown", but the Markdown extension is not added to the editor. Please add the Markdown extension to use this feature.');if(this.editor.options.content===void 0||typeof this.editor.options.content!="string")throw new Error('[tiptap][markdown]: The `contentType` option is set to "markdown", but the initial content is not a string. Please provide the initial content as a markdown string.');const e=this.editor.markdown.parse(this.editor.options.content);this.editor.options.content=e}});const H=new $("y-sync"),tt=new $("y-undo"),Ut=new $("yjs-cursor"),Ec=t=>{for(let n=6;n<t.length;n++)t[n%6]=t[n%6]^t[n];return t.slice(0,6)},Lc=t=>zr(Ec(Br(Ur(t)))),Yt=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&e.sv.get(t.id.client)>t.id.clock&&!Wo(e.ds,t.id),_c=[{light:"#ecd44433",dark:"#ecd444"}],Ic=(t,e,n)=>{if(!t.has(n)){if(t.size<e.length){const s=Dr();t.forEach(r=>s.add(r)),e=e.filter(r=>!s.has(r))}t.set(n,Rr(e))}return t.get(n)},Oc=(t,{colors:e=_c,colorMapping:n=new Map,permanentUserData:s=null,onFirstRender:r=()=>{},mapping:o}={})=>{let i=!1;const a=new Hc(t,o),l=new O({props:{editable:c=>{const u=H.getState(c);return u.snapshot==null&&u.prevSnapshot==null}},key:H,state:{init:(c,u)=>({type:t,doc:t.doc,binding:a,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,isUndoRedoOperation:!1,addToHistory:!0,colors:e,colorMapping:n,permanentUserData:s}),apply:(c,u)=>{const d=c.getMeta(H);if(d!==void 0){u=Object.assign({},u);for(const p in d)u[p]=d[p]}return u.addToHistory=c.getMeta("addToHistory")!==!1,u.isChangeOrigin=d!==void 0&&!!d.isChangeOrigin,u.isUndoRedoOperation=d!==void 0&&!!d.isChangeOrigin&&!!d.isUndoRedoOperation,a.prosemirrorView!==null&&d!==void 0&&(d.snapshot!=null||d.prevSnapshot!=null)&&Oe(0,()=>{a.prosemirrorView!=null&&(d.restore==null?a._renderSnapshot(d.snapshot,d.prevSnapshot,u):(a._renderSnapshot(d.snapshot,d.snapshot,u),delete u.restore,delete u.snapshot,delete u.prevSnapshot,a.mux(()=>{a._prosemirrorChanged(a.prosemirrorView.state.doc)})))}),u}},view:c=>(a.initView(c),o==null&&a._forceRerender(),r(),{update:()=>{const u=l.getState(c.state);if(u.snapshot==null&&u.prevSnapshot==null&&(i||c.state.doc.content.findDiffStart(c.state.doc.type.createAndFill().content)!==null)){if(i=!0,u.addToHistory===!1&&!u.isChangeOrigin){const d=tt.getState(c.state),p=d&&d.undoManager;p&&p.stopCapturing()}a.mux(()=>{u.doc.transact(d=>{d.meta.set("addToHistory",u.addToHistory),a._prosemirrorChanged(c.state.doc)},H)})}},destroy:()=>{a.destroy()}})});return l},$c=(t,e,n)=>{if(e!==null&&e.anchor!==null&&e.head!==null)if(e.type==="all")t.setSelection(new os(t.doc));else if(e.type==="node"){const s=lt(n.doc,n.type,e.anchor,n.mapping);t.setSelection(Pc(t,s))}else{const s=lt(n.doc,n.type,e.anchor,n.mapping),r=lt(n.doc,n.type,e.head,n.mapping);s!==null&&r!==null&&t.setSelection(z.between(t.doc.resolve(s),t.doc.resolve(r)))}},Pc=(t,e)=>{const n=t.doc.resolve(e);return n.nodeAfter?et.create(t.doc,e):z.near(n)},Ae=(t,e)=>({type:e.selection.jsonID,anchor:Ot(e.selection.anchor,t.type,t.mapping),head:Ot(e.selection.head,t.type,t.mapping)});class Hc{constructor(e,n=new Map){this.type=e,this.prosemirrorView=null,this.mux=_r(),this.mapping=n,this.isOMark=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&this.prosemirrorView!=null&&(this.beforeTransactionSelection=Ae(this,this.prosemirrorView.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(Ir&&this._domSelectionInView===null&&(Oe(0,()=>{this._domSelectionInView=null}),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const e=this.prosemirrorView._root.getSelection();if(e==null||e.anchorNode==null)return!1;const n=this.prosemirrorView._root.createRange();n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),n.getClientRects().length===0&&n.startContainer&&n.collapsed&&n.selectNodeContents(n.startContainer);const r=n.getBoundingClientRect(),o=Or.documentElement;return r.bottom>=0&&r.right>=0&&r.left<=(window.innerWidth||o.clientWidth||0)&&r.top<=(window.innerHeight||o.clientHeight||0)}renderSnapshot(e,n){n||(n=Fo(Yo(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(H,{snapshot:e,prevSnapshot:n}))}unrenderSnapshot(){this.mapping.clear(),this.mux(()=>{const e=this.type.toArray().map(s=>Wt(s,this.prosemirrorView.state.schema,this)).filter(s=>s!==null),n=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new ft(W.from(e),0,0));n.setMeta(H,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(n)})}_forceRerender(){this.mapping.clear(),this.mux(()=>{const e=this.beforeTransactionSelection!==null?null:this.prosemirrorView.state.selection,n=this.type.toArray().map(r=>Wt(r,this.prosemirrorView.state.schema,this)).filter(r=>r!==null),s=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new ft(W.from(n),0,0));if(e){const r=at(Kt(e.anchor,0),s.doc.content.size),o=at(Kt(e.head,0),s.doc.content.size);s.setSelection(z.create(s.doc,r,o))}this.prosemirrorView.dispatch(s.setMeta(H,{isChangeOrigin:!0,binding:this}))})}_renderSnapshot(e,n,s){let r=this.doc,o=this.type;if(e||(e=ue(this.doc)),e instanceof Uint8Array||n instanceof Uint8Array)if((!(e instanceof Uint8Array)||!(n instanceof Uint8Array))&&$e(),r=new jo({gc:!1}),hn(r,n),n=ue(r),hn(r,e),e=ue(r),o._item===null){const i=Array.from(this.doc.share.keys()).find(a=>this.doc.share.get(a)===this.type);o=r.getXmlFragment(i)}else{const i=r.store.clients.get(o._item.id.client)??[],a=Vo(i,o._item.id.clock);o=i[a].content.type}this.mapping.clear(),this.mux(()=>{r.transact(i=>{const a=s.permanentUserData;a&&a.dss.forEach(d=>{fn(i,d,p=>{})});const l=(d,p)=>{const h=d==="added"?a.getUserByClientId(p.client):a.getUserByDeletedId(p);return{user:h,type:d,color:Ic(s.colorMapping,s.colors,h)}},c=ds(o,new us(n.ds,e.sv)).map(d=>!d._item.deleted||Yt(d._item,e)||Yt(d._item,n)?Wt(d,this.prosemirrorView.state.schema,{mapping:new Map,isOMark:new Map},e,n,l):null).filter(d=>d!==null),u=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new ft(W.from(c),0,0));this.prosemirrorView.dispatch(u.setMeta(H,{isChangeOrigin:!0}))},H)})}_typeChanged(e,n){if(this.prosemirrorView==null)return;const s=H.getState(this.prosemirrorView.state);if(e.length===0||s.snapshot!=null||s.prevSnapshot!=null){this.renderSnapshot(s.snapshot,s.prevSnapshot);return}this.mux(()=>{const r=(a,l)=>this.mapping.delete(l);fn(n,n.deleteSet,a=>{if(a.constructor===ls){const l=a.content.type;l&&this.mapping.delete(l)}}),n.changed.forEach(r),n.changedParentTypes.forEach(r);const o=this.type.toArray().map(a=>hr(a,this.prosemirrorView.state.schema,this)).filter(a=>a!==null);let i=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new ft(W.from(o),0,0));$c(i,this.beforeTransactionSelection,this),i=i.setMeta(H,{isChangeOrigin:!0,isUndoRedoOperation:n.origin instanceof as}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&i.scrollIntoView(),this.prosemirrorView.dispatch(i)})}_prosemirrorChanged(e){this.doc.transact(()=>{Le(this.doc,this.type,e,this),this.beforeTransactionSelection=Ae(this,this.prosemirrorView.state)},H)}initView(e){this.prosemirrorView!=null&&this.destroy(),this.prosemirrorView=e,this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),this.type.observeDeep(this._observeFunction)}destroy(){this.prosemirrorView!=null&&(this.prosemirrorView=null,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions))}}const hr=(t,e,n,s,r,o)=>{const i=n.mapping.get(t);if(i===void 0){if(t instanceof Q)return Wt(t,e,n,s,r,o);throw $r()}return i},Wt=(t,e,n,s,r,o)=>{const i=[],a=l=>{var c,u;if(l instanceof Q){const d=hr(l,e,n,s,r,o);d!==null&&i.push(d)}else{const d=(u=(c=l._item.right)==null?void 0:c.content)==null?void 0:u.type;d instanceof cs&&!d._item.deleted&&d._item.id.client===d.doc.clientID&&(l.applyDelta([{retain:l.length},...d.toDelta()]),d.doc.transact(h=>{d._item.delete(h)}));const p=Nc(l,e,n,s,r,o);p!==null&&p.forEach(h=>{h!==null&&i.push(h)})}};s===void 0||r===void 0?t.toArray().forEach(a):ds(t,new us(r.ds,s.sv)).forEach(a);try{const l=t.getAttributes(s);s!==void 0&&(Yt(t._item,s)?Yt(t._item,r)||(l.ychange=o?o("added",t._item.id):{type:"added"}):l.ychange=o?o("removed",t._item.id):{type:"removed"});const c=e.node(t.nodeName,l,i);return n.mapping.set(t,c),c}catch{return t.doc.transact(c=>{t._item.delete(c)},H),n.mapping.delete(t),null}},Nc=(t,e,n,s,r,o)=>{const i=[],a=t.toDelta(s,r,o);try{for(let l=0;l<a.length;l++){const c=a[l];i.push(e.text(c.insert,jc(c.attributes,e)))}}catch{return t.doc.transact(c=>{t._item.delete(c)},H),null}return i},Rc=(t,e)=>{const n=new G,s=t.map(r=>({insert:r.text,attributes:mr(r.marks,e)}));return n.applyDelta(s),e.mapping.set(n,t),n},Dc=(t,e)=>{const n=new Q(t.type.name);for(const s in t.attrs){const r=t.attrs[s];r!==null&&s!=="ychange"&&n.setAttribute(s,r)}return n.insert(0,ce(t).map(s=>Ee(s,e))),e.mapping.set(n,t),n},Ee=(t,e)=>t instanceof Array?Rc(t,e):Dc(t,e),Rn=t=>typeof t=="object"&&t!==null,tn=(t,e)=>{const n=Object.keys(t).filter(r=>t[r]!==null);let s=n.length===Object.keys(e).filter(r=>e[r]!==null).length;for(let r=0;r<n.length&&s;r++){const o=n[r],i=t[o],a=e[o];s=o==="ychange"||i===a||Rn(i)&&Rn(a)&&tn(i,a)}return s},ce=t=>{const e=t.content.content,n=[];for(let s=0;s<e.length;s++){const r=e[s];if(r.isText){const o=[];for(let i=e[s];s<e.length&&i.isText;i=e[++s])o.push(i);s--,n.push(o)}else n.push(r)}return n},fr=(t,e)=>{const n=t.toDelta();return n.length===e.length&&n.every((s,r)=>s.insert===e[r].text&&Pr(s.attributes||{}).length===e[r].marks.length&&Hr(s.attributes,(o,i)=>{var u;const a=en(i),l=e[r].marks;return l.find(d=>d.type.name===a)?tn(o,(u=l.find(d=>d.type.name===a))==null?void 0:u.attrs):!1}))},It=(t,e)=>{if(t instanceof Q&&!(e instanceof Array)&&_e(t,e)){const n=ce(e);return t._length===n.length&&tn(t.getAttributes(),e.attrs)&&t.toArray().every((s,r)=>It(s,n[r]))}return t instanceof G&&e instanceof Array&&fr(t,e)},Xt=(t,e)=>t===e||t instanceof Array&&e instanceof Array&&t.length===e.length&&t.every((n,s)=>e[s]===n),Dn=(t,e,n)=>{const s=t.toArray(),r=ce(e),o=r.length,i=s.length,a=at(i,o);let l=0,c=0,u=!1;for(;l<a;l++){const d=s[l],p=r[l];if(Xt(n.mapping.get(d),p))u=!0;else if(!It(d,p))break}for(;l+c<a;c++){const d=s[i-c-1],p=r[o-c-1];if(Xt(n.mapping.get(d),p))u=!0;else if(!It(d,p))break}return{equalityFactor:l+c,foundMappedChild:u}},zc=t=>{let e="",n=t._start;const s={};for(;n!==null;)n.deleted||(n.countable&&n.content instanceof Qo?e+=n.content.str:n.content instanceof Go&&(s[n.content.key]=null)),n=n.right;return{str:e,nAttrs:s}},Bc=(t,e,n)=>{n.mapping.set(t,e);const{nAttrs:s,str:r}=zc(t),o=e.map(c=>({insert:c.text,attributes:Object.assign({},s,mr(c.marks,n))})),{insert:i,remove:a,index:l}=Nr(r,o.map(c=>c.insert).join(""));t.delete(l,a),t.insert(l,i),t.applyDelta(o.map(c=>({retain:c.insert.length,attributes:c.attributes})))},Uc=/(.*)(--[a-zA-Z0-9+/=]{8})$/,en=t=>{var e;return((e=Uc.exec(t))==null?void 0:e[1])??t},jc=(t,e)=>{const n=[];for(const s in t)n.push(e.mark(en(s),t[s]));return n},mr=(t,e)=>{const n={};return t.forEach(s=>{if(s.type.name!=="ychange"){const r=ns(e.isOMark,s.type,()=>!s.type.excludes(s.type));n[r?`${s.type.name}--${Lc(s.toJSON())}`:s.type.name]=s.attrs}}),n},Le=(t,e,n,s)=>{if(e instanceof Q&&e.nodeName!==n.type.name)throw new Error("node name mismatch!");if(s.mapping.set(e,n),e instanceof Q){const d=e.getAttributes(),p=n.attrs;for(const h in p)p[h]!==null?d[h]!==p[h]&&h!=="ychange"&&e.setAttribute(h,p[h]):e.removeAttribute(h);for(const h in d)p[h]===void 0&&e.removeAttribute(h)}const r=ce(n),o=r.length,i=e.toArray(),a=i.length,l=at(o,a);let c=0,u=0;for(;c<l;c++){const d=i[c],p=r[c];if(!Xt(s.mapping.get(d),p))if(It(d,p))s.mapping.set(d,p);else break}for(;u+c+1<l;u++){const d=i[a-u-1],p=r[o-u-1];if(!Xt(s.mapping.get(d),p))if(It(d,p))s.mapping.set(d,p);else break}t.transact(()=>{for(;a-c-u>0&&o-c-u>0;){const p=i[c],h=r[c],f=i[a-u-1],m=r[o-u-1];if(p instanceof G&&h instanceof Array)fr(p,h)||Bc(p,h,s),c+=1;else{let y=p instanceof Q&&_e(p,h),g=f instanceof Q&&_e(f,m);if(y&&g){const v=Dn(p,h,s),b=Dn(f,m,s);v.foundMappedChild&&!b.foundMappedChild?g=!1:!v.foundMappedChild&&b.foundMappedChild||v.equalityFactor<b.equalityFactor?y=!1:g=!1}y?(Le(t,p,h,s),c+=1):g?(Le(t,f,m,s),u+=1):(s.mapping.delete(e.get(c)),e.delete(c,1),e.insert(c,[Ee(h,s)]),c+=1)}}const d=a-c-u;if(a===1&&o===0&&i[0]instanceof G?(s.mapping.delete(i[0]),i[0].delete(0,i[0].length)):d>0&&(e.slice(c,c+d).forEach(p=>s.mapping.delete(p)),e.delete(c,d)),c+u<o){const p=[];for(let h=c;h<o-u;h++)p.push(Ee(r[h],s));e.insert(c,p)}},H)},_e=(t,e)=>!(e instanceof Array)&&t.nodeName===e.type.name;let At=null;const Vc=()=>{const t=At;At=null,t.forEach((e,n)=>{const s=n.state.tr,r=H.getState(n.state);r&&r.binding&&!r.binding.isDestroyed&&(e.forEach((o,i)=>{s.setMeta(i,o)}),n.dispatch(s))})},Fc=(t,e,n)=>{At||(At=new Map,Oe(0,Vc)),ns(At,t,jr).set(e,n)},Ot=(t,e,n)=>{if(t===0)return pe(e,0,-1);let s=e._first===null?null:e._first.content.type;for(;s!==null&&e!==s;){if(s instanceof G){if(s._length>=t)return pe(s,t,-1);if(t-=s._length,s._item!==null&&s._item.next!==null)s=s._item.next.content.type;else{do s=s._item===null?null:s._item.parent,t--;while(s!==e&&s!==null&&s._item!==null&&s._item.next===null);s!==null&&s!==e&&(s=s._item===null?null:s._item.next.content.type)}}else{const r=(n.get(s)||{nodeSize:0}).nodeSize;if(s._first!==null&&t<r)s=s._first.content.type,t--;else{if(t===1&&s._length===0&&r>1)return new ye(s._item===null?null:s._item.id,s._item===null?ve(s):null,null);if(t-=r,s._item!==null&&s._item.next!==null)s=s._item.next.content.type;else{if(t===0)return s=s._item===null?s:s._item.parent,new ye(s._item===null?null:s._item.id,s._item===null?ve(s):null,null);do s=s._item.parent,t--;while(s!==e&&s._item.next===null);s!==e&&(s=s._item.next.content.type)}}}if(s===null)throw $e();if(t===0&&s.constructor!==G&&s!==e)return Wc(s._item.parent,s._item)}return pe(e,e._length,-1)},Wc=(t,e)=>{let n=null,s=null;return t._item===null?s=ve(t):n=Jo(t._item.id.client,t._item.id.clock),new ye(n,s,e.id)},lt=(t,e,n,s)=>{const r=qo(n,t);if(r===null||r.type!==e&&!Ko(e,r.type._item))return null;let o=r.type,i=0;if(o.constructor===G)i=r.index;else if(o._item===null||!o._item.deleted){let a=o._first,l=0;for(;l<o._length&&l<r.index&&a!==null;){if(!a.deleted){const c=a.content.type;l++,c instanceof G?i+=c._length:i+=s.get(c).nodeSize}a=a.right}i+=1}for(;o!==e&&o._item!==null;){const a=o._item.parent;if(a._item===null||!a._item.deleted){i+=1;let l=a._first;for(;l!==null;){const c=l.content.type;if(c===o)break;l.deleted||(c instanceof G?i+=c._length:i+=s.get(c).nodeSize),l=l.right}}o=a}return i-1};function qc(t){const e=t.toArray(),n=s=>{let r;if(s instanceof G)r=s.toDelta().map(i=>{const a={type:"text",text:i.insert};return i.attributes&&(a.marks=Object.keys(i.attributes).map(l=>{const c=i.attributes[l],d={type:en(l)};return Object.keys(c)&&(d.attrs=c),d})),a});else if(s instanceof Q){r={type:s.nodeName};const o=s.getAttributes();Object.keys(o).length&&(r.attrs=o);const i=s.toArray();i.length&&(r.content=i.map(n).flat())}else $e();return r};return{type:"doc",content:e.map(n)}}const Kc=(t,e,n)=>t!==e,Jc=t=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null);const s=document.createTextNode("â "),r=document.createTextNode("â ");return e.insertBefore(s,null),e.insertBefore(n,null),e.insertBefore(r,null),e},gr=t=>({style:`background-color: ${t.color}70`,class:"ProseMirror-yjs-selection"}),Qc=/^#[0-9a-fA-F]{6}$/,zn=(t,e,n,s,r)=>{const o=H.getState(t);if(o==null||o.doc==null||o.binding==null)return Z.create(t.doc,[]);const i=o.doc,a=[];return o.snapshot!=null||o.prevSnapshot!=null||o.binding.mapping.size===0?Z.create(t.doc,[]):(e.getStates().forEach((l,c)=>{if(n(i.clientID,c,l)&&l.cursor!=null){const u=l.user||{};u.color==null?u.color="#ffa500":Qc.test(u.color)||console.warn("A user uses an unsupported color format",u),u.name==null&&(u.name=`User: ${c}`);let d=lt(i,o.type,Ct(l.cursor.anchor),o.binding.mapping),p=lt(i,o.type,Ct(l.cursor.head),o.binding.mapping);if(d!==null&&p!==null){const h=Kt(t.doc.content.size-1,0);d=at(d,h),p=at(p,h),a.push(ct.widget(p,()=>s(u,c),{key:c+"",side:10}));const f=at(d,p),m=Kt(d,p);a.push(ct.inline(f,m,r(u,c),{inclusiveEnd:!0,inclusiveStart:!1}))}}}),Z.create(t.doc,a))},Gc=(t,{awarenessStateFilter:e=Kc,cursorBuilder:n=Jc,selectionBuilder:s=gr,getSelection:r=i=>i.selection}={},o="cursor")=>new O({key:Ut,state:{init(i,a){return zn(a,t,e,n,s)},apply(i,a,l,c){const u=H.getState(c),d=i.getMeta(Ut);return u&&u.isChangeOrigin||d&&d.awarenessUpdated?zn(c,t,e,n,s):a.map(i.mapping,i.doc)}},props:{decorations:i=>Ut.getState(i)},view:i=>{const a=()=>{i.docView&&Fc(i,Ut,{awarenessUpdated:!0})},l=()=>{const c=H.getState(i.state),u=t.getLocalState()||{};if(i.hasFocus()){const d=r(i.state),p=Ot(d.anchor,c.type,c.binding.mapping),h=Ot(d.head,c.type,c.binding.mapping);(u.cursor==null||!mn(Ct(u.cursor.anchor),p)||!mn(Ct(u.cursor.head),h))&&t.setLocalStateField(o,{anchor:p,head:h})}else u.cursor!=null&&lt(c.doc,c.type,Ct(u.cursor.anchor),c.binding.mapping)!==null&&t.setLocalStateField(o,null)};return t.on("change",a),i.dom.addEventListener("focusin",l),i.dom.addEventListener("focusout",l),{update:l,destroy:()=>{i.dom.removeEventListener("focusin",l),i.dom.removeEventListener("focusout",l),t.off("change",a),t.setLocalStateField(o,null)}}}}),Yc=t=>{const e=tt.getState(t).undoManager;if(e!=null)return e.undo(),!0},Xc=t=>{const e=tt.getState(t).undoManager;if(e!=null)return e.redo(),!0},Zc=new Set(["paragraph"]),td=(t,e)=>!(t instanceof ls)||!(t.content instanceof Uo)||!(t.content.type instanceof cs||t.content.type instanceof Q&&e.has(t.content.type.nodeName))||t.content.type._length===0,ed=({protectedNodes:t=Zc,trackedOrigins:e=[],undoManager:n=null}={})=>new O({key:tt,state:{init:(s,r)=>{const o=H.getState(r),i=n||new as(o.type,{trackedOrigins:new Set([H].concat(e)),deleteFilter:a=>td(a,t),captureTransaction:a=>a.meta.get("addToHistory")!==!1});return{undoManager:i,prevSel:null,hasUndoOps:i.undoStack.length>0,hasRedoOps:i.redoStack.length>0}},apply:(s,r,o,i)=>{const a=H.getState(i).binding,l=r.undoManager,c=l.undoStack.length>0,u=l.redoStack.length>0;return a?{undoManager:l,prevSel:Ae(a,o),hasUndoOps:c,hasRedoOps:u}:c!==r.hasUndoOps||u!==r.hasRedoOps?Object.assign({},r,{hasUndoOps:l.undoStack.length>0,hasRedoOps:l.redoStack.length>0}):r}},view:s=>{const r=H.getState(s.state),o=tt.getState(s.state).undoManager;return o.on("stack-item-added",({stackItem:i})=>{const a=r.binding;a&&i.meta.set(a,tt.getState(s.state).prevSel)}),o.on("stack-item-popped",({stackItem:i})=>{const a=r.binding;a&&(a.beforeTransactionSelection=i.meta.get(a)||a.beforeTransactionSelection)}),{destroy:()=>{o.destroy()}}}});function nd(t){return!!t.getMeta(H)}function sd(t,e){const n=H.getState(t);return lt(n.doc,n.type,e,n.binding.mapping)||0}function yr(t,e){const n=H.getState(t);return Ot(e,n.type,n.binding.mapping)}var qt=class vr extends Ke{constructor(e,n){super(e),this.yRelativePosition=n}static fromJSON(e){return new vr(e.position,e.yRelativePosition)}toJSON(){return{position:this.position,yRelativePosition:this.yRelativePosition}}};function rd(t,e){const n=yr(e,t);return new qt(t,n)}function od(t,e,n){const s=t instanceof qt?t.yRelativePosition:null;if(nd(e)&&s){const i=sd(n,s);return{position:new qt(i,s),mapResult:null}}const r=_s(t,e),o=r.position.position;return{position:new qt(o,s??yr(n,o)),mapResult:r.mapResult}}var id=_.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null,provider:null}},addStorage(){return{isDisabled:!1}},onCreate(){this.editor.extensionManager.extensions.find(t=>t.name==="undoRedo")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-undo-redo".')},onBeforeCreate(){this.editor.utils.getUpdatedPosition=(t,e)=>od(t,e,this.editor.state),this.editor.utils.createMappablePosition=t=>rd(t,this.editor.state)},addCommands(){return{undo:()=>({tr:t,state:e,dispatch:n})=>(t.setMeta("preventDispatch",!0),tt.getState(e).undoManager.undoStack.length===0?!1:n?Yc(e):!0),redo:()=>({tr:t,state:e,dispatch:n})=>(t.setMeta("preventDispatch",!0),tt.getState(e).undoManager.redoStack.length===0?!1:n?Xc(e):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var t;const e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),n=ed(this.options.yUndoOptions),s=n.spec.view;n.spec.view=i=>{const{undoManager:a}=tt.getState(i.state);a.restore&&(a.restore(),a.restore=()=>{});const l=s?s(i):void 0;return{destroy:()=>{const c=a.trackedOrigins.has(a),u=a._observers;a.restore=()=>{c&&a.trackedOrigins.add(a),a.doc.on("afterTransaction",a.afterTransactionHandler),a._observers=u},l!=null&&l.destroy&&l.destroy()}}};const r={...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender},o=Oc(e,r);return this.editor.options.enableContentCheck&&((t=e.doc)==null||t.on("beforeTransaction",()=>{try{const i=qc(e);if(i.content.length===0)return;this.editor.schema.nodeFromJSON(i).check()}catch(i){return this.editor.emit("contentError",{error:i,editor:this.editor,disableCollaboration:()=>{var a;(a=e.doc)==null||a.destroy(),this.storage.isDisabled=!0}}),!1}})),[o,n,this.editor.options.enableContentCheck&&new O({key:new $("filterInvalidContent"),filterTransaction:()=>{var i;return this.storage.isDisabled!==!1&&((i=e.doc)==null||i.destroy()),!0}})].filter(Boolean)}}),Tu=id,Bn=t=>Array.from(t.entries()).map(([e,n])=>({clientId:e,...n.user})),Un=()=>null,ad=_.create({name:"collaborationCaret",priority:999,addOptions(){return{provider:null,user:{name:null,color:null},render:t=>{const e=document.createElement("span");e.classList.add("collaboration-carets__caret"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");return n.classList.add("collaboration-carets__label"),n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null),e.insertBefore(n,null),e},selectionRender:gr,onUpdate:Un}},onCreate(){if(this.options.onUpdate!==Un&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCaret.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-caret'),!this.options.provider)throw new Error('The "provider" option is required for the CollaborationCaret extension')},addStorage(){return{users:[]}},addCommands(){return{updateUser:t=>()=>(this.options.provider.awareness.setLocalStateField("user",t),!0),user:t=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-caret'),e.commands.updateUser(t))}},addProseMirrorPlugins(){return[Gc((this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=Bn(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=Bn(this.options.provider.awareness.states)}),this.options.provider.awareness),{cursorBuilder:this.options.render,selectionBuilder:this.options.selectionRender})]}}),Cu=ad,ld=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,cd=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,dd=J.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",A(this.options.HTMLAttributes,t),0]},renderMarkdown:(t,e)=>`==${e.renderChildren(t)}==`,parseMarkdown:(t,e)=>e.applyMark("highlight",e.parseInline(t.tokens||[])),markdownTokenizer:{name:"highlight",level:"inline",start:t=>t.indexOf("=="),tokenize(t,e,n){const r=/^(==)([^=]+)(==)/.exec(t);if(r){const o=r[2].trim(),i=n.inlineTokens(o);return{type:"highlight",raw:r[0],text:o,tokens:i}}}},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[dt({find:ld,type:this.type})]},addPasteRules(){return[ot({find:cd,type:this.type})]}}),Su=dd,ud=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,pd=N.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",A(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,s,r,o,i;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(r=(s=t.attrs)==null?void 0:s.alt)!=null?r:"",c=(i=(o=t.attrs)==null?void 0:o.title)!=null?i:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:s}=this.options.resize;return({node:r,getPos:o,HTMLAttributes:i,editor:a})=>{const l=document.createElement("img");Object.entries(i).forEach(([d,p])=>{if(p!=null)switch(d){case"width":case"height":break;default:l.setAttribute(d,p);break}}),l.src=i.src;const c=new Da({element:l,editor:a,node:r,getPos:o,onResize:(d,p)=>{l.style.width=`${d}px`,l.style.height=`${p}px`},onCommit:(d,p)=>{const h=o();h!==void 0&&this.editor.chain().setNodeSelection(h).updateAttributes(this.name,{width:d,height:p}).run()},onUpdate:(d,p,h)=>d.type===r.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:s===!0}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",l.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[Ks({find:ud,type:this.type,getAttributes:t=>{const[,,e,n,s]=t;return{src:n,alt:e,title:s}}})]}}),Au=pd;function hd(t){var e;const{char:n,allowSpaces:s,allowToIncludeChar:r,allowedPrefixes:o,startOfLine:i,$position:a}=t,l=s&&!r,c=Ba(n),u=new RegExp(`\\s${c}$`),d=i?"^":"",p=r?"":c,h=l?new RegExp(`${d}${c}.*?(?=\\s${p}|$)`,"gm"):new RegExp(`${d}(?:^)?${c}[^\\s${p}]*`,"gm"),f=((e=a.nodeBefore)==null?void 0:e.isText)&&a.nodeBefore.text;if(!f)return null;const m=a.pos-f.length,y=Array.from(f.matchAll(h)).pop();if(!y||y.input===void 0||y.index===void 0)return null;const g=y.input.slice(Math.max(0,y.index-1),y.index),v=new RegExp(`^[${o==null?void 0:o.join("")}\0]?$`).test(g);if(o!==null&&!v)return null;const b=m+y.index;let k=b+y[0].length;return l&&u.test(f.slice(k-1,k+1))&&(y[0]+=" ",k+=1),b<a.pos&&k>=a.pos?{range:{from:b,to:k},query:y[0].slice(n.length),text:y[0]}:null}var fd=new $("suggestion");function md({pluginKey:t=fd,editor:e,char:n="@",allowSpaces:s=!1,allowToIncludeChar:r=!1,allowedPrefixes:o=[" "],startOfLine:i=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:c="",decorationEmptyClass:u="is-empty",command:d=()=>null,items:p=()=>[],render:h=()=>({}),allow:f=()=>!0,findSuggestionMatch:m=hd,shouldShow:y}){let g;const v=h==null?void 0:h(),b=()=>{const x=e.state.selection.$anchor.pos,C=e.view.coordsAtPos(x),{top:S,right:P,bottom:E,left:R}=C;try{return new DOMRect(R,S,P-R,E-S)}catch{return null}},k=(x,C)=>C?()=>{const S=t.getState(e.state),P=S==null?void 0:S.decorationId,E=x.dom.querySelector(`[data-decoration-id="${P}"]`);return(E==null?void 0:E.getBoundingClientRect())||null}:b;function M(x,C){var S;try{const E=t.getState(x.state),R=E!=null&&E.decorationId?x.dom.querySelector(`[data-decoration-id="${E.decorationId}"]`):null,j={editor:e,range:(E==null?void 0:E.range)||{from:0,to:0},query:(E==null?void 0:E.query)||null,text:(E==null?void 0:E.text)||null,items:[],command:U=>d({editor:e,range:(E==null?void 0:E.range)||{from:0,to:0},props:U}),decorationNode:R,clientRect:k(x,R)};(S=v==null?void 0:v.onExit)==null||S.call(v,j)}catch{}const P=x.state.tr.setMeta(C,{exit:!0});x.dispatch(P)}const T=new O({key:t,view(){return{update:async(x,C)=>{var S,P,E,R,j,U,V;const L=(S=this.key)==null?void 0:S.getState(C),q=(P=this.key)==null?void 0:P.getState(x.state),F=L.active&&q.active&&L.range.from!==q.range.from,bt=!L.active&&q.active,Pt=L.active&&!q.active,kt=!bt&&!Pt&&L.query!==q.query,wt=bt||F&&kt,Ht=kt||F,de=Pt||F&&kt;if(!wt&&!Ht&&!de)return;const ht=de&&!wt?L:q,nn=x.dom.querySelector(`[data-decoration-id="${ht.decorationId}"]`);g={editor:e,range:ht.range,query:ht.query,text:ht.text,items:[],command:Mr=>d({editor:e,range:ht.range,props:Mr}),decorationNode:nn,clientRect:k(x,nn)},wt&&((E=v==null?void 0:v.onBeforeStart)==null||E.call(v,g)),Ht&&((R=v==null?void 0:v.onBeforeUpdate)==null||R.call(v,g)),(Ht||wt)&&(g.items=await p({editor:e,query:ht.query})),de&&((j=v==null?void 0:v.onExit)==null||j.call(v,g)),Ht&&((U=v==null?void 0:v.onUpdate)==null||U.call(v,g)),wt&&((V=v==null?void 0:v.onStart)==null||V.call(v,g))},destroy:()=>{var x;g&&((x=v==null?void 0:v.onExit)==null||x.call(v,g))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(x,C,S,P){const{isEditable:E}=e,{composing:R}=e.view,{selection:j}=x,{empty:U,from:V}=j,L={...C},q=x.getMeta(t);if(q&&q.exit)return L.active=!1,L.decorationId=null,L.range={from:0,to:0},L.query=null,L.text=null,L;if(L.composing=R,E&&(U||e.view.composing)){(V<C.range.from||V>C.range.to)&&!R&&!C.composing&&(L.active=!1);const F=m({char:n,allowSpaces:s,allowToIncludeChar:r,allowedPrefixes:o,startOfLine:i,$position:j.$from}),bt=`id_${Math.floor(Math.random()*4294967295)}`;F&&f({editor:e,state:P,range:F.range,isActive:C.active})&&(!y||y({editor:e,range:F.range,query:F.query,text:F.text,transaction:x}))?(L.active=!0,L.decorationId=C.decorationId?C.decorationId:bt,L.range=F.range,L.query=F.query,L.text=F.text):L.active=!1}else L.active=!1;return L.active||(L.decorationId=null,L.range={from:0,to:0},L.query=null,L.text=null),L}},props:{handleKeyDown(x,C){var S,P,E,R;const{active:j,range:U}=T.getState(x.state);if(!j)return!1;if(C.key==="Escape"||C.key==="Esc"){const L=T.getState(x.state),q=(S=g==null?void 0:g.decorationNode)!=null?S:null,F=q??(L!=null&&L.decorationId?x.dom.querySelector(`[data-decoration-id="${L.decorationId}"]`):null);if(((P=v==null?void 0:v.onKeyDown)==null?void 0:P.call(v,{view:x,event:C,range:L.range}))||!1)return!0;const Pt={editor:e,range:L.range,query:L.query,text:L.text,items:[],command:kt=>d({editor:e,range:L.range,props:kt}),decorationNode:F,clientRect:F?()=>F.getBoundingClientRect()||null:null};return(E=v==null?void 0:v.onExit)==null||E.call(v,Pt),M(x,t),!0}return((R=v==null?void 0:v.onKeyDown)==null?void 0:R.call(v,{view:x,event:C,range:U}))||!1},decorations(x){const{active:C,range:S,decorationId:P,query:E}=T.getState(x);if(!C)return null;const R=!(E!=null&&E.length),j=[l];return R&&j.push(u),Z.create(x.doc,[ct.inline(S.from,S.to,{nodeName:a,class:j.join(" "),"data-decoration-id":P,"data-decoration-content":c})])}}});return T}function gd({editor:t,overrideSuggestionOptions:e,extensionName:n,char:s="@"}){const r=new $;return{editor:t,char:s,pluginKey:r,command:({editor:o,range:i,props:a})=>{var l,c,u;const d=o.view.state.selection.$to.nodeAfter;((l=d==null?void 0:d.text)==null?void 0:l.startsWith(" "))&&(i.to+=1),o.chain().focus().insertContentAt(i,[{type:n,attrs:{...a,mentionSuggestionChar:s}},{type:"text",text:" "}]).run(),(u=(c=o.view.dom.ownerDocument.defaultView)==null?void 0:c.getSelection())==null||u.collapseToEnd()},allow:({state:o,range:i})=>{const a=o.doc.resolve(i.from),l=o.schema.nodes[n];return!!a.parent.type.contentMatch.matchType(l)},...e}}function br(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>gd({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function jn(t,e){const n=br(t),s=n.find(r=>r.char===e);return s||(n.length?n[0]:null)}N.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,s;return`${(n=e==null?void 0:e.char)!=null?n:"@"}${(s=t.attrs.label)!=null?s:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var s,r;return["span",A(this.HTMLAttributes,t.HTMLAttributes),`${(s=n==null?void 0:n.char)!=null?s:"@"}${(r=e.attrs.label)!=null?r:e.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=jn(this,t.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",A({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const s={...this.options};s.HTMLAttributes=A({"data-type":this.name},this.options.HTMLAttributes,e);const r=this.options.renderHTML({options:s,node:t,suggestion:n});return typeof r=="string"?["span",A({"data-type":this.name},this.options.HTMLAttributes,e),r]:r},...Qs({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:t=>{const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let s=n.exec(t);for(;s!==null;){const[,r,o,i]=s,a=o??i;e[r==="char"?"mentionSuggestionChar":r]=a,s=n.exec(t)}return e},serializeAttributes:t=>Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e==="mentionSuggestionChar"?"char":e}="${n}"`).join(" ")}),renderText({node:t}){const e={options:this.options,node:t,suggestion:jn(this,t.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:s}=e,{empty:r,anchor:o}=s;if(!r)return!1;let i=new He,a=0;return e.doc.nodesBetween(o-1,o,(l,c)=>{if(l.type.name===this.name)return n=!0,i=l,a=c,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":i.attrs.mentionSuggestionChar,a,a+i.nodeSize),n})}},addProseMirrorPlugins(){return br(this).map(md)}});var yd=J.create({name:"subscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sub"},{style:"vertical-align",getAttrs(t){return t!=="sub"?!1:null}}]},renderHTML({HTMLAttributes:t}){return["sub",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setSubscript:()=>({commands:t})=>t.setMark(this.name),toggleSubscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSubscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-,":()=>this.editor.commands.toggleSubscript()}}}),Eu=yd,vd=J.create({name:"superscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sup"},{style:"vertical-align",getAttrs(t){return t!=="super"?!1:null}}]},renderHTML({HTMLAttributes:t}){return["sup",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setSuperscript:()=>({commands:t})=>t.setMark(this.name),toggleSuperscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSuperscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-.":()=>this.editor.commands.toggleSuperscript()}}}),Lu=vd,bd=_.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).some(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).some(e=>e),toggleTextAlign:t=>({editor:e,commands:n})=>this.options.alignments.includes(t)?e.isActive({textAlign:t})?n.unsetTextAlign():n.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),_u=bd,kd=t=>D({find:/--$/,replace:t??"â"}),wd=t=>D({find:/\.\.\.$/,replace:t??"â¦"}),Md=t=>D({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:t??"â"}),xd=t=>D({find:/"$/,replace:t??"â"}),Td=t=>D({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:t??"â"}),Cd=t=>D({find:/'$/,replace:t??"â"}),Sd=t=>D({find:/<-$/,replace:t??"â"}),Ad=t=>D({find:/->$/,replace:t??"â"}),Ed=t=>D({find:/\(c\)$/,replace:t??"Â©"}),Ld=t=>D({find:/\(tm\)$/,replace:t??"â¢"}),_d=t=>D({find:/\(sm\)$/,replace:t??"â "}),Id=t=>D({find:/\(r\)$/,replace:t??"Â®"}),Od=t=>D({find:/(?:^|\s)(1\/2)\s$/,replace:t??"Â½"}),$d=t=>D({find:/\+\/-$/,replace:t??"Â±"}),Pd=t=>D({find:/!=$/,replace:t??"â "}),Hd=t=>D({find:/<<$/,replace:t??"Â«"}),Nd=t=>D({find:/>>$/,replace:t??"Â»"}),Rd=t=>D({find:/\d+\s?([*x])\s?\d+$/,replace:t??"Ã"}),Dd=t=>D({find:/\^2$/,replace:t??"Â²"}),zd=t=>D({find:/\^3$/,replace:t??"Â³"}),Bd=t=>D({find:/(?:^|\s)(1\/4)\s$/,replace:t??"Â¼"}),Ud=t=>D({find:/(?:^|\s)(3\/4)\s$/,replace:t??"Â¾"}),jd=_.create({name:"typography",addOptions(){return{closeDoubleQuote:"â",closeSingleQuote:"â",copyright:"Â©",ellipsis:"â¦",emDash:"â",laquo:"Â«",leftArrow:"â",multiplication:"Ã",notEqual:"â ",oneHalf:"Â½",oneQuarter:"Â¼",openDoubleQuote:"â",openSingleQuote:"â",plusMinus:"Â±",raquo:"Â»",registeredTrademark:"Â®",rightArrow:"â",servicemark:"â ",superscriptThree:"Â³",superscriptTwo:"Â²",threeQuarters:"Â¾",trademark:"â¢"}},addInputRules(){const t=[];return this.options.emDash!==!1&&t.push(kd(this.options.emDash)),this.options.ellipsis!==!1&&t.push(wd(this.options.ellipsis)),this.options.openDoubleQuote!==!1&&t.push(Md(this.options.openDoubleQuote)),this.options.closeDoubleQuote!==!1&&t.push(xd(this.options.closeDoubleQuote)),this.options.openSingleQuote!==!1&&t.push(Td(this.options.openSingleQuote)),this.options.closeSingleQuote!==!1&&t.push(Cd(this.options.closeSingleQuote)),this.options.leftArrow!==!1&&t.push(Sd(this.options.leftArrow)),this.options.rightArrow!==!1&&t.push(Ad(this.options.rightArrow)),this.options.copyright!==!1&&t.push(Ed(this.options.copyright)),this.options.trademark!==!1&&t.push(Ld(this.options.trademark)),this.options.servicemark!==!1&&t.push(_d(this.options.servicemark)),this.options.registeredTrademark!==!1&&t.push(Id(this.options.registeredTrademark)),this.options.oneHalf!==!1&&t.push(Od(this.options.oneHalf)),this.options.plusMinus!==!1&&t.push($d(this.options.plusMinus)),this.options.notEqual!==!1&&t.push(Pd(this.options.notEqual)),this.options.laquo!==!1&&t.push(Hd(this.options.laquo)),this.options.raquo!==!1&&t.push(Nd(this.options.raquo)),this.options.multiplication!==!1&&t.push(Rd(this.options.multiplication)),this.options.superscriptTwo!==!1&&t.push(Dd(this.options.superscriptTwo)),this.options.superscriptThree!==!1&&t.push(zd(this.options.superscriptThree)),this.options.oneQuarter!==!1&&t.push(Bd(this.options.oneQuarter)),this.options.threeQuarters!==!1&&t.push(Ud(this.options.threeQuarters)),t}}),Iu=jd;function Vd(t){const e=new Set,n=new Set;return t.forEach(s=>{e.has(s)?n.add(s):e.add(s)}),Array.from(n)}var Fd=_.create({name:"uniqueID",priority:1e4,addOptions(){return{attributeName:"id",types:[],generateID:()=>Vr(),filterTransaction:null,updateDocument:!0}},addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:t=>t.getAttribute(`data-${this.options.attributeName}`),renderHTML:t=>t[this.options.attributeName]?{[`data-${this.options.attributeName}`]:t[this.options.attributeName]}:{}}}}]},onCreate(){var t;if(!this.options.updateDocument)return;const e=this.editor.extensionManager.extensions.find(a=>a.name==="collaboration"),n=this.editor.extensionManager.extensions.find(a=>a.name==="collaborationCaret"),r=[e,n].filter(Boolean).find(a=>{var l;return(l=a==null?void 0:a.options)==null?void 0:l.provider}),o=(t=r==null?void 0:r.options)==null?void 0:t.provider,i=()=>{const{view:a,state:l}=this.editor,{tr:c,doc:u}=l,{types:d,attributeName:p,generateID:h}=this.options;st(u,m=>d.includes(m.type.name)&&m.attrs[p]===null).forEach(({node:m,pos:y})=>{c.setNodeMarkup(y,void 0,{...m.attrs,[p]:h({node:m,pos:y})})}),c.setMeta("addToHistory",!1),a.dispatch(c),o&&o.off("synced",i)};if(r){if(!o)return i();o.on("synced",i)}else return i()},addProseMirrorPlugins(){if(!this.options.updateDocument)return[];let t=null,e=!1;return[new O({key:new $("uniqueID"),appendTransaction:(n,s,r)=>{const o=n.some(m=>m.docChanged)&&!s.doc.eq(r.doc),i=this.options.filterTransaction&&n.some(m=>{var y,g;return!((g=(y=this.options).filterTransaction)!=null&&g.call(y,m))});if(n.find(m=>m.getMeta("y-sync$"))||!o||i)return;const{tr:l}=r,{types:c,attributeName:u,generateID:d}=this.options,p=Ue(s.doc,n),{mapping:h}=p;if(We(p).forEach(({newRange:m})=>{const y=vs(r.doc,m,v=>c.includes(v.type.name)),g=y.map(({node:v})=>v.attrs[u]).filter(v=>v!==null);y.forEach(({node:v,pos:b},k)=>{var M;const T=(M=l.doc.nodeAt(b))==null?void 0:M.attrs[u];if(T===null){l.setNodeMarkup(b,void 0,{...v.attrs,[u]:d({node:v,pos:b})});return}const x=y[k+1];if(x&&v.content.size===0){const E=l.doc.nodeAt(x.pos);if(E!=null&&E.attrs[u]&&E.attrs[u]!==T)return;l.setNodeMarkup(x.pos,void 0,{...x.node.attrs,[u]:T}),g[k+1]=T;const R=d({node:v,pos:b});return l.setNodeMarkup(b,void 0,{...v.attrs,[u]:R}),g[k]=R,l}const C=Vd(g),{deleted:S}=h.invert().mapResult(b);S&&C.includes(T)&&l.setNodeMarkup(b,void 0,{...v.attrs,[u]:d({node:v,pos:b})})})}),!!l.steps.length)return l.setStoredMarks(r.tr.storedMarks),l.setMeta("__uniqueIDTransaction",!0),l},view(n){const s=r=>{var o;t=(o=n.dom.parentElement)!=null&&o.contains(r.target)?n.dom.parentElement:null};return window.addEventListener("dragstart",s),{destroy(){window.removeEventListener("dragstart",s)}}},props:{handleDOMEvents:{drop:(n,s)=>{var r,o;return(t!==n.dom.parentElement||((r=s.dataTransfer)==null?void 0:r.effectAllowed)==="copyMove"||((o=s.dataTransfer)==null?void 0:o.effectAllowed)==="copy")&&(t=null,e=!0),!1},paste:()=>(e=!0,!1)},transformPasted:n=>{if(!e)return n;const{types:s,attributeName:r}=this.options,o=i=>{const a=[];return i.forEach(l=>{if(l.isText){a.push(l);return}if(!s.includes(l.type.name)){a.push(l.copy(o(l.content)));return}const c=l.type.create({...l.attrs,[r]:null},o(l.content),l.marks);a.push(c)}),W.from(a)};return e=!1,new ft(o(n.content),n.openStart,n.openEnd)}}})]}}),Ou=Fd,Wd=/https?:\/\/[^\s]+?\.(?:mp3|wav|ogg|oga|flac|m4a|aac|opus|weba|webm)(?:\?[^\s]*)?/gi,qd=/^data:audio\/[a-zA-Z0-9.+-]+;base64,/i,kr=(t,e=!1)=>{if(!t)return!1;if(e&&qd.test(t)||t.startsWith("//")||t.startsWith("/")||t.startsWith("./")||t.startsWith("../"))return!0;try{const n=new URL(t);return n.protocol==="http:"||n.protocol==="https:"}catch{return!1}},Kd=(t,e=!1)=>t&&kr(t,e)?t:null,Jd=N.create({name:"audio",addOptions(){return{addPasteHandler:!0,allowBase64:!1,autoplay:!1,controls:!0,loop:!1,muted:!1,preload:"metadata",controlslist:void 0,crossorigin:void 0,disableRemotePlayback:!1,HTMLAttributes:{},inline:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},atom:!0,draggable:!0,addAttributes(){return{src:{default:null},controls:{default:this.options.controls},autoplay:{default:this.options.autoplay},loop:{default:this.options.loop},muted:{default:this.options.muted},preload:{default:this.options.preload},controlslist:{default:this.options.controlslist},crossorigin:{default:this.options.crossorigin},disableremoteplayback:{default:this.options.disableRemotePlayback}}},parseHTML(){return[{tag:this.options.allowBase64?"audio[src]":'audio[src]:not([src^="data:"])'}]},addCommands(){return{setAudio:t=>({commands:e})=>kr(t.src,this.options.allowBase64)?e.insertContent({type:this.name,attrs:t}):!1}},addPasteRules(){return this.options.addPasteHandler?[qa({find:Wd,type:this.type,getAttributes:t=>({src:t[0]})})]:[]},renderHTML({HTMLAttributes:t}){const e=Kd(t.src,this.options.allowBase64),n=A(this.options.HTMLAttributes,{controls:this.options.controls,autoplay:this.options.autoplay,loop:this.options.loop,muted:this.options.muted,preload:this.options.preload,controlslist:this.options.controlslist,crossorigin:this.options.crossorigin,disableremoteplayback:this.options.disableRemotePlayback},{...t,src:e});return["audio",Object.fromEntries(Object.entries(n).filter(([,r])=>r!=null&&r!==!1))]},...Js({nodeName:"audio",allowedAttributes:["src","controls","autoplay","loop","muted","preload","controlslist","crossorigin","disableremoteplayback"]})}),$u=Jd;function wr(t,e=[]){return t.flatMap(n=>{const s=[...e,...n.properties?n.properties.className:[]];return n.children?wr(n.children,s):{text:n.value,classes:s}})}function Vn(t){return t.value||t.children||[]}function Qd(t){return!!Xo.getLanguage(t)}function Fn({doc:t,name:e,lowlight:n,defaultLanguage:s}){const r=[];return st(t,o=>o.type.name===e).forEach(o=>{var i;let a=o.pos+1;const l=o.node.attrs.language||s,c=n.listLanguages(),u=l&&(c.includes(l)||Qd(l)||(i=n.registered)!=null&&i.call(n,l))?Vn(n.highlight(l,o.node.textContent)):Vn(n.highlightAuto(o.node.textContent));wr(u).forEach(d=>{const p=a+d.text.length;if(d.classes.length){const h=ct.inline(a,p,{class:d.classes.join(" ")});r.push(h)}a=p})}),Z.create(t,r)}function Gd(t){return typeof t=="function"}function Yd({name:t,lowlight:e,defaultLanguage:n}){if(!["highlight","highlightAuto","listLanguages"].every(r=>Gd(e[r])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");const s=new O({key:new $("lowlight"),state:{init:(r,{doc:o})=>Fn({doc:o,name:t,lowlight:e,defaultLanguage:n}),apply:(r,o,i,a)=>{const l=i.selection.$head.parent.type.name,c=a.selection.$head.parent.type.name,u=st(i.doc,p=>p.type.name===t),d=st(a.doc,p=>p.type.name===t);return r.docChanged&&([l,c].includes(t)||d.length!==u.length||r.steps.some(p=>p.from!==void 0&&p.to!==void 0&&u.some(h=>h.pos>=p.from&&h.pos+h.node.nodeSize<=p.to)))?Fn({doc:r.doc,name:t,lowlight:e,defaultLanguage:n}):o.map(r.mapping,r.doc)}},props:{decorations(r){return s.getState(r)}}});return s}var Xd=Ys.extend({addOptions(){var t;return{...(t=this.parent)==null?void 0:t.call(this),lowlight:{},languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},addProseMirrorPlugins(){var t;return[...((t=this.parent)==null?void 0:t.call(this))||[],Yd({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),Pu=Xd;export{gu as $,au as A,Xl as B,lu as C,ku as D,_ as E,bu as F,nc as G,wu as H,pt as I,Mu as J,Ou as K,mu as L,Iu as M,N,mc as O,_u as P,$l as Q,Da as R,Lu as S,pc as T,Eu as U,uu as V,xu as W,Zl as X,Au as Y,Su as Z,vc as _,ru as a,yc as a0,Cu as a1,Tu as a2,gc as a3,Ja as a4,I as b,ic as c,w as d,Ba as e,bs as f,Ki as g,$u as h,pu as i,Pu as j,hu as k,fu as l,A as m,Ks as n,tc as o,ec as p,ze as q,iu as r,Na as s,vu as t,cu as u,Ka as v,gt as w,du as x,Be as y,yu as z};
